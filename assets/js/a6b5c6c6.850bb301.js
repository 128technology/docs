"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[3005],{69429:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var r=i(74848),t=i(28453);const s={title:"Configuring DSCP Steering",sidebar_label:"Configuring DSCP Steering"},o=void 0,c={id:"config_dscp_steering",title:"Configuring DSCP Steering",description:"Version History",source:"@site/docs/config_dscp_steering.md",sourceDirName:".",slug:"/config_dscp_steering",permalink:"/docs/config_dscp_steering",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Configuring DSCP Steering",sidebar_label:"Configuring DSCP Steering"},sidebar:"docs",previous:{title:"Asset Connection Resiliency",permalink:"/docs/config_asset_connection_resiliency"},next:{title:"DSCP Preservation",permalink:"/docs/config_dscp_preservation"}},a={},l=[{value:"Version History",id:"version-history",level:4},{value:"Basic Configuration",id:"basic-configuration",level:2},{value:"Example Config",id:"example-config",level:4},{value:"How It Works",id:"how-it-works",level:2},{value:"Network Interface Configuration",id:"network-interface-configuration",level:3},{value:"Service Configuration",id:"service-configuration",level:3},{value:"DSCP Steering Using GTP",id:"dscp-steering-using-gtp",level:3},{value:"Service Route Configuration",id:"service-route-configuration",level:3},{value:"Restrictions",id:"restrictions",level:3},{value:"GUI Configuration Screens",id:"gui-configuration-screens",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h4,{id:"version-history",children:"Version History"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Release"}),(0,r.jsx)(n.th,{children:"Modification"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"5.4.4"}),(0,r.jsx)(n.td,{children:"DSCP Steering Introduced"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"6.1.4"}),(0,r.jsx)(n.td,{children:"Enabled DSCP steering for BGP over SVR tunnels"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"7.1.0"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.a,{href:"#dscp-steering-using-gtp",children:"Support added for steering Non-IPSEC tunnels"})," (GTP)"]})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"When traffic is traversing an IPSec encrypted tunnel, every flow within that tunnel shares the same layer 3 headers, making them difficult to identify."}),"\n",(0,r.jsx)(n.p,{children:"To provide identification and aid in load balancing and traffic engineering, DSCP values can be set at the tunnel endpoint. When the traffic reaches the SSR, the DSCP value is used for both traffic engineering priority and path priority for DSCP traffic steering."}),"\n",(0,r.jsxs)(n.p,{children:["Beginning with SSR version 6.1.4, DSCP Steering is enabled for BGP over SVR tunnels. Using the configuration below, and ",(0,r.jsx)(n.a,{href:"/docs/config_bgp#bgp-over-svr-bgposvr",children:"configuring BGP over SVR"}),", the child service configured for DSCP steering is now recognized and steered appropriately."]}),"\n",(0,r.jsx)(n.p,{children:"With SSR version 7.1.0, the restriction for matching ports has been lifted. The match criteria for incoming packets only requires the destination port to match the given configuration. IPSec tunnels continue to be supported. Steering for new tunnels such as GPRS Tunnel Protocol (GTP), which uses a well-defined destination port and optionally randomized source ports, is supported."}),"\n",(0,r.jsx)(n.h2,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Configure the ingress interface for ",(0,r.jsx)(n.code,{children:"dscp-steering"})]}),"\n",(0,r.jsx)(n.li,{children:"Configure a parent service that matches the traffic profile of the tunnel"}),"\n",(0,r.jsxs)(n.li,{children:["Configure a child service that defines the ",(0,r.jsx)(n.code,{children:"dscp-range"})," to steer"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["When configuring DSCP steering, it is important to have all possible DSCP values (0-63) configured over the collective child services that share a parent. Omitting a value can lead to a scenario where traffic that is marked for DSCP steering, but has no corresponding steering configuration, results in a ",(0,r.jsx)(n.code,{children:"No ServicePaths available"})," error."]}),(0,r.jsxs)(n.p,{children:["For example; The DSCP value range is 0-63. Let's say there are two child services configured; ",(0,r.jsx)(n.code,{children:"child service1"})," has a range of 1-32. ",(0,r.jsx)(n.code,{children:"child service2"})," covers 33-63. In this configuration, ",(0,r.jsx)(n.code,{children:"0"})," is not a configured value. If traffic enters with a DSCP value of ",(0,r.jsx)(n.code,{children:"0"}),", there is no steering configuration for ",(0,r.jsx)(n.code,{children:"0"}),", and it results in a ",(0,r.jsx)(n.code,{children:"No ServicePaths available"})," error."]})]}),"\n",(0,r.jsx)(n.h4,{id:"example-config",children:"Example Config"}),"\n",(0,r.jsxs)(n.p,{children:["Configure the ",(0,r.jsx)(n.code,{children:"network-interface"})," for ",(0,r.jsx)(n.code,{children:"dcsp-steering"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"network-interface foo\n    name foo\n    global-id 12\n    vlan 0\n    dscp-steering\n        enabled true\n        transport\n            protocol udp\n            port-range\n                start-port 4500\n            exit\n        exit\n    exit\nexit     \n"})}),"\n",(0,r.jsx)(n.p,{children:"Configure the parent service for the tunnel:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'service          tunnel\n    name           tunnel\n    description    "IPSec Tunnel"\n    scope          public\n    security       internal\n    address        5.5.5.100/0\n    access-policy  red\n        source      red\n        permission  allow\n    exit\nexit\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Configure the child service with the ",(0,r.jsx)(n.code,{children:"dscp-range"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'service          high-priority.tunnel\n    name           high-priority.tunnel\n    description    "The high priority traffic within this tunnel"\n    scope          public\n    security       internal\n    dscp-range     14\n        start-value 14\n    exit\nexit\n'})}),"\n",(0,r.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsxs)(n.p,{children:["DSCP traffic steering is configured on the ",(0,r.jsx)(n.code,{children:"network-interface"})," to identify the protocol and port, and the ",(0,r.jsx)(n.code,{children:"service"}),", to identify the DSCP values used to steer the traffic."]}),"\n",(0,r.jsx)(n.h3,{id:"network-interface-configuration",children:"Network Interface Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Configuring ",(0,r.jsx)(n.code,{children:"dscp-steering"})," at the network-interface level focuses DSCP traffic steering on a specific transport protocol and port range, rather than an entire interface."]}),"\n",(0,r.jsxs)(n.p,{children:["Only traffic matching the ",(0,r.jsx)(n.code,{children:"dscp-steering"})," properties configured on the ",(0,r.jsx)(n.code,{children:"network-interface"})," and in the ",(0,r.jsx)(n.code,{children:"service"})," is steered using DSCP. Other traffic is handled according to the relevant configuration."]}),"\n",(0,r.jsx)(n.p,{children:"The following example is designed to target IPSec NAT traversal traffic which is typically UDP, with a destination port 4500."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"network-interface foo\n    name foo\n    global-id 12\n    vlan 0\n    dscp-steering\n        enabled true\n        transport\n            protocol udp\n            port-range\n                start-port 4500\n            exit\n        exit\n    exit\nexit     \n"})}),"\n",(0,r.jsx)(n.p,{children:"When steering ESP traffic, ports are not specified. For example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"network-interface foo\n    name foo\n    global-id 12\n    vlan 0\n    dscp-steering\n        enabled true\n        transport\n            protocol esp\n            exit\n        exit\n    exit\nexit   \n"})}),"\n",(0,r.jsx)(n.h3,{id:"service-configuration",children:"Service Configuration"}),"\n",(0,r.jsx)(n.p,{children:"A DSCP value and range is configured for a child service; this identifies the priority and handling of the traffic at the router. DSCP aware services are configured in a hierarchy; DSCP values are not configured on the parent service."}),"\n",(0,r.jsxs)(n.p,{children:["The following example configuration splits the tunnel across 3 services. Traffic with ",(0,r.jsx)(n.code,{children:"dscp-range"})," value 14 is handled by the high-priority service; traffic with ",(0,r.jsx)(n.code,{children:"dscp-range"})," values from 26 to 28 is handled by the low-priority service. The remaining traffic falls back into the parent tunnel service."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'service          tunnel\n    name           tunnel\n    description    "IPSec Tunnel"\n    scope          public\n    security       internal\n    address        5.5.5.100/0\n    access-policy  red\n        source      red\n        permission  allow\n    exit\nexit\n\nservice          high-priority.tunnel\n    name           high-priority.tunnel\n    description    "The high priority traffic within this tunnel"\n    scope          public\n    security       internal\n    dscp-range     14\n        start-value 14\n    exit\nexit\n\nservice          low-priority.tunnel\n    name           low-priority.tunnel\n    description    "The low priority traffic within this tunnel"\n    scope          public\n    security       internal\n    dscp-range     26\n        start-value 26\n        end-value   28\n    exit\nexit\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"dscp-steering-using-gtp",children:"DSCP Steering Using GTP"}),"\n",(0,r.jsx)(n.p,{children:"While the configuration for DSCP steering using a GTP tunnel is nearly identical to the IPSec configuration, there are some restrictions."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Configuring ",(0,r.jsx)(n.code,{children:"dscp-steering"})," at the network-interface level supports several port ranges, but only a single protocol. For example, it is not currently possible to perform steering for both TCP and UDP at the same time."]}),"\n",(0,r.jsx)(n.li,{children:"The tunneled packets must either be an ESP packet or have a valid L4 header that accurately describes the tunnel endpoint."}),"\n",(0,r.jsx)(n.li,{children:"The listed protocol on the SSR session/flow keys will report ESP, even when not within an IPSec tunnel."}),"\n",(0,r.jsx)(n.li,{children:"The egress LAN must also have a DSCP Steering configuration enabled to support proper classification of reverse traffic."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"In the following example, the receiver endpoint is at IP 2.2.2.2 at UDP port 2152. The initial packet entering the SSR will match against this service via the SSR\u2019s FIB."}),"\n",(0,r.jsx)(n.p,{children:"The tunnel is then further broken down into three DSCP ranges and assigned to child services. The SSR refines down to the appropriate child service based on the DSCP marking of the incoming packet. As with hierarchical services in general, a different service-policy may be defined on the child services, otherwise the parent policy will be inherited."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"authority\n\n   service tunnel\n      description \u201cDescribes the properties of the tunnel endpoint receiver\u201d\n      address 2.2.2.2\n\n      transport udp\n         protocol udp\n         port-range 2152\n            start-port 2152\n         exit\n      exit\n\n      access-policy lan\n         source lan\n         permission allow\n      exit\n   exit\n\n   service low.tunnel\n      dscp-range 0\n         start-value 0\n         end-value 15\n      exit\n   exit\n\n   service med.tunnel\n      dscp-range 16\n         start-value 16\n         end-value 40\n      exit\n   exit\n\n   service high.tunnel\n      dscp-range 41\n         start-value 41\n         end-value 63\n      exit\n   exit\n\nexit\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"If the destination port is not found, the source-port of the packet is checked against the configured element. If the source-port is identified, then it is treated as a reverse dscp-steering packet."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"gtp config",src:i(12667).A+"",width:"1322",height:"732"})}),"\n",(0,r.jsxs)(n.p,{children:["On the reverse flow, the packet will not match any configuration for the randomly generated port ",(0,r.jsx)(n.code,{children:"12345"}),". Because it does match the source-port of ",(0,r.jsx)(n.code,{children:"2152"}),", it is treated as a reverse tunnel packet."]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["The diagram above shows a DSCP value of 10 on both the forward and reverse flows. This assigns steering to the ",(0,r.jsx)(n.code,{children:"service low.tunnel"})," configured above."]})}),"\n",(0,r.jsx)(n.h3,{id:"service-route-configuration",children:"Service Route Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["DSCP steering follows the SSR's ",(0,r.jsx)(n.a,{href:"/docs/bcp_service_and_service_policy_design#hierarchical-services",children:"Hierarchical Services"})," model. As such, service-route configurations from the parent tunnel service are available to the child DSCP services. Flows may be steered via DSCP value by defining a service-route configuration for the child DSCP services."]}),"\n",(0,r.jsx)(n.p,{children:"When no service-route configuration is applied, the RIB will be followed for routing purposes."}),"\n",(0,r.jsxs)(n.p,{children:["If a ",(0,r.jsx)(n.code,{children:"service-route"})," is configured on the parent service, that route is inherited by the child service. This will prevent routing lookup for the child DSCP services."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"In versions 6.2.7 and below, or version 6.3.0, if you did not configure a service-route for the parent or child services, the system would only consider BGP over SVR routes from the RIB. In versions beginning with 6.2.8 and 6.3.3-r2, if a service route is not configured on the parent or child services, all routes available to the RIB are considered; connected routes, static routes, routes from BGP neighbors (not just BGP over SVR neighbors), and OSPF routes."})}),"\n",(0,r.jsx)(n.h3,{id:"restrictions",children:"Restrictions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The DSCP steering transport list for a ",(0,r.jsx)(n.code,{children:"network-interface"})," is limited to one range."]}),"\n",(0,r.jsxs)(n.li,{children:["Any service with a ",(0,r.jsx)(n.code,{children:"dscp-range"})," configuration must be a child service."]}),"\n",(0,r.jsx)(n.li,{children:"DSCP steering ranges must not overlap."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"gui-configuration-screens",children:"GUI Configuration Screens"}),"\n",(0,r.jsx)(n.p,{children:"The following screens demonstrate configuring DSCP steering on the network interface using the GUI."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Enable DSCP Steering, and select the DSCP Steering Transport button."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"DSCP Steering button",src:i(10776).A+"",width:"640",height:"568"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Select a protocol."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"DSCP Steering Info",src:i(56531).A+"",width:"557",height:"414"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Enter the port or port range."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"DSCP Steering Port Ranges",src:i(17674).A+"",width:"608",height:"540"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"Select Validate and Commit."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"DSCP Steering Transport Validate",src:i(84549).A+"",width:"644",height:"381"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},12667:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/dscp-steering-gtp-4cfe97cae7c3bd3435017b69fad4930e.png"},10776:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/dscp_steering1-63dfa27514d583d66d5c2cb56f1f4e16.png"},56531:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/dscp_steering2-5d9b3136792e93ad775db1cfc11a633b.png"},17674:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/dscp_steering3-45849ab6fccf6dc93e39ae70f125617b.png"},84549:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/dscp_steering4-f38c0fd82cfa623811402e7d21230b71.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var r=i(96540);const t={},s=r.createContext(t);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);