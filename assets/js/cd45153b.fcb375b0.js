"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[6986],{1534:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var t=i(74848),s=i(28453);const o={title:"Dynamic Ingress Source NAT",sidebar_label:"Dynamic Ingress Source NAT"},r=void 0,a={id:"config_dnat",title:"Dynamic Ingress Source NAT",description:"Dynamic Source NAT translates multiple source IP addresses into a smaller pool of translated addresses and dynamic ports, which conserves public IP address space and provides the flexibility to source NAT a specific IP range. This supports scaling up sessions for an internal service. For example, in a corporate office with a SIP phone service where all phones have different IPs on port 5060, these internal IP addresses are source NAT\u2019ed to a single external IP address.",source:"@site/docs/config_dnat.md",sourceDirName:".",slug:"/config_dnat",permalink:"/docs/config_dnat",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Dynamic Ingress Source NAT",sidebar_label:"Dynamic Ingress Source NAT"},sidebar:"docs",previous:{title:"Static Bi-directional NAT",permalink:"/docs/config_static_nat"},next:{title:"NAT Pools",permalink:"/docs/config_nat_pools"}},c={},d=[{value:"Configuration",id:"configuration",level:2},{value:"Sample PCLI Configuration",id:"sample-pcli-configuration",level:3},{value:"Sample GUI Configuration:",id:"sample-gui-configuration",level:3},{value:"Configuration Commands",id:"configuration-commands",level:3},{value:"Show Commands",id:"show-commands",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Dynamic Source NAT translates multiple source IP addresses into a smaller pool of translated addresses and dynamic ports, which conserves public IP address space and provides the flexibility to source NAT a specific IP range. This supports scaling up sessions for an internal service. For example, in a corporate office with a SIP phone service where all phones have different IPs on port 5060, these internal IP addresses are source NAT\u2019ed to a single external IP address."}),"\n",(0,t.jsxs)(n.p,{children:["Dynamic Source NAT may also provide solutions for IP address conflicts, but the IP mapping is not one-to-one and does NOT provide destination NAT in the reverse direction. To facilitate the destination NAT mapping for network connections from the external client to the internal client, use ",(0,t.jsx)(n.a,{href:"/docs/config_static_nat",children:(0,t.jsx)(n.code,{children:"bidirectional-nat"})}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Consider the following scenario, similar to the Static NAT example focusing on a company acquisition, where the ",(0,t.jsx)(n.code,{children:"spk-lan2"})," network is overlapping and not routable in ",(0,t.jsx)(n.code,{children:"Corp"})," and ",(0,t.jsx)(n.code,{children:"Internet"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Static Nat Diagram",src:i(53532).A+"",width:"488",height:"948"})}),"\n",(0,t.jsxs)(n.p,{children:["The Dynamic Source NAT challenge is illustrated in scenarios #2 and #4 below, where multiple clients of IP subnet 192.168.1.0/24, from ",(0,t.jsx)(n.code,{children:"spk-lan2"})," are running same application on port 1111, but given only one IP address, 172.16.128.10, to source NAT out."]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Scenario"}),(0,t.jsx)(n.th,{children:"Source"}),(0,t.jsx)(n.th,{children:"Destination"}),(0,t.jsx)(n.th,{children:"Translation Required"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2"}),(0,t.jsxs)(n.td,{children:["192.168.1.10:1111 @ spk-lan2",(0,t.jsx)("br",{})," 192.168.1.11:1111 @ spk-lan2"]}),(0,t.jsxs)(n.td,{children:["10.10.10.10",":xxxx"," @ hub-lan1"]}),(0,t.jsxs)(n.td,{children:["172.16.128.10:1653 -> 10.10.10.10",":xxxx"," ",(0,t.jsx)("br",{})," 172.16.128.10:1654 -> 10.10.10.10",":xxxx"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"4"}),(0,t.jsxs)(n.td,{children:["192.168.1.10:1111 @ spk-lan2",(0,t.jsx)("br",{})," 192.168.1.11:1111 @ spk-lan2"]}),(0,t.jsx)(n.td,{children:"172.16.129.10:* @spk-lan1"}),(0,t.jsxs)(n.td,{children:["172.16.128.10:1653 -> 172.16.129.10",":xxxx"," ",(0,t.jsx)("br",{})," 172.16.128.10:1654 -> 172.16.129.10",":xxxx"]})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["By applying Dynamic Source NAT configuration to the ",(0,t.jsx)(n.code,{children:"spk-lan2"})," interface, the ",(0,t.jsx)(n.code,{children:"192.168.1.0/24"})," subnet can be mapped to the single IP address and subnet ",(0,t.jsx)(n.code,{children:"172.16.128.10/32"}),", with dynamically allocated ports. This allows the SSR to dynamically build a many-to-one source NAT mapping."]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.p,{children:"In scenario #2, sessions from an application using port 1111 are initiated from multiple clients of the spk-lan2 interface, to a client of hub-lan1 on 10.10.10.10. The first client at host 192.168.1.10 and port 1111 is assigned a source NAT of 172.16.128.10:1653 where port 1653 is allocated dynamically. The second client at 192.168.1.11 with port 1111 is allocated a dynamic source NAT of 172.16.128.10:1654."}),"\n",(0,t.jsxs)(n.p,{children:["Scenario #4 is similar, except the target connections are to the client at the ",(0,t.jsx)(n.code,{children:"spk-lan1"})," interface using 172.16.129.10  which has been mapped by Static NAT. The same Dynamic Source NAT processes from Senario #2 are applied here."]}),"\n",(0,t.jsxs)(n.p,{children:["The following is the router configuration for both the above use cases. Packets going through ",(0,t.jsx)(n.code,{children:"spk-lan2"})," within the 192.168.1.0/24 domain will be source-natted to 172.16.128.10/32."]}),"\n",(0,t.jsx)(n.h3,{id:"sample-pcli-configuration",children:"Sample PCLI Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"config\n    authority\n         router  spoke\n            node  node1-spoke\n                device-interface  spk-lan2\n                    network-interface  spk-lan2\n                        dynamic-source-nat  192.168.1.0/24\n                            local-ip   192.168.1.0/24\n                            remote-ip  172.16.128.10/32\n                        exit\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit \n"})}),"\n",(0,t.jsx)(n.h3,{id:"sample-gui-configuration",children:"Sample GUI Configuration:"}),"\n",(0,t.jsx)(n.p,{children:"Network Interface Configuration"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Network Interface configuration",src:i(95983).A+"",width:"474",height:"115"})}),"\n",(0,t.jsx)(n.p,{children:"Dynamic Source NAT Configuration"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Dynamic Source NAT Configuration",src:i(61419).A+"",width:"474",height:"129"})}),"\n",(0,t.jsx)(n.h3,{id:"configuration-commands",children:"Configuration Commands"}),"\n",(0,t.jsx)(n.p,{children:"Dynamic Source NAT is configured from the network-interface using the following commands:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"/docs/config_command_guide#configure-authority-router-node-device-interface-network-interface-dynamic-source-nat",children:(0,t.jsx)(n.code,{children:"dynamic-source-nat"})}),": Defines the prefixes that need to be dynamically source natted for packets ingressing this interface."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/config_command_guide#configure-authority-router-node-device-interface-network-interface-dynamic-source-nat-local-ip",children:(0,t.jsx)(n.code,{children:"local-ip"})}),": For packets ingressing this interface, the IP that is source NAT'ed to the ",(0,t.jsx)(n.code,{children:"remote-ip"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/config_command_guide#configure-authority-router-node-device-interface-network-interface-dynamic-source-nat-remote-ip",children:(0,t.jsx)(n.code,{children:"remote-ip"})}),": For packets ingressing this interface, the IP where the ",(0,t.jsx)(n.code,{children:"local-ip"})," will be source NAT'ed. ",(0,t.jsx)(n.code,{children:"remote-ip"})," must use the /32 prefix."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"show-commands",children:"Show Commands"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-network-interface-source-nat-rules",children:(0,t.jsx)(n.code,{children:"show network-interface source-nat-rules"})})," can be run from the router or the conductor to display brief or detailed information for NAT configurations. Please see the ",(0,t.jsx)(n.a,{href:"/docs/ts_nat_troubleshooting",children:"NAT Troubleshooting"})," pages for information about the ",(0,t.jsx)(n.code,{children:"source-nat-rules"})," subcommand."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},61419:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/dnat_gui_config-8c3aadf5e0127ab3cacb23e5754d8d17.png"},95983:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/dnat_net-intf_gui_config-18afd902edb710e3632f72698500ba38.png"},53532:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/static_nat_example-29a76f18237ff4aaafc180c1ca333294.png"},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(96540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);