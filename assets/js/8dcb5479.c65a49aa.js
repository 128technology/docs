"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[4711],{37116:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var n=i(74848),s=i(28453);const r={title:"Adding a Trusted Certificate",sidebar_label:"Adding a Trusted Certificate"},c=void 0,o={id:"howto_trusted_ca_certificate",title:"Adding a Trusted Certificate",description:"Any Linux system hosting SSR comes with public certificates of common public Certificate Authorities (CA) already loaded. This allows them to trust end host certificates signed by these CAs, or signed by designated signing authorities in a chain of trust back to the CAs, right out of the box.",source:"@site/docs/howto_trusted_ca_certificate.md",sourceDirName:".",slug:"/howto_trusted_ca_certificate",permalink:"/docs/howto_trusted_ca_certificate",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1710456059,formattedLastUpdatedAt:"Mar 14, 2024",frontMatter:{title:"Adding a Trusted Certificate",sidebar_label:"Adding a Trusted Certificate"},sidebar:"docs",previous:{title:"Microsoft 365",permalink:"/docs/howto_ms365"},next:{title:"Application Troubleshooting",permalink:"/docs/ts_applications"}},a={},d=[{value:"Example Scenario",id:"example-scenario",level:2},{value:"Automation of CA Certificate Installation Using Salt",id:"automation-of-ca-certificate-installation-using-salt",level:2}];function h(e){const t={code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"Any Linux system hosting SSR comes with public certificates of common public Certificate Authorities (CA) already loaded. This allows them to trust end host certificates signed by these CAs, or signed by designated signing authorities in a chain of trust back to the CAs, right out of the box."}),"\n",(0,n.jsx)(t.p,{children:"However, many enterprises or service providers operate their own CA with no tie to public CA infrastructure. Should the SSR host need to connect to servers using certificates signed by these private CAs, the system will need to have the private CA's certificates installed as a trusted certificate authority."}),"\n",(0,n.jsx)(t.p,{children:"An example of this is an SSR host configured for LDAP over SSL, which must connect to an LDAP server that is using a host certificate signed by the private CA. If the SSR host is to trust the server when it opens a connection, it will require that it can has the private CA certificate, and any intermediate signing CA certificates."}),"\n",(0,n.jsx)(t.h2,{id:"example-scenario",children:"Example Scenario"}),"\n",(0,n.jsx)(t.p,{children:"Let's say our enterprise has a private certificate authority consisting of a root CA which delegates signing authority to a subordinate signing CA, and the signing CA signs end host certificates which are to be trusted."}),"\n",(0,n.jsx)(t.p,{children:"The public certificate of the root CA in PEM form looks like:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"-----BEGIN CERTIFICATE-----\nMIIDxjCCAq6gAwIBAgIBATANBgkqhkiG9w0BAQUFADB0MRMwEQYKCZImiZPyLGQB\n...root CA contents...\nEvWDvU72qH7pfC7TMeuvTOhnBmGsY/0RZnVbzG3SvE5/ZfWhjBK1MegQeHKVvZjl\nEz9VDlefIZwjSA==\n-----END CERTIFICATE-----\n"})}),"\n",(0,n.jsx)(t.p,{children:"The public certificate of the signing CA in PEM form looks like:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"-----BEGIN CERTIFICATE-----\nMIIDzzCCAregAwIBAgIBAjANBgkqhkiG9w0BAQUFADB0MRMwEQYKCZImiZPyLGQB\n...signing CA contents...\nNB7FEenRXO+vevj0PVVaxJUNyJEqfQwTyH0GaQD3VlGXJheyMCzpW9Gx76aBOXz0\nEyuS5Hop+ONX7G3qPTv8gQc8EQ==\n-----END CERTIFICATE-----\n"})}),"\n",(0,n.jsxs)(t.p,{children:["To load these on an SSR host, place the PEM formatted public key contents in ",(0,n.jsx)(t.code,{children:"/etc/pki/ca-trust/source/anchors/"}),". For this example the root CA public certificate would be saved to ",(0,n.jsx)(t.code,{children:"/etc/pki/ca-trust/source/anchors/myenterprise-root-ca.crt"}),", and the signing CA public certificate would be saved to ",(0,n.jsx)(t.code,{children:"/etc/pki/ca-trust/source/anchors/myenterprise-signing-ca.crt"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["With the public certificate saved, run ",(0,n.jsx)(t.code,{children:"sudo update-ca-trust"})," for the system to process and recognize them as trusted CA certificates."]}),"\n",(0,n.jsx)(t.h2,{id:"automation-of-ca-certificate-installation-using-salt",children:"Automation of CA Certificate Installation Using Salt"}),"\n",(0,n.jsx)(t.p,{children:"If you have a deployment of many SSR nodes which must all be loaded with private CA certificates, you can automate the distribution of the certificates using salt."}),"\n",(0,n.jsxs)(t.p,{children:["For example, the salt state ",(0,n.jsx)(t.code,{children:"/srv/salt/trusted-ca-certificates.sls"})," with contents below would install the certificate as previously described:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"myenterprise root ca:\n  file.managed:\n    - name: /etc/pki/ca-trust/source/anchors/myenterprise-root-ca.crt\n    - contents: |\n        -----BEGIN CERTIFICATE-----\n        MIIDxjCCAq6gAwIBAgIBATANBgkqhkiG9w0BAQUFADB0MRMwEQYKCZImiZPyLGQB\n        ...root CA contents...\n        EvWDvU72qH7pfC7TMeuvTOhnBmGsY/0RZnVbzG3SvE5/ZfWhjBK1MegQeHKVvZjl\n        Ez9VDlefIZwjSA==\n        -----END CERTIFICATE-----\n\nmyenterprise signing ca:\n  file.managed:\n    - name: /etc/pki/ca-trust/source/anchors/myenterprise-signing-ca.crt\n    - contents: |\n        -----BEGIN CERTIFICATE-----\n        MIIDzzCCAregAwIBAgIBAjANBgkqhkiG9w0BAQUFADB0MRMwEQYKCZImiZPyLGQB\n        ...signing CA contents...\n        NB7FEenRXO+vevj0PVVaxJUNyJEqfQwTyH0GaQD3VlGXJheyMCzpW9Gx76aBOXz0\n        EyuS5Hop+ONX7G3qPTv8gQc8EQ==\n        -----END CERTIFICATE-----\n\nupdate ca trust:\n  cmd.run:\n   - name: 'update-ca-trust'\n   - onchanges_any:\n     - file: /etc/pki/ca-trust/source/anchors/myenterprise-signing-ca.crt\n     - file: /etc/pki/ca-trust/source/anchors/myenterprise-root-ca.crt\n"})})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},28453:(e,t,i)=>{i.d(t,{R:()=>c,x:()=>o});var n=i(96540);const s={},r=n.createContext(s);function c(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);