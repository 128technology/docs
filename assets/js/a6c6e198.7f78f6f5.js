"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[4744],{12618:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var i=n(74848),r=n(28453);const s={title:"Configuring In-Memory Metrics",sidebar_label:"In-Memory Metrics"},o=void 0,a={id:"config_in-memory_metrics",title:"Configuring In-Memory Metrics",description:"Support for persisting in-memory SSR metrics allows historical access to longer term system measurements. The feature also provides greater control over which combinations of those in-memory metrics are persisted and for how long.",source:"@site/docs/config_in-memory_metrics.md",sourceDirName:".",slug:"/config_in-memory_metrics",permalink:"/docs/config_in-memory_metrics",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1710958440,formattedLastUpdatedAt:"Mar 20, 2024",frontMatter:{title:"Configuring In-Memory Metrics",sidebar_label:"In-Memory Metrics"},sidebar:"docs",previous:{title:"Native GRE Tunnels",permalink:"/docs/config_gre_tunnel"},next:{title:"NAT",permalink:"/docs/config_nat"}},l={},c=[{value:"Metrics Profile",id:"metrics-profile",level:2},{value:"Metrics",id:"metrics",level:3},{value:"Filters",id:"filters",level:3},{value:"Profile References",id:"profile-references",level:3},{value:"Profile Retention",id:"profile-retention",level:3},{value:"Example Profile",id:"example-profile",level:4},{value:"In-Memory Metrics Sample Configuration",id:"in-memory-metrics-sample-configuration",level:3}];function d(e){const t={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Support for persisting in-memory SSR metrics allows historical access to longer term system measurements. The feature also provides greater control over which combinations of those in-memory metrics are persisted and for how long."}),"\n",(0,i.jsx)(t.h2,{id:"metrics-profile",children:"Metrics Profile"}),"\n",(0,i.jsx)(t.p,{children:"To use In-Memory Metrics, specify the metrics intended for persistence as part of a Metrics Profile. Profiles are configured at the Authority level and referenced by the relevant routers. Each Profile specifies a number of metrics and the desired parameter filters."}),"\n",(0,i.jsx)(t.h3,{id:"metrics",children:"Metrics"}),"\n",(0,i.jsx)(t.p,{children:"An individual metric indicates one SSR metric to be part of the profile. Each profile must contain at least one metric to be valid. The metric\u2019s ID matches the description in the REST API/Swagger documentation for the statistic."}),"\n",(0,i.jsx)(t.h3,{id:"filters",children:"Filters"}),"\n",(0,i.jsx)(t.p,{children:"Filters are optional, but are important in their ability to limit the resources consumed by the metrics subsystem. Filters allow you to indicate your interest in a particular interface or peer-path without the necessity to persist all of the instances of the metric. If no filters are indicated, all instances are persisted."}),"\n",(0,i.jsx)(t.p,{children:"When using filters, the parameters and values must be relevant for all metrics in the profile. If one of the metrics does not have the specified parameter, or has none of the values, that metric will produce no data."}),"\n",(0,i.jsx)(t.p,{children:"Example of Simple Grouping with Filtering:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'config\n\n    authority\n\n        metrics-profile  internet-reachability-metrics\n            name    internet-reachability-metrics\n\n            metric  /stats/highway/destination-reachability/icmp/time-to-establishment/max\n                id           /stats/highway/destination-reachability/icmp/time-to-establishment/max\n                description  "Max ICMP time to establish"\n            exit\n\n            metric  /stats/highway/destination-reachability/tcp/time-to-establishment/max\n                id           /stats/highway/destination-reachability/tcp/time-to-establishment/max\n                description  "Max TCP time to establish"\n            exit\n\n            metric  /stats/highway/destination-reachability/icmp/time-to-establishment/mean\n                id           /stats/highway/destination-reachability/icmp/time-to-establishment/mean\n                description  "Avg ICMP time to establish"\n            exit\n\n            metric  /stats/highway/destination-reachability/tcp/time-to-establishment/mean\n                id           /stats/highway/destination-reachability/tcp/time-to-establishment/mean\n                description  "Avg TCP time to establish"\n            exit\n\n            filter  service\n                parameter  service\n                value      internet\n            exit\n\n            filter  traffic-class\n                parameter  traffic-class\n                value      best-effort\n            exit\n        exit\n    exit\nexit\n'})}),"\n",(0,i.jsxs)(t.p,{children:["When the above profile is referenced by a router, the various reachability metrics are persisted only for the ",(0,i.jsx)(t.code,{children:"internet"})," service and ",(0,i.jsx)(t.code,{children:"best-effort"})," traffic-class. These metrics are available as time-series from the GraphQL API or in the GUI."]}),"\n",(0,i.jsx)(t.h3,{id:"profile-references",children:"Profile References"}),"\n",(0,i.jsx)(t.p,{children:"Once a profile is configured on the Authority, it is availble to the routers, and each router may reference any number of relevant profiles. With each reference to a profile, the router configuration must specify the retention for the profile. The Profile Retention value determines how long the profile\u2019s metrics are retained."}),"\n",(0,i.jsx)(t.h3,{id:"profile-retention",children:"Profile Retention"}),"\n",(0,i.jsxs)(t.p,{children:["Profile Retention can be configured as any of four values: ",(0,i.jsx)(t.strong,{children:"in-memory"}),", ",(0,i.jsx)(t.strong,{children:"short"}),", ",(0,i.jsx)(t.strong,{children:"intermediate"}),", and ",(0,i.jsx)(t.strong,{children:"long"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["The current implementation of the ",(0,i.jsx)(t.strong,{children:"in-memory"})," retention value is limited."]}),"\n",(0,i.jsxs)(t.admonition,{type:"note",children:[(0,i.jsx)(t.mdxAdmonitionTitle,{}),(0,i.jsxs)(t.p,{children:["Metrics cascade from one retention value to the next; the use of any one value implies all values before it are also in effect. For example, using ",(0,i.jsx)(t.strong,{children:"intermediate"})," implies that ",(0,i.jsx)(t.strong,{children:"short"})," is also used."]})]}),"\n",(0,i.jsx)(t.p,{children:"Configuring retention values for persisted metrics helps manage the amount of data stored over time. Three settings are configurable:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"short"}),"\n",(0,i.jsx)(t.li,{children:"intermediate"}),"\n",(0,i.jsx)(t.li,{children:"long"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Each setting has three configuration fields."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"enabled"})," (true/false): Activates/deactivates the retention setting, as well as the retention value(s) that follow. For example, disabling intermediate retention also disables long retention. Similarly, disabling the short retention disables all retention."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"interval"}),": Time between data points for retention."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"duration"}),": How long the data will be stored before being dropped from the data store."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Retention Defaults"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Retention"}),(0,i.jsx)(t.th,{children:"State"}),(0,i.jsx)(t.th,{children:"Interval"}),(0,i.jsx)(t.th,{children:"Duration"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"short"}),(0,i.jsx)(t.td,{children:"Enabled: true"}),(0,i.jsx)(t.td,{children:"5 seconds"}),(0,i.jsx)(t.td,{children:"1 hour"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"intermediate"}),(0,i.jsx)(t.td,{children:"Enabled: true"}),(0,i.jsx)(t.td,{children:"5 minutes"}),(0,i.jsx)(t.td,{children:"1 day"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"long"}),(0,i.jsx)(t.td,{children:"Enabled: true"}),(0,i.jsx)(t.td,{children:"1 hour"}),(0,i.jsx)(t.td,{children:"180 days"})]})]})]}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsx)(t.p,{children:"Increasing the retention duration and/or decreasing the interval from the defaults has the potential to impact system overhead and should be carefully considered."})}),"\n",(0,i.jsx)(t.p,{children:"The following example shows metrics retention configured only for short retention with the default values:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"configure\n    authority\n        router        MyRouter\n            name   MyRouter \n                system\n                    metrics\n                        retention \n                            short\n                                enabled true\n                                interval 5s\n                                duration 1h\n                            intermediate \n                                enabled false  \n                                interval 5m\n                                duration 1d\n                            long\n                                enabled false  \n                                interval 1h\n                                duration 180d\n                            exit\n                        exit\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,i.jsx)(t.h4,{id:"example-profile",children:"Example Profile"}),"\n",(0,i.jsxs)(t.p,{children:["The following example configuration takes metrics specified in the ",(0,i.jsx)(t.code,{children:"internet-reachability-metrics"})," profile and stores them through the ",(0,i.jsx)(t.strong,{children:"intermediate"})," retention time period."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"configure\n    authority\n        router           MyRouter\n            name MyRouter\n            system\n                metrics\n                    profile  internet-reachability-metrics\n                        name       internet-reachability-metrics\n                        retention  intermediate\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n\n"})}),"\n",(0,i.jsx)(t.h3,{id:"in-memory-metrics-sample-configuration",children:"In-Memory Metrics Sample Configuration"}),"\n",(0,i.jsx)(t.p,{children:"The following example provides a sample configuration that makes use of several aspects of the Metrics Profile feature."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Multiple metrics in the same profile"}),"\n",(0,i.jsx)(t.li,{children:"Filtered profile (peer-metrics)"}),"\n",(0,i.jsx)(t.li,{children:"Unfiltered profile (events)"}),"\n",(0,i.jsx)(t.li,{children:"Multiple profiles for the same router (MyRouter)"}),"\n",(0,i.jsx)(t.li,{children:"Different retention targets for different profiles (MyRouter)"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"config\n    authority\n        metrics-profile  peer-metrics\n            name    peer-metrics\n\n            metric  /stats/bfd/peer-path/async/sent/success\n                id  /stats/bfd/peer-path/async/sent/success\n            exit\n\n            metric  /stats/bfd/peer-path/async/received/miss\n                id  /stats/bfd/peer-path/async/received/miss\n            exit\n\n            filter  peer-name\n                parameter  peer-name\n                value      MyOtherRouter\n            exit\n        exit\n\n        metrics-profile  events\n            name    events\n\n            metric  /stats/audit/events/produced\n                id  /stats/audit/events/produced\n            exit\n        exit\n\n        router           MyRouter\n            name MyRouter\n            system\n                metrics\n                    profile  events\n                        name       events\n                        retention  long\n                    exit\n\n                    profile  peer-metrics\n                        name       peer-metrics\n                        retention  short\n                    exit\n                exit\n            exit\n        exit\n\n        router           MyConductor\n            name MyConductor\n            system\n                metrics\n                    profile  events\n                        name       events\n                        retention  long\n                     exit\n                exit\n            exit\n        exit\n    exit\nexit\n\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(96540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);