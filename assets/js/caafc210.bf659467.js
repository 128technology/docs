"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[7342],{46250:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var t=o(74848),s=o(28453);const i={title:"NAT Pools",sidebar_label:"NAT Pools"},r=void 0,a={id:"config_nat_pools",title:"NAT Pools",description:"NAT Pools",source:"@site/docs/config_nat_pools.md",sourceDirName:".",slug:"/config_nat_pools",permalink:"/docs/config_nat_pools",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"NAT Pools",sidebar_label:"NAT Pools"},sidebar:"docs",previous:{title:"Dynamic Ingress Source NAT",permalink:"/docs/config_dnat"},next:{title:"NAT Troubleshooting",permalink:"/docs/ts_nat_troubleshooting"}},l={},c=[{value:"NAT Pools",id:"nat-pools",level:2},{value:"Static NAT Bindings",id:"static-nat-bindings",level:2},{value:"Shared NAT Pools",id:"shared-nat-pools",level:3},{value:"Flow Move Considerations",id:"flow-move-considerations",level:4},{value:"Session Recovery Considerations",id:"session-recovery-considerations",level:4},{value:"Tenant Filtering",id:"tenant-filtering",level:3}];function d(e){const n={code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"nat-pools",children:"NAT Pools"}),"\n",(0,t.jsx)(n.p,{children:"NAT pools are a construct that allows for the use of IP and port ranges to be shared across one or more network-interfaces for either source or destination NATing capabilities."}),"\n",(0,t.jsx)(n.h2,{id:"static-nat-bindings",children:"Static NAT Bindings"}),"\n",(0,t.jsxs)(n.p,{children:["A static NAT binding is configured by creating an ",(0,t.jsx)(n.code,{children:"authority > router > nat-pool"})," object and assigning it to a network-interface. The following rules and constraints apply to this configuration:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.em,{children:"nat-pool"})," prefix is used to create a N",":M"," mapping, where each source IP (from an ingress interface) is hashed to an IP address in the nat pool."]}),"\n",(0,t.jsxs)(n.li,{children:["The static ",(0,t.jsx)(n.em,{children:"nat-pool"})," can only be configured as:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"ingress-nat-pool"})," on a ",(0,t.jsx)(n.em,{children:"network-interface"})," when peering with another SSR"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"egress-nat-pool"})," on a ",(0,t.jsx)(n.em,{children:"network-interface"})," when not performing SVR"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"source-nat-pool"})," on a ",(0,t.jsx)(n.em,{children:"service-route / next-hop"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["SSR software will not reply to ARP requests on the pool prefix on the associated interface. The SSR relies on the pool to be routed to the SSR gateway interface by another mechanism such as static-routes, BGP, etc., by the ",(0,t.jsx)(n.em,{children:"next-hop"})," in the network."]}),"\n",(0,t.jsx)(n.li,{children:"Changes to the pool configuration will not affect the existing sessions as it has the potential of cascading effect on the network. These changes resolve over time as the existing sessions naturally expire."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The static NAT pool hashes the source IP address of incoming packets to the corresponding IP address in the pool."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"nat-pool\n\tname static-pool-1\n\ttype static\n\taddress-pool\n\t\taddress 10.10.10.10/31\n\nnetwork-interface\n\tname\ttest-lan\n\taddress\n\t\tip-address 192.168.10.1\n\t\tprefix-length 24\n\tingress-source-nat-pool static-pool-1\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In the configuration snippet above, the ",(0,t.jsx)(n.em,{children:"192.168.10.0/24"})," network for the ",(0,t.jsx)(n.code,{children:"test-lan"})," will be source NAT\u2019d to ",(0,t.jsx)(n.code,{children:"10.10.10.10/31"}),". Traffic from an endpoint of source address 192.168.10.10 will be source NAT\u2019d to 10.10.10.10; 192.168.10.11 will be source NAT\u2019d to 10.10.10.11 and so on. Since the NAT in the model relies on a N",":M"," mapping this can only be configured as an ",(0,t.jsx)(n.em,{children:"ingress-source-nat-pool"})," (on ",(0,t.jsx)(n.em,{children:"network-interface"}),") or as a destination-nat-pool (on ",(0,t.jsx)(n.em,{children:"service-route / next-hop"}),")."]}),"\n",(0,t.jsx)(n.h3,{id:"shared-nat-pools",children:"Shared NAT Pools"}),"\n",(0,t.jsx)(n.p,{children:"In some scenarios, it is desirable to share the same NAT pool across services and interfaces. This feature accommodates the same NAT pool to be configured on different interfaces. There are some considerations that should be noted for failure and recovery."}),"\n",(0,t.jsx)(n.h4,{id:"flow-move-considerations",children:"Flow Move Considerations"}),"\n",(0,t.jsx)(n.p,{children:"Currently session migration is only supported for SVR sessions. This restriction exists because session migration of a non-SVR session is not guaranteed to terminate on the same server. As a result, the remote server might receive mid flow packets from a different source, resulting in undefined behavior."}),"\n",(0,t.jsx)(n.h4,{id:"session-recovery-considerations",children:"Session Recovery Considerations"}),"\n",(0,t.jsx)(n.p,{children:"For shared NAT pools provisioned on an HA interface that encounters a failover, the SSR software will put the interface into recovery mode to recover all sessions. At the end of the recovery period all non-discovered ports designed as free are returned to the NAT pool."}),"\n",(0,t.jsx)(n.h3,{id:"tenant-filtering",children:"Tenant Filtering"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.em,{children:"nat-pool"})," configuration can optionally be provisioned with a list of tenants. When the configuration has ",(0,t.jsx)(n.em,{children:"multiple"})," IP pools available, the ",(0,t.jsx)(n.em,{children:"tenant"})," can be used to determine which IP pool will be selected for the source NAT. Absence of a tenant implies that the IP pool is valid for all traffic. The following rules will be applied in order to determine the selection of the NAT pool:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The packet has a source tenant associated with it:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If more than one IP pool has a matching tenant, only the first IP pool is used and the hash is applied to create a session. The remainder of the matches are discarded."}),"\n",(0,t.jsxs)(n.li,{children:["If a pool with no tenant is configured:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Same as above."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["All IP pools have tenant configured but none of them match the source tenant:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Log the failure, increment stat and drop the packet."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["The packet has no source tenant associated with it:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"At least one IP pool has no tenant configured to do the source NAT, otherwise this will result in the session being dropped."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The tenant matching rules apply to sub-tenants as well. For example, if an IP pool allows tenant engineering, then traffic with source tenant ",(0,t.jsx)(n.code,{children:"lab.engineering"})," will also match the pool."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>a});var t=o(96540);const s={},i=t.createContext(s);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);