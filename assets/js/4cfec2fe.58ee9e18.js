"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[7599],{80697:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var r=n(74848),i=n(28453);const a={title:"DHCP Relay Best Practices",sidebar_label:"DHCP Relay Best Practices"},s=void 0,c={id:"bcp_dhcp_relay_overview",title:"DHCP Relay Best Practices",description:"The purpose of a DHCP relay is to forward incoming requests from DHCP clients to a DHCP server. Normally, a client can talk directly to a DHCP server; especially on a single subnet. However, in the case where the server and clients are not on the same subnet, a DCHP relay agent can be deployed to mediate these requests. The SSR can accommodate this type of DHCP relay services.",source:"@site/docs/bcp_dhcp_relay_overview.md",sourceDirName:".",slug:"/bcp_dhcp_relay_overview",permalink:"/docs/bcp_dhcp_relay_overview",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"DHCP Relay Best Practices",sidebar_label:"DHCP Relay Best Practices"},sidebar:"docs",previous:{title:"Branch NTP Service",permalink:"/docs/bcp_using_128T_as_ntp_server"},next:{title:"ExpressRoute QoS Configuration",permalink:"/docs/bcp_qos_msft_expressroute"}},o={},d=[{value:"Requirements",id:"requirements",level:3},{value:"Design Types",id:"design-types",level:3},{value:"Architecture",id:"architecture",level:3},{value:"Site Types",id:"site-types",level:3},{value:"DHCP Relay with SVR",id:"dhcp-relay-with-svr",level:2},{value:"Tenant",id:"tenant",level:3},{value:"Service",id:"service",level:3},{value:"Service Route",id:"service-route",level:3},{value:"Network Interface",id:"network-interface",level:3},{value:"Sample Configuration",id:"sample-configuration",level:3},{value:"DHCP Relay and Multiple DHCP Servers",id:"dhcp-relay-and-multiple-dhcp-servers",level:2},{value:"Adding Service-Routes",id:"adding-service-routes",level:3},{value:"Sample Configuration",id:"sample-configuration-1",level:3},{value:"DHCP Relay with BGP over SVR",id:"dhcp-relay-with-bgp-over-svr",level:2},{value:"Service",id:"service-1",level:3},{value:"Service Routes",id:"service-routes",level:3},{value:"RIB/FIB/BGP Show Commands",id:"ribfibbgp-show-commands",level:3},{value:"SSR Branch 1",id:"ssr-branch-1",level:4},{value:"SSR Branch 2",id:"ssr-branch-2",level:4},{value:"Sample Configuration",id:"sample-configuration-2",level:3}];function l(t){const e={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"The purpose of a DHCP relay is to forward incoming requests from DHCP clients to a DHCP server. Normally, a client can talk directly to a DHCP server; especially on a single subnet. However, in the case where the server and clients are not on the same subnet, a DCHP relay agent can be deployed to mediate these requests. The SSR can accommodate this type of DHCP relay services."}),"\n",(0,r.jsx)(e.h3,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsx)(e.p,{children:"To configure DHCP relay on the SSR, the following requirements must be met or available."}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"IP address of the DHCP server which manages the DHCP address pool."}),"\n",(0,r.jsx)(e.li,{children:"The DHCP server must be accessible from the SSR."}),"\n",(0,r.jsx)(e.li,{children:"A unique tenant must be configured for the DHCP relay to flag requests observed by the SSR."}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"design-types",children:"Design Types"}),"\n",(0,r.jsx)(e.p,{children:"The following standard design models for DHCP Relay are addressed in this guide:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"#dhcp-relay-with-svr",children:"DHCP relay with SVR"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"#dhcp-relay-and-multiple-dhcp-servers",children:"DHCP relay with SVR and multiple DHCP servers"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"#dhcp-relay-with-bgp-over-svr",children:"DHCP relay with BGP over SVR"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(e.p,{children:"A high-level overview of the architecture used for testing is shown in the diagram below."}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"DHCP Test Architecture",src:n(80547).A+"",width:"360",height:"300"})}),"\n",(0,r.jsx)(e.h3,{id:"site-types",children:"Site Types"}),"\n",(0,r.jsx)(e.p,{children:"The following characteristics define the common models where DHCP Relay is deployed:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Enterprise DC to Branch relay (DHCP server lives on the DC LAN)"}),"\n",(0,r.jsx)(e.li,{children:"Branch to Branch relay (DHCP server lives on one of the branch LANs)"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"dhcp-relay-with-svr",children:"DHCP Relay with SVR"}),"\n",(0,r.jsx)(e.p,{children:"Most basic deployments utilize DHCP relay with SVR only, where DHCP relay is implemented in its simplest form. The key elements to configure are tenants, services, and service-routes. The final step is to tag the branch office\u2019s network interface with the tenant. This will be the interface receiving DHCP broadcasts."}),"\n",(0,r.jsx)(e.h3,{id:"tenant",children:"Tenant"}),"\n",(0,r.jsx)(e.p,{children:"A unique tenant and service must be designed as shown below. This tenant will be used to tag and identify DHCP request session on the ingress interface and associated them with the dhcp-relay service."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n        tenant dhcp.demo \n            name dhcp.demo\n        exit \n    exit\nexit\n\n"})}),"\n",(0,r.jsx)(e.h3,{id:"service",children:"Service"}),"\n",(0,r.jsxs)(e.p,{children:["A service is created with ",(0,r.jsx)(e.code,{children:"application-type dhcp-relay"}),". A unique tenant must be applied to the access policy to allow the SSR to process DHCP requests."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n        service    \tdhcp_relay\n            name \t\t\tdhcp_relay\n            security \t\tinternal\n\n            access-policy \tdhcp.demo\n            \tsource \t\tdhcp.demo\n            exit\n            application-type \tdhcp-relay\n        exit\n    exit\nexit\n\n"})}),"\n",(0,r.jsx)(e.h3,{id:"service-route",children:"Service Route"}),"\n",(0,r.jsxs)(e.p,{children:["A service-route is configured on the Branch1 or Enterprise DC routers referencing the DHCP relay service, with a ",(0,r.jsx)(e.code,{children:"service-agent next-hop"})," pointing to the IP address of the DHCP server (",(0,r.jsx)(e.code,{children:"nat-target"})," in the example below)."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n        router \t\tBranch1\n            name \t\tBranch1\n\n            service-route        dhcp_relay_service-route\n                name             dhcp_relay_service-route\n                service-name     dhcp-relay\n                nat-target       172.16.1.3\n\n                next-hop         node1 lan1\n                    node-name    node1\n                    interface \t node1\n                exit\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsxs)(e.p,{children:["See ",(0,r.jsx)(e.a,{href:"/docs/concepts_glossary#service-routes",children:"Service Routes"})," for additional information."]}),"\n",(0,r.jsx)(e.h3,{id:"network-interface",children:"Network Interface"}),"\n",(0,r.jsxs)(e.p,{children:["On the router processing the DHCP relay requests (Branch 2), the unique tenant created must be applied to the network-interface receiving the DHCP broadcasts. These DHCP request broadcasts are tagged by the tenant and associated with the ",(0,r.jsx)(e.code,{children:"dhcp-relay"})," service. After the association is made, the SSR will convert the broadcast into a unicast and forward it to the IP of the DHCP servers."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n        router    Branch2\n            name \tBranch2\n\n            node    node1\n                name                node1\n\n                device-interface    blue-lan1\n                    name                blue-lan1\n                    pci-address         0000:00:04.0\n\n                    network-interface   lan1\n                        name            \t\t lan1\n                        global-id       \t\t 6\n                        tenant          \t\t dhcp.demo\n                        inter-router-security    internal\n                        source-nat               true\n\n                        address \t\t\t\t 172.26.2.25\n                            ip-address \t\t\t 172.26.2.25\n                            prefix-length \t\t 24\n                            gateway \t\t\t 172.26.2.1\n                        exit\n                    exit\n                exit\n            exit\n        exit\n    exit\n"})}),"\n",(0,r.jsx)(e.h3,{id:"sample-configuration",children:"Sample Configuration"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n\t\trouter\t\t\t\tBranch1 \n\t\t\tname\t\t\t\tBranch1\n\n\t\t\tnode\t\tnode1\n\t\t\t\tname\t\t\tnode1\n\t\t\t\tasset-id\t\tt220-dut1.openstacklocal\n\n\t\t\t\tdevice-interface  \twan-eth0 \n\t\t\t\t\tname\t\t\t\twan-eth0\n\t\t\t\t\tpci-address\t\t\t0000:00:03.0\n\n\t\t\t\t\tnetwork-interface \twan\n\t\t\t\t\t\tname\t\t\t\twan\n\t\t\t\t\t\tglobal-id\t\t\t1\n\t\t\t\t\t\tconductor\t\t\ttrue\n\t\t\t\t\t\tdefault-route\t\ttrue\n\n\t\t\t\t\t\tneighborhood\tBroadband \n\t\t\t\t\t\t\tname\t\t\tBroadband\n\t\t\t\t\t\t\ttopology \t\tmesh \n\t\t\t\t\t\texit\n\t\t\t\t\t\tinter-router-security \tinternal \n\t\t\t\t\t\tsource-nat\t\t\t\ttrue\n\t\t\t\t\t\tmanagement\t\t\t\ttrue\n\n\t\t\t\t\t\tmanagement-vector \n\t\t\t\t\t\t\tname\t\tmgmt \n\t\t\t\t\t\t\tpriority \t5\n\t\t\t\t\t\texit\n\n\t\t\t\t\t\taddress\t\t\t192.168.1.9\n\t\t\t\t\t\t\tip-address\t\t192.168.1.9\n\t\t\t\t\t\t\tprefix-length \t24\n\t\t\t\t\t\t\tgateway\t\t\t192.168.1.1\n\t\t\t\t\t\texit \n\t\t\t\t\texit\n\t\t\t\texit\n\n\t\t\t\tdevice-interface  \tred-lan1 \n\t\t\t\t\tname\t\t\t\tred-lan1\n\t\t\t\t\tpci-address\t\t\t0000:00:04.0\n\n\t\t\t\t\tnetwork-interface \tlan1\n\t\t\t\t\t\tname\t\t\t\tlan1\n\t\t\t\t\t\tglobal-id\t\t\t6\n\t\t\t\t\t\ttenant\t\t\t\tlan\n\t\t\t\t\t\tinter-router-security\tinternal\n\t\t\t\t\t\tsource-nat\t\t\ttrue\n\t\t\t\t\t\taddress\t\t\t\t172.16.1.15\n\t\t\t\t\t\t\tip-address\t\t\t172.16.1.15\n\t\t\t\t\t\t\tprefix-length \t\t24\n\t\t\t\t\t\t\tgateway\t\t\t\t172.16.1.1\n\t\t\t\t\t\texit \n\t\t\t\t\texit\n\t\t\t\texit \n\t\t\texit\n\n\t\t\tservice-route \tdhcp-relay_route\n\t\t\t\tname\t\t\tdhcp-relay_route \n\t\t\t\tservice-name\tdhcp_relay\n\t\t\t\tnat-target\t\t172.16.1.3\n\t\t\t\tnext-hop\t\tnode1 lan1 \n\t\t\t\t\tnode-name \t\tnode1 \n\t\t\t\t\tinterface \t\tlan1\n\t\t\t\texit \n\t\t\texit\n\t\texit\n\t\t\t\n\t\trouter    Branch2\n            name \tBranch2\n\n            node    node1\n                name                node1\n\n\t            device-interface    blue-lan1\n\t                name                blue-lan1\n\t                pci-address         0000:00:04.0\n\n\t                network-interface   lan1\n\t                    name            \t\t lan1\n\t                    global-id       \t\t 6\n\t                    tenant          \t\t dhcp.demo\n\t                    inter-router-security    internal\n\t                    address \t\t\t\t 172.26.2.25\n\t                        ip-address \t\t\t 172.26.2.25\n\t                        prefix-length \t\t 24\n\t                        gateway \t\t\t 172.26.2.1\n\t                        exit\n\t                    exit\n\t                exit\n\t            exit\n\t        exit\n\t    exit\n\n\t\ttenant \tlan\n\t\t\tname \tlan\n\t\texit\n\n\t\ttenant \tdhcp.demo\n\t\t\tname \tdhcp.demo\n\t\texit\n\n\t\tservice \tinternet\n\t\t\tname \tinternet\n\t\t\taddress \t0.0.0.0/0\n\n\t\t\taccess-policy \tlan\n\t\t\t\tsource \t\t\tlan\n\t\t\texit\n\t\texit\n\n\t\tservice \tdhcp_relay\n\t\t\tname \t\tdhcp_relay\n\t\t\tsecurity \tinternal\n\n\t\t\taccess-policy \tdhcp.demo\n\t\t\t\tsource \t\t\tdhcp.demo\n\t\t\texit\n\n\t\t\tservice-policy \t\tdhcp_relay\n\t\t\tapplication-type \tdhcp-relay\n\t\texit\n\texit\nexit\n"})}),"\n",(0,r.jsx)(e.h2,{id:"dhcp-relay-and-multiple-dhcp-servers",children:"DHCP Relay and Multiple DHCP Servers"}),"\n",(0,r.jsxs)(e.p,{children:["To achieve redundancy, more than one DHCP server is deployed. ",(0,r.jsx)(e.strong,{children:"The SSR accommodates multiple severs by configuring additional service-route elements referencing the same service."})," When ingress traffic on the SSR is tagged by the network-interface with the tenant associated with ",(0,r.jsx)(e.code,{children:"dhcp_relay"})," service, the SSR broadcasts DHCP requests to all next-hops within the service-route's next-hop."]}),"\n",(0,r.jsx)(e.p,{children:"The fastest server wins."}),"\n",(0,r.jsx)(e.h3,{id:"adding-service-routes",children:"Adding Service-Routes"}),"\n",(0,r.jsxs)(e.p,{children:["Building upon the earlier configuration and the information above, all that is needed to add additional DHCP servers is an additional ",(0,r.jsx)(e.strong,{children:"service-route"})," for each DHCP server. In our example configuration, we will be adding a second service route (",(0,r.jsx)(e.code,{children:"dhcp-relay_route2"}),") to the Branch1 router with the new DHCP Server IP address - ",(0,r.jsx)(e.code,{children:"nat-target"})," 172.16.1.4."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n        router \t\tBranch1\n            name \t\tBranch1\n\n            service-route        dhcp-relay_route1\n                name             dhcp-relay_route1\n                service-name     dhcp-relay\n                nat-target       172.16.1.3\n\n                next-hop         node1 lan1\n                    node-name    node1\n                    interface \t lan1\n                exit\n            exit\n\n            service-route        dhcp-relay_route2\n                name             dhcp-relay_route2\n                service-name     dhcp-relay\n                nat-target       172.16.1.4\n\n                next-hop         node1 lan1\n                    node-name    node1\n                    interface \t lan1\n                exit\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsx)(e.h3,{id:"sample-configuration-1",children:"Sample Configuration"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n\t\trouter\t\t\t\tBranch1 \n\t\t\tname\t\t\t\tBranch1\n\n\t\t\tnode\tnode1\n\t\t\t\tname\tnode1\n\t\t\t\tasset-id\tt220-dut1.openstacklocal\n\n\t\t\t\tdevice-interface  \twan-eth0 \n\t\t\t\t\tname\t\t\t\twan-eth0\n\t\t\t\t\tpci-address\t\t\t0000:00:03.0\n\n\t\t\t\t\tnetwork-interface \twan\n\t\t\t\t\t\tname\t\t\t\twan\n\t\t\t\t\t\tglobal-id\t\t\t1\n\t\t\t\t\t\tconductor\t\t\ttrue\n\t\t\t\t\t\tdefault-route\t\ttrue\n\n\t\t\t\t\t\tneighborhood\tBroadband \n\t\t\t\t\t\t\tname\t\t\tBroadband\n\t\t\t\t\t\t\ttopology \t\tmesh \n\t\t\t\t\t\texit\n\t\t\t\t\t\tinter-router-security \tinternal \n\t\t\t\t\t\tsource-nat\t\t\t\ttrue\n\t\t\t\t\t\tmanagement\t\t\t\ttrue\n\n\t\t\t\t\t\tmanagement-vector \n\t\t\t\t\t\t\tname\t\tmgmt \n\t\t\t\t\t\t\tpriority \t5\n\t\t\t\t\t\texit\n\n\t\t\t\t\t\taddress\t\t\t192.168.1.9\n\t\t\t\t\t\t\tip-address\t\t192.168.1.9\n\t\t\t\t\t\t\tprefix-length \t24\n\t\t\t\t\t\t\tgateway\t\t\t192.168.1.1\n\t\t\t\t\t\texit \n\t\t\t\t\texit\n\t\t\t\texit\n\n\t\t\t\tdevice-interface  \tred-lan1 \n\t\t\t\t\tname\t\t\tred-lan1\n\t\t\t\t\tpci-address\t\t0000:00:04.0\n\n\t\t\t\t\tnetwork-interface \tlan1\n\t\t\t\t\t\tname\t\t\t\tlan1\n\t\t\t\t\t\tglobal-id\t\t\t6\n\t\t\t\t\t\ttenant\t\t\t\tlan\n\t\t\t\t\t\tinter-router-security\t\tinternal\n\t\t\t\t\t\tsource-nat\t\t\ttrue\n\t\t\t\t\t\taddress\t\t\t\t172.16.1.15\n\t\t\t\t\t\t\tip-address\t\t172.16.1.15\n\t\t\t\t\t\t\tprefix-length \t24\n\t\t\t\t\t\t\tgateway\t\t\t172.16.1.1\n\t\t\t\t\t\texit \n\t\t\t\t\texit\n\t\t\t\texit \n\n\t\t\t\tservice-route \tdhcp-relay_route1\n\t\t\t\t\tname\t\t\tdhcp-relay_route1 \n\t\t\t\t\tservice-name\tdhcp_relay\n\t\t\t\t\tnat-target\t\t172.16.1.3\n\t\t\t\t\tnext-hop\t\tnode1 lan1 \n\t\t\t\t\t\tnode-name \t\tnode1 \n\t\t\t\t\t\tinterface \t\tlan1\n\t\t\t\t\texit \n\t\t\t\texit\n\n\t\t\t\tservice-route \tdhcp-relay_route2\n\t\t\t\t\tname\t\t\tdhcp-relay_route2 \n\t\t\t\t\tservice-name\tdhcp_relay\n\t\t\t\t\tnat-target\t\t172.16.1.4\n\t\t\t\t\tnext-hop\t\tnode1 lan1 \n\t\t\t\t\t\tnode-name \t\tnode1 \n\t\t\t\t\t\tinterface \t\tlan1\n\t\t\t\t\texit \n\t\t\t\texit\n\n\t\trouter    Branch2\n            name \tBranch2\n\n            node    node1\n                name                node1\n\n\t            device-interface    blue-lan1\n\t                name                blue-lan1\n\t                pci-address         0000:00:04.0\n\n\t                network-interface   lan1\n\t                    name            \t\t lan1\n\t                    global-id       \t\t 6\n\t                    tenant          \t\t dhcp.demo\n\t                    inter-router-security    internal\n\t                    source-nat               true\n\n\t                    address \t\t\t\t 172.26.2.25\n\t                        ip-address \t\t\t 172.26.2.25\n\t                        prefix-length \t\t 24\n\t                        gateway \t\t\t 172.26.2.1\n\t                        exit\n\t                    exit\n\t                exit\n\t            exit\n        \texit\n    \texit\n\n\t\ttenant \tlan\n\t\t\tname \tlan\n\t\texit\n\n\t\ttenant \tdhcp.demo\n\t\t\tname \tdhcp.demo\n\t\texit\n\n\t\tservice \tinternet\n\t\t\tname \t\tinternet\n\t\t\taddress \t0.0.0.0/0\n\n\t\t\taccess-policy \tlan\n\t\t\t\tsource \t\tlan\n\t\t\texit\n\t\texit\n\t\tservice\t\t\tlocal-lan-summary_router1\n\t\t\tname\t\tlocal-lan-summary_router1\n\t\t\tsecurity\tinternal\n\t\t\taddress\t\t172.16.1.12/32\n\n\t\t\taccess-policy \tlan \n\t\t\t\tsource \t\tlan\n\t\t\texit \n\t\texit\n\n\t\tservice\t\tlocal-lan-summary_router3\n\t\t\tname\t\tlocal-lan-summary_router3\n\t\t\tsecurity\tinternal\n\t\t\taddress\t\t172.16.1.12/32\n\n\t\t\taccess-policy \twan \n\t\t\t\tsource \t\twan\n\t\t\texit \n\t\texit\n\n\t\tservice \tdhcp_relay\n\t\t\tname \t\tdhcp_relay\n\t\t\tsecurity \tinternal\n\n\t\t\taccess-policy \tdhcp.demo\n\t\t\t\tsource \t\tdhcp.demo\n\t\t\texit\n\n\t\t\tservice-policy \t\tdhcp_relay\n\t\t\tapplication-type \tdhcp-relay\n\t\texit\n\texit\nexit\n"})}),"\n",(0,r.jsx)(e.h2,{id:"dhcp-relay-with-bgp-over-svr",children:"DHCP Relay with BGP over SVR"}),"\n",(0,r.jsxs)(e.p,{children:["By default, the SSR will auto-generate service-routes and services for each DHCP server. This is good for SVR without BGP. To make DHCP relay work with BGP over SVR, we need to make additional changes to the auto-generated configuration ",(0,r.jsx)(e.strong,{children:"after"})," the auto-generation of configuration objects is complete."]}),"\n",(0,r.jsx)(e.p,{children:"Please review DHCP Relay with SVR for tenant and network-interface configurations."}),"\n",(0,r.jsx)(e.h3,{id:"service-1",children:"Service"}),"\n",(0,r.jsxs)(e.p,{children:["Configure the ",(0,r.jsx)(e.code,{children:"dhcp-relay"})," service with ",(0,r.jsx)(e.code,{children:"application-type dhcp-relay"})," and add the tenants to which this applies. Finally, set ",(0,r.jsx)(e.code,{children:"share-service-route"})," to ",(0,r.jsx)(e.code,{children:"false"}),"."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n        service    \tdhcp_relay\n            name \t\t\tdhcp_relay\n            security \t\tservice-sec\n\n            access-policy \tdhcp.demo\n            \tsource \t\tdhcp.demo\n            exit\n            share-service-routes false\n            application-type \tdhcp-relay\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsx)(e.h3,{id:"service-routes",children:"Service Routes"}),"\n",(0,r.jsx)(e.p,{children:"On the Branch 1 SSR Router:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Create a ",(0,r.jsx)(e.code,{children:"service-route"})," for this service with a ",(0,r.jsx)(e.code,{children:"nat-target"})," of the DHCP server, and perform a commit. The conductor auto-generates an additional DHCP service."]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n    authority\n        router \t\tBranch1\n            name \t\tBranch1\n\n            service-route        dhcp_relay_service-route\n                name             dhcp_relay_service-route\n                service-name     dhcp-relay\n                nat-target       172.16.1.3\n\n                next-hop         node1 lan1\n                    node-name    node1\n                    interface \t lan1\n                exit\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Change the configuration of the auto-generated DHCP service"})," to ",(0,r.jsx)(e.code,{children:"generated=false"})," and ",(0,r.jsx)(e.code,{children:"share-service-routes=false"}),"."]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'config\n\tauthority\n\n\t\tservice _dhcp_relay_5_172.16.1.3\n\t\t\tname \t\t\t\t_dhcp_relay_5_172.16.1.3\n\t\t\tdescription \t\t"Auto generated DHCP relay service for DHCP server 172.16.1.3"\n\t\t\tenabled \t\t\ttrue\n\t\t\tscope \t\t\t\tprivate\n\t\t\ttap-multiplexing \tfalse\n\n\t\t\ttransport \tudp\n\t\t\t\tprotocol \t\tudp\n\t\t\t\tport-range \t\t67\n\t\t\t\t\tstart-port \t67\n\t\t\t\t\tend-port \t\t67\n\t\t\t\texit\n\t\t\texit\n\t\t\taddress \t\t\t\t\t172.16.1.3/32\n\t\t\tgenerate-categories \t\tfalse\n\t\t\taccess-policy-generated \tfalse\n\t\t\t\n\t\t\taccess-policy \t\t\t\tdhcp.demo\n\t\t\t\tsource \t\t\t\t\tdhcp.demo\n\t\t\t\tpermission \t\t\t\tallow\n\t\t\texit\n\t\t\tshare-service-routes \t\tfalse\n\t\t\tsource-nat \t\t\t\t\tdisabled\n\t\t\tapplication-type \t\t\tgeneric\n\t\t\tfqdn-resolution-type \t\tv4\n\t\t\t\n\t\t\tsession-record\n\t\t\t\tinclude-hierarchical-services \ttrue\n\t\t\texit\n\t\t\tgenerated \t\tfalse\n\t\texit\n\texit\nexit\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"3",children:["\n",(0,r.jsxs)(e.li,{children:["Go into the auto-generated service-route and change ",(0,r.jsx)(e.code,{children:"generated"})," to ",(0,r.jsx)(e.code,{children:"false"}),", change type to ",(0,r.jsx)(e.code,{children:"use-learned-routes"}),", and perform one last commit."]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"config\n\tauthority\n\t\trouter \tBranch1\n\t\t\tname \t\tBranch1\n\t\t\tservice-route \t\t_dhcp_relay_dhcp_relay_service-route\n\t\t\t\tname \t\t\t_dhcp_relay_dhcp_relay_service-route\n\t\t\t\tservice-name \t_dhcp_relay_5_172.16.1.3\n\t\t\t\tenable-failover false\n\t\t\t\tgenerated \t\tfalse\n\t\t\t\tuse-learned-routes\n\t\t\texit\n\t\texit\n\texit\nexit\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"4",children:["\n",(0,r.jsxs)(e.li,{children:["RIB/FIB should show the service for BGP as the path for ",(0,r.jsx)(e.code,{children:"dhcp_relay"}),". In this case, the SSR on Branch2 has a path for ",(0,r.jsx)(e.code,{children:"dhcp_relay"})," to the SSR on Branch1 over BGP."]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"ribfibbgp-show-commands",children:"RIB/FIB/BGP Show Commands"}),"\n",(0,r.jsx)(e.h4,{id:"ssr-branch-1",children:"SSR Branch 1"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"admin@node1.Branch1# show bgp summary\nThu 2022-03-31 20:24:49 UTC\nIPv4 Unicast Summary:\nBGP router identifier 2.2.2.1, local AS number 64512 vrf-id 0\nBGP table version 3\nRIB entries 5, using 960 bytes of memory\nPeers 2, using 43 KiB of memory\n\nNeighbor    V \t\tAS \t\tMsgRcvd \tMsgSent \tTblVer \tInQ \tOutQ \tUp/Down \tState/PfxRcd \tPfxSnt\n2.2.2.2 \t4 \t 64513 \t\t  18087 \t  19383 \t\t 0 \t  0 \t   0 \t6d01h18m \t\t\t   0 \t\t 3\n2.2.2.4 \t4 \t 64514 \t\t  17219 \t  17221 \t\t 0 \t  0 \t   0 \t5d23h27m \t\t\t   0 \t\t 3\n\n\nTotal number of neighbors 2\nCompleted in 0.20 seconds\nadmin@node1.Branch1# show bgp\nThu 2022-03-31 20:24:51 UTC\nBGP table version is 3, local router ID is 2.2.2.1, vrf id 0\nDefault local pref 100, local AS 64512\nStatus codes: s suppressed, d damped, h history, * valid, > best, = multipath,\n\t\t\t  i internal, r RIB-failure, S Stale, R Removed\nNexthop codes: @NNN nexthop's vrf id, < announce-nh-self\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n\tNetwork \t\tNext Hop \tMetric \tLocPrf Weight Path\n*> \t2.2.2.1/32 \t\t0.0.0.0 \t\t 0 \t\t\t32768 \t?\n*> \t172.16.1.0/24 \t0.0.0.0 \t\t 0 \t\t\t32768 \t?\n*> \t192.168.1.0/24 \t0.0.0.0 \t\t 0 \t\t\t32768 \t?\n\nDisplayed 3 routes and 3 total paths\nCompleted in 0.22 seconds\n\nadmin@node1.Branch1# show fib service-name _bgp_Branch1_R1\nThu 2022-03-31 20:31:42 UTC\n\nEntry Count: 109\nCapacity: 23387\n\n============ ====== ======= =============== ===== ================= ============= ======== ======\nIP Prefix \t  Port \t Proto \t Tenant \t\t VRF \tService \t\tNext Hops \t  Vector \tCost\n============ ====== ======= =============== ===== ================= ============= ======== ======\n2.2.2.1/32 \t  179 \t  TCP \t_bgp_speaker_ \t  -\t  _bgp_Branch1_R1 \t0-None.4095 \t- \t\t 0\n\nCompleted in 0.05 seconds\nadmin@node1.Branch1# show fib service-name _dhcp_relay_5_172.16.1.3\nThu 2022-03-31 20:31:45 UTC\n\nEntry Count: 109\nCapacity: 23387\n\n=============== ====== ======= ========= ===== ========================== =========== ======== ======\nIP Prefix \t\tPort \tProto \tTenant \t  VRF   Service \t\t\t\t  Next Hops   Vector   Cost\n=============== ====== ======= ========= ===== ========================== =========== ======== ======\n172.16.1.3/32 \t 67 \t UDP   dhcp.demo   - \t_dhcp_relay_5_172.16.1.3 \t1-2.0 \t\t - \t\t 0\n"})}),"\n",(0,r.jsx)(e.h4,{id:"ssr-branch-2",children:"SSR Branch 2"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Default local pref 100, local AS 64514\nStatus codes: s suppressed, d damped, h history, * valid, > best, = multipath,\n\t\t\t  i internal, r RIB-failure, S Stale, R Removed\nNexthop codes: @NNN nexthop's vrf id, < announce-nh-self\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n\tNetwork \t\tNext Hop \tMetric \tLocPrf Weight Path\n*> \t2.2.2.1/32 \t\t2.2.2.1 \t\t 0 \t\t 0  64512  ?\n*> \t172.16.1.0/24   2.2.2.1 \t\t 0 \t\t 0  64512  ?\n*> \t192.168.1.0/24  2.2.2.1 \t\t 0 \t\t 0  64512  ?\n\nDisplayed 3 routes and 3 total paths\nCompleted in 0.40 seconds\n\nadmin@node1.Branch2# show bgp summary\nThu 2022-03-31 20:32:25 UTC\n\nIPv4 Unicast Summary:\nBGP router identifier 2.2.2.4, local AS number 64514 vrf-id 0\nBGP table version 3\nRIB entries 5, using 960 bytes of memory\nPeers 1, using 21KiB of memory\n\nNeighbor    V \t\tAS \t\tMsgRcvd \tMsgSent \tTblVer \tInQ \tOutQ \tUp/Down \tState/PfxRcd \tPfxSnt\n2.2.2.1\t\t4\t\t64512\t17236\t\t17234\t\t\t 0\t 0\t\t  0 \t5d23h35m\t\t3\t\t\t\t3\n\n\nTotal number of neighbors 1 Completed in 0.18 seconds\n\nadmin@node1.Branch2# show fib service-name _dhcp_relay_5_172.16.1.3 Thu 2022-03-31 20:32:38 UTC\n\nEntry Count: 112\nCapacity:\t23387\n\n=============== ====== ======= ========= ===== ========================== =========== ======== ======\nIP Prefix \t\tPort \tProto \tTenant \t  VRF   Service \t\t\t\t  Next Hops   Vector   Cost\n=============== ====== ======= ========= ===== ========================== =========== ======== ======\n172.16.1.3/32\t 67\t\tUDP\t\tdhcp.demo  -\t_dhcp_relay_5_172.16.1.3  192.168.1.9\t -\t\t 0\n\nCompleted in 0.15 seconds\n\nadmin@node1.Branch2# show fib service-name _bgp_Branch1_R1 Thu 2022-03-31 20:33:05 UTC\n\nEntry Count: 112\nCapacity:\t23387\n\n=============== ====== ======= ============= ===== ========================== =========== ======== ======\nIP Prefix \t\tPort \tProto \tTenant \t  \t VRF    Service \t\t\t\t  Next Hops   Vector   Cost\n=============== ====== ======= ============= ===== ========================== =========== ======== ======\n2.2.2.1/32\t\t179\t\tTCP\t   _bgp_speaker_   -\t_bgp_Branch1_R1\t\t\t  192.168.1.9\t -\t\t  0\n"})}),"\n",(0,r.jsx)(e.h3,{id:"sample-configuration-2",children:"Sample Configuration"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'config\n\tauthority\n\t\tservice \t\tdhcp_relay\n\t\t\tname \t\t\tdhcp_relay\n\t\t\taccess-policy \tdhcp.demo\n\t\t\t\tsource \t\tdhcp.demo\n\t\t\texit\n\n\t\t\tshare-service-routes \tfalse\n\t\t\tapplication-type \t\tdhcp-relay\n\t\texit\n\texit\nexit\n\nconfig\n\tauthority\n\t\tservice \t\t_dhcp_relay_5_172.16.1.3\n\t\t\tname \t\t\t_dhcp_relay_5_172.16.1.3\n\t\t\tdescription \t"Auto generated DHCP relay service for DHCP server 172.16.1.3"\n\t\t\tenabled \t\ttrue\n\t\t\tscope \t\t\tprivate\n\t\t\ttap-multiplexing \tfalse\n\t\t\ttransport \t\tudp\n\t\t\t\tprotocol \tudp\n\n\t\t\t\tport-range \t67\n\t\t\t\t\tstart-port \t67\n\t\t\t\t\tend-port \t67\n\t\t\t\texit\n\t\t\texit\n\n\t\t\taddress \t172.16.1.3/32\n\t\t\tgenerate-categories \tfalse\n\t\t\taccess-policy-generated false\n\n\t\t\taccess-policy \t\tdhcp.demo\n\t\t\t\tsource \t\t\tdhcp.demo\n\t\t\t\tpermission \t\tallow\n\t\t\texit\n\n\t\t\tshare-service-routes \tfalse\n\t\t\tsource-nat \t\t\t\tdisabled\n\t\t\tapplication-type generic\n\t\t\tfqdn-resolution-type \tv4\n\n\t\t\tsession-record\n\t\t\t\tinclude-hierarchical-services \ttrue\n\t\t\texit\n\n\t\t\tgenerated \t\tfalse\n\t\texit\n\texit\nexit\n\nconfig\n\tauthority\n\t\trouter \t\tBranch1\n\t\t\tname \t\t\tBranch1\n\t\t\tservice-route \tdhcp_relay_service-route\n\t\t\t\tname \t\t\tdhcp_relay_service-route\n\t\t\t\tservice-name \tdhcp_relay\n\t\t\t\tnat-target \t\t172.16.1.3\n\t\t\t\tnext-hop \t\tnode1 lan1\n\t\t\t\t\tnode-name \tnode1\n\t\t\t\t\tinterface \tlan1\n\t\t\t\texit\n\t\t\texit\n\t\texit\n\texit\nexit\n\nconfig\n\tauthority\n\t\trouter \tBranch1\n\t\t\tname \tBranch1\n\t\t\tservice-route \t_dhcp_relay_dhcp_relay_service-route\n\t\t\t\tname \t\t\t_dhcp_relay_dhcp_relay_service-route\n\t\t\t\tservice-name \t_dhcp_relay_5_172.16.1.3\n\t\t\t\tenable-failover false\n\t\t\t\tgenerated \t\tfalse\n\t\t\t\tuse-learned-routes\n\t\t\t\t\n\t\t\t\treachability-detection\n\t\t\t\t\tenabled \t\t\tfalse\n\t\t\t\t\tdetection-window \t5\n\t\t\t\texit\n\t\t\texit\n\t\texit\n\texit\nexit\n'})})]})}function h(t={}){const{wrapper:e}={...(0,i.R)(),...t.components};return e?(0,r.jsx)(e,{...t,children:(0,r.jsx)(l,{...t})}):l(t)}},80547:(t,e,n)=>{n.d(e,{A:()=>r});const r=n.p+"assets/images/dhcp_relay_arch-f7ff65e65489d9559496eab006599bdf.jpg"},28453:(t,e,n)=>{n.d(e,{R:()=>s,x:()=>c});var r=n(96540);const i={},a=r.createContext(i);function s(t){const e=r.useContext(a);return r.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function c(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:s(t.components),r.createElement(a.Provider,{value:e},t.children)}}}]);