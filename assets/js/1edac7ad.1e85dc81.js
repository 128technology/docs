"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[2985],{14999:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var t=i(74848),r=i(28453);const s={title:"Multicast",sidebar_label:"Multicast"},o=void 0,a={id:"config_multicast",title:"Multicast",description:"Multicast is a \u201cone source, many destinations\u201d method of traffic distribution, meaning only the destinations that explicitly indicate their need to receive the information from a particular source receive the traffic stream.",source:"@site/docs/config_multicast.md",sourceDirName:".",slug:"/config_multicast",permalink:"/docs/config_multicast",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Multicast",sidebar_label:"Multicast"},sidebar:"docs",previous:{title:"VLAN Support on PPPoE",permalink:"/docs/howto_pppoe_vlan"},next:{title:"Link Aggregation and LACP",permalink:"/docs/config_lacp"}},c={},d=[{value:"Version History",id:"version-history",level:4},{value:"Multicast on the SSR",id:"multicast-on-the-ssr",level:2},{value:"Multicast Configuration",id:"multicast-configuration",level:3},{value:"Configuration Process",id:"configuration-process",level:3},{value:"Configuration for rtr2",id:"configuration-for-rtr2",level:4},{value:"Configuration for Spoke 1 (rtr0)",id:"configuration-for-spoke-1-rtr0",level:4},{value:"Configuration for Spoke 2 (rtr1)",id:"configuration-for-spoke-2-rtr1",level:4},{value:"Configure the Service",id:"configure-the-service",level:4},{value:"Other Considerations",id:"other-considerations",level:4},{value:"Multicast Source Discovery Protocol (MSDP)",id:"multicast-source-discovery-protocol-msdp",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Show Commands",id:"show-commands",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Multicast is a \u201cone source, many destinations\u201d method of traffic distribution, meaning only the destinations that explicitly indicate their need to receive the information from a particular source receive the traffic stream."}),"\n",(0,t.jsx)(n.p,{children:"Network applications that can function with unicast but are better suited for multicast include collaborative groupware, teleconferencing, periodic or \u201cpush\u201d data delivery (stock quotes, sports scores, magazines, newspapers, and advertisements), server or website replication, and distributed interactive simulation (DIS) such as war simulations or virtual reality. Any IP network concerned with reducing network resource overhead for one-to-many or many-to-many data or multimedia applications with multiple receivers benefits from multicast."}),"\n",(0,t.jsxs)(n.p,{children:["Please refer to the ",(0,t.jsx)(n.a,{href:"https://www.juniper.net/documentation/us/en/software/junos/multicast/topics/concept/multicast-ip-overview.html",children:"Juniper Multicast Overview"})," for more in-depth information about Multicast."]}),"\n",(0,t.jsx)(n.h4,{id:"version-history",children:"Version History"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Release"}),(0,t.jsx)(n.th,{children:"Modification"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"6.1.0"}),(0,t.jsx)(n.td,{children:"This feature was introduced"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"6.2.0"}),(0,t.jsx)(n.td,{children:"Added support for MSDP, SSR as RP"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"multicast-on-the-ssr",children:"Multicast on the SSR"}),"\n",(0,t.jsx)(n.p,{children:"Multicast on the SSR supports the following protocols and topology:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"PIM Sparse-Mode"}),"\n",(0,t.jsx)(n.li,{children:"PIM Source-Specific Multicast (PIM-SSM)"}),"\n",(0,t.jsx)(n.li,{children:"Static Configuration of RP"}),"\n",(0,t.jsx)(n.li,{children:"IGMP v2/v3"}),"\n",(0,t.jsx)(n.li,{children:"Multicast over SVR in Hub and Spoke topology"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"multicast-configuration",children:"Multicast Configuration"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["In order to support Multicast over SVR, the BGP over SVR configuration is used in conjunction with the PIM configuration to generate auto-provisioned services and service-paths. BGP over SVR must be provisioned to support the Multicast feature. See ",(0,t.jsx)(n.a,{href:"/docs/config_bgp#bgp-over-svr-bgposvr",children:"BGP over SVR"})," for configuration details."]})}),"\n",(0,t.jsx)(n.p,{children:"The following are the components necessary to configure multicast over SVR on the SSR. Configuration for each of the components is provided below, and a full example configuration is provided at the end of this process."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Routing Interface: Specify the BGP over SVR interface"}),"\n",(0,t.jsxs)(n.li,{children:["BGP over SVR: See ",(0,t.jsx)(n.a,{href:"/docs/config_bgp#bgp-over-svr-bgposvr",children:"BGP over SVR"})," for configuration details."]}),"\n",(0,t.jsx)(n.li,{children:"Routing protocol such as IGMPv2/v3"}),"\n",(0,t.jsx)(n.li,{children:"PIM"}),"\n",(0,t.jsx)(n.li,{children:"RP: The Rendezvous Point. In the initial implementation (v6.1.x), the RP must be external to the SSR. This has been revised and the configuration below offers both configurations."}),"\n",(0,t.jsx)(n.li,{children:"Service: Services are created for the multicast traffic, and defined for the Group address."}),"\n",(0,t.jsx)(n.li,{children:"Multicast-sender-policy: Defines the tenant that is allowed to be the source of the multicast stream."}),"\n",(0,t.jsx)(n.li,{children:"Access Policy: Configures the tenants allowed to receive the multicast traffic via IGMP joins at routers in the network."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.a,{href:"/docs/config_tenants",children:"Tenants"})," for more information on configuring Tenants."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Multicast Source Discovery Protocol (MSDP) is a protocol that allows inter-domain multicast communication. MSDP is only valid for the Any-Source Multicast (ASM) model. If the Source-Specific Multicast (SSM) model is used, MSDP will not send Source-Active (SA) messages to indicate an active source."})}),"\n",(0,t.jsx)(n.h3,{id:"configuration-process",children:"Configuration Process"}),"\n",(0,t.jsx)(n.p,{children:"The following diagram represents a simple multicast configuration. A Client sends a multicast to address 225.1.1.1. Location1 and Location2 want to receive this multicast stream. The network is setup to use an external, non-SSR Rendezvous Point (RP) at 20.20.20.20 for all multicast traffic. This router is 192.168.22.2 and is configured for BGP with SSR rtr2. It advertises 20.20.20.20 as the RP for multicast into BGP,  allowing the SSR network to identify the path to the RP."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Multicast diagram",src:i(67932).A+"",width:"2190",height:"1334"})}),"\n",(0,t.jsx)(n.p,{children:"Key points in the rtr2 configuration:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"BGP is configured with the external router, 192.168.22.2"}),"\n",(0,t.jsx)(n.li,{children:"BGP over SVR is configured with two spokes"}),"\n",(0,t.jsx)(n.li,{children:"PIM is configured on the LAN interface towards the external router"}),"\n",(0,t.jsxs)(n.li,{children:["The tenant ",(0,t.jsx)(n.code,{children:"edsel"})," is configured on the LAN interface"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"configuration-for-rtr2",children:"Configuration for rtr2"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"config\n    authority\n        router  rtr2\n            node                 node1\n                name              node1\n                device-interface  eth6\n                    network-interface  lan3\n                        name       lan3\n                        tenant     edsel\n                        address    192.168.22.1\n                            ip-address     192.168.22.1\n                            prefix-length  30\n                            gateway        192.168.22.2\n                        exit\n                    exit\n                exit\n            exit\n            routing              default-instance\n                type              default-instance\n                routing-protocol  bgp\n                    type            bgp\n                    local-as        65128\n                    neighbor        192.168.22.2\n                        neighbor-address  192.168.22.2\n                        neighbor-as       65100\n                    exit\n                    neighbor        192.168.128.0\n                        neighbor-address  192.168.128.0\n                        neighbor-as       65128\n                        transport\n\n                            local-address\n                                routing-interface  loopback0\n                            exit\n                        exit\n                        address-family    ipv4-unicast\n                            afi-safi       ipv4-unicast\n                            next-hop-self  true\n                        exit\n                    exit\n                    neighbor        192.168.128.1\n                        neighbor-address  192.168.128.1\n                        neighbor-as       65128\n                        transport\n\n                            local-address\n                                routing-interface  loopback0\n                            exit\n                        exit\n                        address-family    ipv4-unicast\n                            afi-safi       ipv4-unicast\n                            next-hop-self  true\n                        exit\n                    exit\n                exit\n                pim\n                    interface  node1 lan3\n                        node       node1\n                        interface  lan3\n                    exit\n                    rp         224.0.0.0/4\n                        address      20.20.20.20\n                        group-range  224.0.0.0/4\n                    exit\n                exit\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To use ",(0,t.jsx)(n.code,{children:"rtr2"})," as the Rendezvous Point, the existing static RP configuration takes the IP address of the RP. This address should be a routable address configured on ",(0,t.jsx)(n.code,{children:"rtr2"}),". The SSR detects this address as one of its local interfaces and assumes the role of RP. It is recommended to create a routing-interface (unrelated to BGPoSVR configuration) to be a routable address of the local RP. This routing interface must be advertised in the routing protocol. To do this either enable OSPF on the interface, or advertise the address using a BGP network command. For example:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Create the Routing Interface:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"           routing      default-instance\n                type    default-instance\n                interface       loopback-rp\n                    name        loopback-rp\n                    ip-address  192.168.128.0\n                exit\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Advertise the Address using BGP:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"               routing-protocol     bgp\n                    type            bgp\n                    address-family      ipv4-unicast\n                        afi-safi        ipv4-unicast\n                        network         192.168.128.0/32\n                            network-address     192.168.128.0/32\n                        exit\n                    exit\n"})}),"\n",(0,t.jsx)(n.h4,{id:"configuration-for-spoke-1-rtr0",children:"Configuration for Spoke 1 (rtr0)"}),"\n",(0,t.jsx)(n.p,{children:"Key points for the Spoke configuration - this applies to each spoke, since the configuration is nearly identical."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"BGP over SVR configured to the hub"}),"\n",(0,t.jsx)(n.li,{children:"PIM configured with the same RP on the LAN interface"}),"\n",(0,t.jsx)(n.li,{children:"IGMP configured on the LAN interface"}),"\n",(0,t.jsxs)(n.li,{children:["Using tenant ",(0,t.jsx)(n.code,{children:"studebaker"})," on the LAN where the IGMP joins originate"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"config\n    authority\n        router  rtr0\n            node                 node1\n                device-interface  eth3\n                    network-interface  lan0\n                        tenant     studebaker\n                        address    192.168.0.1\n                            ip-address     192.168.0.1\n                            prefix-length  24\n                        exit\n                    exit\n                exit\n            exit\n            routing              default-instance\n                type              default-instance\n                interface         loopback0\n                    name        loopback0\n                    ip-address  192.168.128.0\n                exit\n                routing-protocol  bgp\n                    type            bgp\n                    local-as        65128\n                    address-family  ipv4-unicast\n                        afi-safi  ipv4-unicast\n                        network   192.168.0.0/24\n                            network-address  192.168.0.0/24\n                        exit\n                    exit\n                    neighbor        192.168.128.2\n                        neighbor-address  192.168.128.2\n                        neighbor-as       65128\n                        transport\n\n                            local-address\n                                routing-interface  loopback0\n                            exit\n                        exit\n                    exit\n                exit\n                igmp\n                    interface  node1 lan0\n                        node       node1\n                        interface  lan0\n                    exit\n                exit\n                pim\n                    interface  node1 lan0\n                        node       node1\n                        interface  lan0\n                    exit\n                    rp         225.0.0.0/4\n                        address      20.20.20.20\n                        group-range  225.0.0.0/4\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,t.jsx)(n.h4,{id:"configuration-for-spoke-2-rtr1",children:"Configuration for Spoke 2 (rtr1)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"config\n    authority\n        router  rtr1\n            node                 node1\n                device-interface  eth3\n                    network-interface  lan0\n                        tenant     studebaker\n                        address    192.168.1.1\n                            ip-address     192.168.1.1\n                            prefix-length  24\n                        exit\n                    exit\n                exit\n            exit\n            routing              default-instance\n                type              default-instance\n                interface         loopback0\n                    name        loopback0\n                    ip-address  192.168.128.1\n                exit\n                routing-protocol  bgp\n                    type            bgp\n                    local-as        65128\n                    address-family  ipv4-unicast\n                        afi-safi  ipv4-unicast\n                        network   192.168.1.0/24\n                            network-address  192.168.1.0/24\n                        exit\n                    exit\n                    neighbor        192.168.128.2\n                        neighbor-address  192.168.128.2\n                        neighbor-as       65128\n                        transport\n                            local-address\n                                routing-interface  loopback0\n                            exit\n                        exit\n                    exit\n                exit\n                igmp\n                    interface  node1 lan0\n                        node       node1\n                        interface  lan0\n                    exit\n                exit\n                pim\n                    interface  node1 lan0\n                        node       node1\n                        interface  lan0\n                    exit\n                    rp         224.0.0.0/4\n                        address      20.20.20.20\n                        group-range  224.0.0.0/4\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,t.jsx)(n.h4,{id:"configure-the-service",children:"Configure the Service"}),"\n",(0,t.jsxs)(n.p,{children:["The service allows the traffic to flow. It allows the tenant from the hub ",(0,t.jsx)(n.code,{children:"edsel"})," to send the multicast stream, and the tenants ",(0,t.jsx)(n.code,{children:"studebaker"})," on each spoke can join and receive the multicast stream."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"config\n    authority\n        service  multicast\n            name                     multicast\n            address                  224.0.0.0/4\n            access-policy            studebaker\n                source  studebaker\n            exit\n            multicast-sender-policy  edsel\n                source  edsel\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,t.jsx)(n.h4,{id:"other-considerations",children:"Other Considerations"}),"\n",(0,t.jsx)(n.p,{children:"While this configuration example uses one RP for the multicast range, you can use different RPs for different multicast addresses or ranges. The same can be done for the service; smaller services for more specific ranges of multicast with different senders and receivers as needed."}),"\n",(0,t.jsx)(n.h2,{id:"multicast-source-discovery-protocol-msdp",children:"Multicast Source Discovery Protocol (MSDP)"}),"\n",(0,t.jsx)(n.p,{children:"MSDP is used to allow RPs to share the active Multicast Sources. Messages are sent as Source-Active (SA) messages between MSDP peers. In normal MSDP operation, an MSDP peer is received from one peer and forwarded to the other MSDP peers. To ensure there are no loops, RPF checks have been put in place."}),"\n",(0,t.jsxs)(n.p,{children:["MSDP can also be configured as a ",(0,t.jsx)(n.code,{children:"mesh-group"}),". In this mode, the SA messages received from a peer are not forwarded to the other members of the mesh-group, since all the peers are configured as part of the mesh. This is commonly used with Anycast RPs, where the same RP address is configured on multiple routers in the network. The Anycast RP routers use an MSDP mesh-group to distribute the active source information to the other anycast RPs. This provides redundancy in the network, in case an RP fails."]}),"\n",(0,t.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.p,{children:"MSDP can be configured on the router as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"authority\n    router A\n        routing default-instance\n            msdp\n                peer 10.10.10.2 source 16.0.0.2\n            exit\n        exit\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Alternatively, MSDP can be configured with a ",(0,t.jsx)(n.code,{children:"mesh-group"}),". A mesh-group is similar to an IBGP peering relationship, in that the received SA messages are not forwarded to other members of the mesh-group."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"authority\n    router A\n        routing default-instance\n            msdp\n                peer 10.10.10.2 source 16.0.0.2\n                mesh-group myMesh \n                    source 16.0.0.2\n                    member 11.11.11.1\n                exit\n            exit\n        exit\n"})}),"\n",(0,t.jsx)(n.p,{children:"MSDP can also be enabled in a VRF:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"authority\n    router A\n        routing default-instance\n            vrf     vrfA\n                msdp\n                    peer     10.10.10.2 source 16.0.0.2\n                exit\n            exit\n        exit\n"})}),"\n",(0,t.jsx)(n.h2,{id:"show-commands",children:"Show Commands"}),"\n",(0,t.jsx)(n.p,{children:"Each of the commands listed below and the subcommands for each, provide additional details for multicast visibility. Use the links to learn more about each command."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Command"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-igmp-interface",children:"show igmp interface"})}),(0,t.jsx)(n.td,{children:"Display the igmp interfaces"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-igmp-groups",children:"show igmp groups"})}),(0,t.jsx)(n.td,{children:"Display the igmp groups"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-msdp-peer",children:"show msdp peer"})}),(0,t.jsx)(n.td,{children:"Display MSDP peer information"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-msdp-mesh-group",children:"show msdp mesh-group"})}),(0,t.jsx)(n.td,{children:"Display MSDP mesh-group details"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-msdp-sa",children:"show msdp sa"})}),(0,t.jsx)(n.td,{children:"Display MSDP source active"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-pim-mroute",children:"show pim mroute"})}),(0,t.jsx)(n.td,{children:"Display the PIM mroute"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-pim-interface",children:"show pim interface"})}),(0,t.jsx)(n.td,{children:"Display the PIM interface"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-pim-join",children:"show pim join"})}),(0,t.jsx)(n.td,{children:"Display the PIM Joins"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-pim-neighbor",children:"show pim neighbor"})}),(0,t.jsx)(n.td,{children:"Display the PIM neighbor"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-pim-rp-info",children:"show pim rp-info"})}),(0,t.jsx)(n.td,{children:"Display the PIM RP info"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/docs/cli_reference#show-pim-state",children:"show pim state"})}),(0,t.jsx)(n.td,{children:"Display the PIM state"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Each show command allows a vrf option:\n",(0,t.jsx)(n.code,{children:"show ip igmp [vrf <vrfname>]"})]})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},67932:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/config_multicast-eb4c9e95be96de9f18006430c37f6e27.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(96540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);