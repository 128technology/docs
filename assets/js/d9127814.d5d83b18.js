"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[6581],{49211:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var r=n(74848),i=n(28453);const s={title:"HTTP Probe Reachability Detection Plugin",sidebar_label:"HTTP Probe Reachability Detection"},o=void 0,a={id:"plugin_http_probe",title:"HTTP Probe Reachability Detection Plugin",description:"The http-probe plugin is designed to leverage the reachability detection APIs that were introduced in the SSR as of 5.2.0 version of software. More documentation on the core product feature can be found here",source:"@site/docs/plugin_http_probe.md",sourceDirName:".",slug:"/plugin_http_probe",permalink:"/docs/plugin_http_probe",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"HTTP Probe Reachability Detection Plugin",sidebar_label:"HTTP Probe Reachability Detection"},sidebar:"docs",previous:{title:"HA Sync Redundancy Plugin",permalink:"/docs/plugin_ha_sync_redundancy"},next:{title:"ICMP Reachability Detection",permalink:"/docs/plugin_icmp_reachability_detection"}},l={},d=[{value:"Overview",id:"overview",level:2},{value:"Configuration Snippet",id:"configuration-snippet",level:2},{value:"HTTP Probe Profile configuration",id:"http-probe-profile-configuration",level:3},{value:"SLA",id:"sla",level:3},{value:"Version History",id:"version-history",level:5},{value:"Proxy Settings",id:"proxy-settings",level:3},{value:"Version History",id:"version-history-1",level:5},{value:"HTTP Probe Log Level",id:"http-probe-log-level",level:3},{value:"Service Route Configuration",id:"service-route-configuration",level:3},{value:"Probe reachability",id:"probe-reachability",level:3},{value:"Up Delay Timer",id:"up-delay-timer",level:3},{value:"Version History",id:"version-history-2",level:5},{value:"Use Cases",id:"use-cases",level:2},{value:"Path selection",id:"path-selection",level:3},{value:"Proportional Load balancing via destination NATs",id:"proportional-load-balancing-via-destination-nats",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Checking the probe status",id:"checking-the-probe-status",level:3},{value:"Triggering Manual Failover Or Recovery",id:"triggering-manual-failover-or-recovery",level:2},{value:"Metrics",id:"metrics",level:3},{value:"Release Notes",id:"release-notes",level:2},{value:"Release 2.3.0",id:"release-230",level:3},{value:"New Features and Improvements",id:"new-features-and-improvements",level:4},{value:"Issues Fixed",id:"issues-fixed",level:4},{value:"Release 2.2.0",id:"release-220",level:3},{value:"New Features and Improvements",id:"new-features-and-improvements-1",level:4},{value:"Release 2.1.0",id:"release-210",level:3},{value:"New Features and Improvements",id:"new-features-and-improvements-2",level:4},{value:"Issues Fixed",id:"issues-fixed-1",level:4},{value:"Release 2.0.0",id:"release-200",level:3},{value:"Release 1.2.0",id:"release-120",level:3},{value:"New Features and Improvements",id:"new-features-and-improvements-3",level:4},{value:"Release 1.0.2",id:"release-102",level:3},{value:"Issues Fixed",id:"issues-fixed-2",level:4},{value:"Release 1.0.1",id:"release-101",level:3},{value:"Issues Fixed",id:"issues-fixed-3",level:4}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["The http-probe plugin is designed to leverage the reachability detection APIs that were introduced in the SSR as of 5.2.0 version of software. More documentation on the core product feature can be found ",(0,r.jsx)(t.a,{href:"/docs/config_service_health",children:"here"})]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["The instructions for installing and managing the plugin can be found ",(0,r.jsx)(t.a,{href:"/docs/plugin_intro#installation-and-management",children:"here"}),"."]})}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(t.p,{children:"Once installed and configured properly, the plugin will do the following operations on the router."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Launch a set of HTTP(s) monitor services which will probe the configured HTTP or HTTPs URL at the configured frequency"}),"\n",(0,r.jsx)(t.li,{children:"Periodically update the load-balancer APIs with the up/down status on service-paths associated with the http-probes"}),"\n"]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"For HTTPS probes, the client will allow self-signed certificates for inspecting the reachability status of the service."})}),"\n",(0,r.jsx)(t.h2,{id:"configuration-snippet",children:"Configuration Snippet"}),"\n",(0,r.jsx)(t.p,{children:"The plugin leverages the existing SSR reachability detection and enforcement configuration within the service-route on the router."}),"\n",(0,r.jsx)(t.h3,{id:"http-probe-profile-configuration",children:"HTTP Probe Profile configuration"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Config Path: authority > router[name] > http-probe-profile"}),"\n",(0,r.jsx)(t.li,{children:"Config Fields:"}),"\n"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Constraints"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"name"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:"key"}),(0,r.jsx)(t.td,{children:"The name of the http probe profile"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"url"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:"max: 2048"}),(0,r.jsx)(t.td,{children:"A valid http or https URL to be used for availability checking"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"probe-interval"}),(0,r.jsx)(t.td,{children:"uint32"}),(0,r.jsx)(t.td,{children:"default: 10"}),(0,r.jsx)(t.td,{children:"The duration (in seconds) of how often to perform a link test to the destination"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"number-of-attempts"}),(0,r.jsx)(t.td,{children:"uint32"}),(0,r.jsx)(t.td,{children:"default: 4"}),(0,r.jsx)(t.td,{children:"The number of consecutive HTTP(s) requests to be sent within the probe-duration before deciding that destination is unreachable"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"probe-duration"}),(0,r.jsx)(t.td,{children:"uint32"}),(0,r.jsx)(t.td,{children:"default: 5"}),(0,r.jsx)(t.td,{children:"The duration (in seconds) within which to reach the destination. Each attempt will be made in (probe-duration / number-of-attempts) interval"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"valid-status-code"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:"at least 1 value required"}),(0,r.jsx)(t.td,{children:"The list of valid status codes to be expected from the server"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"sla"}),(0,r.jsx)(t.td,{children:"container"}),(0,r.jsx)(t.td,{children:"optional"}),(0,r.jsxs)(t.td,{children:["SLA requirements for http probe. See ",(0,r.jsx)(t.a,{href:"#sla",children:"SLA"})," for more information."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"up-delay-timer"}),(0,r.jsx)(t.td,{children:"uint32"}),(0,r.jsx)(t.td,{children:"default: 0"}),(0,r.jsx)(t.td,{children:"The duration (in seconds) a probe is held down before transitioning from down to up state"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proxy-settings"}),(0,r.jsx)(t.td,{children:"container"}),(0,r.jsx)(t.td,{children:"optional"}),(0,r.jsxs)(t.td,{children:["Proxy settings if choosing to use proxy. See ",(0,r.jsx)(t.a,{href:"#proxy-settings",children:"Proxy Settings"})," for more information."]})]})]})]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Example:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-config",metastring:"{9-14}",children:"\nconfig\n\n    authority\n\n        router  my-router\n            name                my-router\n\n            http-probe-profile  http-probe-1\n                name               http-probe-1\n                url                http://172.16.2.5:5060/\n                probe-interval     60\n                number-of-attempts 5\n                probe-duration     20\n                valid-status-code  202\n                valid-status-code  200\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Above configuration runs http probe as follow:\n",(0,r.jsx)(t.img,{alt:"Http Probe Timeline",src:n(1790).A+"",width:"2475",height:"771"}),"\nBased on the configuration, every test runs five probe attempts. Each attempt runs with a two second hard timeout, calculated by the ",(0,r.jsx)(t.code,{children:"probe-duration"})," divided by the ",(0,r.jsx)(t.code,{children:"number-of-attempts"}),". Each probe may fail due to a request failure, timeout reached, or an invalid response code. Service path status is determined at the end of the probe duration and the current status will remain until the end of the next test."]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"Each router can configure up to 10 http probe profiles."})}),"\n",(0,r.jsx)(t.h3,{id:"sla",children:"SLA"}),"\n",(0,r.jsx)(t.h5,{id:"version-history",children:"Version History"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Release"}),(0,r.jsx)(t.th,{children:"Modification"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"1.2.0"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"http-probe-profile > sla"})," introduced"]})]})})]}),"\n",(0,r.jsxs)(t.p,{children:["SLA can be configured to add additional criteria to determine probe test success. The result of a probe test is based on number of probe attempts defined in the ",(0,r.jsx)(t.code,{children:"http probe profile"})," configuration. Certain validations are applied to SLA configuration. ",(0,r.jsx)(t.code,{children:"max-loss"})," should be less than ",(0,r.jsx)(t.code,{children:"number-of-attempts"}),", ",(0,r.jsx)(t.code,{children:"max-jitter"})," and ",(0,r.jsx)(t.code,{children:"average-rtt"})," should be less than the single probe timeout calculated by ",(0,r.jsx)(t.code,{children:"probe-duration"})," / ",(0,r.jsx)(t.code,{children:"number-of-attempts"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"The below example sets SLA on the probe test; with these settings, the test will be triggered every 10 seconds, 3 probes with a single probe timeout of 2 seconds will be applied and max-loss of 2 is considered for every test."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"router\n    http-probe-profile      http-probe-1\n        name                http-probe-1\n        url                 http://172.16.2.5:5060/\n        valid-status-code   202\n        valid-status-code   200\n        probe-duration      6\n        probe-interval      10\n        number-of-attemps   3\n        sla\n            max-loss       2\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Example:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-config",metastring:"{9-14}",children:"router\n    http-probe-profile  http-probe-1\n        sla\n            max-jitter     300\n            max-loss       2\n            average-rtt    200\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"max-jitter"}),(0,r.jsx)(t.td,{children:"uint32"}),(0,r.jsx)(t.td,{children:"Maximum difference between the maximum and minimum RTT of the HTTP probe in milliseconds"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"average-rtt"}),(0,r.jsx)(t.td,{children:"unit32"}),(0,r.jsx)(t.td,{children:"Maximum average RTT for an HTTP probe test to be up in milliseconds"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"max-loss"}),(0,r.jsx)(t.td,{children:"unit8"}),(0,r.jsx)(t.td,{children:"Number of failed HTTP(s) probe requests to mark the test down"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"proxy-settings",children:"Proxy Settings"}),"\n",(0,r.jsx)(t.h5,{id:"version-history-1",children:"Version History"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Release"}),(0,r.jsx)(t.th,{children:"Modification"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"2.3.0"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"http-probe-profile > proxy-settings"})," introduced"]})]})})]}),"\n",(0,r.jsx)(t.p,{children:"Proxy settings can be used to specify the http proxy server to use when sending probe traffic."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"router\n    http-probe-profile      http-probe-1\n        name                http-probe-1\n        url                 http://172.16.2.5:5060/\n        valid-status-code   202\n        valid-status-code   200\n        probe-duration      6\n        probe-interval      10\n        number-of-attemps   3\n        proxy-settings\n            proxy-address   192.168.1.48\n            proxy-port      8080\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Constraints"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proxy-address"}),(0,r.jsx)(t.td,{children:"key"}),(0,r.jsx)(t.td,{children:"ipv4-address"}),(0,r.jsx)(t.td,{children:"Proxy server IP address."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proxy-port"}),(0,r.jsx)(t.td,{children:"optional"}),(0,r.jsx)(t.td,{children:"uint32"}),(0,r.jsx)(t.td,{children:"Proxy server port. If an address is given, this port will default to port 80."})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"http-probe-log-level",children:"HTTP Probe Log Level"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Config Path: authority > router[name] > http-probe"}),"\n",(0,r.jsx)(t.li,{children:"Config Fields:"}),"\n"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Constraints"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"log-level"}),(0,r.jsx)(t.td,{children:"enum"}),(0,r.jsx)(t.td,{children:"default: info"}),(0,r.jsx)(t.td,{children:"Http Probe Log Level"})]})})]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Example:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-config",metastring:"{9-14}",children:"\nconfig\n\n    authority\n\n        router  my-router\n            http-probe\n                log-level debug\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,r.jsx)(t.h3,{id:"service-route-configuration",children:"Service Route Configuration"}),"\n",(0,r.jsx)(t.p,{children:"Once the profile is created, the next step is to enable the reachability enforcement and probe detection for a non SVR service-route and reference the profile in that config."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Config Path: authority > router[name] > service-route[name] > reachability-detection"}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Config Fields:\nThe following fields should be enabled for the probe based detection to work. The http-probe mechanism is based on the concept of health probes described ",(0,r.jsx)(t.a,{href:"https://docs.128technology.com/docs/config_service_health/#health-probes",children:"here"}),". The configuration fields below are required for the system to react to the loadbalancer API calls that the plugin makes."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Value"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"enforcement"}),(0,r.jsx)(t.td,{children:"boolean"}),(0,r.jsx)(t.td,{children:"true"}),(0,r.jsx)(t.td,{children:"Toggle the configuration to be enabled for the reachability enforcement to take effect."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"probe-type"}),(0,r.jsx)(t.td,{children:"enumeration"}),(0,r.jsx)(t.td,{children:"always"}),(0,r.jsxs)(t.td,{children:["For probe based reachability detection to take effect the probe-type must be set to ",(0,r.jsx)(t.code,{children:"always"}),"."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"probe > probe-type"}),(0,r.jsx)(t.td,{children:"enumeration"}),(0,r.jsx)(t.td,{children:"http-probe"}),(0,r.jsxs)(t.td,{children:["The probe-type must be set to ",(0,r.jsx)(t.code,{children:"http-probe"})," in order to leverage the HTTP(s) based probing"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"probe > http-probe-profile"}),(0,r.jsx)(t.td,{children:"reference"}),(0,r.jsx)(t.td,{children:"-"}),(0,r.jsx)(t.td,{children:"Reference to a previously configured http-probe-profile on the router"})]})]})]}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"reachability-detection > probe"})," configuration allows for multiple probes of various types to be configured. All the probes for a given service-route must be up for the route to be considered as up."]})}),"\n",(0,r.jsx)(t.h3,{id:"probe-reachability",children:"Probe reachability"}),"\n",(0,r.jsxs)(t.p,{children:["The router should have a distinct path for the probe traffic. It is recommended that the user create dedicated services and service routes for this purpose. At this time, the plugin does not generate any configuration to ensure the reachability of the probe traffic to the destination. The probe will be originated in the default linux environment. In case of in-band management, the probe traffic will be associated with the ",(0,r.jsx)(t.code,{children:"_internal_"})," tenant so care must be taken to allow the tenant when creating such config. As a reference the following configuration represents a service and route to reach one of the HTTP probes in this document."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"config\n\n    authority\n\n        service  http-probe-1\n            name                  http-probe-1\n\n            transport             tcp\n                protocol    tcp\n\n                port-range  5060\n                    start-port  5060\n                exit\n            exit\n            address               172.16.2.5\n\n            access-policy         _internal_\n                source  _internal_\n                permission allow\n            exit\n            share-service-routes  false\n        exit\n\n        router  my-router\n            name           my-router\n\n            service-route  http-probe-rte-1\n                name          http-probe-rte-1\n                service-name  http-probe-1\n\n                next-hop      node1 wan\n                    node-name  node1\n                    interface  wan\n                exit\n            exit\n        exit\n\n    exit\nexit\n"})}),"\n",(0,r.jsx)(t.h3,{id:"up-delay-timer",children:"Up Delay Timer"}),"\n",(0,r.jsx)(t.h5,{id:"version-history-2",children:"Version History"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Release"}),(0,r.jsx)(t.th,{children:"Modification"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"2.1.0"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"http-probe-profile > up-delay-timer"})," introduced"]})]})})]}),"\n",(0,r.jsxs)(t.p,{children:["An ",(0,r.jsx)(t.code,{children:"up-delay-timer"})," can be configured on a probe to prevent a probe watching an unstable service path from coming up right away. When a probe state transitions from down to up, instead of bringing that probe up, if an ",(0,r.jsx)(t.code,{children:"up-delay-timer"})," is configured the probe will be kept down until the timer finishes. If the probe goes back down while the timer is running, the timer will cancel and the probe will remain down. If it is set to the default value (0) then the timer is disabled."]}),"\n",(0,r.jsxs)(t.p,{children:["It is recommended that a probe's ",(0,r.jsx)(t.code,{children:"up-delay-timer"})," has a value greater than the ",(0,r.jsx)(t.code,{children:"probe-interval"})," field. This configuration allows the probe to run at least one more time while the timer is active. A warning will be produced if a probe is configured with an ",(0,r.jsx)(t.code,{children:"up-delay-timer"})," value less than the ",(0,r.jsx)(t.code,{children:"probe-interval"}),". If a configuration reload occurs while a probe timer is active, the timer is honored with the previous config."]}),"\n",(0,r.jsxs)(t.p,{children:["The below example shows a probe with a configured ",(0,r.jsx)(t.code,{children:"up-delay-timer"}),"; with these settings, the test will be triggered every 10 seconds, 3 probes with a single probe timeout of 2 seconds will be applied and when the probe transitions from down > up it will be held down for 15 seconds."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"router\n    http-probe-profile      http-probe-1\n        name                http-probe-1\n        url                 http://172.16.2.5:5060/\n        valid-status-code   202\n        valid-status-code   200\n        probe-duration      6\n        probe-interval      10\n        number-of-attemps   3\n        up-delay-timer      15\n    exit\nexit\n"})}),"\n",(0,r.jsx)(t.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsx)(t.h3,{id:"path-selection",children:"Path selection"}),"\n",(0,r.jsx)(t.p,{children:"One of the primary use cases of the plugin would be to monitor the internet or some other service reachability by pinging an HTTP server over a given service path. This is very much similar in concept to the native ICMP probe functionality that exists in the product."}),"\n",(0,r.jsx)(t.h3,{id:"proportional-load-balancing-via-destination-nats",children:"Proportional Load balancing via destination NATs"}),"\n",(0,r.jsx)(t.p,{children:"In this use case, a particular service or workflow is designed to be load balanced across several upstream servers by doing a proportional load balancing along with destination NAT. In this use case, the SSR http-probe plugin can be used to monitor the service status of each of those upstream servers to determine if the particular server should be in service or not from routing perspective. The following configuration snippet builds on the example above to demonstrate this scenario."}),"\n",(0,r.jsxs)(t.p,{children:["In this example, both ",(0,r.jsx)(t.code,{children:"test-app-route-1"})," and ",(0,r.jsx)(t.code,{children:"test-app-route-2"})," are equal cost routes used for proportional load balancing."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-config",children:"config\n\n    authority\n\n        router  my-router\n            name           my-router\n\n            service-route  test-app-route-1\n                name                    test-app-route-1\n                service-name            test-app\n                vector                  path1\n                nat-target              172.16.2.5\n\n                next-hop                node1 wan-bb\n                    node-name  node1\n                    interface  wan-bb\n                exit\n\n                reachability-detection\n                    enabled               true\n                    enforcement           true\n                    reachability-profile  dummy\n                    probe-type            always\n\n                    probe                 probe1\n                        name                probe1\n                        http-probe-profile  http-probe-1\n                    exit\n                exit\n            exit\n\n            service-route  test-app-route-2\n                name                    test-app-route-2\n                service-name            test-app\n                vector                  path2\n                nat-target              172.16.3.5\n\n                next-hop                node1 wan-lte\n                    node-name  node1\n                    interface  wan-lte\n                exit\n\n                reachability-detection\n                    enabled               true\n                    enforcement           true\n                    reachability-profile  dummy\n                    probe-type            always\n\n                    probe                 probe2\n                        name                probe2\n                        http-probe-profile  http-probe-2\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n\nadmin@node1.conductor1#\n\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Each service-route is designed to probe a unique URL for that server and monitor the health of the service at the TCP socket level as well as the HTTP stack. When one of the servers either cannot be reached, responds with an unsuccessful status code (e.g. 404, 504 etc), or the configured ",(0,r.jsx)(t.a,{href:"#sla",children:"SLA"})," is not met, the service path is taken out of service."]}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:["When all the service routes associated with the same service are down, the default system behavior is to operates in a ",(0,r.jsx)(t.code,{children:"best-effort"})," mode in which the physical link and L2 connectivity is used to determine the health of the path. In this case, it is possible that sessions are routed to paths that are down from a probe perspective. As soon as one of the paths comes back in service, the load balancer will start using that path for all subsequent new sessions. The ",(0,r.jsx)(t.code,{children:"best-effort"})," flag can be set to false for the associated service-policy to disable this behavior."]})}),"\n",(0,r.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(t.h3,{id:"checking-the-probe-status",children:"Checking the probe status"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"show service-path"})," command can be used to view the current status of the probe and to view how the load balancer is interpreting the current status. For example:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"admin@node1.conductor1# show service-path router my-router node node1 service-name test-app\nSun 2021-11-07 03:19:33 UTC\nNode: node1.my-router Page 1\n\n========== ================== =============== =============== ============ =========== ======== ====== ====== ========== ==========\n Service    Service-Route      Type            Destination     Next-Hop     Interface   Vector   Cost   Rate   Capacity   State\n========== ================== =============== =============== ============ =========== ======== ====== ====== ========== ==========\n test-app   test-app-route-1   service-agent   172.16.2.5/32   172.16.2.5   wan-bb      path1     100      0   0/100      Up(Up)\n test-app   test-app-route-2   service-agent   172.16.3.5/32   172.16.3.5   wan-lte     path2     100      0   0/100      Up(Down)\n\nCompleted in 0.05 seconds\nadmin@node1.conductor1#admin@node1.conductor1#\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"show plugins state router <router-name> summary 128T-http-probe"})," command can be used to view the current status of the probe and whether the probe is being held down. For example:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"admin@node1.conductor1# show plugins state router my-router summary 128T-http-probe\nWed 2024-10-02 03:19:33 UTC\nTarget: node1.my-router\n\n============= ======== =========== =================\n Probe         Status   Held Down   Time Left (sec)\n============= ======== =========== =================\n test-probe1   up       True                      8\n test-probe2   down     False                     0\n\nRetrieved state data.\nCompleted in 0.05 seconds\n"})}),"\n",(0,r.jsxs)(t.p,{children:["In addition, the probe's running status in linux can be found by inspecting the ",(0,r.jsx)(t.code,{children:"128T-http-probe-status-change-notifier@<probe-name>.service"}),". For example,"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"# systemctl status 128T-http-probe-status-change-notifier@http-probe-2.service -l\n\u25cf 128T-http-probe-status-change-notifier@http-probe-2.service - HTTP Monitor Status change observer for destination http-probe-2\n   Loaded: loaded (/usr/lib/systemd/system/128T-http-probe-status-change-notifier@.service; static; vendor preset: disabled)\n   Active: inactive (dead) since Sun 2021-11-07 03:22:43 UTC; 8s ago\n  Process: 24823 ExecStart=/usr/libexec/128T-http-probe/scripts/loadbalancer_cli --probe-name ${NAME} determine-status --status ${STATUS} --code ${CODE} (code=exited, status=0/SUCCESS)\n Main PID: 24823 (code=exited, status=0/SUCCESS)\n\nNov 07 03:22:42 my-router.openstacklocal systemd[1]: Starting HTTP Monitor Status change observer for destination http-probe-2...\nNov 07 03:22:43 my-router.openstacklocal loadbalancer_cli[24823]: Determine status for probe http-probe-2 with status down and code 0\nNov 07 03:22:43 my-router.openstacklocal loadbalancer_cli[24823]: Skipping service-route test-app-route-1 with profile {'validStatusCode': [202, 200], 'probeDuration': 5, 'numberOfAttempts': 4, 'probeInterval': 10, 'name': 'http-probe-1', 'url': 'http://172.16.2.5:5060/'}\nNov 07 03:22:43 my-router.openstacklocal loadbalancer_cli[24823]: Processing service-route test-app-route-2 with profile {'validStatusCode': [202, 200], 'probeDuration': 5, 'numberOfAttempts': 4, 'probeInterval': 10, 'name': 'http-probe-2', 'url': 'http://172.16.3.5:5061/'}\nNov 07 03:22:43 my-router.openstacklocal loadbalancer_cli[24823]: http-probe-2: Setting service-path test-app-route-2 for service test-app as down\nNov 07 03:22:43 my-router.openstacklocal systemd[1]: Started HTTP Monitor Status change observer for destination http-probe-2.\n"})}),"\n",(0,r.jsx)(t.h2,{id:"triggering-manual-failover-or-recovery",children:"Triggering Manual Failover Or Recovery"}),"\n",(0,r.jsxs)(t.p,{children:["In some situations, it might be desirable to forcefully trigger a failover or recovery for an otherwise healthy path. In the above example, the primary ",(0,r.jsx)(t.code,{children:"http-probe-1"})," can be brought down by doing the following:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Stop the http-monitor service for the path instance"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# systemctl stop http-monitor@http-probe-1.service\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Edit the ",(0,r.jsx)(t.code,{children:"/var/run/128technology/plugins/http_monitor/{probe-name}.state"})," and set the ",(0,r.jsx)(t.code,{children:"STATUS=down"})]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# echo \"STATUS=down\" >> /var/run/128technology/plugins/http_monitor/http-probe-1.state\n\n# systemctl status 128T-http-probe-status-change-notifier@http-probe-1.service -l\n\u25cf 128T-http-probe-status-change-notifier@http-probe-1.service - HTTP Monitor Status change observer for destination http-probe-1\n   Loaded: loaded (/usr/lib/systemd/system/128T-http-probe-status-change-notifier@.service; static; vendor preset: disabled)\n   Active: inactive (dead) since Sun 2021-11-07 03:27:34 UTC; 45s ago\n  Process: 29533 ExecStart=/usr/libexec/128T-http-probe/scripts/loadbalancer_cli --probe-name ${NAME} determine-status --status ${STATUS} --code ${CODE} (code=exited, status=0/SUCCESS)\n Main PID: 29533 (code=exited, status=0/SUCCESS)\n\nNov 07 03:27:34 my-router.openstacklocal systemd[1]: Starting HTTP Monitor Status change observer for destination http-probe-1...\nNov 07 03:27:34 my-router.openstacklocal loadbalancer_cli[29533]: Determine status for probe http-probe-1 with status down and code 200\nNov 07 03:27:34 my-router.openstacklocal loadbalancer_cli[29533]: Processing service-route test-app-route-1 with profile {'validStatusCode': [202, 200], 'probeDuration': 5, 'numberOfAttempts': 4, 'probeInterval': 10, 'name': 'http-probe-1', 'url': 'http://172.16.2.5:5060/'}\nNov 07 03:27:34 my-router.openstacklocal loadbalancer_cli[29533]: http-probe-1: Setting service-path test-app-route-1 for service test-app as down\nNov 07 03:27:34 my-router.openstacklocal loadbalancer_cli[29533]: Skipping service-route test-app-route-2 with profile {'validStatusCode': [202, 200], 'probeDuration': 5, 'numberOfAttempts': 4, 'probeInterval': 10, 'name': 'http-probe-2', 'url': 'http://172.16.3.5:5061/'}\nNov 07 03:27:34 my-router.openstacklocal systemd[1]: Started HTTP Monitor Status change observer for destination http-probe-1.\n"})}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsxs)(t.p,{children:["The same steps can be used to bring ",(0,r.jsx)(t.code,{children:"up"})," a path that is currently ",(0,r.jsx)(t.code,{children:"down"})," by changing ",(0,r.jsx)(t.code,{children:"STATUS=up"})," in the steps above."]})}),"\n",(0,r.jsx)(t.h3,{id:"metrics",children:"Metrics"}),"\n",(0,r.jsx)(t.p,{children:"In-memory metrics were added for http probe SLA values"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"# show stats http-probe\nWed 2024-04-17 02:52:35 UTC\n\u2714 Retrieving statistics...\n\nHttp Probe Stats Metrics\n------------------------\n\n===================== ======= ==================== ====================\n Metric                Node    Probe-profile-name                Value\n===================== ======= ==================== ====================\n average-rtt           test2   http-probe-1                       0.12\n dns-resolution-time   test2   http-probe-1         2.1130787988658994\n jitter                test2   http-probe-1                       0.02\n loss                  test2   http-probe-1                          0\n max-rtt               test2   http-probe-1                       0.13\n min-rtt               test2   http-probe-1                       0.11\n updated               test2   http-probe-1         1718376794.8707266\n\n\nCompleted in 0.21 seconds\n"})}),"\n",(0,r.jsx)(t.h2,{id:"release-notes",children:"Release Notes"}),"\n",(0,r.jsx)(t.h3,{id:"release-230",children:"Release 2.3.0"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Release Date:"})," Apr 30, 2025"]}),"\n",(0,r.jsx)(t.h4,{id:"new-features-and-improvements",children:"New Features and Improvements"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-2505"})," HTTP Probe Proxy Support"]}),"\n"]}),"\n",(0,r.jsx)(t.h4,{id:"issues-fixed",children:"Issues Fixed"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-2959"})," Resolve copying unncessary files on image-based upgrade"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"release-220",children:"Release 2.2.0"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Release Date:"})," Jan 8, 2025"]}),"\n",(0,r.jsx)(t.h4,{id:"new-features-and-improvements-1",children:"New Features and Improvements"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-2505"})," Ensure server is restarted on upgrade"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-2505"})," Improved debuggability of probe and up-delay-timer"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"release-210",children:"Release 2.1.0"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Release Date:"})," Oct 31, 2024"]}),"\n",(0,r.jsx)(t.h4,{id:"new-features-and-improvements-2",children:"New Features and Improvements"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-2510"})," Implement an up-delay-timer"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The plugin allows users to configure an up-delay-timer which holds a path down for a set duration before bringing the path up."}),"\n",(0,r.jsx)(t.h4,{id:"issues-fixed-1",children:"Issues Fixed"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-2629"})," Display stats in older (5.X) SSR releases"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-2721"})," Resolve on plugin downgrade config removal"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"release-200",children:"Release 2.0.0"}),"\n",(0,r.jsx)(t.p,{children:"Image based install and upgrade (IBU) support for SSR 6.3.0."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Release Date:"})," Sep 30, 2024"]}),"\n",(0,r.jsx)(t.h3,{id:"release-120",children:"Release 1.2.0"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Release Date:"})," Aug 20, 2024"]}),"\n",(0,r.jsx)(t.h4,{id:"new-features-and-improvements-3",children:"New Features and Improvements"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-2300"})," Implement SLA monitoring per probe"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The plugin allows users to configure the following SLA settings: max-loss, max-jitter, average-rtt. These settings are considered as part of the probe success criteria. Additionally, these values are available through metrics."}),"\n",(0,r.jsx)(t.h3,{id:"release-102",children:"Release 1.0.2"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Release Date:"})," Apr 29, 2022"]}),"\n",(0,r.jsx)(t.h4,{id:"issues-fixed-2",children:"Issues Fixed"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-1680"})," The HTTP probe status takes a very long time to detect upstream failure"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Resolution:"})})," The logic for detecting upstream failures for combination of very small duration and retry has been improved upon."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"release-101",children:"Release 1.0.1"}),"\n",(0,r.jsx)(t.h4,{id:"issues-fixed-3",children:"Issues Fixed"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"PLUGIN-1640"})," Error downloading router components when http-probe plugin enabled on a router"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Resolution:"})})," Updated the salt states to provide the correct router components."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},1790:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/http-probe-timeline-73f1ce42782ac9b0e07c49066c27bfea.png"},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(96540);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);