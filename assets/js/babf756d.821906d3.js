"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[7698],{3905:function(e,t,r){r.d(t,{Zo:function(){return s},kt:function(){return d}});var o=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var u=o.createContext({}),l=function(e){var t=o.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},s=function(e){var t=l(e.components);return o.createElement(u.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,u=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=l(r),d=n,h=p["".concat(u,".").concat(d)]||p[d]||m[d]||a;return r?o.createElement(h,i(i({ref:t},s),{},{components:r})):o.createElement(h,i({ref:t},s))}));function d(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,i=new Array(a);i[0]=p;var c={};for(var u in t)hasOwnProperty.call(t,u)&&(c[u]=t[u]);c.originalType=e,c.mdxType="string"==typeof e?e:n,i[1]=c;for(var l=2;l<a;l++)i[l]=r[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}p.displayName="MDXCreateElement"},48798:function(e,t,r){r.r(t),r.d(t,{assets:function(){return s},contentTitle:function(){return u},default:function(){return d},frontMatter:function(){return c},metadata:function(){return l},toc:function(){return m}});var o=r(87462),n=r(63366),a=(r(67294),r(3905)),i=["components"],c={title:"Router Migration",sidebar_label:"Router Migration"},u=void 0,l={unversionedId:"howto_router_migration",id:"howto_router_migration",title:"Router Migration",description:"This process is used to migrate an existing conductor-managed router to a new conductor and infrastructure. From the PCLI, the command can be run from the existing conductor to automatically migrate the router to the new conductor, or it can be run from the router itself. Before perfoming the procedure below, the new conductor must be installed and configured, and both the old and the new conductors must be reachable. For steps to install a conductor, see Single Conductor Interactive Installation.",source:"@site/docs/howto_router_migration.md",sourceDirName:".",slug:"/howto_router_migration",permalink:"/docs/howto_router_migration",draft:!1,tags:[],version:"current",lastUpdatedAt:1706632135,formattedLastUpdatedAt:"Jan 30, 2024",frontMatter:{title:"Router Migration",sidebar_label:"Router Migration"},sidebar:"docs",previous:{title:"Onboard an SSR Device using OTP",permalink:"/docs/onboard_ssr_device_otp"},next:{title:"Image-Based Installation",permalink:"/docs/intro_installation_image"}},s={},m=[{value:"PCLI",id:"pcli",level:3},{value:"GUI",id:"gui",level:3},{value:"Verify Migration",id:"verify-migration",level:3}],p={toc:m};function d(e){var t=e.components,c=(0,n.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},p,c,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This process is used to migrate an existing conductor-managed router to a new conductor and infrastructure. From the PCLI, the command can be run from the existing conductor to automatically migrate the router to the new conductor, or it can be run from the router itself. Before perfoming the procedure below, the new conductor must be installed and configured, and both the old and the new conductors must be reachable. For steps to install a conductor, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/single_conductor_install"},"Single Conductor Interactive Installation"),"."),(0,a.kt)("h3",{id:"pcli"},"PCLI"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"migrate")," command automates the process of migrating a router to a new conductor. "),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Export the router configuration from the old conductor, and import and commit the router configuration to the new conductor. "),(0,a.kt)("p",{parentName:"li"},"A.) From the ",(0,a.kt)("strong",{parentName:"p"},"router PCLI")," (this will include only configuration for the specific router), run ",(0,a.kt)("inlineCode",{parentName:"p"},"show config running flat > /tmp/router_config.txt"),". The router configuration is exported to the temp directory as a text file."),(0,a.kt)("p",{parentName:"li"},"B.) Open the ",(0,a.kt)("inlineCode",{parentName:"p"},"router_config.txt")," file and remove the ",(0,a.kt)("inlineCode",{parentName:"p"},"conductor-address")," from the configuration. This prevents the import operation from overwriting the new conductor address with the old one. Adjust any routing configuration necessary for the router to reach the new conductor."),(0,a.kt)("p",{parentName:"li"},"C.) From the PCLI of the new conductor, import ",(0,a.kt)("inlineCode",{parentName:"p"},"/tmp/router_config.txt"),"."),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"< /tmp/router_config.txt")),(0,a.kt)("p",{parentName:"li"},"D.) Perform migration using the migrate command as shown in step 2 below.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Run the ",(0,a.kt)("inlineCode",{parentName:"p"},"migrate")," command from the old conductor: "),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"migrate conductor <new-address> router <router>")))),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"migrate conductor")," command uses WAN IP(s) to migrate a router from one conductor to another. Because of this, the command cannot be used when both the old and new conductor are behind the same head-end router and use ",(0,a.kt)("inlineCode",{parentName:"p"},"dest-nat")," or SVR to reach the Conductor. In this case, the WAN IP will be the same for both conductors and the migration will not work.")),(0,a.kt)("p",null,"In some situations, such as debugging or for monitoring purposes, the ",(0,a.kt)("inlineCode",{parentName:"p"},"migrate")," command can be run from the router: ",(0,a.kt)("inlineCode",{parentName:"p"},"migrate conductor <new_address>"),". However, it is recommended to execute the command from the conductor. "),(0,a.kt)("h3",{id:"gui"},"GUI"),(0,a.kt)("p",null,"When using the GUI, a ",(0,a.kt)("strong",{parentName:"p"},"Migrate")," button is visible for Routers that are possible to migrate. "),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"From the Authority menu, select Routers.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"On the Routers page, choose the router to migrate.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"At the top of the Router page, select the ",(0,a.kt)("strong",{parentName:"p"},"More")," list (three vertical dots) to display the Migrate button."),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("img",{alt:"Migrate Button",src:r(62807).Z,width:"1400",height:"340"}))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Click the button to display the Migrate Router dialog."),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("img",{alt:"Migrate Dialog",src:r(10445).Z,width:"1824",height:"660"}))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Enter the new Conductor address(es). You can also choose to rollback to the existing configuration if there is a failure (recommended), or to force the configuration change regardless of errors.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Click ",(0,a.kt)("strong",{parentName:"p"},"Migrate"),"."))),(0,a.kt)("h3",{id:"verify-migration"},"Verify Migration"),(0,a.kt)("p",null,"After the migration command is run, you will see a ",(0,a.kt)("strong",{parentName:"p"},"Connected")," state on the conductor showing the migration was successful. The router(s) will transition to running after a few minutes. If a router does not migrate successfully, an error message will be displayed and no action will be taken."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Verify that the TCP ports 930, 4505 and 4506 on the conductor are enabled. The routers use these ports to communicate with the conductor."),(0,a.kt)("li",{parentName:"ul"},"If there is a firewall in front of the conductor, these same TCP ports must be enabled.")))}d.isMDXComponent=!0},62807:function(e,t,r){t.Z=r.p+"assets/images/howto_migrate_router_button-b26a885d7148a01d51a80f84b3339324.png"},10445:function(e,t,r){t.Z=r.p+"assets/images/howto_migrate_router_dialog-a8b4e415b6bb0b51f3ce1cdf7243d979.png"}}]);