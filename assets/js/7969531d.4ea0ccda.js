"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[2987],{87225:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>a});var t=r(74848),n=r(28453);const s={title:"Upgrades with Restricted Internet Access",sidebar_label:"Upgrades with Restricted Internet Access"},i=void 0,d={id:"upgrade_restricted_access",title:"Upgrades with Restricted Internet Access",description:"The standard upgrade workflow is for individual instances of SSR software to download upgrades directly from mirror servers hosted and managed by Juniper on the public internet. However, we recognize that there are deployments where the SSR does not have internet access. In this case, you can configure the routers to retrieve software from a conductor.",source:"@site/docs/upgrade_restricted_access.md",sourceDirName:".",slug:"/upgrade_restricted_access",permalink:"/docs/upgrade_restricted_access",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Upgrades with Restricted Internet Access",sidebar_label:"Upgrades with Restricted Internet Access"},sidebar:"docs",previous:{title:"Upgrading a Router",permalink:"/docs/upgrade_router"},next:{title:"Legacy Upgrades",permalink:"/docs/upgrade_legacy"}},c={},a=[{value:"Offline Mode",id:"offline-mode",level:2},{value:"Air-Gap Network Upgrade Process",id:"air-gap-network-upgrade-process",level:2},{value:"Import ISO",id:"import-iso",level:3},{value:"Selecting the Boot Volume",id:"selecting-the-boot-volume",level:3}];function l(e){const o={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.p,{children:"The standard upgrade workflow is for individual instances of SSR software to download upgrades directly from mirror servers hosted and managed by Juniper on the public internet. However, we recognize that there are deployments where the SSR does not have internet access. In this case, you can configure the routers to retrieve software from a conductor."}),"\n",(0,t.jsx)(o.p,{children:"There are four configurable software access modes on a router:"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.code,{children:"conductor-only"}),": The router retrieves software versions only from the conductor."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.code,{children:"prefer-conductor"}),": The router will retrieve software versions from the conductor, and fall back to using the internet."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.code,{children:"internet-only"})," (default): The router will use Juniper's publicly hosted repositories for retrieving software images."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.code,{children:"offline-mode"}),': This mode is used for conductors and routers that do not have internet access - "air-gap" networks.']}),"\n"]}),"\n",(0,t.jsxs)(o.p,{children:["In the ",(0,t.jsx)(o.code,{children:"router > system > software-update > repository"})," configuration, use the ",(0,t.jsx)(o.code,{children:"source-type"})," setting to define the software update repository to one of the first three values; ",(0,t.jsx)(o.code,{children:"conductor-only"}),", ",(0,t.jsx)(o.code,{children:"prefer-conductor"}),", or ",(0,t.jsx)(o.code,{children:"internet-only"}),"."]}),"\n",(0,t.jsx)(o.p,{children:"With each of these settings, the conductor(s) require internet access, and the routers must be able to resolve internet hosted repositories. Because the access mode is configured on the router, your collection of routers can each use different preferences. For example, a router on the internet can use a Juniper repository, but another router managed by the same conductor sitting in an isolated environment can use the conductor."}),"\n",(0,t.jsx)(o.h2,{id:"offline-mode",children:"Offline Mode"}),"\n",(0,t.jsxs)(o.p,{children:["In networks that do not have internet access, routers can be configured to override the ",(0,t.jsx)(o.code,{children:"source-type"})," setting and retrieve software directly from the conductor. In the GUI, set ",(0,t.jsx)(o.code,{children:"router > system > software-update > repository > offline-mode"})," to ",(0,t.jsx)(o.code,{children:"true"}),"."]}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.strong,{children:"From the PCLI:"})}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{children:"config\n    authority\n        router\n            system\n                software-update\n                    repository\n                        offline-mode true\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n"})}),"\n",(0,t.jsx)(o.h2,{id:"air-gap-network-upgrade-process",children:"Air-Gap Network Upgrade Process"}),"\n",(0,t.jsx)(o.p,{children:"The following process is used to upgrade a Conductor and Conductor-managed Routers to version 6.3.0 of the SSR software."}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:["On a system that has internet access, use the ",(0,t.jsx)(o.a,{href:"/docs/intro_downloading_iso#downloading-an-iso",children:"ISO Download procedure"})," to download the ",(0,t.jsx)(o.code,{children:"128T-6.3.0-xx.r1.el7"})," and the ",(0,t.jsx)(o.code,{children:"SSR-6.3.0-xx.r1.el7.x86_64.ibu-v1.iso"})," software packages."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.a,{href:"/docs/intro_creating_bootable_usb",children:"Create a bootable USB"})," drive from the SSR ISO."]}),"\n",(0,t.jsxs)(o.li,{children:["Import the ",(0,t.jsx)(o.code,{children:"128T-6.3.0-xx.r1.el7"})," package onto the conductor using the ",(0,t.jsx)(o.a,{href:"/docs/cli_reference#import-iso",children:(0,t.jsx)(o.code,{children:"import iso"})})," command."]}),"\n",(0,t.jsxs)(o.li,{children:["Upgrade the conductor using the ",(0,t.jsx)(o.a,{href:"/docs/upgrade_ibu_conductor",children:"Conductor Upgrade procedure"}),"."]}),"\n",(0,t.jsxs)(o.li,{children:["Import the ",(0,t.jsx)(o.code,{children:"SSR-6.3.0-xx.r1.el7.x86_64.ibu-v1.iso"})," package onto the conductor. The conductor will act as the software repository for the subsequent router upgrades. You do ",(0,t.jsx)(o.strong,{children:"not"})," install this package onto the conductor, only import it."]}),"\n",(0,t.jsxs)(o.li,{children:["Upgrade individual routers using the ",(0,t.jsx)(o.a,{href:"/docs/upgrade_router",children:"Router Upgrade"})," procedure."]}),"\n"]}),"\n",(0,t.jsx)(o.h3,{id:"import-iso",children:"Import ISO"}),"\n",(0,t.jsxs)(o.p,{children:["The ",(0,t.jsx)(o.a,{href:"/docs/cli_reference#import-iso",children:(0,t.jsx)(o.code,{children:"import iso"})})," command is used to import the SSR ISO onto a local repository, allowing the SSR to be upgraded without connecting to Juniper servers. When upgrading a conductor or when ",(0,t.jsx)(o.code,{children:"offline-mode"})," is defined for a router, the ISO must be imported to the target conductor to perform the upgrade."]}),"\n",(0,t.jsxs)(o.p,{children:["Use the ",(0,t.jsx)(o.code,{children:"filepath"})," argument to specify the exact location of the ISO. ",(0,t.jsx)(o.code,{children:"hunt"})," will search for files that match the patterns ",(0,t.jsx)(o.code,{children:"128T*.iso"}),", ",(0,t.jsx)(o.code,{children:"SSR*.iso"}),", or ",(0,t.jsx)(o.code,{children:"SSR*.tar"}),", and the corresponding checksum and signature files. These checksum and signature files are essential for security verification and are included as part of the ",(0,t.jsx)(o.code,{children:"import iso"})," operation. To install the 6.3.0 software, the following file must be downloaded to the USB and imported onto the conductor:"]}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"SSR-6.3.0-xx.r1.el7.x86_64.ibu-v1.iso"})}),"\n"]}),"\n",(0,t.jsx)(o.p,{children:"After the local software repository has been updated with the ISO, the upgrade can proceed."}),"\n",(0,t.jsx)(o.p,{children:"If you are installing older images on the routers (versions 6.2.5 or older) you may need to include the checksum and signature files with the ISO when you download and import the software to the conductor."}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"SSR-6.2.5-xx.r1.el7.x86_64.ibu-v1.iso"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"SSR-6.2.5-xx.r1.el7.x86_64.ibu-v1.tar.sha256sum"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"SSR-6.2.5-xx.r1.el7.x86_64.ibu-v1.tar.sha256sum.asc"})}),"\n"]}),"\n",(0,t.jsx)(o.admonition,{type:"note",children:(0,t.jsx)(o.p,{children:"In an HA setup, when using offline-mode for routers to access the software from the conductors, the ISO must be imported to both conductors before performing the upgrade."})}),"\n",(0,t.jsx)(o.h3,{id:"selecting-the-boot-volume",children:"Selecting the Boot Volume"}),"\n",(0,t.jsxs)(o.p,{children:["In instances where you are downloading and storing an SSR version for ",(0,t.jsx)(o.em,{children:"router"})," upgrades, you can identify the boot volume (the disk volume where the image-based software is stored) from which the router will boot."]}),"\n",(0,t.jsxs)(o.p,{children:["To view the current boot volume, use the ",(0,t.jsx)(o.code,{children:"show system version"})," command:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{children:"admin@conductor-node-1.Conductor# show system version router RTR_WEST_COMBO node combo-west-1 detail\nThu 2024-05-02 14:03:28 UTC\nRetrieving system version...\n\n=================================================================\n Node: combo-west-1.RTR_WEST_COMBO\n=================================================================\n Version:               6.3.0\n Status:                r1\n Build Date:            2024-05-01T21:25:38Z\n Build Machine:         releaseslave3.openstacklocal\n Build User:            jenkins\n Build Directory:       /i95code\n Hash:                  1d892d709c45409369048d129840b02e435b4e21\n Package:               128T-6.3.0-107.r1.el7\n SSR-IMG-release:       SSR-6.3.0-107.r1.el7.x86_64.ibu-v1\n ---\x3e Volume ID:             b  <---\n ---\x3e Selected Boot Volume:  b  <---\n Idle Volume:\n   Version:               5.4.11\n   Status:                unavailable\n   Build Date:            2022-12-21T03:10:13Z\n   Build Machine:         releaseslave4.openstacklocal\n   Build User:\n   Build Directory:\n   Hash:\n   Package:               128T-5.4.11-4.el7\n   Volume ID:             a\n\nCompleted in 5.53 seconds\nadmin@conductor-node-1.Conductor#\n\n"})}),"\n",(0,t.jsxs)(o.p,{children:["Change the ",(0,t.jsx)(o.code,{children:"Selected Boot Volume"})," using the command ",(0,t.jsx)(o.code,{children:"set system software router <name> node <name> boot-volume {a|b}"}),"."]}),"\n",(0,t.jsxs)(o.p,{children:["Use the reboot command to boot into the specifed volume: ",(0,t.jsx)(o.code,{children:"send command reboot router <name> node <name>"}),"."]})]})}function h(e={}){const{wrapper:o}={...(0,n.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,o,r)=>{r.d(o,{R:()=>i,x:()=>d});var t=r(96540);const n={},s=t.createContext(n);function i(e){const o=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(s.Provider,{value:o},e.children)}}}]);