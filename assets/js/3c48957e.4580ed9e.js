"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[8435],{28770:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var i=t(74848),s=t(28453);const r={title:"Native GRE Tunnels",sidebar_label:"Native GRE Tunnels"},a=void 0,o={id:"config_gre_tunnel",title:"Native GRE Tunnels",description:"Generic Routing Encapsulation (GRE) is a lightweight tunneling protocol that encapsulates L3 traffic in an L3 and GRE header. The SSR Networking Platform now supports both a GRE plugin as well as native GRE tunnels.",source:"@site/docs/config_gre_tunnel.md",sourceDirName:".",slug:"/config_gre_tunnel",permalink:"/docs/config_gre_tunnel",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1711024380,formattedLastUpdatedAt:"Mar 21, 2024",frontMatter:{title:"Native GRE Tunnels",sidebar_label:"Native GRE Tunnels"},sidebar:"docs",previous:{title:"Inline Flow Performance Monitoring",permalink:"/docs/config_flow_perf_mon"},next:{title:"In-Memory Metrics",permalink:"/docs/config_in-memory_metrics"}},c={},l=[{value:"Sending Packets",id:"sending-packets",level:2},{value:"Receiving Packets",id:"receiving-packets",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Interface Configuration",id:"interface-configuration",level:3},{value:"Configuration from the GUI",id:"configuration-from-the-gui",level:4},{value:"PCLI Configuration",id:"pcli-configuration",level:4},{value:"Tunnel Statistics",id:"tunnel-statistics",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Generic Routing Encapsulation (GRE) is a lightweight tunneling protocol that encapsulates L3 traffic in an L3 and GRE header. The SSR Networking Platform now supports both a ",(0,i.jsx)(n.a,{href:"/docs/plugin_gre",children:"GRE plugin"})," as well as native GRE tunnels."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"This is not an SVR feature. GRE tunnels are not created to send packets between peered SSR routers. However, a packet coming from SVR can egress into a GRE tunnel, and vice versa."})}),"\n",(0,i.jsx)(n.h2,{id:"sending-packets",children:"Sending Packets"}),"\n",(0,i.jsx)(n.p,{children:"When a GRE tunnel is configured, sessions are set up to and from the endpoints. With a GRE tunnel configured as a possible path for the service, the load balancer has the option of choosing the tunnel as the packet\u2019s next hop."}),"\n",(0,i.jsx)(n.p,{children:"When the tunnel is selcted as the next hop the session sets up normally, and the the appropriate headers are added for the tunnel."}),"\n",(0,i.jsx)(n.h2,{id:"receiving-packets",children:"Receiving Packets"}),"\n",(0,i.jsx)(n.p,{children:"On the receiving end, a static flow is created to receive all traffic coming from that tunnel. When a GRE encapsulated packet arrives, the tunnel headers are removed and the packet is forwarded to the normal lookup path. If a session exists, the packet is processed by the corresponding flow. If the session for this packet does not yet exist, a session is created."}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Use the following information to configure a GRE tunnel."}),"\n",(0,i.jsx)(n.h3,{id:"interface-configuration",children:"Interface Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Network-interfaces can be configured as gre-tunnels. These interfaces are virtual interfaces, which must share a VLAN tag with a non-virtual interface. The shared VLAN tag indicates which non-virtual interface the tunnel is associated with."}),"\n",(0,i.jsx)(n.h4,{id:"configuration-from-the-gui",children:"Configuration from the GUI"}),"\n",(0,i.jsx)(n.p,{children:"The following procedure describes configuring a GRE Tunnel using the GUI."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Under Configuration, select the Router."}),"\n",(0,i.jsx)(n.li,{children:"Scroll down and select the Node."}),"\n",(0,i.jsx)(n.li,{children:"Select the Device Interface."}),"\n",(0,i.jsx)(n.li,{children:"Scroll down to Network Interfaces and click ADD."}),"\n",(0,i.jsx)(n.li,{children:"Enter a name for the device interface and click SAVE."}),"\n",(0,i.jsx)(n.li,{children:"Under Type, select GRE Tunnel."}),"\n",(0,i.jsx)(n.li,{children:"Under Network Interface Tunnel Settings, choose either Inherited or Custom. The Source is the IP address of the start the tunnel. It can be inherited from the associated non-virtual network interface, or configured explicitly using Custom."}),"\n",(0,i.jsx)(n.li,{children:"Add the Destination IP address for the tunnel."}),"\n",(0,i.jsx)(n.li,{children:"Click Validate and Commit."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"pcli-configuration",children:"PCLI Configuration"}),"\n",(0,i.jsx)(n.p,{children:"The following example configuration describes using the PCLI to configure a GRE Tunnel.\nRouter and node configuration are provided for context:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"router    Router128\n    name           Router128\n    location       usa  \n    node           test1\n        name              test1\n        enabled           true\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a device interface ",(0,i.jsx)(n.code,{children:"GRE"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"        device-interface  GRE\n            name               GRE\n            type               ethernet\n            pci-address        0000:00:06.0\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Create a non-tunnel interface, ",(0,i.jsx)(n.code,{children:"base"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"            network-interface  base\n                name       base\n                global-id  2\n                tenant     red\n\n                address    172.16.3.1\n                    ip-address     172.16.3.1\n                    prefix-length  24\n                exit\n            exit\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["Create a tunnel interface, ",(0,i.jsx)(n.code,{children:"tunnel"}),". This is the virtual interface representing the tunnel. Set the type field to ",(0,i.jsx)(n.code,{children:"gre-tunnel"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"            network-interface  tunnel\n                name       tunnel\n                global-id  3\n                type       gre-tunnel\n                tenant     red\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Please note that in this configuration, the ",(0,i.jsx)(n.code,{children:"base"})," interface and the gre-tunnel interface ",(0,i.jsx)(n.code,{children:"tunnel"})," share the same vlan. For this to work, they must be on a single device-interface."]}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsxs)(n.li,{children:["Create the tunnel container with a destination of the IP address for the destination of the tunnel. The source identifies how the local IP address is obtained. Setting it to ",(0,i.jsx)(n.code,{children:"network-interface"})," acquires the address from ",(0,i.jsx)(n.code,{children:"network-interface-base"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"                tunnel\n                    destination  172.16.3.2\n\n                    source\n                        network-interface\n                    exit\n                exit\n            exit\n        exit\n    exit\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Create two service-routes for the tunnel, an outbound and inbound. Be sure to specify the virtual tunnel interface as the outbound service-route interface."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"    service-route  gre-outbound\n        name          gre-outbound\n        service-name  gre-outbound\n        next-hop      test1 tunnel\n            node-name   test1\n            interface   tunnel\n            gateway-ip  172.16.3.2\n        exit\n    exit\n\n    service-route  gre-inbound\n        name          gre-inbound\n        service-name  gre-inbound\n\n        next-hop      test1 eth\n            node-name  test1\n            interface  base\n        exit\n    exit\nexit\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tunnel-statistics",children:"Tunnel Statistics"}),"\n",(0,i.jsx)(n.p,{children:"The following tunnel encapsulation statistics provide details on encapsulation and decapsulation success, as well as failure modes."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"/docs/cli_stats_reference#show-stats-packet-processing-action-success-tunnel-gre-encapsulate",children:(0,i.jsx)(n.code,{children:"stats packet-processing action success tunnel gre encapsulate"})})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"/docs/cli_stats_reference#show-stats-packet-processing-action-success-tunnel-gre-decapsulate",children:(0,i.jsx)(n.code,{children:"stats packet-processing action success tunnel gre decapsulate"})})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/cli_stats_reference#show-stats-packet-processing-action-failure-tunnel-gre-decapsulate",children:(0,i.jsx)(n.code,{children:"stats packet-processing action failure tunnel gre decapsulate"})}),": The decapsulate failure indicates that the packets entering from the tunnel either were not tunneled properly, or are otherwise malformed."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/cli_stats_reference#show-stats-packet-processing-action-failure-tunnel-invalid-entry",children:(0,i.jsx)(n.code,{children:"stats packet-processing action failure tunnel invalid-entry"})}),": The ",(0,i.jsx)(n.code,{children:"invalid-entry"})," stat should be 0; it indicates a system error with propagating the tunnel configuration."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);