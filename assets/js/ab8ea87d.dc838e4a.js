"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[8247],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=p(n),m=i,h=c["".concat(s,".").concat(m)]||c[m]||u[m]||r;return n?a.createElement(h,l(l({ref:t},d),{},{components:n})):a.createElement(h,l({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var p=2;p<r;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},26423:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return d},default:function(){return c}});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),l=["components"],o={title:"IPsec Client plugin",sidebar_label:"IPsec Client"},s=void 0,p={unversionedId:"plugin_ipsec_client",id:"plugin_ipsec_client",title:"IPsec Client plugin",description:"The 128T-ipsec-client plugin provides a way to send and encrypt traffic to IPsec endpoints through the 128T router. It is possible to configure the plugin for each router to have multiple destination IPsec endpoints and thus the 128T will failover between them. This is accomplished by performing a Service Function Chain (SFC) with Libreswan, a third-party IPsec client. By enabling this plugin, you can provide IPsec tunnel connectivity to third party providers from your 128T router.",source:"@site/docs/plugin_ipsec_client.md",sourceDirName:".",slug:"/plugin_ipsec_client",permalink:"/docs/plugin_ipsec_client",tags:[],version:"current",lastUpdatedAt:1663684530,formattedLastUpdatedAt:"9/20/2022",frontMatter:{title:"IPsec Client plugin",sidebar_label:"IPsec Client"},sidebar:"docs",previous:{title:"ICMP Reachability Detection",permalink:"/docs/plugin_icmp_reachability_detection"},next:{title:"Loopback Static Routes",permalink:"/docs/plugin_loopback_static_routes"}},d=[{value:"Configuration",id:"configuration",children:[{value:"Profiles",id:"profiles",children:[{value:"Custom Options",id:"custom-options",children:[{value:"Version History",id:"version-history",children:[],level:5}],level:4}],level:3},{value:"Clients",id:"clients",children:[],level:3},{value:"Tunnel Monitoring",id:"tunnel-monitoring",children:[{value:"Version History",id:"version-history-1",children:[],level:5}],level:3},{value:"Configuring services for tunnel traffic",id:"configuring-services-for-tunnel-traffic",children:[],level:3},{value:"Directing traffic through the tunnel",id:"directing-traffic-through-the-tunnel",children:[],level:3}],level:2},{value:"Thirdparty Software &amp; Licenses",id:"thirdparty-software--licenses",children:[],level:2},{value:"Troubleshooting",id:"troubleshooting",children:[{value:"Data Model",id:"data-model",children:[],level:3},{value:"Logging",id:"logging",children:[],level:3},{value:"Salt",id:"salt",children:[],level:3},{value:"PCLI Enhancements",id:"pcli-enhancements",children:[{value:"Tunnel Monitor State",id:"tunnel-monitor-state",children:[],level:4}],level:3},{value:"Commands",id:"commands",children:[{value:"Version History",id:"version-history-2",children:[],level:5}],level:3},{value:"Systemd Services",id:"systemd-services",children:[],level:3},{value:"Failover Alarms",id:"failover-alarms",children:[],level:3}],level:2},{value:"Appendix",id:"appendix",children:[{value:"Generated 128T Configuration",id:"generated-128t-configuration",children:[],level:3},{value:"User-Specific 128T Configuration",id:"user-specific-128t-configuration",children:[],level:3},{value:"Complete Example Configuration",id:"complete-example-configuration",children:[],level:3}],level:2},{value:"Release Notes",id:"release-notes",children:[{value:"Release 3.4.0",id:"release-340",children:[{value:"New Features and Improvements",id:"new-features-and-improvements",children:[],level:4},{value:"Issues Fixed",id:"issues-fixed",children:[],level:4}],level:3},{value:"Release 3.3.1",id:"release-331",children:[{value:"Issues Fixed",id:"issues-fixed-1",children:[],level:4}],level:3},{value:"Release 3.3.0",id:"release-330",children:[{value:"New Features and Improvements",id:"new-features-and-improvements-1",children:[],level:4},{value:"Issues Fixed",id:"issues-fixed-2",children:[],level:4}],level:3},{value:"Release 3.2.0",id:"release-320",children:[{value:"New Features and Improvements",id:"new-features-and-improvements-2",children:[],level:4},{value:"Issues Fixed",id:"issues-fixed-3",children:[],level:4}],level:3},{value:"Release 3.1.3",id:"release-313",children:[{value:"Issues Fixed",id:"issues-fixed-4",children:[],level:4}],level:3},{value:"Release 2.2.0, 3.1.0",id:"release-220-310",children:[{value:"New Features and Improvements",id:"new-features-and-improvements-3",children:[],level:4}],level:3},{value:"Release 1.0.7, 2.0.7, 2.1.0, 3.0.2",id:"release-107-207-210-302",children:[{value:"Issues Fixed",id:"issues-fixed-5",children:[],level:4}],level:3},{value:"Release 3.0.1",id:"release-301",children:[{value:"Issues Fixed",id:"issues-fixed-6",children:[],level:4}],level:3},{value:"Release 3.0.0",id:"release-300",children:[{value:"Issues Fixed",id:"issues-fixed-7",children:[],level:4}],level:3},{value:"Release 1.0.6, 2.0.6",id:"release-106-206",children:[{value:"Issues Fixed",id:"issues-fixed-8",children:[],level:4}],level:3},{value:"Release 1.0.5, 2.0.5",id:"release-105-205",children:[{value:"Issues Fixed",id:"issues-fixed-9",children:[],level:4}],level:3},{value:"Release 1.0.4, 2.0.4",id:"release-104-204",children:[{value:"Issues Fixed",id:"issues-fixed-10",children:[],level:4}],level:3},{value:"Release 1.0.1, 2.0.1",id:"release-101-201",children:[{value:"Issues Fixed",id:"issues-fixed-11",children:[],level:4}],level:3}],level:2}],u={toc:d};function c(e){var t=e.components,o=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The 128T-ipsec-client plugin provides a way to send and encrypt traffic to IPsec endpoints through the 128T router. It is possible to configure the plugin for each router to have multiple destination IPsec endpoints and thus the 128T will failover between them. This is accomplished by performing a ",(0,r.kt)("a",{parentName:"p",href:"/docs/plugin_intro#service-function-chaining"},"Service Function Chain (SFC)")," with Libreswan, a third-party IPsec client. By enabling this plugin, you can provide IPsec tunnel connectivity to third party providers from your 128T router."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The instructions for installing and managing the plugin can be found ",(0,r.kt)("a",{parentName:"p",href:"/docs/plugin_intro#installation-and-management"},"here"),"."))),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"The IPsec plugin setup has the following key parts to the configuration."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ipsec-profile")," describing the mechanism with which to connect to the server."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ipsec-client")," represent the remote endpoints or server with which the ipsec client communicates."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"service-route"),"'s to route the traffic through the tunnels")),(0,r.kt)("h3",{id:"profiles"},"Profiles"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"router > ipsec-profile"),"'s are reusable IPsec settings that can be used across multiple nodes in a router and multiple IPsec endpoint ",(0,r.kt)("inlineCode",{parentName:"p"},"remote"),"s. The table below represents the most common configuration elements for a valid ipsec profile."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"router\n    ipsec-profile  zscaler\n        name                     zscaler\n        ike-encryption           aes256\n        ike-digest               sha2\n        ike-modp                 modp1024\n        authentication-protocol  esp\n        phase2-encryption        aes_gcm128\n        phase2-digest            sha2\n        phase2-modp              modp1024\n        ike-lifetime             1h\n        connection-lifetime      8h\n        perfect-forward-secrecy  true\n        dpddelay                 20\n        dpdtimeout               100\n        dpdaction                restart\n        local-id                 [local-id@domain.com]\n        pre-shared-key           (removed)\n    exit\nexit\n")),(0,r.kt)("p",null,"The above configuration example represents a typical profile used for a IPSec provider such as Zscaler. Please tune the settings to match the settings recommended by your provider."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Config"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Recommended"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"name"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the profile")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ike-encryption"),(0,r.kt)("td",{parentName:"tr",align:null},"enum"),(0,r.kt)("td",{parentName:"tr",align:null},"aes256"),(0,r.kt)("td",{parentName:"tr",align:null},"Algorithm used for IKE encryption")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ike-digest"),(0,r.kt)("td",{parentName:"tr",align:null},"enum"),(0,r.kt)("td",{parentName:"tr",align:null},"sha2"),(0,r.kt)("td",{parentName:"tr",align:null},"Hash algorithm used for IKE encryption")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ike-modp"),(0,r.kt)("td",{parentName:"tr",align:null},"enum"),(0,r.kt)("td",{parentName:"tr",align:null},"modp1024"),(0,r.kt)("td",{parentName:"tr",align:null},"Modp group used for IKE encryption")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"authentication-protocol"),(0,r.kt)("td",{parentName:"tr",align:null},"enum"),(0,r.kt)("td",{parentName:"tr",align:null},"esp"),(0,r.kt)("td",{parentName:"tr",align:null},"The type of SA to be produced for authentication")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"phase2-encryption"),(0,r.kt)("td",{parentName:"tr",align:null},"enum"),(0,r.kt)("td",{parentName:"tr",align:null},"aes_gcm128"),(0,r.kt)("td",{parentName:"tr",align:null},"Algorithm used for phase 2 encryption")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"phase2-digest"),(0,r.kt)("td",{parentName:"tr",align:null},"enum"),(0,r.kt)("td",{parentName:"tr",align:null},"sha2"),(0,r.kt)("td",{parentName:"tr",align:null},"Hash algorithm used for phase 2 encryption")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"phase2-modp"),(0,r.kt)("td",{parentName:"tr",align:null},"enum"),(0,r.kt)("td",{parentName:"tr",align:null},"modp1024"),(0,r.kt)("td",{parentName:"tr",align:null},"Modp group used for phase 2 encryption")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ike-lifetime"),(0,r.kt)("td",{parentName:"tr",align:null},"time"),(0,r.kt)("td",{parentName:"tr",align:null},"1h"),(0,r.kt)("td",{parentName:"tr",align:null},"Lifetime of the keying channel for a connection")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"connection-lifetime"),(0,r.kt)("td",{parentName:"tr",align:null},"time"),(0,r.kt)("td",{parentName:"tr",align:null},"8h"),(0,r.kt)("td",{parentName:"tr",align:null},"Lifetime for the security association")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"perfect-forward-secrecy"),(0,r.kt)("td",{parentName:"tr",align:null},"bool"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Whether Perfect Forward Secrecy of keys is required on the connection")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"dpddelay"),(0,r.kt)("td",{parentName:"tr",align:null},"seconds"),(0,r.kt)("td",{parentName:"tr",align:null},"20"),(0,r.kt)("td",{parentName:"tr",align:null},"Delay between DPP keepalives on the connection")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"dpdtimeout"),(0,r.kt)("td",{parentName:"tr",align:null},"seconds"),(0,r.kt)("td",{parentName:"tr",align:null},"100"),(0,r.kt)("td",{parentName:"tr",align:null},"After the period has elapsed with no traffic including DPD traffic, the connection will be declared dead")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"dpdaction"),(0,r.kt)("td",{parentName:"tr",align:null},"enum"),(0,r.kt)("td",{parentName:"tr",align:null},"restart"),(0,r.kt)("td",{parentName:"tr",align:null},"Action taken once the enabled peer is detected as dead")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"local-id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"user-defined"),(0,r.kt)("td",{parentName:"tr",align:null},"How to identify the router for authentication. Can be an IP address of FQDN. Must be preceded with an ",(0,r.kt)("inlineCode",{parentName:"td"},"@")," symbol to prevent resolution as shown in the example")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"pre-shared-key"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"user-defined"),(0,r.kt)("td",{parentName:"tr",align:null},"pre-shared key used for authentication")))),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This plugin can only connect to IPsec endpoints that support pre-shared key authentication."))),(0,r.kt)("h4",{id:"custom-options"},"Custom Options"),(0,r.kt)("h5",{id:"version-history"},"Version History"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Release"),(0,r.kt)("th",{parentName:"tr",align:null},"Modification"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3.3.0"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"profile > custom-option")," introduced")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"custom-option")," allows the user to configure additional obscure libreswan options that are not exposed via the profile and remote configuration."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"config\n\n    authority\n\n        router  myRouter\n            name           myRouter\n\n            ipsec-profile  myProfile\n                name           myProfile\n\n                custom-option  key\n                    name   key\n                    value  value\n                exit\n            exit\n        exit\n    exit\nexit\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Config"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"name"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the libreswan option")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"value"),(0,r.kt)("td",{parentName:"tr",align:null},"The value of the option")))),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"custom-option")," is added to the libreswan config file; any invalid option could prevent the application from starting up."))),(0,r.kt)("h3",{id:"clients"},"Clients"),(0,r.kt)("p",null,"Clients are a collection of remote endpoints which can be used for connection and failover purposes."),(0,r.kt)("p",null,"The main config properties of a remote endpoint are as follows."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Config"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"name"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the remote client to be used for sending traffic to the tunnel.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"host"),(0,r.kt)("td",{parentName:"tr",align:null},"ip-or-fqdn"),(0,r.kt)("td",{parentName:"tr",align:null},"The address or FQDN of the remote endpoint.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"profile"),(0,r.kt)("td",{parentName:"tr",align:null},"reference"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the profile to be used for this remote endpoint.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"remote-id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The optional remote identifier used during authentication.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"subnet"),(0,r.kt)("td",{parentName:"tr",align:null},"ip-prefix"),(0,r.kt)("td",{parentName:"tr",align:null},"The remote subnet behind the tunnel.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tunnel-monitor"),(0,r.kt)("td",{parentName:"tr",align:null},"container"),(0,r.kt)("td",{parentName:"tr",align:null},"Properties for monitoring the phase-2 connection. See ",(0,r.kt)("a",{parentName:"td",href:"/docs/plugin_ipsec_client#tunnel-monitoring"},"Tunnel Monitoring")," for more information.")))),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"router myRouter\n    node\n        name    myRouter\n        ipsec-client client1\n            name client1\n            enabled true\n            tenant ipsec\n\n            remote primary\n                name primary\n                host <primary-address>\n                profile myProfile\n                remote-id prisma@paloalto.com\n                subnet 0.0.0/0\n                tunnel-monitor\n                    enabled true\n                    destination 8.8.8.8\n                        address 8.8.8.8\n                        timeout 10\n                        max-retries 3\n                        interval 60\n                    exit\n                exit\n            exit\n\n            remote secondary\n                name primary\n                host <primary-address>\n                profile myProfile\n                remote-id prisma@paloalto.com\n                subnet 0.0.0/0\n                tunnel-monitor\n                    enabled true\n                    destination 8.8.8.8\n                        address 8.8.8.8\n                        timeout 10\n                        max-retries 3\n                        interval 60\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Only one ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec-client")," can be configured per node, but two ",(0,r.kt)("inlineCode",{parentName:"p"},"remote"),"s can be configured per client."))),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec-client > name")," cannot start with ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"mast"),". See notes ",(0,r.kt)("a",{parentName:"p",href:"/docs/plugin_ipsec_client#release-340"},"here"),"."))),(0,r.kt)("p",null,"Each ",(0,r.kt)("inlineCode",{parentName:"p"},"remote")," represents a unique tunnel destination and can be used to route traffic in/out of the tunnels. Typically each node has two tunnels to act as primary and backup."),(0,r.kt)("h3",{id:"tunnel-monitoring"},"Tunnel Monitoring"),(0,r.kt)("h5",{id:"version-history-1"},"Version History"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Release"),(0,r.kt)("th",{parentName:"tr",align:null},"Modification"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3.2.0"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"remote > tunnel-monitor")," introduced")))),(0,r.kt)("p",null,"Tunnel monitoring is a way to monitor the health of individual tunnels and have them automatically restart if they become unhealthy. An ICMP ping is used for the traffic. For each ",(0,r.kt)("inlineCode",{parentName:"p"},"remote"),", you can specify a destination, interval, timeout, and the number of max retries for each interval."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"node\n    ipsec-client client1\n        remote c1gateway1\n            tunnel-monitor\n                enabled true\n                destination 8.8.8.8\n                    address 8.8.8.8\n                    timeout 10\n                    max-retries 3\n                    interval 120\n                exit\n            exit\n        exit\n\n        tunnel-monitor-nat-network 10.128.128.0/28\n    exit\nexit\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Config"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"enabled")),(0,r.kt)("td",{parentName:"tr",align:null},"Allows you to switch tunnel monitoring on and off for a ",(0,r.kt)("inlineCode",{parentName:"td"},"remote"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"address")),(0,r.kt)("td",{parentName:"tr",align:null},"The IP or hostname where traffic is sent. This address must be reachable after traversing the  tunnel.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"timeout")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration (in seconds) within which to reach the destination. Each attempt will be made in this duration / ",(0,r.kt)("inlineCode",{parentName:"td"},"max-retries")," interval.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"max-retries")),(0,r.kt)("td",{parentName:"tr",align:null},"Number of consecutive missed ICMP ping responses from the destination within the interval before deciding that the tunnel is unhealthy.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"interval")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration (in seconds) of how often to perform an ICMP probe test to the probe-address.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tunnel-monitor-nat-network")),(0,r.kt)("td",{parentName:"tr",align:null},"The subnet where traffic originates. The corresponding ingress KNI's fourth octet is used. By default, the subnet ",(0,r.kt)("inlineCode",{parentName:"td"},"10.128.128.0/28")," is used.")))),(0,r.kt)("h3",{id:"configuring-services-for-tunnel-traffic"},"Configuring services for tunnel traffic"),(0,r.kt)("p",null,"The user can define up to four ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec-client > remote")," endpoints per node. In addition, the user must also define the necessary service and service-routes to route the tunnel traffic over the desired WAN interface."),(0,r.kt)("p",null,"The following example shows a configuration for capturing the tunnel traffic and allows the ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec")," tenant as defined in ",(0,r.kt)("inlineCode",{parentName:"p"},"router > ipsec-client > tenant")," config above."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"config\n\n    authority\n\n        service  ipsec-tunnel\n            name           ipsec-tunnel\n            scope          private\n            address        <remote-address-1>\n            address        <remote-address-2>\n\n            transport      udp\n                protocol    udp\n\n                port-range  4500\n                    start-port  4500\n                exit\n\n                port-range  500\n                    start-port  500\n                exit\n            exit\n\n            access-policy  ipsec\n                source  ipsec\n            exit\n        exit\n    exit\nexit\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"<remote-address-1>")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"<remote-address-2>")," represent the ",(0,r.kt)("inlineCode",{parentName:"p"},"node > ipsec-client > remote > host")," address. The ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec")," tenant is allowed as per the tenant defined under ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec-client > tenant"),". The user can split the tunnels into separate services per the routing requirements."),(0,r.kt)("h3",{id:"directing-traffic-through-the-tunnel"},"Directing traffic through the tunnel"),(0,r.kt)("p",null,"The user can leverage standard SSR service and service-route to direct intended traffic over the ipsec tunnel. In the example below, all guest internet traffic is sent over the ipsec tunnel for break and inspect. This can be accomplished as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'config\n\n    authority\n\n        router   myRouter\n            name           myRouter\n\n            service-route  guest-internet-rte-primary\n                name          guest-internet-rte-primary\n                service-name  guest-internet\n\n                next-hop      combo-east-1 primary\n                    node-name  combo-east-1\n                    interface  primary\n                exit\n            exit\n\n            service-route  guest-internet-rte-secondary\n                name          guest-internet-rte-secondary\n                service-name  guest-internet\n\n                next-hop      combo-east-1 secondary\n                    node-name  combo-east-1\n                    interface  secondary\n                exit\n            exit\n\n        exit\n\n        tenant   guest\n            name  guest\n        exit\n\n        service  guest-internet\n            name           guest-internet\n            description    "guest-internet access"\n            scope          private\n            address        0.0.0.0/0\n\n            access-policy  guest\n                source  guest\n            exit\n        exit\n    exit\nexit\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"service-route > next-hop > interface")," must point to the corresponding ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec-client > remote > name"),"-intf to route the traffic through the tunnel. All available SSR routing techniques including using vectors, service-policy, etc., can be leveraged to define how the untrusted traffic is sent over the tunnels, and how to route the traffic. The SSR routes the packets through the appropriate IPSec tunnels and manages the failover as per the policy. On the return path, the encrypted traffic is processed, decrypted, and send back to the client that originated the session."),(0,r.kt)("h2",{id:"thirdparty-software--licenses"},"Thirdparty Software & Licenses"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Libreswan v3.23-5.el7_5 (GNU GPLv2)")),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h3",{id:"data-model"},"Data Model"),(0,r.kt)("p",null,"If the data model doesn\u2019t appear in the PCLI or GUI, make sure that you have restarted the 128T service."),(0,r.kt)("h3",{id:"logging"},"Logging"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/128technology/persistentDataManager.log")," file at trace level will hold whether the configuration generation was run as well as output and return code.\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/128technology/automatedProvisioner.log")," file at trace level will hold whether the pillar generation was run as well as output and return code.\nConfiguration and pillar generation logs can be found on the conductor under ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/128technology/plugins/ipsec-client-config-generation.log")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/128technology/plugins/ipsec-client-pillar-generation.log")," respectively."),(0,r.kt)("h3",{id:"salt"},"Salt"),(0,r.kt)("p",null,"Salt status can be found on the conductor by utilizing the PCLI\u2019s ",(0,r.kt)("inlineCode",{parentName:"p"},"show assets")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"show assets <asset-id>")," commands."),(0,r.kt)("h3",{id:"pcli-enhancements"},"PCLI Enhancements"),(0,r.kt)("p",null,"To check the status of the IPsec tunnels for a given ingress KNI, extra IPsec tunnel related output will be found in the ",(0,r.kt)("inlineCode",{parentName:"p"},"show device-interface")," command as well as the ",(0,r.kt)("inlineCode",{parentName:"p"},"show plugin state")," command."),(0,r.kt)("p",null,"Example output for a healthy tunnel:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"admin@combo-west.RTR_WEST_COMBO# show device-interface name rem2\nTue 2020-06-30 16:44:39 UTC\n\n=========================================================\n combo-west:rem2\n=========================================================\n Type:                host\n Forwarding:          true\n Mode:                host\n MAC Address:         22:ee:4e:b6:37:a8\n\n Admin Status:        up\n Operational Status:  up\n Redundancy Status:   non-redundant\n Speed:               1000\n Duplex:              full\n\n in-octets:                        9992\n in-unicast-pkts:                   161\n in-errors:                           0\n out-octets:                       6986\n out-unicast-pkts:                  161\n out-errors:                         11\n\n IPSec:\n     Tunnel Status:   Up\n     Tunnel Details:\n         Name:        ipsec-client-tunnel-secondary-rem2\n         Remote id:   172.16.5.4\n         SA creation time:\n           2020-06-30 16:37:50\n         In bytes:    0\n         Out bytes:   336\n     SA Count:        1\n\nCompleted in 0.12 seconds\n")),(0,r.kt)("p",null,"Example output for a tunnel that is down:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"========================================\n combo-west:rem1\n========================================\n Type:                host\n Forwarding:          true\n Mode:                host\n MAC Address:         76:78:79:fc:eb:69\n\n Admin Status:        up\n Operational Status:  down\n Redundancy Status:   non-redundant\n Speed:               0\n Duplex:              unknown\n\n in-octets:                     1962932\n in-unicast-pkts:                 32710\n in-errors:                           0\n out-octets:                    1373442\n out-unicast-pkts:                32701\n out-errors:                          6\n\n IPSec:\n   Tunnel Status:     Down\n")),(0,r.kt)("h4",{id:"tunnel-monitor-state"},"Tunnel Monitor State"),(0,r.kt)("p",null,"If tunnel monitoring is enabled for a remote, corresponding tunnel monitoring state is included in the pcli commands."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," IPSec:\n     Tunnel Status:   Up\n     Tunnel Details:\n         Name:        ipsec-client-tunnel-primary-rem1\n         Remote id:   172.16.4.3\n         SA Details:\n             Add time:2022-02-14 15:41:15\n             In bytes:60\n             Out bytes:60\n         Ingress Total (bytes):60\n         Egress Total (bytes):60\n     SA Count:        1\n     Tunnel Monitoring:\n           Destination:8.8.8.8\n           Status:    up\n           Last Attempt:2022-02-14 15:42:34\n           Last Restart:2022-02-14 15:41:15\n")),(0,r.kt)("h3",{id:"commands"},"Commands"),(0,r.kt)("h5",{id:"version-history-2"},"Version History"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Release"),(0,r.kt)("th",{parentName:"tr",align:null},"Modification"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3.3.0"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"restart ipsec remote")," command was introduced")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"restart ipsec remote")," command can be used to restart an individual IPSec tunnel via the conductor PCLI and UI."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'admin@node1.conductor# restart ipsec remote router router-1 node node-1 remote-1\n\u2714 Retrieving 0/1 targets complete....\nTarget: node1.conductor\n\n002 "ipsec-client-tunnel-primary-remote-1": terminating SAs using this connection\n002 "ipsec-client-tunnel-primary-remote-1" #8261: deleting state (STATE_PARENT_I1)\n002 "ipsec-client-tunnel-primary-remote-1" #8262: initiating v2 parent SA\n133 "ipsec-client-tunnel-primary-remote-1" #8262: STATE_PARENT_I1: initiate\n\nSuccessfully retrieved info.\nadmin@node1.conductor#\n')),(0,r.kt)("p",null,"From the conductor UI, the command can be accessed as shown in the screenshot below."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"IPsec Tunnel Restart Command",src:n(75358).Z})),(0,r.kt)("h3",{id:"systemd-services"},"Systemd Services"),(0,r.kt)("p",null,"To check the status of the IPsec client service on the router, you can run ",(0,r.kt)("inlineCode",{parentName:"p"},"show system services")," which will show all 128T related services running on the specified node. The one for this plugin is named ",(0,r.kt)("inlineCode",{parentName:"p"},"128t-ipsec"),"."),(0,r.kt)("p",null,"To verify that the services are running properly on the 128T router:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"systemctl status 128t-ipsec@<client>.service"))),(0,r.kt)("h3",{id:"failover-alarms"},"Failover Alarms"),(0,r.kt)("p",null,"If a tunnel goes down, we set the corresponding ingress KNI to be operationally down. An alarm will be created when this happens."),(0,r.kt)("p",null,"Example output when the tunnel for ",(0,r.kt)("inlineCode",{parentName:"p"},"rem1")," goes down:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-admin@combo-west.RTR_WEST_COMBO#",metastring:"show alarms",show:!0,alarms:!0},"Tue 2020-06-30 16:42:50 UTC\n\n============== ===================== ========== ============= =========== ==================================\n ID             Time                  Severity   Source        Category    Message\n============== ===================== ========== ============= =========== ==================================\n combo-west:8   2020-06-30 16:32:42   critical   unavailable   interface   Intf rem1 (4) operationally down\n\nThere are 0 shelved alarms\nCompleted in 0.10 seconds\n")),(0,r.kt)("h2",{id:"appendix"},"Appendix"),(0,r.kt)("h3",{id:"generated-128t-configuration"},"Generated 128T Configuration"),(0,r.kt)("p",null,"A KNI per remote is created with the name of the ",(0,r.kt)("inlineCode",{parentName:"p"},"remote")," and a single egress KNI is created with the name of the ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec-client"),"."),(0,r.kt)("h3",{id:"user-specific-128t-configuration"},"User-Specific 128T Configuration"),(0,r.kt)("p",null,"To allow the maximum flexibility on getting the traffic into the plugin's network namespace and getting the traffic out, we rely on the user to configure those means (usually through services and service routes)."),(0,r.kt)("p",null,"You will need to have the IPsec endpoint bound traffic sent into the KNIs with the names of the ",(0,r.kt)("inlineCode",{parentName:"p"},"remote"),"s. You can use builtin 128T failover techniques due to the KNIs being reported operationally down when the corresponding tunnel is down. You will also need to configure a way for the traffic to be routed towards the IPsec endpoint after being encrypted. All of this encrypted traffic will be assigned to the ",(0,r.kt)("inlineCode",{parentName:"p"},"tenant")," configured under ",(0,r.kt)("inlineCode",{parentName:"p"},"ipsec-client"),"."),(0,r.kt)("h3",{id:"complete-example-configuration"},"Complete Example Configuration"),(0,r.kt)("p",null,"Below is an example of a complete, but minimal configuration entered by the user."),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This example configuration is good to understand all of the concepts but should not be used on a system as is."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"config\n    authority\n        tenant ipsec\n        exit\n\n        tenant lan\n        exit\n\n        service         cleartext\n            name            cleartext\n            address         1.1.1.0/24\n\n            access-policy   lan\n                source      lan\n                permission  allow\n            exit\n        exit\n\n        service         ipsec\n            name           ipsec\n            address        172.16.4.3\n\n            access-policy  ipsec\n                source      ipsec\n                permission  allow\n            exit\n        exit\n\n        router               router1\n            ipsec-profile         primary\n                name                 primary\n                pre-shared-key       somekey1\n            exit\n\n            ipsec-profile         secondary\n                name                 secondary\n                pre-shared-key       somekey2\n            exit\n\n            node node1\n                device-interface          lan\n                    name               lan\n\n                    network-interface  lanintf\n                        name          lanintf\n                        tenant        lan\n\n                        address       172.16.1.2\n                            ip-address     172.16.1.2\n                            prefix-length  24\n                            gateway        2.2.2.1\n                        exit\n                    exit\n                exit\n\n                device-interface          wan\n                    name               wan\n\n                    network-interface  wanintf\n                        name          wanintf\n\n                        address       172.16.3.2\n                            ip-address     172.16.3.2\n                            prefix-length  24\n                            gateway        172.16.3.5\n                        exit\n                    exit\n                exit\n\n                ipsec-client              client1\n                    name     client1\n                    enabled  true\n                    tenant   ipsec\n\n                    remote   rem1\n                        name     rem1\n                        host     172.16.4.3\n                        profile  primary\n                    exit\n\n                    remote   rem2\n                        name     rem2\n                        host     172.16.5.4\n                        profile  secondary\n                    exit\n                exit\n            exit\n\n            service-route         rem1\n                name          rem1\n                service-name  cleartext\n\n                next-hop      router1 rem1-intf\n                    node-name   router1\n                    interface   rem1-intf\n                    gateway-ip  169.254.129.6\n                exit\n            exit\n\n            service-route         rem2\n                name          rem2\n                service-name  cleartext\n\n                next-hop      router1 rem2-intf\n                    node-name   router1\n                    interface   rem2-intf\n                    gateway-ip  169.254.129.10\n                exit\n            exit\n\n            service-route         ipsec\n                name          ipsec\n                service-name  ipsec\n\n                next-hop      router1 wanintf\n                    node-name   router1\n                    interface   wanintf\n                    gateway-ip  172.16.3.5\n                exit\n            exit\n        exit\n    exit\nexit\n")),(0,r.kt)("p",null,"Upon commit, the plugin will generate other configuration as shown below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'config\n    authority\n        router router1\n            node node1\n                device-interface          client1\n                    name               client1\n                    description        "Auto-generated host interface for use with ipsec-client"\n                    type               host\n                    network-namespace  client1\n\n                    network-interface  client1-intf\n                        name       client1-intf\n                        type       external\n                        tenant     ipsec\n\n                        address    169.254.129.1\n                            ip-address     169.254.129.1\n                            prefix-length  30\n                            gateway        169.254.129.2\n                        exit\n                    exit\n                exit\n\n                device-interface          rem1\n                    name               rem1\n                    description        "Auto-generated host interface for use with ipsec-client"\n                    type               host\n                    network-namespace  client1\n\n                    network-interface  rem1-intf\n                        name       rem1-intf\n                        type       external\n                        tenant     _internal_\n\n                        address    169.254.129.5\n                            ip-address     169.254.129.5\n                            prefix-length  30\n                            gateway        169.254.129.6\n                        exit\n                    exit\n                exit\n\n                device-interface          rem2\n                    name               rem2\n                    description        "Auto-generated host interface for use with ipsec-client"\n                    type               host\n                    network-namespace  client1\n\n                    network-interface  rem2-intf\n                        name       rem2-intf\n                        type       external\n                        tenant     _internal_\n\n                        address    169.254.129.9\n                            ip-address     169.254.129.9\n                            prefix-length  30\n                            gateway        169.254.129.10\n                        exit\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n')),(0,r.kt)("h2",{id:"release-notes"},"Release Notes"),(0,r.kt)("h3",{id:"release-340"},"Release 3.4.0"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Release Date:")," Jul 13, 2022"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Router Version")," 128T-ipsec-2.2.4-2"),(0,r.kt)("h4",{id:"new-features-and-improvements"},"New Features and Improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1720")," Added support for new ciphers for Phase-1 and Phase-2 security")),(0,r.kt)("p",null,"The plugin now support aes-256-gcm, dh-20, sha512 and no-auth encryption schemes."),(0,r.kt)("h4",{id:"issues-fixed"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-880")," IPSec client connection is not initiated for certain config combinations"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution:"))," The ipsec client names beginning with ipsec and mast are not supported by libreswan. As part of the fix, a new config rule was added to enforce this requirement.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1807")," IPSec health monitoring configuration does not report correct status"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution:"))," The monitoring scripts were writing data to a non-persistent path resulting in the failure across reboots. The state directory will not be automatically re-generated on system reboots.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1810")," Trace logging in configuration results in IPSec failures"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution:"))," Trace level logging is now converted appropriately for IPSec configuration to prevent underlying failures."))),(0,r.kt)("h3",{id:"release-331"},"Release 3.3.1"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Release Date:")," May 25, 2022"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Router Version")," 128T-ipsec-2.2.2-1"),(0,r.kt)("h4",{id:"issues-fixed-1"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1730")," Invalid libreswan configuration was being generated when multiple local or remote subnets were configured."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution"))," The issue with the libreswan configuration generation has been resolved."))),(0,r.kt)("h3",{id:"release-330"},"Release 3.3.0"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Release Date:")," Apr 27, 2022"),(0,r.kt)("h4",{id:"new-features-and-improvements-1"},"New Features and Improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-630")," Raise the number of supported IPSec client tunnels from 2 to 4")),(0,r.kt)("p",null,"The plugin now supports up to 4 IPSec tunnels per node."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1641")," Optimize the initial IPSec environment setup")),(0,r.kt)("p",null,"The majority of the IPSec config and environment management is performed locally on the router thereby minimizing the interaction with salt states."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1533")," Create a command to restart an individual tunnel")),(0,r.kt)("p",null,"A new command was added to allow the user to restart an individual tunnel. More details can be found in the ",(0,r.kt)("a",{parentName:"p",href:"#commands"},"commands section")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1532")," Enable additional configuration options for IPSec tunnels.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"encapsulation")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"remote-peer-type")," options are now available for configuration."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1554")," Collect ipsec-client plugin data as part of tech support info")),(0,r.kt)("p",null,"The detailed tech support info bundle will now include the necessary logs and data for troubleshooting ipsec-client plugin related problems."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1598")," - Support custom options for obscure libreswan config fields")),(0,r.kt)("p",null,"A new config option has been added to enable libreswan features that are not made available as first class configuration."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1591")," Add cpu, memory, and  status tracking for ipsec services.")),(0,r.kt)("p",null,"The system will now track the cpu, memory and usage information for various IPSec client related processes."),(0,r.kt)("h4",{id:"issues-fixed-2"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1628")," Incorrect network-script path was being used in the auto generated device-interface configuration"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution"))," The auto configuration was updated to use the correct script path.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1610")," The IPSec environment setup can fail on first time plugin install"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution"))," The salt states were improved to have better interdependencies to avoid the first time boot failure."))),(0,r.kt)("h3",{id:"release-320"},"Release 3.2.0"),(0,r.kt)("h4",{id:"new-features-and-improvements-2"},"New Features and Improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1509")," Ability to configure tunnel monitors")),(0,r.kt)("p",null,"The feature adds support for configuring tunnel monitors using ping. See ",(0,r.kt)("a",{parentName:"p",href:"#tunnel-monitoring"},"the tunnel monitoring section")," for more details."),(0,r.kt)("h4",{id:"issues-fixed-3"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1389")," Corrupt encryption database caused tunnels to not come up."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution"))," The service on the router will clean up these database files on startup.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1467")," Configuring ",(0,r.kt)("inlineCode",{parentName:"p"},"aes_gcm256")," for ",(0,r.kt)("inlineCode",{parentName:"p"},"phase2-encryption")," resulted in invalid libreswan configuration."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution"))," The libreswan config generation will generate valid configuration for ",(0,r.kt)("inlineCode",{parentName:"p"},"aes_gcm256"),"."))),(0,r.kt)("h3",{id:"release-313"},"Release 3.1.3"),(0,r.kt)("h4",{id:"issues-fixed-4"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1480")," IPSec tunnels were removed from all previously configured routers after config commit"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution:"))," The config generation logic for the plugin will handle config with long lines correctly"))),(0,r.kt)("h3",{id:"release-220-310"},"Release 2.2.0, 3.1.0"),(0,r.kt)("h4",{id:"new-features-and-improvements-3"},"New Features and Improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1289")," Ability to provision custom MSS on the remote tunnel interfaces")),(0,r.kt)("p",null,"The feature adds support for configuring a custom MSS value on the remote IPSec tunnel interface. The new configuration can be found under ",(0,r.kt)("inlineCode",{parentName:"p"},"router > node > ipsec-client > remote > enforced-mss"),". The configuration follows the same format as the ",(0,r.kt)("a",{parentName:"p",href:"/docs/config_reference_guide#network-interface"},"network-interface > enforced-mss"),"."),(0,r.kt)("h3",{id:"release-107-207-210-302"},"Release 1.0.7, 2.0.7, 2.1.0, 3.0.2"),(0,r.kt)("h4",{id:"issues-fixed-5"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1092")," IPSec left and right subnet configuration does not always work correctly"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution:"))," The non-default left and right subnet configuration is correctly translated to corresponding libreswan configuration.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PLUGIN-1103")," IPSec remote host does not appear as link on the GUI"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Resolution:"))," The GUI presentation model was updated to include the missing key field."))),(0,r.kt)("h3",{id:"release-301"},"Release 3.0.1"),(0,r.kt)("h4",{id:"issues-fixed-6"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1092")," Added fix for local and remote subnet configuration option to allow a single value or a list of values.")),(0,r.kt)("h3",{id:"release-300"},"Release 3.0.0"),(0,r.kt)("h4",{id:"issues-fixed-7"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-768")," Support the IPSec client plugin in 128T versions ",(0,r.kt)("inlineCode",{parentName:"li"},"5.1.0")," and greater."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-611")," Added support for plugin state. Plugin state information can be accessed on the PCLI using ",(0,r.kt)("inlineCode",{parentName:"li"},"show plugins state [router <router>] [node <node>] [{detail | summmary}] 128T-ipsec-client"))),(0,r.kt)("h3",{id:"release-106-206"},"Release 1.0.6, 2.0.6"),(0,r.kt)("h4",{id:"issues-fixed-8"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1057")," Ensure all critical IPsec client directories are created during installation of the plugin."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1053")," Added an inactive IPsec client plugin state to allow seamless migration from zscaler. The inactive state is achieved by excluding ",(0,r.kt)("inlineCode",{parentName:"li"},"ipsec-client")," from the configuration."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-1046")," Provide IPsec client auto-upgrade capability while crossing the 128T version ",(0,r.kt)("inlineCode",{parentName:"li"},"4.3.0")," boundary.")),(0,r.kt)("h3",{id:"release-105-205"},"Release 1.0.5, 2.0.5"),(0,r.kt)("h4",{id:"issues-fixed-9"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-994")," The ",(0,r.kt)("inlineCode",{parentName:"li"},"ipsec-client > remote-id")," configuration is not being used correctly when generating the libreswan config.")),(0,r.kt)("h3",{id:"release-104-204"},"Release 1.0.4, 2.0.4"),(0,r.kt)("h4",{id:"issues-fixed-10"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-384")," Added an MTU configuration option to the ipsec profile."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-333")," The ",(0,r.kt)("inlineCode",{parentName:"li"},"plugin-network")," ip prefix setting in the configuration was ignored and would instead use the default ip prefix setting."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-336")," Using the ",(0,r.kt)("inlineCode",{parentName:"li"},"vector-name")," configuration option would generate invalid configuration."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-400")," Added a local subnet configuration option and enhanced the remote subnet configuration option to allow a list of values.")),(0,r.kt)("h3",{id:"release-101-201"},"Release 1.0.1, 2.0.1"),(0,r.kt)("h4",{id:"issues-fixed-11"},"Issues Fixed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PLUGIN-47")," Created generic IPsec client plugin to provide connectivity to remote ipsec endpoints. This version supports a single client with up to two remote endpoints.")))}c.isMDXComponent=!0},75358:function(e,t,n){t.Z=n.p+"assets/images/ipsec_tunnel_restart-148ecaf788dacf7fc5a9cfd2ef6ead65.png"}}]);