"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[717],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},f=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),f=c(n),d=a,m=f["".concat(s,".").concat(d)]||f[d]||u[d]||r;return n?i.createElement(m,o(o({ref:t},p),{},{components:n})):i.createElement(m,o({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=f;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<r;c++)o[c]=n[c];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}f.displayName="MDXCreateElement"},89878:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return s},toc:function(){return c},default:function(){return u}});var i=n(87462),a=n(63366),r=(n(67294),n(3905)),o=["components"],l={title:"Inline Flow Performance Monitoring",sidebar_label:"Inline Flow Performance Monitoring"},s={unversionedId:"config_flow_perf_mon",id:"config_flow_perf_mon",isDocsHomePage:!1,title:"Inline Flow Performance Monitoring",description:"Inline Flow Performance Monitoring (FPM) complements BFD in measuring peer paths between two SSR devices. To provide this additional level of detail, the initiating router adds a small amount of metadata to a sample number of packets. This metadata indicates that metrics are collected per path, traffic class, and protocol (TCP or UDP). The receiving router reads the metadata and returns the data to the intiating router. The configurable fields include:",source:"@site/docs/config_flow_perf_mon.md",sourceDirName:".",slug:"/config_flow_perf_mon",permalink:"/docs/config_flow_perf_mon",version:"current",lastUpdatedAt:1637605101,formattedLastUpdatedAt:"11/22/2021",sidebar_label:"Inline Flow Performance Monitoring",frontMatter:{title:"Inline Flow Performance Monitoring",sidebar_label:"Inline Flow Performance Monitoring"},sidebar:"docs",previous:{title:"Configuring Ethernet Over Secure Vector Routing",permalink:"/docs/config_EthoSVR"},next:{title:"Native GRE Tunnels",permalink:"/docs/config_gre_tunnel"}},c=[{value:"Configuration",id:"configuration",children:[{value:"Load Balancing",id:"load-balancing",children:[]},{value:"Show Commands",id:"show-commands",children:[]}]},{value:"Troubleshooting",id:"troubleshooting",children:[]}],p={toc:c};function u(e){var t=e.components,l=(0,a.Z)(e,o);return(0,r.kt)("wrapper",(0,i.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Inline Flow Performance Monitoring (FPM) complements BFD in measuring peer paths between two SSR devices. To provide this additional level of detail, the initiating router adds a small amount of metadata to a sample number of packets. This metadata indicates that metrics are collected per path, traffic class, and protocol (TCP or UDP). The receiving router reads the metadata and returns the data to the intiating router. The configurable fields include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"name"),": The name of the performance monitoring profile."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"marking-count"),": The number of packets to mark within a given interval."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"interval-duration"),": The duration of a packet marking interval in milliseconds."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"monitor-only"),": Collect statistics without influencing packet processing features."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"resource-group"),": Associate this performance monitoring profile with a top-level resource-group.")),(0,r.kt)("p",null,"Additional information is available at ",(0,r.kt)("a",{parentName:"p",href:"/docs/config_reference_guide/#performance-monitoring-profile"},(0,r.kt)("inlineCode",{parentName:"a"},"performance-monitoring-profile"),".")),(0,r.kt)("p",null,"The data returned is organized by traffic class (high/medium/low/best-effort) and protocol (TDP, UDP), giving more granular data on the performance of a link - not just through synthetic traffic (BFD), but by piggybacking onto actual user traffic."),(0,r.kt)("h4",{id:"a-bit-about-traffic-class"},"A bit about traffic-class"),(0,r.kt)("p",null,"The SSR has four traffic classes, in order of priority: high, medium, low, best-effort. The traffic-class allows you to configure different treatments for different classes of traffic for the same service."),(0,r.kt)("p",null,"Working in concert with the traffic engineering subsystem, this lets you determine which paths the traffic referenced by a service class will use, and therefore how much guaranteed bandwidth is reserved for each class."),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("h4",{id:"from-the-command-line"},"From the command line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"config\n\n    authority\n\n        performance-monitoring-profile  wan-assurance-monitoring-profile\n            name               wan-assurance-monitoring-profile\n            marking-count      100\n            interval-duration  10000\n            monitor-only       true\n        exit\n    exit\nexit\n")),(0,r.kt)("h4",{id:"from-the-gui"},"From the GUI:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"From the Authority level, scroll down to Performance Monitoring Profiles, and click ADD.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Performance Monitoring Profiles",src:n(43574).Z})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Enter a name for the profile.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"New Profile Name",src:n(96498).Z})),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Configure monitoring values, or accept the defaults to gather a baseline.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Monitoring Profile Intervals",src:n(98765).Z})),(0,r.kt)("p",null,"   The default setting for Monitor Only is false. This generates metrics, but does not influence load balancing decisions or traffic flow. To use the Flow performance metrics for load balancing decisions, select true. "),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Optionally, assign the profile to a Resource Group.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Validate and Commit the configuration changes."))),(0,r.kt)("p",null,"Additionally, ensure that the profile is applied to your peer paths. This is generally configured through ",(0,r.kt)("strong",{parentName:"p"},"router > node > device-interface > network-interface > neighborhood"),". Apply the profile to both sides of the SVR peer path."),(0,r.kt)("h3",{id:"load-balancing"},"Load Balancing"),(0,r.kt)("p",null,"Flow performance monitoring operates on top of existing traffic, and does not intiate its own traffic. Because of the interval timing and sample time, no significant load is added to the path, and no impact to load balancing is generated. "),(0,r.kt)("p",null,"By default, the metrics generated by FPM are not contributed to the BFD metrics to influence load balancing. By disabling monitor mode (set to true) the FPM metrics are reported to the load balancer.",(0,r.kt)("br",{parentName:"p"}),"\n","When FPM is active (not configured as monitor only), both BFD and FPM provide metrics for calculating SLA and making load balancing decisions. Because FPM metrics provide greater detail than BFD metrics, these metrics are used first by the load balancer. When FPM metrics are stale (due to lack of traffic) the use of BFD metrics resumes."),(0,r.kt)("h3",{id:"show-commands"},"Show Commands"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"show stats performance-monitoring")," to view the results. The following metrics are provided:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"peer-path jitter"),": Jitter in milliseconds for the SSR peer path."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"peer-path latency"),": Latency in milliseconds for the SSR peer path."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"peer-path loss"),": Packet loss percentange for the SSR peer path."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"peer-path mos"),": MOS value calculated for the SSR peer path (hundreths of a decimal)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"peer-path updated"),": Time of last reported FPM activity on this peer path. ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"admin@labsystem1.fiedler# show stats performance-monitoring router all force\nTue 2021-11-09 11:19:51 EST\n\u2714 Retrieving statistics...\n\nHighway Manager Performance Monitoring Stats\n--------------------------------------------\n\n=================== =========== ======== =========== ================ ============= ====== =============== ========== ============\n Metric              Router      Node     Peer-name   Peer-host        Device-name   Vlan   Traffic-class   Protocol        Value\n=================== =========== ======== =========== ================ ============= ====== =============== ========== ============\n peer-path jitter    natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp                21\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp                12\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp                 4\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp                51\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp                 0\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp                 1\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp                 0\n peer-path latency   natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp                78\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp                64\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp                45\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp               113\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp                18\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp                15\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp                 0\n peer-path loss      natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp                 0\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp                 0\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp                 0\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp                 0\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp                 0\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp                 0\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp               100\n peer-path mos       natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp               434\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp               436\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp               438\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp               412\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp               440\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp               440\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp               100\n peer-path updated   natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp        1636474788\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp        1636216599\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp        1636474188\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp        1636216603\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp        1636466059\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp        1636466059\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp        1636025768\n\n\n")),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h4",{id:"i-am-experiencing-100-loss-on-one-node-when-traffic-is-flowing"},"I am experiencing 100% loss on one node when traffic is flowing:"),(0,r.kt)("p",null,"Verify that the peer router has FPM enabled on its peer path. If not, the peer router will not collect and respond to FPM data analytics queries."),(0,r.kt)("h4",{id:"i-am-seeing-infrequent-fpm-analytics-updates-when-generating-test-traffic-using-tools-like-iperf"},"I am seeing infrequent FPM analytics updates when generating test traffic using tools like Iperf:"),(0,r.kt)("p",null,"FPM operates on packets below MTU so calculations are not impacted by fragmentation stacks. Certain test tools that by default generate jumbo traffic may not satisfy this condition. As a result, FPM will not sample packets that will not generate new analytics."),(0,r.kt)("h4",{id:"loss-values-generated-by-fpm-are-very-volatile"},"Loss values generated by FPM are very volatile:"),(0,r.kt)("p",null,"Because FPM attaches to existing traffic and does not generate its own, a very short interval duration can lead to inaccurate loss values. This is due to FPM not being able to sample a sufficient number of packets within the given interval. Increasing the interval duration allows more packets to be sampled, providing a more accurate representation of loss on the path."))}u.isMDXComponent=!0},43574:function(e,t,n){t.Z=n.p+"assets/images/config_ifpm1-8397280be51b4724bc3462ce730b2d4c.png"},96498:function(e,t,n){t.Z=n.p+"assets/images/config_ifpm2-2eb0dcf71b732a9da83f8810a1cdb107.png"},98765:function(e,t,n){t.Z=n.p+"assets/images/config_ifpm3-11200f7efb4b929667477e957c0a21c1.png"}}]);