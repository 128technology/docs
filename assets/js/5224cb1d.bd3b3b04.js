"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[8770],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=l(n),d=r,f=m["".concat(p,".").concat(d)]||m[d]||u[d]||i;return n?a.createElement(f,o(o({ref:t},c),{},{components:n})):a.createElement(f,o({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},14606:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return p},metadata:function(){return l},toc:function(){return c},default:function(){return m}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),o=["components"],s={title:"ExpressRoute QoS Configuration",sidebar_label:"ExpressRoute QoS Configuration"},p=void 0,l={unversionedId:"bcp_qos_msft_expressroute",id:"bcp_qos_msft_expressroute",title:"ExpressRoute QoS Configuration",description:"When peering with Microsoft using ExpressRoute \u2013 particularly for Skype for Business and Microsoft Teams applications \u2013 it is important to ensure that you leverage appropriate QoS (DSCP) markings. Failing to use recognized marks will cause your packets to get dropped by Microsoft. This document identifies the appropriate service-class configuration to be used to ensure smooth interoperability with Microsoft ExpressRoute peering.",source:"@site/docs/bcp_qos_msft_expressroute.md",sourceDirName:".",slug:"/bcp_qos_msft_expressroute",permalink:"/docs/bcp_qos_msft_expressroute",tags:[],version:"current",lastUpdatedAt:1660230464,formattedLastUpdatedAt:"8/11/2022",frontMatter:{title:"ExpressRoute QoS Configuration",sidebar_label:"ExpressRoute QoS Configuration"},sidebar:"docs",previous:{title:"Per Adjacency Traffic Engineering",permalink:"/docs/bcp_per-adjacency_traffic_engineering"},next:{title:"LTE Peering",permalink:"/docs/bcp_lte_peering"}},c=[{value:"Sample Configuration Excerpt",id:"sample-configuration-excerpt",children:[],level:2}],u={toc:c};function m(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"When peering with Microsoft using ExpressRoute \u2013 particularly for Skype for Business and Microsoft Teams applications \u2013 it is important to ensure that you leverage appropriate QoS (DSCP) markings. Failing to use recognized marks will cause your packets to get dropped by Microsoft.",(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," This document identifies the appropriate ",(0,i.kt)("inlineCode",{parentName:"p"},"service-class")," configuration to be used to ensure smooth interoperability with Microsoft ExpressRoute peering."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This applies only to ExpressRoute peering for voice applications. Consult your Microsoft account representative to ensure these requirements apply to your peering connection for other service types."))),(0,i.kt)("p",null,"Microsoft only recognizes five different DSCP values on ExpressRoute. Any packets marked with a DSCP value other than one of these five will be dropped; therefore, ",(0,i.kt)("em",{parentName:"p"},"it is important to ensure any services that will leverage ExpressRoute have a service-policy that marks traffic to one of thsee five values.")),(0,i.kt)("p",null,"The table below is an augmented version of ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/expressroute/expressroute-qos"},"the one provided by Microsoft"),", to indicate the mapping of ExpressRoute DSCP to built-in 128T ",(0,i.kt)("inlineCode",{parentName:"p"},"service-class"),' definitions. Each 128T system will have these mappings as part of the "factory default" configuration.'),(0,i.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"It is possible that your factory default configuration has been administratively modified or various elements administratively deleted, and thus these ",(0,i.kt)("inlineCode",{parentName:"p"},"service-class")," definitions do not exist on your system. You can confirm the presence or absence of these configuration elements by using the PCLI command ",(0,i.kt)("inlineCode",{parentName:"p"},"show config running authority service-class verbose all"),", and ensuring the five classes mentioned below exist, and match the DSCP markings as indicated."))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Traffic Class"),(0,i.kt)("th",{parentName:"tr",align:null},"DSCP Marking"),(0,i.kt)("th",{parentName:"tr",align:null},"128T Service Class"),(0,i.kt)("th",{parentName:"tr",align:null},"Workload"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Voice"),(0,i.kt)("td",{parentName:"tr",align:null},"EF (46)"),(0,i.kt)("td",{parentName:"tr",align:null},"Telephony"),(0,i.kt)("td",{parentName:"tr",align:null},"Skype/Microsoft Teams/Lync voice")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Interactive"),(0,i.kt)("td",{parentName:"tr",align:null},"AF41 (34)"),(0,i.kt)("td",{parentName:"tr",align:null},"MultimediaConferencing"),(0,i.kt)("td",{parentName:"tr",align:null},"Video, VBSS")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Interactive"),(0,i.kt)("td",{parentName:"tr",align:null},"AF21 (18)"),(0,i.kt)("td",{parentName:"tr",align:null},"LowLatencyData"),(0,i.kt)("td",{parentName:"tr",align:null},"App sharing")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Default"),(0,i.kt)("td",{parentName:"tr",align:null},"AF11 (10)"),(0,i.kt)("td",{parentName:"tr",align:null},"HighThroughputData"),(0,i.kt)("td",{parentName:"tr",align:null},"File transfer")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Default"),(0,i.kt)("td",{parentName:"tr",align:null},"CS0 (0)"),(0,i.kt)("td",{parentName:"tr",align:null},"Standard"),(0,i.kt)("td",{parentName:"tr",align:null},"Anything else")))),(0,i.kt)("h2",{id:"sample-configuration-excerpt"},"Sample Configuration Excerpt"),(0,i.kt)("p",null,"The following example configuration excerpt illustrates the relationship between a ",(0,i.kt)("inlineCode",{parentName:"p"},"service"),", a ",(0,i.kt)("inlineCode",{parentName:"p"},"service-policy"),", and a ",(0,i.kt)("inlineCode",{parentName:"p"},"service-class"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'config\n\n    authority\n\n        service  Skype-Voice\n            name              Skype-Voice\n            description       "Skype voice traffic"\n            scope             private\n            security          my-encryption-policy\n            application-name  O365-Skype\n\n            access-policy     trusted\n                source      trusted\n                permission  allow\n            exit\n\n            access-policy     quarantine\n                source      quarantine\n                permission  deny\n            exit\n            service-policy    voip-audio\n        exit\n\n        service-policy  voip-audio\n            name                 voip-audio\n            description          "RTP/bearer audio"\n            service-class        Telephony\n            session-resiliency   failover\n            path-quality-filter  true\n            best-effort          true\n            max-loss             1\n            max-latency          150\n            max-jitter           30\n        exit\n\n        service-class  Telephony\n            name           Telephony\n            dscp           46\n            traffic-class  high\n        exit\n    exit\nexit\n')),(0,i.kt)("p",null,"In this example, the ",(0,i.kt)("inlineCode",{parentName:"p"},"Skype-Voice")," service leverages the built-in O365 application module for Skype and is given treatment according to the ",(0,i.kt)("inlineCode",{parentName:"p"},"voip-audio")," policy. The ",(0,i.kt)("inlineCode",{parentName:"p"},"voip-audio")," policy in turn references the ",(0,i.kt)("inlineCode",{parentName:"p"},"service-class")," named ",(0,i.kt)("inlineCode",{parentName:"p"},"Telephony"),", which will mark packets with DSCP 46 (a.k.a. EF)."),(0,i.kt)("p",null,"Given this configuration, as traffic arrives and is matched to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Skype-Voice")," service, it will be marked as EF (46) on egress."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This marking is path independent, so even if this traffic does not use an ExpressRoute (if for example the ExpressRoute is temporarily unavailable), the packets will still be marked per the ",(0,i.kt)("inlineCode",{parentName:"p"},"service-class")," assigned."))),(0,i.kt)("div",{className:"footnotes"},(0,i.kt)("hr",{parentName:"div"}),(0,i.kt)("ol",{parentName:"div"},(0,i.kt)("li",{parentName:"ol",id:"fn-1"},(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/expressroute/expressroute-qos"},"https://docs.microsoft.com/en-us/azure/expressroute/expressroute-qos"),(0,i.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")))))}m.isMDXComponent=!0}}]);