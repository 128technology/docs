"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[3103],{8701:e=>{e.exports=JSON.parse('{"blogPosts":[{"id":"I95-56233","metadata":{"permalink":"/kb/I95-56233","source":"@site/kb/2024-04-25-I95-56233.md","title":"Packet forwarding stops in AWS after several hours","description":"Packet forwarding on the SSR stops after several hours of runtime in AWS when using Elastic Network Adapter (ENA) driver.","date":"2024-04-26T00:00:00.000Z","formattedDate":"April 26, 2024","tags":[{"label":"6.1","permalink":"/kb/tags/6-1"},{"label":"6.1.7","permalink":"/kb/tags/6-1-7"}],"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Packet forwarding stops in AWS after several hours","slug":"I95-56233","date":"2024-4-26","tags":["6.1","6.1.7"],"hide_table_of_contents":false},"unlisted":false,"nextItem":{"title":"Unable to bind accelerated networking interfaces in Azure when using vmbus-id","permalink":"/kb/I95-54541"}},"content":"Packet forwarding on the SSR stops after several hours of runtime in AWS when using Elastic Network Adapter (ENA) driver.\\n\\n\x3c!-- truncate --\x3e\\n\\n**Issue ID:** I95-56233  \\n**Last Updated:** 2024-04-26  \\n**Introduced in SSR Version:** 6.1.7\\n\\n### Problem\\nThe ENA command-queue becomes unresponsive (device not responding) and the interface no longer passes traffic.\\n\\nIndications of the symptoms can be observed by viewing the output of `show device-interface extended-statistics`.\\nThere will be an excessive amount of rx errors indicated by the system.\\n```\\n Extended Statistics:\\n   bw_in_allowance_exceeded:                0\\n   bw_out_allowance_exceeded:               0\\n   conntrack_allowance_exceeded:            0\\n   dev_start:                               0\\n   dev_stop:                                0\\n   device_port:                             4\\n   dpdk_port:                               0\\n   linklocal_allowance_exceeded:            0\\n   pps_allowance_exceeded:                  0\\n   rx_errors:                 139836994071144\\n   rx_good_bytes:                           0\\n   rx_good_packets:                         0\\n   rx_mbuf_allocation_errors: 139838439323150\\n   rx_missed_errors:          139837561586960\\n   rx_q0_bytes:                       1876012\\n   rx_q0_cnt:                               0\\n   rx_q0_errors:                      2734322\\n   rx_q0_l3_csum_bad:                       0\\n   rx_q0_l4_csum_bad:                       0\\n   rx_q0_l4_csum_good:                      0\\n   rx_q0_packets:                   875075952\\n   rx_q0_refill_partial:                    0\\n   rx_q1_bytes:                       1862808\\n   rx_q1_cnt:                               0\\n   rx_q1_errors:                      2100224\\n```\\n\\nAdditionally, the following log messages provide evidence of the failure event:\\n`DPDK.log`\\n```\\nApr 02 23:47:22.351 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_com_wait_and_process_admin_cq_interrupts]Timeout waiting for comp_ctx->wait_event\\nApr 02 23:47:22.351 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_com_wait_and_process_admin_cq_interrupts]The ena device didn\'t send a completion for the admin cmd 11 status 0\\nApr 02 23:47:22.351 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_get_dev_stats]Failed to get stats. error: -62\\nApr 02 23:47:22.351 [DPDK| -- ] ERROR (deviceManagerTP) ena_stats_get(): Could not retrieve statistics from ENA\\nApr 02 23:47:25.352 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_com_wait_and_process_admin_cq_interrupts]Timeout waiting for comp_ctx->wait_event\\nApr 02 23:47:25.352 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_com_wait_and_process_admin_cq_interrupts]The ena device didn\'t send a completion for the admin cmd 11 status 0\\nApr 02 23:47:25.352 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_get_dev_stats]Failed to get stats. error: -62\\nApr 02 23:47:25.352 [DPDK| -- ] ERROR (deviceManagerTP) ena_stats_get(): Could not retrieve statistics from ENA\\nApr 02 23:47:26.353 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_get_dev_stats]Failed to get stats. error: -19\\nApr 02 23:47:26.353 [DPDK| -- ] ERROR (deviceManagerTP) ena_stats_get(): Could not retrieve statistics from ENA\\nApr 02 23:47:26.354 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_get_dev_stats]Failed to get stats. error: -19\\n```\\n\\n`journal.log`\\n```\\nApr 03 08:26:02.642583 relayroutereast001 highway[9604]: Failed to queue packet; No ARP for x.x.x.1, interface 1.0, ex: ArpEntryPendException: Pend list max size of 5 exceeded\\nApr 03 08:26:02.642595 relayroutereast001 highway[9604]: Send packet failed for session remote-host:  ip-address: x.x.x.1; local-ip x.x.x.242; local-intf: 1.0; peer-name Router11-W\\n```\\n\\n`highway.log`\\n```\\nApr 03 09:25:35.173 [LINK|BFDS] ERROR (bfdAgentTP     ) Failed to queue packet; No ARP for x.x.x.195, interface 1.0, ex: ArpEntryPendException: Pend list max size of 5 exceeded\\nApr 03 09:25:35.173 [LINK|BFDS] ERROR (bfdAgentTP     ) Send packet failed for session remote-host:  ip-address: x.x.x.195; local-ip x.x.x.242; local-intf: 1.0; peer-name RelayRouter001\\n```\\n\\n### Release Notes\\nThe ENA command-queue becomes unresponsive (device not responding) and the interface no longer passes traffic.\\n\\nUpdated ENA device driver from DPDK/Amazon (upgrading driver from 2.6.0 to 2.9.0).\\n[ENA release notes](https://github.com/amzn/amzn-drivers/blob/master/kernel/linux/ena/RELEASENOTES.md)\\n\\nENA supports health checks which can be used to detect faulty behavior of the hardware and the driver. As such, an ENA driver watchdog has been developed to check for the following reset reasons:\\n\\n* HW unresponsiveness \u2013 Driver detected that the periodic keep alive signals stopped arriving from the HW through the Asynchronous Event Notification Queue (AENQ).\\n* Faulty admin queue behavior \u2013 The admin queue entered a faulty state.\\n* Faulty behavior on the IO path \u2013 The device returned invalid descriptors or caused the driver to enter the invalid state.\\n* Missing Tx completions exceeds a dynamically calculated threshold - Prevent Tx ring stalls in case Tx descriptors were not returned by the HW.\\n\\n### Severity\\n<details>\\nThe potential impact of a software defect if encountered. Severity levels are:\\n* Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system.\\n* Major: Could seriously affect system operation, maintenance, administration and related tasks.\\n* Minor: Would not significantly impair the functioning or affect service.\\n</details>\\nCritical\\n\\n### STATUS\\nOpen\\n\\n### RESOLVED IN\\n\\n\\n### PRODUCT\\nSSR\\n\\n### FUNCTIONAL AREA\\nDatapath\\n\\n### WORKAROUND\\n:::info\\nJuniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues.\\n:::\\nDisable enhanced networking in AWS instance.\\n\\nA restart of the SSR is necessary to remediate this condition:\\n`systemctl restart 128T`"},{"id":"I95-54541","metadata":{"permalink":"/kb/I95-54541","source":"@site/kb/2024-04-25-I95-54541.md","title":"Unable to bind accelerated networking interfaces in Azure when using vmbus-id","description":"Recent changes to fix MTU to use the max device supported value causes the SSR to set MTU to 9K. However since NetVSC does not support Scatter RX, it fails to bind because the SSR uses packet buffers of size 2K, and cannot span multiple mbufs.","date":"2024-04-25T00:00:00.000Z","formattedDate":"April 25, 2024","tags":[{"label":"6.1","permalink":"/kb/tags/6-1"},{"label":"6.1.5","permalink":"/kb/tags/6-1-5"}],"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Unable to bind accelerated networking interfaces in Azure when using vmbus-id","slug":"I95-54541","date":"2024-4-25","tags":["6.1","6.1.5"],"hide_table_of_contents":false},"unlisted":false,"prevItem":{"title":"Packet forwarding stops in AWS after several hours","permalink":"/kb/I95-56233"},"nextItem":{"title":"Upgrade from 6.1 to 6.2 changes PCI mapping in AWS","permalink":"/kb/I95-54838"}},"content":"Recent changes to fix MTU to use the max device supported value causes the SSR to set MTU to 9K. However since NetVSC does not support Scatter RX, it fails to bind because the SSR uses packet buffers of size 2K, and cannot span multiple mbufs.\\n\\n\x3c!-- truncate --\x3e\\n\\n**Issue ID:** I95-54541  \\n**Last Updated:** 2024-04-25  \\n**Introduced in SSR Version:** 6.1.5\\n\\n### Problem\\nNetVSC does not support Scatter RX, so with new change to use 9K max RX, it is unable to span multipe 2K packet buffers. When matched with MLX in accelerated networking, the MLX device fails to initialize.\\nDuring device configuration, user specified MTU exceeding 2K will cause init failure for that device interface.\\n\\nLimit the MTU (also max RX size in DPDK) of NetVSC devices to SSR packet buffer size.\\n\\n### Release Notes\\nFixes an issue where device-interfaces configured in Azure VM would fail during initialization and port remains operationally down.\\n\\n### Severity\\n<details>\\nThe potential impact of a software defect if encountered. Severity levels are:\\n* Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system.\\n* Major: Could seriously affect system operation, maintenance, administration and related tasks.\\n* Minor: Would not significantly impair the functioning or affect service.\\n</details>\\nMajor\\n\\n### Status\\nClosed\\n\\n### Resolved In\\nTo be resolved in [6.1.8](../docs/release_notes_128t_6.1)  \\n[6.2.4](../docs/release_notes_128t_6.2#release-624-14r2)\\n\\n### Product\\nAzure SSR AMI\\n\\n### Functional Area\\nInterface Binding\\n\\n### Workaround\\n<details>\\nJuniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues.\\n</details>\\nDisabling the accelerated networking to allow the device to be bound via PCLI address instead of vmbus-id"},{"id":"I95-54838","metadata":{"permalink":"/kb/I95-54838","source":"@site/kb/2024-04-25-I95-54838.md","title":"Upgrade from 6.1 to 6.2 changes PCI mapping in AWS","description":"Existing device to PCI mappings are not persistent across software upgrades.","date":"2024-04-25T00:00:00.000Z","formattedDate":"April 25, 2024","tags":[{"label":"6.2","permalink":"/kb/tags/6-2"},{"label":"6.2.3-r2","permalink":"/kb/tags/6-2-3-r-2"}],"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Upgrade from 6.1 to 6.2 changes PCI mapping in AWS","slug":"I95-54838","date":"2024-4-25","tags":["6.2","6.2.3-r2"],"hide_table_of_contents":false},"unlisted":false,"prevItem":{"title":"Unable to bind accelerated networking interfaces in Azure when using vmbus-id","permalink":"/kb/I95-54541"},"nextItem":{"title":"Application Identification incompatible with DSCP Steering","permalink":"/kb/I95-56437"}},"content":"Existing device to PCI mappings are not persistent across software upgrades.\\n\\n\x3c!-- truncate --\x3e\\n\\n**Issue ID:** I95-54838  \\n**Last Updated:** 2024-04-25  \\n**Introduced in SSR Version:** 6.2.3\\n\\n\\n### Problem\\nDevice interfaces that do not have consistent naming do not hold to consistent PCI mappings. This is a known behavior in Linux. See [workarounds](#workaround)\\n\\n6.1 output\\n```\\n[root@egress_us-gov-east-1b_router2_i-0dc522cf745932463 bin]# lshw -c network -businfo\\n\\nBus info         Device Class         Description\\n====================================================\\npci@0000:00:05.0 ens5   network       Elastic Network Adapter (ENA)\\npci@0000:00:06.0 eth7   network       Elastic Network Adapter (ENA)\\npci@0000:00:07.0 eth6   network       Elastic Network Adapter (ENA)\\npci@0000:00:08.0 eth5   network       Elastic Network Adapter (ENA)\\npci@0000:00:09.0 eth4   network       Elastic Network Adapter (ENA)\\npci@0000:00:0a.0 ens10  network       Elastic Network Adapter (ENA)\\npci@0000:00:0b.0 ens11  network       Elastic Network Adapter (ENA)\\npci@0000:00:0c.0 ens12  network       Elastic Network Adapter (ENA)\\npci@0000:00:0d.0 ens13  network       Elastic Network Adapter (ENA)\\npci@0000:00:0e.0 eth3   network       Elastic Network Adapter (ENA)\\npci@0000:00:0f.0 eth2   network       Elastic Network Adapter (ENA)\\npci@0000:00:10.0 eth1   network       Elastic Network Adapter (ENA)\\npci@0000:00:11.0 eth0   network       Elastic Network Adapter (ENA)\\npci@0000:00:12.0 ens18  network       Elastic Network Adapter (ENA)\\npci@0000:00:13.0 ens19  network       Elastic Network Adapter (ENA)\\n```\\n\\n6.2 output. Note the changes to the `eth` interfaces. `ens` interfaces remain consistent.\\n```\\n[root@egress_us-gov-east-1a_router1_i-02d02f0ad597702e6 bin]# lshw -c network -businfo\\n\\nBus info         Device Class         Description\\n====================================================\\npci@0000:00:05.0 ens5   network       Elastic Network Adapter (ENA)\\npci@0000:00:06.0 eth5   network       Elastic Network Adapter (ENA)\\npci@0000:00:07.0 eth4   network       Elastic Network Adapter (ENA)\\npci@0000:00:08.0 eth3   network       Elastic Network Adapter (ENA)\\npci@0000:00:09.0 eth6   network       Elastic Network Adapter (ENA)\\npci@0000:00:0a.0 ens10  network       Elastic Network Adapter (ENA)\\npci@0000:00:0b.0 ens11  network       Elastic Network Adapter (ENA)\\npci@0000:00:0c.0 ens12  network       Elastic Network Adapter (ENA)\\npci@0000:00:0d.0 ens13  network       Elastic Network Adapter (ENA)\\npci@0000:00:0e.0 eth7   network       Elastic Network Adapter (ENA)\\npci@0000:00:0f.0 eth2   network       Elastic Network Adapter (ENA)\\npci@0000:00:10.0 eth1   network       Elastic Network Adapter (ENA)\\npci@0000:00:11.0 eth0   network       Elastic Network Adapter (ENA)\\npci@0000:00:12.0 ens18  network       Elastic Network Adapter (ENA)\\npci@0000:00:13.0 ens19  network       Elastic Network Adapter (ENA)\\n```\\n\\n### Release Notes\\n\\n### Severity\\n<details>\\nThe potential impact of a software defect if encountered. Severity levels are:\\n* Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system.\\n* Major: Could seriously affect system operation, maintenance, administration and related tasks.\\n* Minor: Would not significantly impair the functioning or affect service.\\n</details>\\nMinor\\n\\n### Status\\nOpen\\n\\n### Resolved In\\n\\n### Product\\nAWS SSR AMI\\n\\n### Functional Area\\nInterface Binding\\n\\n### Workaround\\n<details>\\nJuniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues.\\n</details>\\n[Give Network Interfaces Persistent Names Without Changing The GRUB Boot Configuration (Kernel Parameter biosdevname Or net.ifnames)](https://support.oracle.com/knowledge/Oracle%20Linux%20and%20Virtualization/2521902_1.html)"},{"id":"I95-56437","metadata":{"permalink":"/kb/I95-56437","source":"@site/kb/2024-04-25-I95-56437.md","title":"Application Identification incompatible with DSCP Steering","description":"Issue ID: I95-56437","date":"2024-04-25T00:00:00.000Z","formattedDate":"April 25, 2024","tags":[{"label":"5.6","permalink":"/kb/tags/5-6"},{"label":"5.6.13","permalink":"/kb/tags/5-6-13"}],"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Application Identification incompatible with DSCP Steering","slug":"I95-56437","date":"2024-4-25","tags":["5.6","5.6.13"],"hide_table_of_contents":false},"unlisted":false,"prevItem":{"title":"Upgrade from 6.1 to 6.2 changes PCI mapping in AWS","permalink":"/kb/I95-54838"},"nextItem":{"title":"Upgrade from 5.6 to 6.1 may result in missing FIB entries","permalink":"/kb/I95-55904"}},"content":"\x3c!-- truncate --\x3e\\n\\n**Issue ID:** I95-56437  \\n**Last Updated:** 2024-04-25  \\n**Introduced in SSR Version:** 5.6.13\\n\\n### Problem\\nThe app-id and dscp-steering features are incompatible.  \\n\\nIf app-id is configured on a child service (application-name, domain-name, domain-name-category, url, subcategory) and also on the same service a dscp-range list is defined, this triggers a failure state when the configuration is committed, causing the service to be added/modified/removed twice during config processing (ServiceManager + AppIdManager).  The commit action fails, and any subsequent service config updates *within that failed config* are ignored.  \\n\\nThe administrator will not be aware of a configuration issue. The only indication of the failure are log messages, as shown below.\\n`highway.log`\\n```\\nApr 17 13:59:54.622 [HWMC|SVC ] WARN  (routingAgPoller) ServiceAddException: Failed to Add Service Audio.MicrosoftTeams\\nApr 17 13:59:54.622 [HWMC|SVC ] ERROR (routingAgPoller) ServiceManager failed to process config trackers\\n```\\n\\n### Release Notes\\nThe app-id and dscp-steering features are incompatible and should not be configured simultaneously; doing so will cause future commits to fail. Strict configuration validation has been added to prevent configuring both features simultaneously.\\n\\n### Severity\\n<details>\\nThe potential impact of a software defect if encountered. Severity levels are:\\n* Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system.\\n* Major: Could seriously affect system operation, maintenance, administration and related tasks.\\n* Minor: Would not significantly impair the functioning or affect service.\\n</details>\\nMajor\\n\\n### Status\\nOpen\\n\\n### Resolved In\\n\\n### Product\\nSSR\\n\\n### Functional Area\\nConfiguration\\n\\n### Workaround\\n<details>\\nJuniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues.\\n</details>\\nDisable the service, or delete the offending configuration."},{"id":"I95-55904","metadata":{"permalink":"/kb/I95-55904","source":"@site/kb/2024-04-24-I95-55904.md","title":"Upgrade from 5.6 to 6.1 may result in missing FIB entries","description":"Upgrade from 5.6.8 to 6.1.7 may result in missing FIB entries and service-paths, causing connectivity issues.","date":"2024-04-24T00:00:00.000Z","formattedDate":"April 24, 2024","tags":[{"label":"6.1","permalink":"/kb/tags/6-1"},{"label":"6.1.7","permalink":"/kb/tags/6-1-7"}],"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Upgrade from 5.6 to 6.1 may result in missing FIB entries","slug":"I95-55904","date":"2024-4-24","tags":["6.1","6.1.7"],"hide_table_of_contents":false},"unlisted":false,"prevItem":{"title":"Application Identification incompatible with DSCP Steering","permalink":"/kb/I95-56437"}},"content":"Upgrade from 5.6.8 to 6.1.7 may result in missing FIB entries and service-paths, causing connectivity issues.\\n\\n\\n\x3c!-- truncate --\x3e\\n\\n**Issue ID:** I95-55904  \\n**Last Updated:** 2024-04-24  \\n**Introduced in SSR Version:** 6.1.7\\n\\n### PROBLEM\\nThe key of the data structure storing service configuration is a net::IpMask, which has custom `operator<`` and `operator==`` operator functions. These operators treat the bits after the prefix length as 1s, so 147.161.128.0/17 should be equal to 147.161.254.0/23 (as an example). The container used in 5.6 uses the `operator<`. The container used in 6.1 takes a hash operator which is not hashing these equivalent net::IpMasks to be equal, hence the difference in behavior.\\n\\n### RELEASE NOTES\\nFix case where adding services with overlapping address prefixes would cause config to not apply in highway.\\n\\n### SEVERITY\\n:::info\\nThe potential impact of a software defect if encountered. Severity levels are:\\n* Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system.\\n* Major: Could seriously affect system operation, maintenance, administration and related tasks.\\n* Minor: Would not significantly impair the functioning or affect service.\\n:::\\nCritical\\n\\n### STATUS\\nClosed\\n\\n### RESOLVED IN\\nTo be resolved in 6.1.8\\n\\n### PRODUCT\\nSSR\\n\\n### FUNCTIONAL AREA\\nRouting\\n\\n### WORKAROUND\\n:::info\\nJuniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues.\\n:::\\n\\n```bash\\ncurl -JLO https://github.com/majes-git/128t-scripts/raw/main/t128-show-ip-prefix-conflicts.pyz\\nchmod +x t128-show-ip-prefix-conflicts.pyz\\n```\\n\\nCommand Help\\n```bash\\n$ ./t128-show-ip-prefix-conflicts.pyz --help\\nusage: t128-show-ip-prefix-conflicts.pyz [-h] [-c HOST] [-u USER] [-p PASSWORD] [--config-store {running,candidate}] [-r READ_JSON] [--dump-json]\\n\\nShow overlapping ip prefixes in 128T services\\n\\noptional arguments:\\n  -h, --help            show this help message and exit\\n  -c HOST, --host HOST  Conductor/router hostname\\n  -u USER, --user USER  Conductor/router username (if no key auth)\\n  -p PASSWORD, --password PASSWORD\\n                        Conductor/router password (if no key auth)\\n  --config-store {running,candidate}\\n                        Config store to be used (running/candidate)\\n  -r READ_JSON, --read-json READ_JSON\\n                        Read services config from json file\\n  --dump-json           Write config dump to json file \\"t128-show-ip-prefix-conflicts.json\\"\\n```\\nSample\\n```bash\\n$ ./t128-show-ip-prefix-conflicts.pyz -r ssr-configuration.json\\nWARNING: Service \\"zscaler__client.internet\\" has conflicting addresses:\\n* 147.161.254.0/23 and 147.161.128.0/17\\n* 104.129.192.0/20 and 104.129.206.0/23\\n* 136.226.0.0/16 and 136.226.254.0/23\\n```"}]}')}}]);