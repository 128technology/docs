"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[1100],{93187:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var r=o(74848),t=o(28453);const i={title:"Proxy Server Configuration",sidebar_label:"Proxy Server Configuration"},s=void 0,d={id:"config-proxy-server",title:"Proxy Server Configuration",description:"With only MPLS or private connectivity available, it is possible to leverage a connection a public URL or to MIST using an explicit proxy and a private web proxy in the network. This type of web proxy is often used to bridge the gap between private and public networks.",source:"@site/docs/config-proxy-server.md",sourceDirName:".",slug:"/config-proxy-server",permalink:"/docs/config-proxy-server",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Proxy Server Configuration",sidebar_label:"Proxy Server Configuration"},sidebar:"docs",previous:{title:"NAT Troubleshooting",permalink:"/docs/ts_nat_troubleshooting"},next:{title:"DHCP",permalink:"/docs/config_dhcp"}},a={},l=[{value:"Configure an SSR Web Proxy",id:"configure-an-ssr-web-proxy",level:2},{value:"Static",id:"static",level:3},{value:"Learned",id:"learned",level:3},{value:"Network Interface Override",id:"network-interface-override",level:4},{value:"Proxy Address Selection",id:"proxy-address-selection",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"With only MPLS or private connectivity available, it is possible to leverage a connection a public URL or to MIST using an explicit proxy and a private web proxy in the network. This type of web proxy is often used to bridge the gap between private and public networks."}),"\n",(0,r.jsx)(n.p,{children:"The following support is provided for proxy server configuration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Proxy IP per WAN interface","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configuration override of proxy IP per WAN link"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Proxy IP for public URLs accessed by SSR. For example:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Websense"}),"\n",(0,r.jsx)(n.li,{children:"Sophos Server"}),"\n",(0,r.jsx)(n.li,{children:"Juniper Software download"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Proxy IP for an SSR to Mist connection (Secure ZTP Onboarding)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This document provides information to configure the SSR to identify and use the non-transparent proxy. That information can also be used to perform the ",(0,r.jsx)(n.a,{href:"/docs/sec-ztp-web-proxy",children:"Mist secure ZTP onboarding process"}),"."]}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.mdxAdmonitionTitle,{}),(0,r.jsx)(n.p,{children:"Anti-Virus configurations do not support the use of the proxy server. Anti-Virus will not work when a proxy server is enabled."})]}),"\n",(0,r.jsx)(n.h2,{id:"configure-an-ssr-web-proxy",children:"Configure an SSR Web Proxy"}),"\n",(0,r.jsx)(n.p,{children:"By default the SSR uses DHCP to identify the SSR web proxy addresses. To leverage a connection using an explicit proxy and a private web proxy, you can configure the SSR to either configure a static proxy IP address and port, or dynamically learn the proxy address."}),"\n",(0,r.jsx)(n.h3,{id:"static",children:"Static"}),"\n",(0,r.jsxs)(n.p,{children:["To set the proxy IP addresses manually, configure the ",(0,r.jsx)(n.code,{children:"management-proxy mode"})," to ",(0,r.jsx)(n.code,{children:"static"}),", and enter the IP address and port to be accessed by the SSR."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"config authority router router management-proxy mode   static\nconfig authority router router management-proxy proxy 10.0.0.1 address  10.0.0.1\nconfig authority router router management-proxy proxy 10.0.0.1 port     5000\n"})}),"\n",(0,r.jsx)(n.p,{children:"This same address will be used for both nodes in an HA pair, and across all WAN interfaces."}),"\n",(0,r.jsxs)(n.p,{children:["Optionally, you can use the ",(0,r.jsx)(n.code,{children:"onboarding-config.json"})," to set the static IP address and port number until the router is onboarded to the conductor. For additional information about using the ",(0,r.jsx)(n.code,{children:"onboarding-config.json"})," see ",(0,r.jsx)(n.a,{href:"/docs/initialize_u-iso_adv_workflow#onboarding-configuration-file",children:"Onboarding Configuration"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"learned",children:"Learned"}),"\n",(0,r.jsx)(n.p,{children:"The SSR can be configured to dynamically learn proxy addresses from a DHCP-server on the network."}),"\n",(0,r.jsxs)(n.p,{children:["When the ",(0,r.jsx)(n.code,{children:"router management-proxy"})," is ",(0,r.jsx)(n.code,{children:"enabled"}),", the default mode is ",(0,r.jsx)(n.code,{children:"learned"}),". In this case, the device will identify the web proxy addresses from a DHCP server on the network."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"config authority router router management-proxy enable\nconfig authority router router management-proxy mode  learned\n"})}),"\n",(0,r.jsx)(n.p,{children:"The following diagram describes the DHCP discovery process."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"DHCP Discovery Process",src:o(46682).A+"",width:"1070",height:"612"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["The SSR sends a DHCP DISCOVER message with ",(0,r.jsx)(n.code,{children:"Option 60"})," and value of ",(0,r.jsx)(n.code,{children:"JuniperSSR"}),". The message also includes ",(0,r.jsx)(n.code,{children:"Option 43"})," as a requested parameter."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'08:34:24.685760 IP (tos 0x0, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 306)\n    0.0.0.0.bootpc > 255.255.255.255.bootps: [udp sum ok] BOOTP/DHCP, Request from fa:16:3e:14:db:05 (oui Unknown), length 278, xid 0xe5dadd09, Flags [none] (0x0000)\n\t  Client-Ethernet-Address fa:16:3e:14:db:05 (oui Unknown)\n\t  Vendor-rfc1048 Extensions\n\t    Magic Cookie 0x63825363\n\t    DHCP-Message Option 53, length 1: Discover\n\t    Client-ID Option 61, length 7: ether fa:16:3e:14:db:05\n\t    Parameter-Request Option 55, length 4:\n\t      Subnet-Mask, Default-Gateway, Domain-Name-Server, Vendor-Option\n\t    Vendor-Class Option 60, length 10: "JuniperSSR\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["To enable proxy auto-discovery, the DHCP server must send DHCP option ",(0,r.jsx)(n.code,{children:"43"})," with a sub-option of ",(0,r.jsx)(n.code,{children:"128"}),". The sub-option should contain the proxy address and port information."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"08:34:25.687329 IP (tos 0x10, ttl 128, id 0, offset 0, flags [none], proto UDP (17), length 337)\n    linux-router.novalocal.bootps > 10.73.3.50.bootpc: [udp sum ok] BOOTP/DHCP, Reply, length 309, xid 0xe5dadd09, Flags [none] (0x0000)\n\t  Your-IP 10.73.3.50\n\t  Client-Ethernet-Address fa:16:3e:14:db:05 (oui Unknown)\n\t  Vendor-rfc1048 Extensions\n\t    Magic Cookie 0x63825363\n\t    DHCP-Message Option 53, length 1: Offer\n\t    Server-ID Option 54, length 4: linux-router.novalocal\n\t    Lease-Time Option 51, length 4: 6000\n\t    Subnet-Mask Option 1, length 4: 255.255.255.0\n\t    Default-Gateway Option 3, length 4: linux-router.novalocal\n\t    Domain-Name-Server Option 6, length 8: dns.google,dns.google\n\t    Vendor-Option Option 43, length 17: 10.92.53.8:3128\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["The same sequence repeats for ",(0,r.jsx)(n.code,{children:"DHCP REQUEST"})," and ",(0,r.jsx)(n.code,{children:"DHCP ACK"})," messages. This ensures that the information is successfully obtained during lease renewals."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["By default, the SSR includes the above options in its DHCP discovery implementation. When the ",(0,r.jsx)(n.code,{children:"router management-proxy"})," is ",(0,r.jsx)(n.code,{children:"enabled"}),", the discovered proxy is used."]}),"\n",(0,r.jsx)(n.h4,{id:"network-interface-override",children:"Network Interface Override"}),"\n",(0,r.jsx)(n.p,{children:"In a case where you do not want an SSR to learn a proxy address from a network interface, you can disable learning mode on that interface. This allows a user to define from which network-interfaces the web-proxy can be learned."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"config authority router router network-interface enable-proxy-discovery false\n"})}),"\n",(0,r.jsx)(n.h3,{id:"proxy-address-selection",children:"Proxy Address Selection"}),"\n",(0,r.jsxs)(n.p,{children:["It is possible that multiple SSR device-interfaces may be configured to use a DHCP client, which could result in learning multiple IP addresses. This may happen in cases where a device has multiple interfaces with ",(0,r.jsx)(n.code,{children:"dhcp"})," enabled, or in an HA deployment using ",(0,r.jsx)(n.code,{children:"learned"})," mode."]}),"\n",(0,r.jsx)(n.p,{children:"In these situations, the SSR will use the lowest integer value from the list of proxy-addresses learned. For example, if the DHCP mode learns the following address:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"192.168.10.10, 192.168.10.11"})}),"\n",(0,r.jsxs)(n.p,{children:["The SSR will select ",(0,r.jsx)(n.code,{children:"192.168.10.10"})," - the address with the lowest integer value."]}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.p,{children:"Use the following commands to see the learned proxy address and the selected proxy address."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"show dhcp learned-proxies"})," shows all learned proxy addresses for each network-interface."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"show management-proxy"})," shows the active proxy (if applicable)."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},46682:(e,n,o)=>{o.d(n,{A:()=>r});const r=o.p+"assets/images/sec-dhcp-discover-process-291c5640b57cbf747d5298fb2f27d7f5.png"},28453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>d});var r=o(96540);const t={},i=r.createContext(t);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);