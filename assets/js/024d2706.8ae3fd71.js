"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[7470],{80568:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var r=t(74848),i=t(28453);const s={title:"Packet forwarding stops in AWS after several hours",slug:"I95-56233",date:"2024-4-26",tags:["6.1","6.1.7"],hide_table_of_contents:!1},a=void 0,o={permalink:"/kb/I95-56233",source:"@site/kb/2024-04-25-I95-56233.md",title:"Packet forwarding stops in AWS after several hours",description:"Packet forwarding on the SSR stops after several hours of runtime in AWS when using Elastic Network Adapter (ENA) driver.",date:"2024-04-26T00:00:00.000Z",formattedDate:"April 26, 2024",tags:[{label:"6.1",permalink:"/kb/tags/6-1"},{label:"6.1.7",permalink:"/kb/tags/6-1-7"}],hasTruncateMarker:!0,authors:[],frontMatter:{title:"Packet forwarding stops in AWS after several hours",slug:"I95-56233",date:"2024-4-26",tags:["6.1","6.1.7"],hide_table_of_contents:!1},unlisted:!1,nextItem:{title:"Unable to bind accelerated networking interfaces in Azure when using vmbus-id",permalink:"/kb/I95-54541"}},d={authorsImageUrls:[]},c=[{value:"Problem",id:"problem",level:3},{value:"Release Notes",id:"release-notes",level:3},{value:"Severity",id:"severity",level:3},{value:"STATUS",id:"status",level:3},{value:"RESOLVED IN",id:"resolved-in",level:3},{value:"PRODUCT",id:"product",level:3},{value:"FUNCTIONAL AREA",id:"functional-area",level:3},{value:"WORKAROUND",id:"workaround",level:3}];function l(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Packet forwarding on the SSR stops after several hours of runtime in AWS when using Elastic Network Adapter (ENA) driver."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Issue ID:"})," I95-56233",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.strong,{children:"Last Updated:"})," 2024-04-26",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.strong,{children:"Introduced in SSR Version:"})," 6.1.7"]}),"\n",(0,r.jsx)(n.h3,{id:"problem",children:"Problem"}),"\n",(0,r.jsx)(n.p,{children:"The ENA command-queue becomes unresponsive (device not responding) and the interface no longer passes traffic."}),"\n",(0,r.jsxs)(n.p,{children:["Indications of the symptoms can be observed by viewing the output of ",(0,r.jsx)(n.code,{children:"show device-interface extended-statistics"}),".\nThere will be an excessive amount of rx errors indicated by the system."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:" Extended Statistics:\n   bw_in_allowance_exceeded:                0\n   bw_out_allowance_exceeded:               0\n   conntrack_allowance_exceeded:            0\n   dev_start:                               0\n   dev_stop:                                0\n   device_port:                             4\n   dpdk_port:                               0\n   linklocal_allowance_exceeded:            0\n   pps_allowance_exceeded:                  0\n   rx_errors:                 139836994071144\n   rx_good_bytes:                           0\n   rx_good_packets:                         0\n   rx_mbuf_allocation_errors: 139838439323150\n   rx_missed_errors:          139837561586960\n   rx_q0_bytes:                       1876012\n   rx_q0_cnt:                               0\n   rx_q0_errors:                      2734322\n   rx_q0_l3_csum_bad:                       0\n   rx_q0_l4_csum_bad:                       0\n   rx_q0_l4_csum_good:                      0\n   rx_q0_packets:                   875075952\n   rx_q0_refill_partial:                    0\n   rx_q1_bytes:                       1862808\n   rx_q1_cnt:                               0\n   rx_q1_errors:                      2100224\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Additionally, the following log messages provide evidence of the failure event:\n",(0,r.jsx)(n.code,{children:"DPDK.log"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Apr 02 23:47:22.351 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_com_wait_and_process_admin_cq_interrupts]Timeout waiting for comp_ctx->wait_event\nApr 02 23:47:22.351 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_com_wait_and_process_admin_cq_interrupts]The ena device didn't send a completion for the admin cmd 11 status 0\nApr 02 23:47:22.351 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_get_dev_stats]Failed to get stats. error: -62\nApr 02 23:47:22.351 [DPDK| -- ] ERROR (deviceManagerTP) ena_stats_get(): Could not retrieve statistics from ENA\nApr 02 23:47:25.352 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_com_wait_and_process_admin_cq_interrupts]Timeout waiting for comp_ctx->wait_event\nApr 02 23:47:25.352 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_com_wait_and_process_admin_cq_interrupts]The ena device didn't send a completion for the admin cmd 11 status 0\nApr 02 23:47:25.352 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_get_dev_stats]Failed to get stats. error: -62\nApr 02 23:47:25.352 [DPDK| -- ] ERROR (deviceManagerTP) ena_stats_get(): Could not retrieve statistics from ENA\nApr 02 23:47:26.353 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_get_dev_stats]Failed to get stats. error: -19\nApr 02 23:47:26.353 [DPDK| -- ] ERROR (deviceManagerTP) ena_stats_get(): Could not retrieve statistics from ENA\nApr 02 23:47:26.354 [DPDK| -- ] ERROR (deviceManagerTP) [ENA_COM: ena_get_dev_stats]Failed to get stats. error: -19\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"journal.log"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Apr 03 08:26:02.642583 relayroutereast001 highway[9604]: Failed to queue packet; No ARP for x.x.x.1, interface 1.0, ex: ArpEntryPendException: Pend list max size of 5 exceeded\nApr 03 08:26:02.642595 relayroutereast001 highway[9604]: Send packet failed for session remote-host:  ip-address: x.x.x.1; local-ip x.x.x.242; local-intf: 1.0; peer-name Router11-W\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"highway.log"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Apr 03 09:25:35.173 [LINK|BFDS] ERROR (bfdAgentTP     ) Failed to queue packet; No ARP for x.x.x.195, interface 1.0, ex: ArpEntryPendException: Pend list max size of 5 exceeded\nApr 03 09:25:35.173 [LINK|BFDS] ERROR (bfdAgentTP     ) Send packet failed for session remote-host:  ip-address: x.x.x.195; local-ip x.x.x.242; local-intf: 1.0; peer-name RelayRouter001\n"})}),"\n",(0,r.jsx)(n.h3,{id:"release-notes",children:"Release Notes"}),"\n",(0,r.jsx)(n.p,{children:"The ENA command-queue becomes unresponsive (device not responding) and the interface no longer passes traffic."}),"\n",(0,r.jsxs)(n.p,{children:["Updated ENA device driver from DPDK/Amazon (upgrading driver from 2.6.0 to 2.9.0).\n",(0,r.jsx)(n.a,{href:"https://github.com/amzn/amzn-drivers/blob/master/kernel/linux/ena/RELEASENOTES.md",children:"ENA release notes"})]}),"\n",(0,r.jsx)(n.p,{children:"ENA supports health checks which can be used to detect faulty behavior of the hardware and the driver. As such, an ENA driver watchdog has been developed to check for the following reset reasons:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"HW unresponsiveness \u2013 Driver detected that the periodic keep alive signals stopped arriving from the HW through the Asynchronous Event Notification Queue (AENQ)."}),"\n",(0,r.jsx)(n.li,{children:"Faulty admin queue behavior \u2013 The admin queue entered a faulty state."}),"\n",(0,r.jsx)(n.li,{children:"Faulty behavior on the IO path \u2013 The device returned invalid descriptors or caused the driver to enter the invalid state."}),"\n",(0,r.jsx)(n.li,{children:"Missing Tx completions exceeds a dynamically calculated threshold - Prevent Tx ring stalls in case Tx descriptors were not returned by the HW."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"severity",children:"Severity"}),"\n",(0,r.jsxs)(t,{children:[(0,r.jsx)(n.p,{children:"The potential impact of a software defect if encountered. Severity levels are:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system."}),"\n",(0,r.jsx)(n.li,{children:"Major: Could seriously affect system operation, maintenance, administration and related tasks."}),"\n",(0,r.jsx)(n.li,{children:"Minor: Would not significantly impair the functioning or affect service."}),"\n"]})]}),"\n",(0,r.jsx)(n.p,{children:"Critical"}),"\n",(0,r.jsx)(n.h3,{id:"status",children:"STATUS"}),"\n",(0,r.jsx)(n.p,{children:"Open"}),"\n",(0,r.jsx)(n.h3,{id:"resolved-in",children:"RESOLVED IN"}),"\n",(0,r.jsx)(n.h3,{id:"product",children:"PRODUCT"}),"\n",(0,r.jsx)(n.p,{children:"SSR"}),"\n",(0,r.jsx)(n.h3,{id:"functional-area",children:"FUNCTIONAL AREA"}),"\n",(0,r.jsx)(n.p,{children:"Datapath"}),"\n",(0,r.jsx)(n.h3,{id:"workaround",children:"WORKAROUND"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"Juniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues."})}),"\n",(0,r.jsx)(n.p,{children:"Disable enhanced networking in AWS instance."}),"\n",(0,r.jsxs)(n.p,{children:["A restart of the SSR is necessary to remediate this condition:\n",(0,r.jsx)(n.code,{children:"systemctl restart 128T"})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var r=t(96540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);