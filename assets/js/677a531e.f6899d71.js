"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[8540],{32322:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var t=i(74848),s=i(28453);const o={title:"IPSec algorithms dh2 (modp1024) and dh22 are being deprecated",date:new Date("2024-12-12T00:00:00.000Z"),tags:["ipsec-client"],hide_table_of_contents:!1},r=void 0,a={permalink:"/kb/2024/12/12/PLUGIN-2835",source:"@site/kb/2024-12-12-PLUGIN-2835.md",title:"IPSec algorithms dh2 (modp1024) and dh22 are being deprecated",description:"To implement IPsec, SSR leverages a third-party client called libreswan. The client periodically deprecates weak algorithms from its code base such as dh2 (a.k.a modp1024) and dh22. While the SSR supports these algorithms, it is very likely that these algorithms will be deprecated in the near future. The article is meant to raise awareness of this upcoming change and provide instruction to proactively modify configuration to avoid outages.",date:"2024-12-12T00:00:00.000Z",formattedDate:"December 12, 2024",tags:[{label:"ipsec-client",permalink:"/kb/tags/ipsec-client"}],hasTruncateMarker:!0,authors:[],frontMatter:{title:"IPSec algorithms dh2 (modp1024) and dh22 are being deprecated",date:"2024-12-12T00:00:00.000Z",tags:["ipsec-client"],hide_table_of_contents:!1},unlisted:!1,nextItem:{title:"Change in behavior for Salt states for 5.6.16+, 6.1.12+, 6.2.8+, 6.3.x-r2+",permalink:"/kb/2024/11/06/PLUGIN-2776"}},l={authorsImageUrls:[]},c=[{value:"Problem",id:"problem",level:3},{value:"Severity",id:"severity",level:3},{value:"Status",id:"status",level:3},{value:"Resolved In",id:"resolved-in",level:3},{value:"Product",id:"product",level:3},{value:"Functional Area",id:"functional-area",level:3},{value:"Solution",id:"solution",level:3}];function d(e){const n={a:"a",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["To implement IPsec, SSR leverages a third-party client called ",(0,t.jsx)(n.code,{children:"libreswan"}),". The client periodically deprecates weak algorithms from its code base such as dh2 (a.k.a ",(0,t.jsx)(n.code,{children:"modp1024"}),") and dh22. While the SSR supports these algorithms, it is very likely that these algorithms will be deprecated in the near future. The article is meant to raise awareness of this upcoming change and provide instruction to proactively modify configuration to avoid outages."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issue ID:"})," PLUGIN-2835."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Last Updated:"})," 2024-12-12"]}),"\n",(0,t.jsx)(n.h3,{id:"problem",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"When upgrading to a version of IPsec plugin with the weak ciphers removed, SSR will stop offering these ciphers in its IPsec negotiation with the far end. As a result, the tunnel connection will break and will not be able to be formed again. You can verify this break in the following ways."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Check the output of the ",(0,t.jsx)(n.code,{children:"show plugin state"})," command to inspect the status of the tunnel:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"========================================\n combo-west:rem1\n========================================\n Type:                host\n Forwarding:          true\n Mode:                host\n MAC Address:         76:78:79:fc:eb:69\n\n Admin Status:        up\n Operational Status:  down\n Redundancy Status:   non-redundant\n Speed:               0\n Duplex:              unknown\n\n in-octets:                     1962932\n in-unicast-pkts:                 32710\n in-errors:                           0\n out-octets:                    1373442\n out-unicast-pkts:                32701\n out-errors:                          6\n\n IPSec:\n     rem1:\n         Tunnel Status:Down\n         Tunnel Details:\n             Name:    ipsec-client-tunnel-primary-rem1\n             Remote Host:172.16.4.3\n         Down Reason: Tunnel settings mismatch\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The above output shows the ",(0,t.jsx)(n.code,{children:"Tunnel Status: Down"}),". Because the SSR no longer uses the weak ciphers, a ",(0,t.jsx)(n.code,{children:"Tunnel settings mismatch"})," is identified as the cause."]}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["In the ",(0,t.jsx)(n.code,{children:"128t-ipsec@*"})," service, the log indicates the following:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"received unauthenticated v2N_NO_PROPOSAL_CHOSEN - ignored\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Please see the ",(0,t.jsx)(n.a,{href:"#solution",children:"Solution"})," for remediation steps."]}),"\n",(0,t.jsx)(n.h3,{id:"severity",children:"Severity"}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)(n.p,{children:"The potential impact of a software defect if encountered. Severity levels are:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system."}),"\n",(0,t.jsx)(n.li,{children:"Major: Could seriously affect system operation, maintenance, administration and related tasks."}),"\n",(0,t.jsx)(n.li,{children:"Minor: Would not significantly impair the functioning or affect service."}),"\n"]})]}),"\n",(0,t.jsx)(n.p,{children:"Minor"}),"\n",(0,t.jsx)(n.h3,{id:"status",children:"Status"}),"\n",(0,t.jsx)(n.p,{children:"In Progress"}),"\n",(0,t.jsx)(n.h3,{id:"resolved-in",children:"Resolved In"}),"\n",(0,t.jsx)(n.p,{children:"128T-ipsce-client-4.1.0"}),"\n",(0,t.jsx)(n.h3,{id:"product",children:"Product"}),"\n",(0,t.jsx)(n.p,{children:"SSR Routers"}),"\n",(0,t.jsx)(n.h3,{id:"functional-area",children:"Functional Area"}),"\n",(0,t.jsx)(n.p,{children:"IPsec"}),"\n",(0,t.jsx)(n.h3,{id:"solution",children:"Solution"}),"\n",(0,t.jsx)(i,{children:(0,t.jsx)(n.p,{children:"Juniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues."})}),"\n",(0,t.jsx)(n.p,{children:"Starting with the 128T-ipsec-client-4.1.0 version of the plugin, two changes are being made to support this remediation effort."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["A new warning message has been added for conifgurations that rely on ",(0,t.jsx)(n.code,{children:"dh2"})," and ",(0,t.jsx)(n.code,{children:"dh22"})," algorithms. The warning message is visible when running ",(0,t.jsx)(n.code,{children:"validate"})," or ",(0,t.jsx)(n.code,{children:"commit"})," on the conductor."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Existing versions of IPsec plugin only support configuration specifying a single combination of IKE and IPsec algorithms. Beginning with ",(0,t.jsx)(n.code,{children:"128T-ipsec-client-4.1.0"}),", support has been added to allow multiple ciphers to be configured for IKE and IPsec. The following is an example configuration:"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-config",metastring:"{11-2}",children:"    ipsec-profile primary\n        name primary\n        ike-encryption           aes256\n        ike-digest               sha2\n        ike-modp                 modp1024\n        authentication-protocol  esp\n        phase2-encryption        aes_gcm128\n        phase2-digest            sha2\n        phase2-modp              modp1024\n        ...\n        additional-ike-algorithms algo1\n            name algo1\n            encryption aes128\n            digest sha2\n            modp modp2048\n        exit\n        additional-ike-algorithms algo2\n            name algo2\n            encryption aes256\n            digest sha2\n            modp dh19\n        exit\n    exit\n"})}),"\n",(0,t.jsx)(n.p,{children:"The two solutions to remediate the weak algorithms are:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"While running the existing plugin version, replace the weak cipher with a stronger one from the supported list."}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Chose a new stronger cipher supported by the server."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Replace the weak cipher with the stronger cipher selected from the list."}),"\n",(0,t.jsx)(n.p,{children:"This config change will trigger a restart of the tunnels for new connections to be formed. Here's an example of sample configuration change."}),"\n",(0,t.jsx)(n.p,{children:"Before:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-config",children:"    ipsec-profile primary\n        name primary\n        ike-encryption           aes256\n        ike-digest               sha2\n        ike-modp                 modp1024\n        authentication-protocol  esp\n        phase2-encryption        aes_gcm128\n        phase2-digest            sha2\n        phase2-modp              modp1024\n        ...\n    exit\n"})}),"\n",(0,t.jsx)(n.p,{children:"After:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-config",metastring:"{11-22}",children:"    ipsec-profile primary\n        name primary\n        ike-encryption           aes256\n        ike-digest               sha2\n        ike-modp                 modp1024\n        authentication-protocol  esp\n        phase2-encryption        aes_gcm128\n        phase2-digest            sha2\n        phase2-modp              modp1024\n        ...\n        additional-ike-algorithms algo1\n            name algo1\n            encryption aes128\n            digest sha2\n            modp modp2048\n        exit\n        additional-ike-algorithms algo2\n            name algo2\n            encryption aes256\n            digest sha2\n            modp dh19\n        exit\n    exit\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["Upgrade to the IPsec plugin version ",(0,t.jsx)(n.code,{children:"4.1.0"})," and configure additional supported ciphers on the server side"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The SSR offers all the supported ciphers and identifies the ciphers supported on the server. It is recommended to remove the weak ciphers from the configuration once replacements have been made."}),"\n",(0,t.jsx)(n.p,{children:"Remediating the configuration of weak ciphers ahead of their deprecation allows a seamless transition when upgrading to a new version of SSR software."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(96540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);