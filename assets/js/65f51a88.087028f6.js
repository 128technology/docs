"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[3561],{94264:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>h});var o=n(74848),i=n(28453);const s={title:"Waypoints and Waypoint Ports",sidebar_label:"Waypoints"},r=void 0,a={id:"concepts_waypoint_ports",title:"Waypoints and Waypoint Ports",description:"Secure Vector Routing, the patented technique used by an SSR to send directional, encrypted, tunnel-free traffic to its peers, creates engineered pathways between waypoints \u2013\xa0IP addresses assigned to SSR interfaces.",source:"@site/docs/concepts_waypoint_ports.md",sourceDirName:".",slug:"/concepts_waypoint_ports",permalink:"/docs/concepts_waypoint_ports",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Waypoints and Waypoint Ports",sidebar_label:"Waypoints"},sidebar:"docs",previous:{title:"Session Timers",permalink:"/docs/concepts_session_timer"},next:{title:"Monitoring Agent",permalink:"/docs/concepts_monitoring"}},c={},h=[{value:"Limiting the Options",id:"limiting-the-options",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",p:"p",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.em,{children:"Secure Vector Routing"}),", the patented technique used by an SSR to send directional, encrypted, tunnel-free traffic to its peers, creates engineered pathways between ",(0,o.jsx)(t.em,{children:"waypoints"})," \u2013\xa0IP addresses assigned to SSR interfaces."]}),"\n",(0,o.jsxs)(t.p,{children:['Much like an airplane pilot creates a flight plan between the source airport and destination airport, charting a series of air traffic control towers with which they will check in en route, an SSR also creates a sort of "flight plan" for each session it forwards using SVR. Rather than using tunnels between software instances, the SSR uses a novel NATting technique to create distinct "',(0,o.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Tuple",children:"tuples"}),'" between one another, where the tuple includes a unique combination of source IP, destination IP, source port, destination port, and transport protocol.']}),"\n",(0,o.jsxs)(t.p,{children:["On any given SSR, each ",(0,o.jsx)(t.a,{href:"/docs/concepts_interface_types",children:"forwarding interface's"}),' IP address is referred to as a "waypoint." This represents the source IP address it will use with sending SVR traffic to a peer, or the destination IP address it will use when receiving SVR traffic initiated by a peer. The ports that are used to construct unique tuples are referred to as "waypoint ports" (or sometimes, "wayports").']}),"\n",(0,o.jsxs)(t.p,{children:["When forwarding traffic for a new session, the transmitting SSR ",(0,o.jsx)(t.em,{children:"selects its own local waypoint port as well as the destination SSR's waypoint port"}),'. This is a bit unusual (and part of our "secret sauce"), in that the router maintains a free port list for each of its peers.']}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:'When learning about SVR and waypoint allocation, a frequently asked question about SVR is "how can you send more than 65,535 concurrent sessions (the limits of UDP and TCP port allocations) if you base it on port?" The answer is: because the transmitting SSR can vary its source port and send multiple sessions to the same destination port, the upper limit is much, much, much higher than 65,535. We\'ll show the math behind it shortly.'})}),"\n",(0,o.jsxs)(t.p,{children:["By default, each SSR will allocate waypoint ports for each of its interfaces using the default range of 16,384 through 65,534, for a total of 49,151 ports. When sending traffic to a peer, the SSR will allocate an ",(0,o.jsx)(t.strong,{children:"even numbered"})," waypoint for itself and an ",(0,o.jsx)(t.strong,{children:"odd numbered"}),' waypoint for its peer. (We did this to avoid "glare conditions," the exceedingly unlikely chance that two devices would pick the exact same values in two directions simultaneously).']}),"\n",(0,o.jsx)(t.admonition,{type:"warning",children:(0,o.jsx)(t.p,{children:"Here's the math."})}),"\n",(0,o.jsxs)(t.p,{children:["Thus, each wayport on an SSR can initiate 24,576 (even local ports) sessions to each of 24,575 (odd remote ports) unique wayports on its peer. That's a theoretical maximum of 603,955,200 unique concurrent sessions between a pair of waypoints ",(0,o.jsx)(t.em,{children:"in each direction"}),", disregarding the fact that most peering relationships have multiple transports \u2013 and thus more waypoints \u2013 between them."]}),"\n",(0,o.jsx)(t.h2,{id:"limiting-the-options",children:"Limiting the Options"}),"\n",(0,o.jsx)(t.p,{children:'Sometimes, 603 million concurrent sessions is simply too many to handle \u2013 particularly for security-minded folks who want to limit the exposure of public-facing ports they let into their network. For example, when deploying an SSR behind a firewall and telling the owner of that firewall that you need to open up ports 16,385 through 65,533, you generally get an "oh really?" response.'}),"\n",(0,o.jsxs)(t.p,{children:["For those that want to limit the range of waypoint ports, we allow you to configure your own range rather than adopt the default. This is configured within the ",(0,o.jsx)(t.a,{href:"/docs/config_reference_guide#port-range",children:"port-range"})," and ",(0,o.jsx)(t.a,{href:"/docs/config_reference_guide#max-way-points",children:"max-way-points"})," elements within a ",(0,o.jsx)(t.a,{href:"/docs/config_reference_guide#neighborhood",children:"neighborhood"}),". As mentioned earlier, waypoint ports are allocated by the ingress router for its peer. The port range for the session originating router does not have a configurable range, only the port-range for the destination SSR router."]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsxs)(t.p,{children:["A quick reminder on how neighborhoods work: when setting values in a neighborhood on a router, it will affect how each router that peers with it builds their ",(0,o.jsx)(t.a,{href:"/docs/config_reference_guide#adjacency",children:"adjacency"})," to it. So when you restrict the set of ports in a router's neighborhood, each peer's adjacency will reflect that restriction; thus, when that router goes to build an SVR session to that peer over that adjacency, it will know the valid range of ports to choose from."]})}),"\n",(0,o.jsxs)(t.p,{children:["Limiting this range will make your firewall team happy without putting too much of a crimp in your ability to SVR sessions. In fact, we have some customers that have limited their waypoint port allocation to only 10 ports on their head end routers! At face value this seems like it would severely restrict the number of unique, concurrent sessions that could be established by a peer, but in practice it doesn't. If a branch keeps its range to the default value of ports (49,151 ports), which can be sent to each of ten ports, you still wind up with a theoretical maximum of over 491,510 concurrent sessions ",(0,o.jsx)(t.em,{children:"in each direction"})," to that branch over that adjacency."]}),"\n",(0,o.jsxs)(t.p,{children:["It is important to note that despite the configured ",(0,o.jsx)(t.a,{href:"/docs/config_reference_guide#port-range",children:"port-range"}),", the SSR will at most use 50,000 of those ports by default. The configuration ",(0,o.jsx)(t.a,{href:"/docs/config_reference_guide#max-way-points",children:"max-way-points"})," allows the SSR software to scale respective to the platform and the administrator's needs. A ",(0,o.jsx)(t.code,{children:"max-way-points"})," setting that is smaller than the number of sessions traversing a peer path will result in port exhaustion. A ",(0,o.jsx)(t.code,{children:"max-way-points"})," setting that is too large will result in wasted system resources. Best practice is to tune both the ",(0,o.jsx)(t.code,{children:"port-range"})," and ",(0,o.jsx)(t.code,{children:"max-way-points"})," to a factor of 1.5x of the max number of sessions traversing a peer path."]})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var o=n(96540);const i={},s=o.createContext(i);function r(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);