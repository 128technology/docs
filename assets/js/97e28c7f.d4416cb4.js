"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[3158],{62270:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var s=n(74848),o=n(28453);const i={title:"Asset Connection Resiliency",sidebar_label:"Asset Connection Resiliency"},r=void 0,a={id:"config_asset_connection_resiliency",title:"Asset Connection Resiliency",description:"The SSR software provides path resiliency to a destination when multiple paths exist between peered SSRs. However, a destination may not have another SSR peer in its path. Specifically, an SSR conductor may be deployed on the public internet without a front-end SSR.",source:"@site/docs/config_asset_connection_resiliency.md",sourceDirName:".",slug:"/config_asset_connection_resiliency",permalink:"/docs/config_asset_connection_resiliency",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1711026369,formattedLastUpdatedAt:"Mar 21, 2024",frontMatter:{title:"Asset Connection Resiliency",sidebar_label:"Asset Connection Resiliency"},sidebar:"docs",previous:{title:"Configuration Templates",permalink:"/docs/config_templates"},next:{title:"Session Recovery Detection",permalink:"/docs/config_session_recovery"}},c={},l=[{value:"Configuration",id:"configuration",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",sup:"sup",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"The SSR software provides path resiliency to a destination when multiple paths exist between peered SSRs. However, a destination may not have another SSR peer in its path. Specifically, an SSR conductor may be deployed on the public internet without a front-end SSR."}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:["Refer to the ",(0,s.jsx)(t.a,{href:"/docs/bcp_conductor_deployment",children:"BCP on Conductor Deployment"})," for recommendations on how to deploy a Conductor."]})}),"\n",(0,s.jsx)(t.p,{children:"Without a peering SSR, or without the use of dynamic routing protocols, the SSR considers all next hops equally, even though some paths may not provide a path to the destination. The following diagram depicts a case where two of the three paths to the Conductor are not available, even though the next hop gateway is responsive."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Topology",src:n(27627).A+"",width:"1757",height:"529"})}),"\n",(0,s.jsxs)(t.p,{children:["One of the ",(0,s.jsx)(t.a,{href:"/docs/concepts_machine_communication",children:"connections an SSR establishes to a Conductor"})," is that of the salt-minion (router) connecting to a salt-master (Conductor).  The salt-minion and salt-master maintain a persistent TCP connection on port 4505 which the salt-master uses to publish requests to all salt-minions. When a salt-minion completes a request, it creates a transient connection on port 4506 back to the salt-master, sends an event with the result, then closes the connection."]}),"\n",(0,s.jsx)(t.p,{children:"The effect this problem has on salt is that if an event is sent to an invalid next hop, the request will never make it back to the salt-master. Since the SSR load balances Conductor traffic between all possible paths, some percentage of salt events will fail to be returned to the salt-master, resulting in state inconsistencies between router and Conductor."}),"\n",(0,s.jsxs)(t.p,{children:["In order to avoid these intermittent failures, the SSR can optionally create a long-lived SSH session to the salt-master utilizing FIPS OpenSSH. Long-lived SSH sessions mitigate downstream network failures by ensuring the SSH session is established on at least one of the paths before the salt events are transmitted. As network failures occur, the SSH session will be reestablished on the next available, working path. Salt transactions are instead instantiated within the long-lived SSH connection. The SSR creates SSH sessions for both the salt publish port (4505) and return port (4506).",(0,s.jsx)(t.sup,{children:(0,s.jsx)(t.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]}),"\n",(0,s.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(t.p,{children:["Asset connection resiliency is configured both at the ",(0,s.jsx)(t.code,{children:"authority > asset-connection-resiliency"})," level (so as to apply to every router within an ",(0,s.jsx)(t.em,{children:"authority"}),") as well as at the ",(0,s.jsx)(t.code,{children:"router > asset-connection-resiliency"})," level (so as to provide an override to the value set at the ",(0,s.jsx)(t.em,{children:"authority"}),"). These SSH connections are unnecessary if the network topology already affords reliable salt connectivity."]}),"\n",(0,s.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsxs)(t.p,{children:["In order to determine if the long-lived SSH sessions are established, executing ",(0,s.jsx)(t.code,{children:"show system services"})," will display if the service is running properly:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"Retrieving system services...\n================== ==================================== ==============\n Node               Service                              Active State\n================== ==================================== ==============\n T114_DUT3.Router   128TWeb.service                  \tactive\n T114_DUT3.Router   auditd.service                   \tactive\n T114_DUT3.Router   prank.service                    \tactive\n T114_DUT3.Router   salt-ssh@192.168.1.14-4505.service  active\n T114_DUT3.Router   salt-ssh@192.168.1.14-4506.service  active\n T114_DUT3.Router   salt-ssh@192.168.1.6-4505.service\tactive\n T114_DUT3.Router   salt-ssh@192.168.1.6-4506.service\tactive\n T114_DUT3.Router   t128-process-metrics.service     \tactive\n T114_DUT3.Router   tank.service                     \tactive\n T114_DUT4.Router   128TWeb.service                  \tactive\n T114_DUT4.Router   auditd.service                   \tactive\n T114_DUT4.Router   prank.service                    \tactive\n T114_DUT4.Router   salt-ssh@192.168.1.14-4505.service  active\n T114_DUT4.Router   salt-ssh@192.168.1.14-4506.service  active\n T114_DUT4.Router   salt-ssh@192.168.1.6-4505.service\tactive\n T114_DUT4.Router   salt-ssh@192.168.1.6-4506.service\tactive\n T114_DUT4.Router   t128-process-metrics.service     \tactive\n T114_DUT4.Router   tank.service                     \tactive\n\nCompleted in 0.04 seconds\n"})}),"\n",(0,s.jsx)(t.p,{children:"This output shows a total of four SSH connections, one SSH connection per salt port per node of a HA router."}),"\n",(0,s.jsxs)(t.section,{"data-footnotes":!0,className:"footnotes",children:[(0,s.jsx)(t.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{id:"user-content-fn-1",children:["\n",(0,s.jsxs)(t.p,{children:["Salt does not have a way to configure different IP addresses for the publish and return ports. ",(0,s.jsx)(t.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},27627:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/config_asset_connection_resiliency-20f20c526ba07c2ea2c7b5b4075bb123.png"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var s=n(96540);const o={},i=s.createContext(o);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);