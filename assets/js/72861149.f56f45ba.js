"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[1297],{20640:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var o=n(74848),i=n(28453);const t={title:"Configuring Forward Error Correction",sidebar:"Configuring Forward Error Correction"},s=void 0,a={id:"config_forward_error_correction",title:"Configuring Forward Error Correction",description:"Version History",source:"@site/docs/config_forward_error_correction.md",sourceDirName:".",slug:"/config_forward_error_correction",permalink:"/docs/config_forward_error_correction",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1711024380,formattedLastUpdatedAt:"Mar 21, 2024",frontMatter:{title:"Configuring Forward Error Correction",sidebar:"Configuring Forward Error Correction"},sidebar:"docs",previous:{title:"DNS Proxy",permalink:"/docs/config_dns_proxy"},next:{title:"Management over Forwarding",permalink:"/docs/config_management_over_forwarding"}},c={},d=[{value:"Version History",id:"version-history",level:4},{value:"Overview",id:"overview",level:2},{value:"Dynamic Mode",id:"dynamic-mode",level:2},{value:"Sample Dynamic Configuration",id:"sample-dynamic-configuration",level:3},{value:"Static Mode",id:"static-mode",level:2},{value:"Sample Static Configuration",id:"sample-static-configuration",level:3},{value:"How to Use Forward Error Correction",id:"how-to-use-forward-error-correction",level:2},{value:"Static Profile",id:"static-profile",level:4},{value:"Disable/Enable FEC from the Neighborhood Configuration",id:"disableenable-fec-from-the-neighborhood-configuration",level:3},{value:"Limitations",id:"limitations",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Success Counters",id:"success-counters",level:3},{value:"Add",id:"add",level:4},{value:"Remove",id:"remove",level:4},{value:"Failure Counters",id:"failure-counters",level:3},{value:"Add",id:"add-1",level:4},{value:"Remove",id:"remove-1",level:4}];function l(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.h4,{id:"version-history",children:"Version History"}),"\n",(0,o.jsxs)(r.table,{children:[(0,o.jsx)(r.thead,{children:(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.th,{children:"Release"}),(0,o.jsx)(r.th,{children:"Modification"})]})}),(0,o.jsx)(r.tbody,{children:(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"5.5.0"}),(0,o.jsx)(r.td,{children:"This feature was introduced"})]})})]}),"\n",(0,o.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(r.p,{children:'Forward Error Correction (FEC) adds resiliency against packet loss between two points in the network. The SSR implements Forward Error Correction using parity packets and a "round" based approach. In each round, a set number of data packets are sent before a parity packet. The number of packets per round is based on the observed packet loss for the flow. When the loss is greater, fewer data packets are sent before a parity packet.'}),"\n",(0,o.jsx)(r.p,{children:"FEC has two modes, Dynamic and Static. Each mode is enabled through the FEC profile."}),"\n",(0,o.jsx)(r.h2,{id:"dynamic-mode",children:"Dynamic Mode"}),"\n",(0,o.jsx)(r.p,{children:"Dynamic is the default mode. In Dynamic mode, the behavior of FEC is adjusted for the currently observed packet loss. When no loss is detected, no parity packets are added to the transmission. When some amount of loss is found, the ratio necessary to heal the loss is calculated, and parity packets are added to the transmission. As the loss goes up or down, the loss ratio is adjusted automatically."}),"\n",(0,o.jsx)(r.h3,{id:"sample-dynamic-configuration",children:"Sample Dynamic Configuration"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"        forward-error-correction-profile  fec-profile-dynmc\n            name                 fec-profile-dynmc\n            mode                 dynamic\n        exit\n"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"        service-policy                    policy-a\n            name                              policy-a\n            service-class                     Standard\n            lb-strategy                       hunt\n            session-resiliency                none\n            packet-resiliency                 forward-error-correction\n            transport-state-enforcement       reset\n            forward-error-correction-profile  fec-profile-dynmc\n        exit\n"})}),"\n",(0,o.jsx)(r.h2,{id:"static-mode",children:"Static Mode"}),"\n",(0,o.jsx)(r.p,{children:"In Static mode, you configure the loss ratio in the profile, and FEC uses this ratio regardless of link quality. This provides a consistent number of parity packets, but will increase overhead on links with no or low loss."}),"\n",(0,o.jsx)(r.h3,{id:"sample-static-configuration",children:"Sample Static Configuration"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"forward-error-correction-profile  fec-profile-statc\n            name                 fec-profile-statc\n            mode                 static\n            ratio                10\n"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"        service-policy                    policy-a\n            name                              policy-a\n            service-class                     Standard\n            lb-strategy                       hunt\n            session-resiliency                none\n            packet-resiliency                 forward-error-correction\n            transport-state-enforcement       reset\n            forward-error-correction-profile  fec-profile-statc\n        exit\n"})}),"\n",(0,o.jsx)(r.h2,{id:"how-to-use-forward-error-correction",children:"How to Use Forward Error Correction"}),"\n",(0,o.jsx)(r.p,{children:"Forward Error Correction profiles are configured at the authority level and are not traffic-specific, which allows them to be used on any service and any router in the authority."}),"\n",(0,o.jsx)(r.p,{children:"The order of configuration is not important, but the following process configures a dynamic FEC profile using the default values, and assigns it to a service for UDP traffic."}),"\n",(0,o.jsx)(r.p,{children:"Create the Forware Error Correction profile."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"        forward-error-correction-profile  fec-profile-dynmc\n            name                 fec-profile-dynmc\n            mode                 dynamic\n        exit\n"})}),"\n",(0,o.jsxs)(r.p,{children:["Create the ",(0,o.jsx)(r.code,{children:"service-policy"}),", or add the FEC profile to an existing ",(0,o.jsx)(r.code,{children:"service-policy"})," by specifying ",(0,o.jsx)(r.code,{children:"forward-error-correction"})," under ",(0,o.jsx)(r.code,{children:"packet-resiliency"}),"."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"        service-policy                    policy-a\n            name                              policy-a\n            service-class                     Standard\n            lb-strategy                       hunt\n            session-resiliency                none\n            packet-resiliency                 forward-error-correction\n            transport-state-enforcement       reset\n            forward-error-correction-profile  fec-profile-dynmc\n        exit\n"})}),"\n",(0,o.jsxs)(r.p,{children:["Create the ",(0,o.jsx)(r.code,{children:"service"}),", or add the ",(0,o.jsx)(r.code,{children:"service-policy"})," with the FEC profile to an existing service."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:'        service         west\n            name            west\n            service-group   all\n            description     "web service for everyone"\n            enabled         true\n            scope           private\n            security        aes1\n\n            transport   udp\n                protocol  udp\n            exit\n            address         172.16.2.201/24\n\n            access-policy   red@0.0.0.0/0\n                source      red@0.0.0.0/0\n                permission  allow\n            exit\n            service-policy  policy-a\n        exit\n'})}),"\n",(0,o.jsx)(r.h4,{id:"static-profile",children:"Static Profile"}),"\n",(0,o.jsx)(r.p,{children:"Configuration and use of the static profile is similar to the process described above. The Static profile is configured as shown below."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"        forward-error-correction-profile  fec-static-profile-statc\n            name                 fec-static-profile-statc\n            mode                 static\n            low-loss-ratio       10\n"})}),"\n",(0,o.jsx)(r.h3,{id:"disableenable-fec-from-the-neighborhood-configuration",children:"Disable/Enable FEC from the Neighborhood Configuration"}),"\n",(0,o.jsxs)(r.p,{children:["The neighborhood/adjacency configuration can be used to disable FEC in cases where the per packet overhead from FEC is unnecessary (for example, on a very high quality link). Toggle ",(0,o.jsx)(r.code,{children:"packet-resiliency"})," (enable/disable) across a path, within the Neighborhood."]}),"\n",(0,o.jsx)(r.h4,{id:"limitations",children:"Limitations"}),"\n",(0,o.jsx)(r.p,{children:"Forward Error Correction has the following limitations:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"Forward Error Corrections carries a 4 byte per-packet overhead, and a parity packet overhead every N packets (Largest Packet Size in round + Packet Sizes Trailer (N * 2 bytes) + 4 bytes)."}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["If you are going to be transferring large amounts of data at, or close to, the MTU size with FEC enabled, it is strongly recommended to enable ",(0,o.jsx)(r.code,{children:"path-MTU"}),". This setting automatically adjusts the packet size, allowing space for the FEC headers and preventing fragmentation."]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"Additionally, this feature should not be used to diagnose link quality issues. If the packet loss is above a nominal amount, the extra data that FEC adds to the wire will likely cause extra loss, further decreasing link quality."}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"Packet retransmission will not work when FEC is enabled."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(r.p,{children:"Metrics for FEC are categorized into success and failure counters. Use the following counters to help diagnose any issues that arise."}),"\n",(0,o.jsx)(r.h3,{id:"success-counters",children:"Success Counters"}),"\n",(0,o.jsxs)(r.p,{children:["Use ",(0,o.jsx)(r.a,{href:"/docs/cli_stats_reference#show-stats-packet-processing-action-success-fec",children:(0,o.jsx)(r.code,{children:"show stats packet-processing action success fec"})})," to view the following success metrics."]}),"\n",(0,o.jsx)(r.h4,{id:"add",children:"Add"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Parity-sent:"}),"  A parity packet was successfully sent."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Trailer-added:"})," An FEC trailer was successfully added to a packet."]}),"\n"]}),"\n",(0,o.jsx)(r.h4,{id:"remove",children:"Remove"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Trailer-removed:"})," An FEC trailer was successfully removed from a packet."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Regenerated-packet:"})," A packet that was missing from a round was able to be regenerated via the parity packet."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Completed-round:"})," A round was able to be completed successfully. Either all packets arrived as expected, or a single packet was missing and the parity was able to regenerate the missing packet."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Unnecessary-parity:"})," A parity packet was received for a round in which no loss was experienced, and as such was unnecessary to be able to complete a round."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Resync:"})," The number of times the recipient of an FEC marked packet determined it was out of sync with the sender. This causes a flush of all cached information and a latch to the information contained in the packet."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Out-of-order:"})," The number of times a data packet was received out of order for the current round. This packet was allowed through."]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"failure-counters",children:"Failure Counters"}),"\n",(0,o.jsxs)(r.p,{children:["Use ",(0,o.jsx)(r.a,{href:"/docs/cli_stats_reference#show-stats-packet-processing-action-failure-fec",children:(0,o.jsx)(r.code,{children:"show stats packet-processing action failure fec"})})," to view the following failure metrics."]}),"\n",(0,o.jsx)(r.h4,{id:"add-1",children:"Add"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Allocation:"})," The number of times a packet was dropped because memory for the FEC trailer could not be allocated."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Buffer-expansion:"})," The number of packets that were dropped because packet payload could not be expanded to fit a FEC header."]}),"\n"]}),"\n",(0,o.jsx)(r.h4,{id:"remove-1",children:"Remove"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Completed-round:"})," The number of times a round was not able to be completed. Mainly occurs when the number of packets lost in a round is greater than one, and the parity packet cannot heal the round. However, if the scenario described under the Resync counter is detected, then this stat may also be incremented if the current round is not completed."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Out-of-order:"})," The number of packets dropped due to belonging to a recently completed FEC round."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Unexpected-parity:"})," The number of parity packets received when the recipient of FEC packets was not tracking a round."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Parity-discard:"})," The number of parity packets that were discarded because not enough data packets were received."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Invalid-payload-length:"})," The number of packets dropped while attempting to process an FEC packet, but the payload was too short to accommodate an FEC header."]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>a});var o=n(96540);const i={},t=o.createContext(i);function s(e){const r=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(t.Provider,{value:r},e.children)}}}]);