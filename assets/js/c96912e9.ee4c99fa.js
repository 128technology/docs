"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[3918],{3905:function(e,t,r){r.d(t,{Zo:function(){return d},kt:function(){return p}});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),c=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=c(r),p=a,m=h["".concat(l,".").concat(p)]||h[p]||u[p]||i;return r?n.createElement(m,o(o({ref:t},d),{},{components:r})):n.createElement(m,o({ref:t},d))}));function p(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<i;c++)o[c]=r[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"},98575:function(e,t,r){r.r(t),r.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return p},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var n=r(87462),a=r(63366),i=(r(67294),r(3905)),o=["components"],s={title:"Service and Topology Exchange Protocol (STEP)",sidebar_label:"Service and Topology Exchange Protocol (STEP)"},l=void 0,c={unversionedId:"concepts_STEP",id:"concepts_STEP",title:"Service and Topology Exchange Protocol (STEP)",description:"Because networks are constantly changing, services and service reachability information need to be dynamically exchanged between routers. Services are defined to represent the capabilities that the network is designed to deliver to consumers. These services, along with their requisite policies and characteristics, dictate how the traffic patterns traverse the network.",source:"@site/docs/concepts_STEP.md",sourceDirName:".",slug:"/concepts_STEP",permalink:"/docs/concepts_STEP",draft:!1,tags:[],version:"current",lastUpdatedAt:1697479149,formattedLastUpdatedAt:"Oct 16, 2023",frontMatter:{title:"Service and Topology Exchange Protocol (STEP)",sidebar_label:"Service and Topology Exchange Protocol (STEP)"},sidebar:"docs",previous:{title:"Session Timers",permalink:"/docs/concepts_session_timer"},next:{title:"Waypoints",permalink:"/docs/concepts_waypoint_ports"}},d={},u=[{value:"Calculating the Weighted Moving Average (WMA)",id:"calculating-the-weighted-moving-average-wma",level:3},{value:"Determining the Reporting Delay",id:"determining-the-reporting-delay",level:3},{value:"Threshold Values",id:"threshold-values",level:4},{value:"Mapping from Percentage Change to Resulting Reporting Delay",id:"mapping-from-percentage-change-to-resulting-reporting-delay",level:4},{value:"Consolidating Individual Updates Into Router Document Updates",id:"consolidating-individual-updates-into-router-document-updates",level:3}],h={toc:u};function p(e){var t=e.components,r=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},h,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Because networks are constantly changing, services and service reachability information need to be dynamically exchanged between routers. Services are defined to represent the capabilities that the network is designed to deliver to consumers. These services, along with their requisite policies and characteristics, dictate how the traffic patterns traverse the network. "),(0,i.kt)("p",null,"Service and Topology Exchange Protocol (STEP) provides a way to achieve service availability through a central repository. STEP helps network administrators easily design and scale existing or new networks and provide insight into the service availability across the whole network."),(0,i.kt)("p",null,"The ",(0,i.kt)("strong",{parentName:"p"},"STEP Repository")," is built upon a highly efficient and scalable in-memory database. There is no business logic in the STEP repository itself; all of the routing decisions (both client publishing routing data, and the client using the data to perform path computations) are performed on each router."),(0,i.kt)("p",null,"Routers participating in a STEP-enabled network publish information about services, peer connections, and link state in a JSON encoded document called the STEP document. This information is used by all routers to intelligently route traffic to services and react to network changes. The STEP repository can also be used by service providers to advertise service information from their networks/authority."),(0,i.kt)("p",null,"A router supporting STEP publishes a document to the STEP repository. To enable optimal routing decisions in the network, routers need to advertise the peer path SLA metrics in their STEP router document and publish that to the STEP repository. Much of the router document content is expected to be stable and only need occasional updates (such as the operational status of a peer path changing from \u201cup\u201d to \u201cdown\u201d or vice versa). "),(0,i.kt)("p",null,"However, the peer path metrics can change constantly, multiple times per minute. These loss, latency and jitter metrics are measured at every BFD link test interval (10 seconds by default), so advertising them frequently represents a scaling problem. In general, a router will update its router document and publish it as soon as a relevant change has occurred. But updating the peer path metrics requires a damping mechanism. This guide describes the processing pipeline that receives the raw metric update stream from BFD and transforms it into a manageable series of STEP router document updates. "),(0,i.kt)("h3",{id:"calculating-the-weighted-moving-average-wma"},"Calculating the Weighted Moving Average (WMA)"),(0,i.kt)("p",null,"The peer path SLA metrics originate from BFD and are individually generated for each peer path on the router. By default, this happens every 13s. The metrics are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"loss (as a percentage)"),(0,i.kt)("li",{parentName:"ul"},"latency (in ms)"),(0,i.kt)("li",{parentName:"ul"},"jitter (in ms)")),(0,i.kt)("p",null,"These metrics need to be advertised in the STEP router document, but at a lower frequency. In support of that, a moving average calculation is performed to smooth out brief spikes. The moving average is weighted towards the most recent values, and the sample size for the moving average is configurable. The default sample size is 3. The WMA parameters can be configured by neighborhood. For a configuration example, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/config_STEP#configuring-peer-path-advertisement-settings"},"Configuring Peer Path Advertisement Settings"),". For a list and description of the configuration elements, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/config_reference_guide#step-peer-path-advertisement-neighborhood"},(0,i.kt)("inlineCode",{parentName:"a"},"step-peer-path-advertisement (neighborhood)")),"."),(0,i.kt)("h3",{id:"determining-the-reporting-delay"},"Determining the Reporting Delay"),(0,i.kt)("p",null,"In order to determine how quickly a metric change needs to be advertised, the latest SLA metrics coming out of the WMA calculation are compared against the values most recently advertised in the router document. The result is a percentage increase or decrease for each of the three metric types. The largest percentage increase and the largest percentage decrease are chosen from the three percentage values. The Reporting Delay parameters can be configured by neighborhood, as shown in the link above."),(0,i.kt)("h4",{id:"threshold-values"},"Threshold Values"),(0,i.kt)("p",null,"A 100% change from 1ms latency to 2ms latency versus a 100% change from 100ms to 200ms is qualitatively different. Threshold values for the three metric types can be configured that set a \u201cnoise floor\u201d. Changes in value below the threshold are considered trivial and don\u2019t contribute to the percentage increase/decrease calculation. Before calculating the change, both the previously advertised metric values and the latest WMA metric values are raised up to the threshold (if they are below). The comparison is then done on those resulting values."),(0,i.kt)("p",null,"The default thresholds are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Loss = 1%"),(0,i.kt)("li",{parentName:"ul"},"Latency = 5ms"),(0,i.kt)("li",{parentName:"ul"},"Jitter = 2ms")),(0,i.kt)("h4",{id:"mapping-from-percentage-change-to-resulting-reporting-delay"},"Mapping from Percentage Change to Resulting Reporting Delay"),(0,i.kt)("p",null,"After computing the largest increase and largest decrease percentage, those values then get mapped to a reporting delay value (measured in seconds). By delaying the report of a small change, the router document update gets deferred to a later time, when the metric might have already changed back to its previously advertised value. In that case, the router document update would be avoided completely."),(0,i.kt)("p",null,"As new moving average values come in, the delay gets re-evaluated, always comparing the latest WMA against the values in the most recent router document advertisement. The reference point from which the delay will be applied is the earliest time a change was detected after the most recent router document advertisement. That way the reporting of the metric change does not get delayed indefinitely. "),(0,i.kt)("h3",{id:"consolidating-individual-updates-into-router-document-updates"},"Consolidating Individual Updates Into Router Document Updates"),(0,i.kt)("p",null,"After waiting for the computed delay, a peer path metric change is ready to be included in the next router document update. Ideally that should happen right away in order to get the information out. But there can be multiple peer path metric changes, each with their own reporting delay, resulting in different points in time when they are ready to be advertised in the router document.\nTo consolidate this into a small number of router document updates, an overall rate limit is imposed on the router document updates. The configurable parameters are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Average interval (in seconds) between router document peer path metric updates (default is 3 minutes)."),(0,i.kt)("li",{parentName:"ul"},"Burst size, measured in how many updates may happen in bursts faster than the average interval (default is 2).")),(0,i.kt)("p",null,"Additionally, the burst rate is configurable. That is the smallest possible interval between two consecutive router document peer path metric updates. The default is 30 seconds. The end effect of these rate limiting measures is that \u201cinteresting\u201d changes will get advertised immediately (if the metrics were relatively stable before), whereas in the worst case of constant major change, the router will limit itself to the average update interval (3 minutes by default)."),(0,i.kt)("p",null,"For detailed information about configuring STEP please see ",(0,i.kt)("a",{parentName:"p",href:"/docs/config_STEP"},"Configuring STEP"),"."))}p.isMDXComponent=!0}}]);