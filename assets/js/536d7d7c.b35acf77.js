"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[2597],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return f}});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=c(t),f=i,h=u["".concat(l,".").concat(f)]||u[f]||p[f]||r;return t?a.createElement(h,o(o({ref:n},d),{},{components:t})):a.createElement(h,o({ref:n},d))}));function f(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},90469:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return d},default:function(){return u}});var a=t(87462),i=t(63366),r=(t(67294),t(3905)),o=["components"],s={title:"VRF Learning",sidebar_label:"VRF Learning"},l=void 0,c={unversionedId:"config_vrf_learning",id:"config_vrf_learning",title:"VRF Learning",description:"The following configuration procedures can be used to initiate VRF learning using static routes, BGP, and OSPF. Configuration can take place at the global/default VRF level, or inside a VRF container.",source:"@site/docs/config_vrf_learning.md",sourceDirName:".",slug:"/config_vrf_learning",permalink:"/docs/config_vrf_learning",tags:[],version:"current",lastUpdatedAt:1648499102,formattedLastUpdatedAt:"3/28/2022",frontMatter:{title:"VRF Learning",sidebar_label:"VRF Learning"},sidebar:"docs",previous:{title:"Configuring DSCP Steering",permalink:"/docs/config_dscp_steering"},next:{title:"Audit Events",permalink:"/docs/config_audit_event"}},d=[{value:"Add VRF Objects Using BGP",id:"add-vrf-objects-using-bgp",children:[],level:2},{value:"Add VRF Objects Using OSPF",id:"add-vrf-objects-using-ospf",children:[{value:"VRF Support for Static Routes",id:"vrf-support-for-static-routes",children:[],level:3},{value:"Redistributing Static Routes",id:"redistributing-static-routes",children:[],level:3},{value:"Tenant to VRF Mapping",id:"tenant-to-vrf-mapping",children:[],level:3}],level:2},{value:"Service Mapping",id:"service-mapping",children:[{value:"Services with Different Tenants",id:"services-with-different-tenants",children:[],level:3},{value:"Single Service with Multiple Tenants Associated with Different VRFs",id:"single-service-with-multiple-tenants-associated-with-different-vrfs",children:[],level:3},{value:"Service with no Tenant VRF Association",id:"service-with-no-tenant-vrf-association",children:[],level:3}],level:2},{value:"Show Commands",id:"show-commands",children:[{value:"BGP",id:"bgp",children:[],level:4},{value:"OSPF",id:"ospf",children:[],level:4},{value:"Other Show Commands",id:"other-show-commands",children:[],level:4}],level:2}],p={toc:d};function u(e){var n=e.components,t=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The following configuration procedures can be used to initiate VRF learning using static routes, BGP, and OSPF. Configuration can take place at the global/default VRF level, or inside a VRF container. "),(0,r.kt)("p",null,"With VRF, you have the ability to have multiple, independent instances of both BGP and OSPF. When you are managing multiple networks, VRF learning provides the ability learn and isolate these networks from one another, so that traffic destined for an internal private IP address does not get routed to a different network.  "),(0,r.kt)("h2",{id:"add-vrf-objects-using-bgp"},"Add VRF Objects Using BGP"),(0,r.kt)("p",null,"To add VRF learning using BGP, add VRF objects to the ",(0,r.kt)("inlineCode",{parentName:"p"},"routing default-instance"),", and configure BGP as the routing protocol. This allows the SSR BGP instance to peer with a remote peer and learn routes for the VRF."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"router         Test\n    routing    default-instance\n        vrf    red\n            name    red\n            routing-protocol        bgp\n                type                bgp\n                local-as            1\n                router-id 10.1.1.1\n                neighbor\n                    neighbor-address  10.1.1.2\n                    neighbor-as       3000\n")),(0,r.kt)("p",null,"In the example above, all routes learned via BGP will be installed within the VRF table Red. "),(0,r.kt)("h2",{id:"add-vrf-objects-using-ospf"},"Add VRF Objects Using OSPF"),(0,r.kt)("p",null,"To add VRF learning using OSPF, add VRF objects to the ",(0,r.kt)("inlineCode",{parentName:"p"},"routing default-instance"),", and configure an OSPF instance with the ",(0,r.kt)("inlineCode",{parentName:"p"},"instance-id")," of 1. This allows the SSR OSPF instance to dynamically learn and advertise routes to other routers by way of Link State Advertisements (LSAs). "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"router  Test\n            name     Test\n\n            routing  default-instance\n                type  default-instance\n\n                vrf   red\n                    name              red\n                    tenant-name       finance\n                               \n                    ospf              1\n                        instance      1\n                        router-id     10.11.2.202\n\n                        redistribute  static\n                            protocol  static\n                        exit\n\n                        redistribute  service\n                            protocol  service\n                            policy    OSPF_policy\n                        exit\n\n                        area          0.0.0.0\n                            id         0.0.0.0\n\n                            interface  test-01-1 lan\n                                node       test-01-1\n                                interface  lan\n                            exit\n                        exit\n                    exit\n                exit\n\n                vrf   blue\n                    name              blue\n                    tenant-name       eng\n\n                    ospf              2\n                        instance      2\n                        router-id     11.11.2.202\n\n                        redistribute  service\n                            protocol  service\n                            policy    OSPF_policy\n                        exit\n\n                        redistribute  static\n                            protocol  static\n                        exit\n\n                        area          0.0.0.0\n                            id         0.0.0.0\n\n                            interface  test-01-1 lan2\n                                node       test-01-1\n                                interface  lan2\n                            exit\n                        exit\n                    exit\n                exit\n            exit\n        exit\n    exit\n")),(0,r.kt)("p",null,"In the example above, all routes learned via OSPF will be installed within the VRF table Red. "),(0,r.kt)("h3",{id:"vrf-support-for-static-routes"},"VRF Support for Static Routes"),(0,r.kt)("p",null,"Static route configuration is configured in the respective VRF instance."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"router         Test\n    routing               default-instance\n        vrf               red\n            static-route      11.1.1.1/32 10\n                next-hop-interface  node1 wan5          \n")),(0,r.kt)("h3",{id:"redistributing-static-routes"},"Redistributing Static Routes"),(0,r.kt)("p",null,"When VRF static routes are redistributed (using ",(0,r.kt)("inlineCode",{parentName:"p"},"redistribute-static"),"), only the static routes within that VRF are redistributed. When BGP or OSPF is configured outside a VRF directly under ",(0,r.kt)("inlineCode",{parentName:"p"},"routing default-instance"),", the static routes from the global (default) route table are distributed. The ",(0,r.kt)("inlineCode",{parentName:"p"},"static-route")," command is used to populate static routes in the respective VRF table."),(0,r.kt)("h3",{id:"tenant-to-vrf-mapping"},"Tenant to VRF Mapping"),(0,r.kt)("p",null,"The following information pertains to tenant to VRF mapping using static routes, BGP, or OSPF."),(0,r.kt)("p",null,"SSR routers use Tenants to segment L3 traffic in the forwarding plane. VRF provides L3 segmentation at the routing layer. An SSR router does not have any VRF definitions associated with a network interface. Instead, network interfaces are configured with names matching tenants in a VRF. If the network interface tenant does not match any explicitly configured VRF's, then the network interface belongs to the global/default VRF. Keep in mind that a tenant can only be mapped to one VRF."),(0,r.kt)("p",null,"For example, an VRF can have a tenant-name ",(0,r.kt)("inlineCode",{parentName:"p"},"128"),". This would match network-interfaces with a tenant of ",(0,r.kt)("inlineCode",{parentName:"p"},"engineeering.128")," and a network-interface with a tenant of ",(0,r.kt)("inlineCode",{parentName:"p"},"finance.128"),"."),(0,r.kt)("p",null,"In the following example, all traffic coming from the interface is classified as that tenant. Using vrf ",(0,r.kt)("inlineCode",{parentName:"p"},"blue")," as a reference, the tenant-name ",(0,r.kt)("inlineCode",{parentName:"p"},"eng")," must exist on lan2 and the VRF. The VRF-Tenant mapping is used for redistributing connected routes and for mapping services."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    router Test\n        routing default-instance\n            vrf red\n                tenant-name finance\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"            network-interface  lan\n                name                                 lan\n                global-id                            90\n\n                neighborhood                         LAN\n                    name      LAN\n                    topology  mesh\n                    exit\n                tenant                               finance\n                    inter-router-security                internal\n\n                    address                              10.11.2.210\n                        ip-address     10.11.2.210\n                        prefix-length  29\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    router Test\n        routing default-instance\n            vrf blue\n                tenant-name eng\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"            network-interface  lan2\n                name                                 lan2\n                global-id                            90\n\n                neighborhood                         LAN2\n                    name      LAN2\n                    topology  mesh\n                    exit\n                tenant                               eng\n                    inter-router-security                internal\n\n                    address                              11.11.2.210\n                        ip-address     11.11.2.210\n                        prefix-length  29\n")),(0,r.kt)("h2",{id:"service-mapping"},"Service Mapping"),(0,r.kt)("p",null,"Each Service prefix is matched against the routing table that corresponds to the tenant (using the VRF ",(0,r.kt)("inlineCode",{parentName:"p"},"tenant-name")," mapping configuration). If no VRF tenant mapping exists for the tenant, the service prefix is matched against the global routing table. If no match is found, no FIB entries are installed for that service and tenant."),(0,r.kt)("h3",{id:"services-with-different-tenants"},"Services with Different Tenants"),(0,r.kt)("p",null,"The VRF mapping below has a tenant per VRF, and there are 2 services; each with a different tenant access policy."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"router         Test\n    routing     default-instance\n        vrf         red\n            tenant-name     finance\n        vrf                 blue\n            tenant-name     eng\n    \nService  web\n    address 10.1.1.0/24\n    access-policy tenant finance\n\nService  database\n    address 10.1.1.0/24\n    access-policy tenant eng\n")),(0,r.kt)("p",null,"The prefix is the same for both the services, but the service ",(0,r.kt)("inlineCode",{parentName:"p"},"web")," is matched against the routes in VRF ",(0,r.kt)("inlineCode",{parentName:"p"},"red"),", while the service database is matched against routes in VRF ",(0,r.kt)("inlineCode",{parentName:"p"},"blue"),".\nFIB entries are installed for each tenant based on where the best matched route is in the respective VRF route table."),(0,r.kt)("h3",{id:"single-service-with-multiple-tenants-associated-with-different-vrfs"},"Single Service with Multiple Tenants Associated with Different VRFs"),(0,r.kt)("p",null,"In this example the VRF mapping has a tenant per VRF, but only one service with access to both tenants."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"router         Test\n    routing               default-instance\n        vrf               red\n            tenant-name       finance\n        vrf               blue\n            tenant-name       eng\nService  web\n    address 10.1.1.0/24\n    access-policy tenant finance\n    access-policy tenant eng\n")),(0,r.kt)("p",null,"With the VRF associations to a single service, the tenants (",(0,r.kt)("inlineCode",{parentName:"p"},"finance")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"eng"),") use the same prefix (",(0,r.kt)("inlineCode",{parentName:"p"},"10.1.1.0/24"),") but are located in different VRFs (red/finance, blue/eng). In this configuration the same service can lead to 2 different next hops for different tenants. "),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"In the following cases, a single service with multiple tenants associated with different VRFs is not currently supported. "),(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"If the service has a service-route with a NAT target not bound to a specific next-hop."),(0,r.kt)("li",{parentName:"ul"},"If the service is a multicast service.")),(0,r.kt)("p",{parentName:"div"},"In these cases, validation will ensure that all access-policy tenants are associated with ",(0,r.kt)("strong",{parentName:"p"},"the same, or no VRF.")))),(0,r.kt)("h3",{id:"service-with-no-tenant-vrf-association"},"Service with no Tenant VRF Association"),(0,r.kt)("p",null,"A service with access to tenants that have no VRF association will default to the global routing table for route matches.\nVRF serves as a routing table for each tenant to ensure that there is a route to the destination. Multiple tenants can have access to this VRF table via Services. If a service is not defined with a prefix that matches the routing table, no FIB entries are installed. "),(0,r.kt)("h2",{id:"show-commands"},"Show Commands"),(0,r.kt)("p",null,"The following show commands have been extended to specify ",(0,r.kt)("inlineCode",{parentName:"p"},"vrf"),". For specific use examples, refer to the linked section in the Command Line Reference guide."),(0,r.kt)("h4",{id:"bgp"},"BGP"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-bgp"},(0,r.kt)("inlineCode",{parentName:"a"},"show bgp"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-bgp-neighbors"},(0,r.kt)("inlineCode",{parentName:"a"},"show bgp neighbors"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-bgp-summary"},(0,r.kt)("inlineCode",{parentName:"a"},"show bgp summary"))),(0,r.kt)("h4",{id:"ospf"},"OSPF"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-ospf"},(0,r.kt)("inlineCode",{parentName:"a"},"show ospf"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-ospf-neighbors"},(0,r.kt)("inlineCode",{parentName:"a"},"show ospf neighbors"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-ospf-routes"},(0,r.kt)("inlineCode",{parentName:"a"},"show ospf routes"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-ospf-interfaces"},(0,r.kt)("inlineCode",{parentName:"a"},"show ospf interfaces"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-ospf-database"},(0,r.kt)("inlineCode",{parentName:"a"},"show ospf database"))),(0,r.kt)("h4",{id:"other-show-commands"},"Other Show Commands"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-fib"},(0,r.kt)("inlineCode",{parentName:"a"},"show fib"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-rib"},(0,r.kt)("inlineCode",{parentName:"a"},"show rib"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#show-vrf"},(0,r.kt)("inlineCode",{parentName:"a"},"show vrf"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/cli_reference#clear-bgp"},(0,r.kt)("inlineCode",{parentName:"a"},"clear bgp vrf"))))}u.isMDXComponent=!0}}]);