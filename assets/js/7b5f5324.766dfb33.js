"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[6283],{90654:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>f,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var t=i(74848),r=i(28453);const a={title:"Inline Flow Performance Monitoring",sidebar_label:"Inline Flow Performance Monitoring"},o=void 0,s={id:"config_flow_perf_mon",title:"Inline Flow Performance Monitoring",description:"Inline Flow Performance Monitoring (FPM) complements BFD in measuring peer paths between two SSR devices. To provide this additional level of detail, the initiating router adds a small amount of metadata to a sample number of packets. This metadata indicates that metrics are collected per path, traffic class, and protocol (TCP or UDP). The receiving router reads the metadata and returns the data to the intiating router. The configurable fields include:",source:"@site/docs/config_flow_perf_mon.md",sourceDirName:".",slug:"/config_flow_perf_mon",permalink:"/docs/config_flow_perf_mon",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1710958440,formattedLastUpdatedAt:"Mar 20, 2024",frontMatter:{title:"Inline Flow Performance Monitoring",sidebar_label:"Inline Flow Performance Monitoring"},sidebar:"docs",previous:{title:"Configuring Ethernet Over SVR for Active/Standby",permalink:"/docs/config_EthoSVR_activestandby"},next:{title:"Native GRE Tunnels",permalink:"/docs/config_gre_tunnel"}},l={},c=[{value:"A bit about traffic-class",id:"a-bit-about-traffic-class",level:4},{value:"Configuration",id:"configuration",level:2},{value:"From the Command Line:",id:"from-the-command-line",level:4},{value:"From the GUI:",id:"from-the-gui",level:4},{value:"Load Balancing",id:"load-balancing",level:3},{value:"Show Commands",id:"show-commands",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"I am experiencing 100% loss on one node when traffic is flowing:",id:"i-am-experiencing-100-loss-on-one-node-when-traffic-is-flowing",level:4},{value:"I am seeing infrequent FPM analytics updates when generating test traffic using tools like Iperf:",id:"i-am-seeing-infrequent-fpm-analytics-updates-when-generating-test-traffic-using-tools-like-iperf",level:4},{value:"Loss values generated by FPM are very volatile:",id:"loss-values-generated-by-fpm-are-very-volatile",level:4}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Inline Flow Performance Monitoring (FPM) complements BFD in measuring peer paths between two SSR devices. To provide this additional level of detail, the initiating router adds a small amount of metadata to a sample number of packets. This metadata indicates that metrics are collected per path, traffic class, and protocol (TCP or UDP). The receiving router reads the metadata and returns the data to the intiating router. The configurable fields include:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"name"}),": The name of the performance monitoring profile."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"marking-count"}),": The number of packets to mark within a given interval."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"interval-duration"}),": The duration of a packet marking interval in milliseconds."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"monitor-only"}),": Default is ",(0,t.jsx)(n.code,{children:"false"}),". This generates metrics and provides those metrics for calculating SLA and making load balancing decisions. Setting ",(0,t.jsx)(n.code,{children:"monitor-only"})," to ",(0,t.jsx)(n.code,{children:"true"})," will generate metrics, but does not influence load balancing decisions or traffic flow."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"resource-group"}),": Associate this performance monitoring profile with a top-level resource-group."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Additional information is available at ",(0,t.jsxs)(n.a,{href:"/docs/config_reference_guide#performance-monitoring-profile",children:[(0,t.jsx)(n.code,{children:"performance-monitoring-profile"}),"."]})]}),"\n",(0,t.jsx)(n.p,{children:"The data returned is organized by traffic class (high/medium/low/best-effort) and protocol (TDP, UDP), giving more granular data on the performance of a link - not just through synthetic traffic (BFD), but by piggybacking onto actual user traffic."}),"\n",(0,t.jsx)(n.h4,{id:"a-bit-about-traffic-class",children:"A bit about traffic-class"}),"\n",(0,t.jsx)(n.p,{children:"The SSR has four traffic classes, in order of priority: high, medium, low, best-effort. The traffic-class allows you to configure different treatments for different classes of traffic for the same service."}),"\n",(0,t.jsx)(n.p,{children:"Working in concert with the traffic engineering subsystem, this lets you determine which paths the traffic referenced by a service class will use, and therefore how much guaranteed bandwidth is reserved for each class."}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h4,{id:"from-the-command-line",children:"From the Command Line:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"config\n\n    authority\n\n        performance-monitoring-profile  wan-assurance-monitoring-profile\n            name               wan-assurance-monitoring-profile\n            marking-count      100\n            interval-duration  10000\n            monitor-only       true\n        exit\n    exit\nexit\n"})}),"\n",(0,t.jsx)(n.h4,{id:"from-the-gui",children:"From the GUI:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"From the Authority level, scroll down to Performance Monitoring Profiles, and click ADD."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Performance Monitoring Profiles",src:i(6755).A+"",width:"1708",height:"386"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Enter a name for the profile."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"New Profile Name",src:i(21480).A+"",width:"1256",height:"432"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Configure monitoring values, or accept the defaults to gather a baseline."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Monitoring Profile Intervals",src:i(35697).A+"",width:"1662",height:"824"})}),"\n",(0,t.jsxs)(n.p,{children:["The default setting for Monitor Only is ",(0,t.jsx)(n.code,{children:"false"}),". This generates metrics and provides those metrics for calculating SLA and making load balancing decisions. Setting ",(0,t.jsx)(n.code,{children:"monitor-only"})," to ",(0,t.jsx)(n.code,{children:"true"})," will generate metrics, but does not influence load balancing decisions or traffic flow."]}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Optionally, assign the profile to a Resource Group."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Validate and Commit the configuration changes."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Additionally, ensure that the profile is applied to your peer paths. This is generally configured through ",(0,t.jsx)(n.strong,{children:"router > node > device-interface > network-interface > neighborhood"}),". Apply the profile to both sides of the SVR peer path."]}),"\n",(0,t.jsx)(n.h3,{id:"load-balancing",children:"Load Balancing"}),"\n",(0,t.jsxs)(n.p,{children:["Flow Performance Monitoring (FPM) operates on top of existing traffic, and does not intiate its own traffic. Because of the interval timing and sample time, no significant load is added to the path. In ",(0,t.jsx)(n.code,{children:"monitor-mode true"}),", no impact to load balancing is generated."]}),"\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"monitor-mode"})," is set to ",(0,t.jsx)(n.code,{children:"true"}),", the FPM metrics are collected, but are ",(0,t.jsx)(n.strong,{children:"not"})," reported to the load balancer."]}),"\n",(0,t.jsxs)(n.p,{children:["With ",(0,t.jsx)(n.code,{children:"monitor-mode"})," set to ",(0,t.jsx)(n.code,{children:"false"}),", both BFD and FPM provide metrics for calculating SLA and making load balancing decisions. By default, the metrics generated by FPM are used in favor of BFD metrics, and will influence load balancing."]}),"\n",(0,t.jsxs)(n.p,{children:["In order to collect accurate metrics, FPM requires that user traffic be actively traversing the path. When FPM derived SLA metrics indicate that a path is no longer suitable, the load balancer may steer all user traffic away from that path, depending on how session-resiliency is configured. If SLA steers ALL sessions away from a specific path (except BFD traffic), then FPM will not generate any new metrics. The FPM metrics become stale and the load balancer then harvests performance metrics from BFD. Once the metrics from BFD indicate that the path is better, it (if session-resiliency is configured as ",(0,t.jsx)(n.code,{children:"revertible-failover"}),") reverts all sessions back, in addition to allowing new sessions to be created using that path. Once traffic is again flowing, FPM path metrics are collected and used with the load balancer."]}),"\n",(0,t.jsx)(n.h3,{id:"show-commands",children:"Show Commands"}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"show stats performance-monitoring"})," to view the results. The following metrics are provided:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peer-path jitter"}),": Jitter in milliseconds for the SSR peer path."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peer-path latency"}),": Latency in milliseconds for the SSR peer path."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peer-path loss"}),": Packet loss percentange for the SSR peer path."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peer-path mos"}),": MOS value calculated for the SSR peer path (hundreths of a decimal)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peer-path updated"}),": Time of last reported FPM activity on this peer path."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"admin@labsystem1.fiedler# show stats performance-monitoring router all force\nTue 2021-11-09 11:19:51 EST\n\u2714 Retrieving statistics...\n\nHighway Manager Performance Monitoring Stats\n--------------------------------------------\n\n=================== =========== ======== =========== ================ ============= ====== =============== ========== ============\n Metric              Router      Node     Peer-name   Peer-host        Device-name   Vlan   Traffic-class   Protocol        Value\n=================== =========== ======== =========== ================ ============= ====== =============== ========== ============\n peer-path jitter    natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp                21\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp                12\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp                 4\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp                51\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp                 0\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp                 1\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp                 0\n peer-path latency   natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp                78\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp                64\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp                45\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp               113\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp                18\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp                15\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp                 0\n peer-path loss      natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp                 0\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp                 0\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp                 0\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp                 0\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp                 0\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp                 0\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp               100\n peer-path mos       natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp               434\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp               436\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp               438\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp               412\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp               440\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp               440\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp               100\n peer-path updated   natick      flutie   greyhaven   10.65.228.68     enp1s0f3         0   low             udp        1636474788\n                                 flutie   greyhaven   10.65.228.68     enp1s0f3         0   medium          udp        1636216599\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   low             udp        1636474188\n                                 flutie   greyhaven   192.168.2.101    enp1s0f3         0   medium          udp        1636216603\n                                 flutie   westfield   10.0.0.41        enp1s0f3         0   medium          udp        1636466059\n                     westfield   monty    natick      108.20.166.32    enp1s0           0   medium          udp        1636466059\n                                 monty    natick      108.49.110.151   enp1s0           0   medium          udp        1636025768\n\n\n"})}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h4,{id:"i-am-experiencing-100-loss-on-one-node-when-traffic-is-flowing",children:"I am experiencing 100% loss on one node when traffic is flowing:"}),"\n",(0,t.jsx)(n.p,{children:"Verify that the peer router has FPM enabled on its peer path. If not, the peer router will not collect and respond to FPM data analytics queries."}),"\n",(0,t.jsx)(n.h4,{id:"i-am-seeing-infrequent-fpm-analytics-updates-when-generating-test-traffic-using-tools-like-iperf",children:"I am seeing infrequent FPM analytics updates when generating test traffic using tools like Iperf:"}),"\n",(0,t.jsx)(n.p,{children:"FPM operates on packets below MTU so calculations are not impacted by fragmentation stacks. Certain test tools that by default generate jumbo traffic may not satisfy this condition. As a result, FPM will not sample packets that will not generate new analytics."}),"\n",(0,t.jsx)(n.h4,{id:"loss-values-generated-by-fpm-are-very-volatile",children:"Loss values generated by FPM are very volatile:"}),"\n",(0,t.jsx)(n.p,{children:"Because FPM attaches to existing traffic and does not generate its own, a very short interval duration can lead to inaccurate loss values. This is due to FPM not being able to sample a sufficient number of packets within the given interval. Increasing the interval duration allows more packets to be sampled, providing a more accurate representation of loss on the path."})]})}function f(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},6755:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/config_ifpm1-8397280be51b4724bc3462ce730b2d4c.png"},21480:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/config_ifpm2-2eb0dcf71b732a9da83f8810a1cdb107.png"},35697:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/config_ifpm3-11200f7efb4b929667477e957c0a21c1.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>s});var t=i(96540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);