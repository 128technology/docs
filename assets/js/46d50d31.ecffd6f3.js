"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[7800],{19880:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var i=t(74848),r=t(28453);const a={title:"Enhanced Security Key Management","sidebars-label":"Enhanced Security Key Management"},s=void 0,o={id:"enhanced-sec-key-mgmt",title:"Enhanced Security Key Management",description:"Version History",source:"@site/docs/enhanced-sec-key-mgmt.md",sourceDirName:".",slug:"/enhanced-sec-key-mgmt",permalink:"/docs/enhanced-sec-key-mgmt",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Enhanced Security Key Management","sidebars-label":"Enhanced Security Key Management"},sidebar:"docs",previous:{title:"Configure Certificate Management",permalink:"/docs/config-custom-certs"},next:{title:"Intrusion Detection and Prevention",permalink:"/docs/concepts_ssr_idp"}},d={},c=[{value:"Version History",id:"version-history",level:4},{value:"Conductor Hub and Spoke",id:"conductor-hub-and-spoke",level:4},{value:"Multi-hop Hub and Spoke",id:"multi-hop-hub-and-spoke",level:4},{value:"SVRv2 and IPSec",id:"svrv2-and-ipsec",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Key Rotation",id:"key-rotation",level:3},{value:"SSR Keys",id:"ssr-keys",level:3},{value:"Peer Key and Key Rotation",id:"peer-key-and-key-rotation",level:3},{value:"Certificate Replacement or Revocation",id:"certificate-replacement-or-revocation",level:3},{value:"Peer Authentication",id:"peer-authentication",level:3},{value:"Requirements",id:"requirements",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Rekeying (Key Rotation) Atttributes and Default Values",id:"rekeying-key-rotation-atttributes-and-default-values",level:4},{value:"Default Configuration Example",id:"default-configuration-example",level:4},{value:"Sample Default Configuration:",id:"sample-default-configuration",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Events and Alarms",id:"events-and-alarms",level:3},{value:"Show Commands",id:"show-commands",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h4,{id:"version-history",children:"Version History"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Release"}),(0,i.jsx)(n.th,{children:"Modification"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"7.0.1"}),(0,i.jsx)(n.td,{children:"Enhanced Security Key Management support added."})]})})]}),"\n",(0,i.jsxs)(n.p,{children:["Security is a critical component of ",(0,i.jsx)(n.a,{href:"https://www.juniper.net/us/en/products/routers/session-smart-router.html",children:"SD-WAN (software-defined wide area network)"})," products in today\u2019s market. ",(0,i.jsx)(n.a,{href:"/docs/about_128t",children:"The SSR (Session Smart Router)"})," offers several means of ensuring the integrity of data transmitted through the router, such as encrypting application payload content, encrypting SVR (Secure Vector Routing) metadata, and authentication for metadata."]}),"\n",(0,i.jsxs)(n.p,{children:["As an example, let's look at the needs of a financial institution. They have to keep transaction traffic secure. If not, the results are catastrophic for both the instution and the individual/companies whose transaction gets hijacked. SSR technology uses SVR along with Enhanced Security Key Management, allowing you to configure unparalelled security without the increased packet size, fragmentation, and increased transaction time ",(0,i.jsx)(n.a,{href:"/docs/about_svr_savings",children:"common with IPSec"}),". This design creates maximum scale, avoids mid-network re-encryption, and provides the ability to rotate keys as required."]}),"\n",(0,i.jsx)(n.p,{children:"The following diagrams show simple examples of how Enhanced Security Key Management can be deployed."}),"\n",(0,i.jsx)(n.h4,{id:"conductor-hub-and-spoke",children:"Conductor Hub and Spoke"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Conductor behind",src:t(67209).A+"",width:"1332",height:"1276"})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, green represents management traffic on TCP/930 and TCP/4505-4506. Blue represents SVR between the hub and spokes. The management traffic flows inside the SVR path to the hub. The hub then sends it over the LAN to the conductor. Management traffic can be configured to traverse SVR paths if required. Red represents customer traffic between the hub and spokes. For additional deployment information, see ",(0,i.jsx)(n.a,{href:"/docs/bcp_conductor_deployment#conductor-behind-ssr",children:"Conductor Deployment - Conductor Behind SSR."})]}),"\n",(0,i.jsx)(n.h4,{id:"multi-hop-hub-and-spoke",children:"Multi-hop Hub and Spoke"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Multi-hop hub and spoke",src:t(28618).A+"",width:"846",height:"986"})}),"\n",(0,i.jsx)(n.p,{children:"This example shows a multi-hop hub and spoke deployment. Red represents customer traffic between the hubs and spoke, and out to a public network. Blue represents the SVR connection between spokes and the hub. The traffic flows inside the SVR path from spoke to hub or spoke to hub to spoke."}),"\n",(0,i.jsx)(n.p,{children:"In a newly deployed network, Enhanced Security Key Management is more secure than the default security implementation of SVR, and far more secure than IPSec. Enhanced Security Key Management affords you the best security strength not only because of the encryption key exchange, and its unique per-session encryption keys, but through its ability to perform key rotations for any network topology."}),"\n",(0,i.jsx)(n.p,{children:"Additionally, the flexiblity of SVR to choose a different physical path to satisfy SLA requirements is not found in traffic encrypted within an IPSec Tunnel. Traffic encrypted within an IPSec Tunnel always follows the same path, not allowing for different flows to have different SLA-driven physical paths."}),"\n",(0,i.jsx)(n.h2,{id:"svrv2-and-ipsec",children:"SVRv2 and IPSec"}),"\n",(0,i.jsx)(n.p,{children:"To understand the value of Enhanced Security Key Management, we can draw some comparisons against IPSec."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Characteristic"}),(0,i.jsx)(n.th,{children:"IPSec/IKE"}),(0,i.jsx)(n.th,{children:"SVRv2"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Payload Encryption"}),(0,i.jsx)(n.td,{children:"ESP"}),(0,i.jsx)(n.td,{children:"Encrypted with per-Flow AES-CBC-256 payload key."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Encrypt Original IP SA/DA"}),(0,i.jsx)(n.td,{children:"ESP"}),(0,i.jsx)(n.td,{children:"Encrypted with AES-CBC-256 encrypted Metadata sent within first Payload packet using metadata key."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Secure Channel to exchange keys"}),(0,i.jsx)(n.td,{children:"IKEv2"}),(0,i.jsx)(n.td,{children:"Diffie-Hellman. DH provides 4096-bit Peer key used to encrypt BFD Metadata."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Confidentiality"}),(0,i.jsx)(n.td,{children:"Payload is encrypted with the IPSec Tunnel key; however, all individual sessions with the same IPSec tunnel share the same key. There is no confidentiality between sessions sharing the same source and destination address."}),(0,i.jsx)(n.td,{children:"Payload encrypted with Per-Flow Payload key; SVR Metadata (containing the Per-Flow Payload key) is encrypted with the SVR Metadata Key. Because each session has a separate key, each session has confidentiality, even between the same source and destination address."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Integrity"}),(0,i.jsx)(n.td,{children:"ESP Authentication Header"}),(0,i.jsx)(n.td,{children:"HMAC SHA-384 signature signs all SVR Metadata and/or Payload in SVR packet."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Authentication"}),(0,i.jsx)(n.td,{children:"IKEv2 PSK or x.509v3 certificates"}),(0,i.jsx)(n.td,{children:"SSR-signed x.509v3 certificate through root of trust to Intermediate CA installed on SSR"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Data Origin Authentication"}),(0,i.jsx)(n.td,{children:"HMAC-SHA-384"}),(0,i.jsx)(n.td,{children:"HMAC SHA-384 signature"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Replay Protection"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Nonce added for Replay Protection."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Perfect Forward Secrecy"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Keys in DH are seeded by Salt."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IPv4 and IPv6"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"The Enhanced Security Key Management provides a more secure, more flexible, and more efficient transport network. If you want securtiy across your network, this is the best option."}),"\n",(0,i.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsx)(n.p,{children:"The foundation of Enhanced Security Key Management is the ability to define peer-to-peer certificate-based security and key rotation within your SVR peer network. There are two ways you can provision this level of security."}),"\n",(0,i.jsxs)(n.p,{children:["When configured to used Enhanced Security Key Management, the SSR will automatically create a self-signed certificate. This allows you to configure peering between SSRs quickly, however because it is a self-signed certificate, it does not offer the same protections as a CA-signed certificate. To configure Enhanced Security Key Management using the self-signed certificate, use the ",(0,i.jsx)(n.a,{href:"#configuration",children:"Configuration"})," procedure below."]}),"\n",(0,i.jsxs)(n.p,{children:["To provide thorough, end-to-end security the use of a trusted and provisioned certificate and signing authority is supported. To take advantage of this feature, begin with ",(0,i.jsx)(n.a,{href:"/docs/config-custom-certs",children:"Configuring Certificate Management"}),", and then return to the ",(0,i.jsx)(n.a,{href:"#configuration",children:"Configuration"})," section below."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"The user provided certificates and signing authority must be in place before configuring Enhanced Security Key Management. If they are NOT in place prior to configuration and are added afterwards, then the SSR service will need to be restarted in order to pick up the changes."})}),"\n",(0,i.jsx)(n.p,{children:"The following diagram provides a look at a typical SSR/SVR deployment."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"sample topology",src:t(23016).A+"",width:"1706",height:"804"})}),"\n",(0,i.jsx)(n.p,{children:"In this topology, the selected path through the network is: Host 1 \u2013 R2 \u2013 R3 \u2013 R4 \u2013 Host 5"}),"\n",(0,i.jsxs)(n.p,{children:["The payload for the first flow - ",(0,i.jsx)(n.code,{children:"Blue"})," - consists of data packets A, B, and C. Additional flows may have the same source and destination (Host 1/Host 5) but to satisfy SLA requirements they could take a different physical path through Router 6."]}),"\n",(0,i.jsx)(n.p,{children:"This illustrates an important difference between SVR and IPSec tunnels; traffic encrypted within an IPSec Tunnel always follows the same path, not allowing different flows to have different SLA-driven physical paths. SVR does not have this limitation."}),"\n",(0,i.jsx)(n.h3,{id:"key-rotation",children:"Key Rotation"}),"\n",(0,i.jsx)(n.p,{children:"Key rotation provides a high level of transport security. Configuring this feature creates a specific interval for the router to generate a new security key/payload key and distribute it across the network."}),"\n",(0,i.jsx)(n.p,{children:"The security rekeying mechanism (key rotation) is configured on the conductor, at the Authority level, and requires that all routers and conductors are running the same version of software that supports this feature."}),"\n",(0,i.jsxs)(n.p,{children:["This enhanced level of security is enabled by setting ",(0,i.jsx)(n.code,{children:"enhanced-security-key-management"})," to ",(0,i.jsx)(n.code,{children:"true"}),", which triggers the router to generate ",(0,i.jsx)(n.strong,{children:"a local metadata key"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"ssr-keys",children:"SSR Keys"}),"\n",(0,i.jsxs)(n.p,{children:["The router sends the ",(0,i.jsx)(n.strong,{children:"metadata key"})," and other information to the peers, allowing peer authentication and the ability to encrypt and decrypt messages. The peers store this key until a new key is accepted as a replacement. This dynamic key generation and exchange provides the encryption of Secure Vector Routing (SVR) traffic."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Metadata Key","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Transmitted within BFD Metadata"}),"\n",(0,i.jsx)(n.li,{children:"Metadata Key is same for all peer router connections"}),"\n",(0,i.jsx)(n.li,{children:"Encrypts SVR TLVs"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Routers generate their own ",(0,i.jsx)(n.strong,{children:"peer keys"})," based on X.509 certificates for encrypting metadata keys and distribute them to their peers by BFD metadata."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Peer Key","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Generated via DH from PKI"}),"\n",(0,i.jsx)(n.li,{children:"Encrypts BFD Metadata"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Sessions are encrypted using ",(0,i.jsx)(n.strong,{children:"payload keys"})," generated on demand, encrypted, and distributed to the peer over SVR."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Payload Key","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Transmitted within SVR Metadata encrypted by the peer key"}),"\n",(0,i.jsx)(n.li,{children:"Encrypts Payload per-session"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The following diagram illustrates the SSR Key Exchange process:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Key Exchange",src:t(3538).A+"",width:"1732",height:"732"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"SVR certificates are installed onto the SSR from the Conductor."}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The DH key exchange between routers creates a ",(0,i.jsx)(n.strong,{children:"peer key"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Each router generates a ",(0,i.jsx)(n.strong,{children:"metadata key"})," and transmits this via BFD Metadata, encrypted using the Peer Key."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Each Peer creates their own key."}),"\n",(0,i.jsxs)(n.li,{children:["The originating router encrypts SVR Metadata with the peer\u2019s ",(0,i.jsx)(n.strong,{children:"metadata key"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Each router generates unique ",(0,i.jsx)(n.strong,{children:"payload key"})," per session, and transmits this key in the metadata TLV, encrypted using the ",(0,i.jsx)(n.strong,{children:"metadata key"})," on a router-to-router basis (end-to-end)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"peer-key-and-key-rotation",children:"Peer Key and Key Rotation"}),"\n",(0,i.jsx)(n.p,{children:"A single key is used for all paths between two routers. The key is saved and remains valid during network outages and path failures, until a new key is accepted as a replacement."}),"\n",(0,i.jsx)(n.p,{children:"During the rekeying period the old key is used. A wait time of 30 seconds is added post key computation to prevent any retransmitted packets, delayed packets, or long latency packets not having a key ready for use."}),"\n",(0,i.jsx)(n.p,{children:"If a peer sends a Key Request to a peer for which there is no valid key and receives no response, then the peer path remains out of service until there is a valid response."}),"\n",(0,i.jsxs)(n.p,{children:["The peer continues to resend requests at periodic intervals as defined in the configuration setting ",(0,i.jsx)(n.code,{children:"authority > security-key-management > peer-key-retransmit-interval"}),". If there is no response after the time defined by ",(0,i.jsx)(n.code,{children:"authority > security-key-management > peer-key-timeout"}),", the peer path is declared invalid and removed from service. Once the peer is taken out of service due to key timeout, it will continue to send rekey attempts at the ",(0,i.jsx)(n.code,{children:"peer-key-timeout intervals"}),", or upon interface state change."]}),"\n",(0,i.jsx)(n.h3,{id:"certificate-replacement-or-revocation",children:"Certificate Replacement or Revocation"}),"\n",(0,i.jsxs)(n.p,{children:["When a certificate is revoked, expired, or invalid, the SSR generates an alarm. Based upon the SSR configuration, it will either ",(0,i.jsx)(n.code,{children:"fail-soft"})," (the default behavior) or ",(0,i.jsx)(n.code,{children:"fail-hard"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"fail-soft"})," results in a notification that the certificate is no longer valid and that appropriate action must be taken."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"fail-hard"})," results in a notification that the certificate is no longer valid, as well as the removal of all peering relationships. This severs the peer connection and stops the device from participating in SVR."]}),"\n",(0,i.jsx)(n.h3,{id:"peer-authentication",children:"Peer Authentication"}),"\n",(0,i.jsxs)(n.p,{children:["Peer validation is done whenever a new certificate is added, or peer configuration has changed. When a certificate is received, a cached validation response is used. If configured, the received certificate is validated against the ",(0,i.jsx)(n.code,{children:"trusted-ca-certificate"})," list."]}),"\n",(0,i.jsx)(n.p,{children:"When receiving a certificate from a peer router and performing validation, the receiving router extracts and saves the peer router's public key. This is used for validating the authenticity of any subsequent Peer Key/Rekey requests."}),"\n",(0,i.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsx)(n.p,{children:"SSR 7.0.1 is required on all devices participating in Enhanced Security Key Management. Any SSR running an older version of software that does not support this functionality will cause traffic to fail between those peers. In these cases, events will be generated when peering fails to establish."}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Configuration is performed on the conductor, at the Authority level, on a per router basis. To accept the default values for enhanced security key management:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"enhanced-security-key-management"})," to ",(0,i.jsx)(n.code,{children:"true"}),";"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"config\n\n    authority\n        enhanced-security-key-management  true\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Configure a ",(0,i.jsx)(n.code,{children:"peering-common-name"})," on each router. In a secure environment, the router name should never be sent between routers as plaintext in BFD messages. The ",(0,i.jsx)(n.code,{children:"peering-common-name"})," is an alias that identifies the router and is configured at the router level. When ",(0,i.jsx)(n.code,{children:"enhanced-security-key-management"})," is configured, it is validated against the peering-common-name from the ceritficate, and integrated into the auto-generated adjacencies list for the peers of the router from the neighborhood configuration."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'        router                            combo-east\n            name                 combo-east\n            peering-common-name  second-fake-alias-2\n            location             usa\n            description          "router 1"\n            inter-node-security  internal\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The peer list of the router must also have the ",(0,i.jsx)(n.code,{children:"peering-common-name"})," of that peer. If the peer list is not manually configured, it is auto-generated from the neighborhoods."]}),"\n",(0,i.jsx)(n.h4,{id:"rekeying-key-rotation-atttributes-and-default-values",children:"Rekeying (Key Rotation) Atttributes and Default Values"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Configuration Attributes"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"key-exchange-algorithm"}),(0,i.jsx)(n.td,{children:"Configure Key Exchange Algorithm"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"payload-key-rekey-interval"}),(0,i.jsx)(n.td,{children:"Hours between payload security key regeneration. Range is 1-720, or never. Default is 24 hours."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"peer-key-rekey-interval"}),(0,i.jsx)(n.td,{children:"Hours between security key regeneration for peer routers. Range is 1-720, or never. Default is 24 hours."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"peer-key-retransmit-interval"}),(0,i.jsx)(n.td,{children:"Seconds between security key retransmission for peer routers, when peer key establishment has not been acknowledged. Range is 5-3600. Default is 30 seconds."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"peer-key-timeout"}),(0,i.jsx)(n.td,{children:"Seconds before security key retransmission timeout for peer routers, when peer key establishment has not been acknowledged. Default is 3600 seconds."})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"When rekeying is enabled on a newly initialized router that does NOT have a valid, signed certificate, an alarm is generated. A valid certificate must be obtained from a Certificate Authority before valid secure communication can take place. When a valid certificate is present, the router will create a public/private key pair (see [RFC8422] for addtional information)."}),"\n",(0,i.jsx)(n.h4,{id:"default-configuration-example",children:"Default Configuration Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"config \n    authority \n        security-key-management \n            payload-key-rekey-interval    24\n            peer-key-rekey-interval       24\n            peer-key-retransmit-interval  30\n            peer-key-timeout              3600\n            invalid-certificate-behavior  fail-soft\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In cases where you want to manually force key rotation on the routers, use the ",(0,i.jsx)(n.code,{children:"security metadata-key regenerate"})," command to tell the active node to immediately regenerate the metadata key with an incremented rekey index. The active node will push the new metadata key to the peer node."]}),"\n",(0,i.jsx)(n.h4,{id:"sample-default-configuration",children:"Sample Default Configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'config\n\n    authority\n        enhanced-security-key-management  true\n\t\t\n        router                  RTR_EAST_CONDUCTOR\n            name                RTR_EAST_CONDUCTOR\n\n            node                conductor-east-1\n                name            conductor-east-1\n            exit\n        exit\n\n        router                   combo-east\n            name                 combo-east\n            peering-common-name  second-fake-alias-2\n            location             usa\n            description          "router 1"\n            inter-node-security  internal\n\n        router                   combo-west\n            name                 combo-west\n            peering-common-name  second-fake-alias-3\n            location             usa\n            inter-node-security  internal\n'})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.p,{children:"The following Events, Alarms, and Show commands are available to troubleshoot issues encountered with Enhanced Security Key Management."}),"\n",(0,i.jsx)(n.h3,{id:"events-and-alarms",children:"Events and Alarms"}),"\n",(0,i.jsxs)(n.p,{children:["The following alarms are generated by the router on any certificate it owns if the certificate is invalid, expired, or if the router is unable to authenticate the peer. Use the ",(0,i.jsx)(n.code,{children:"show alarms"})," command to see details about the alarm."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Expiring within a month (Minor)"}),"\n",(0,i.jsx)(n.li,{children:"Expiring within a week (Major)"}),"\n",(0,i.jsx)(n.li,{children:"Expired (Critical)"}),"\n",(0,i.jsx)(n.li,{children:"Revoked (Critical)"}),"\n",(0,i.jsx)(n.li,{children:"Unable to Authenticate Peer"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The following is an example of an alarm generated if the certificate state is invalid:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"=============== ===================== ============ ==================== ================ ======================================================================== \n\n      ID              Time              Severity    Source              Category        Message \n\n=============== ===================== ============ ==================== ================ ======================================================================== \n\ncombo-east-1:4   2025-01-28 19:07:00   MAJOR       INTERFACE                                DHCP address for interface [wan-intf] has not been resolved \ncombo-east-1:5   2025-01-28 19:07:00   MAJOR       INTERFACE                                DHCP address for interface [lan-intf] has not been resolved \ncombo-east-1:13  2025-01-28 19:12:21   CRITICAL    RTR_WEST_COMBO           PEER            Peer RTR_WEST_COMBO certificate is invalid: expired - testing-detail \n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"admin@combo-east-1.RTR_EAST_COMBO# show alarms id combo-east-1:13 \nTue 2025-01-28 19:17:39 UTC \n\u2714 Retrieving alarms... \n============================================================================================ \ncombo-east-1:13 \n============================================================================================ \nTime: 2025-01-28 19:12:21 \nSeverity: CRITICAL \nSource: RTR_WEST_COMBO \nCategory: PEER \nProcess: stateMonitor \nMessage: Peer RTR_WEST_COMBO certificate is invalid: expired - testing-detail \nCompleted in 0.02 seconds \n"})}),"\n",(0,i.jsx)(n.h3,{id:"show-commands",children:"Show Commands"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"show security key-status"})," provides the following additional information:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"metadata rekey index"})," - Index of the current rekey interval."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"metadata last rekey"})," - Number of seconds since the last rekey occurred."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"metadata next rekey"})," - Number of seconds until the next rekey occurs."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"metadata manager status"})," - Indicates whether the current node is Active-Leader or Redundant-Peer, or displays inactive when the feature is not enabled."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"                ================================================\n                 N1\n                ================================================\n                  Key Manager State:        Active Leader\n                  Rekey Index:              189000\n                  Last Rekey:               0 hrs 20 min 24 sec\n                  Next Rekey:               1 hrs 2 min 56 sec\n                  Key Change Count:         5\n                  Config Key Change Count:  2\n                  Key Change Error:         key error\n                  Config Key Change Error:  config error\n                  Metadata Rekey Index:     199000\n                  Metadata Last Rekey:      0 hrs 20 min 25 sec\n                  Metadata Next Rekey:      1 hrs 2 min 57 sec\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"show peers security"})," includes the following information:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Security state machine state"}),"\n",(0,i.jsx)(n.li,{children:"Local salt value"}),"\n",(0,i.jsx)(n.li,{children:"Peer salt value"}),"\n",(0,i.jsx)(n.li,{children:"Local metadata key index"}),"\n",(0,i.jsx)(n.li,{children:"Peer metadata key index"}),"\n",(0,i.jsx)(n.li,{children:"Whether a peer\u2019s certificate has been received"}),"\n",(0,i.jsx)(n.li,{children:"Whether a local certificate has been acknowledged by peer"}),"\n",(0,i.jsx)(n.li,{children:"Whether a peer\u2019s salt has been received"}),"\n",(0,i.jsx)(n.li,{children:"Whether a local salt has been acknowledged by peer"}),"\n",(0,i.jsx)(n.li,{children:"Whether a peer\u2019s metadata key has been received"}),"\n",(0,i.jsx)(n.li,{children:"Whether a local metadata key has been acknowledged by peer"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"admin@test1.headend# show peers security\nMon 2025-07-21 20:28:18 UTC\n\u2714 Retrieving peer paths...\n\n==============\n Peer: branch\n==============\n  Peer:               branch\n  Node:               test1\n  Network Interface:  intf11\n  Destination:        172.16.4.5\n  Status:             up\n  Hostname:           unavailable\n  Path Mtu:           unavailable\n  Security Status:    MKEY_EXCH_COMP\n  Salt:               3565600980\n  Peer Salt:          1668479739\n  Key Index:          5\n  Peer Ki:            253\n  Cert Rec:           True\n  Cert Ack:           True\n  Salt Rec:           True\n  Salt Ack:           True\n  Key Rec:            True\n  Key Ack:            True\n\n\n==============\n Peer: branch\n==============\n  Peer:               branch\n  Node:               test1\n  Network Interface:  intf12\n  Destination:        172.16.4.7\n  Status:             up\n  Hostname:           unavailable\n  Path Mtu:           unavailable\n  Security Status:    MKEY_EXCH_COMP\n  Salt:               3565600980\n  Peer Salt:          1668479739\n  Key Index:          5\n  Peer Ki:            253\n  Cert Rec:           True\n  Cert Ack:           True\n  Salt Rec:           True\n  Salt Ack:           True\n  Key Rec:            True\n  Key Ack:            True\n\nCompleted in 0.10 seconds\nadmin@test1.headend#\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"show security security-associations"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"admin@node0# show security security-associations\nFri 2024-03-01 14:28:03 UTC Retrieving security associations...\n============== =========== ======= =================== ================ ======== \n Peer           Peer Name   Node    Network Interface   Destination      Status\n============== =========== ======= =================== ================ ======== \n 0200019a8f31   Hub1        node0   ge-0-0              192.168.10.101   up\n 0200019a8f31   Hub1        node0   ge-0-1              172.25.22.2      up\n 0200019a8f31   Hub1        node1   ge-0-0              192.168.10.101   up\n 0200019a8f31   Hub1        node1   ge-0-1              172.25.22.2      up\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"show security security-associations [peer-name] detail"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"admin@node0# show security security-associations Hub1 detail\nFri 2024-03-01 14:28:03 UTC Retrieving security associations...\nPeer Name: Hub1\nState: UP\nPeer Certificate: Valid\nPublic Key: Valid\nLocal salt: b869b3424513340a, Remote salt: 4cb3488cb19397c3\nPeer Key Rekey In: 20 hrs 2 min 56 sec\nPeer Rekey Count: 5\nMetadata Key Rekey In: 2 hrs 13 min 12 sec\nLocal Metadata Key Index: 12 (2), Remote Metadata Key Index: 13 (1)\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},67209:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/conductor-behind-svrv2-315092e4b081154561ce01badfcb99ea.png"},28618:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hub-n-spoke-svrv2-03ab9166b436836cd7b4eeef8aed3692.png"},3538:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/svr-ztna-key-exchange-c14417858c2c7985c0fec64d481ea1f6.png"},23016:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/ztna-sample-topo-665a52b75727f5c0e25b2ea2733f8eb4.png"},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(96540);const r={},a=i.createContext(r);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);