"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[2867],{5092:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var s=n(74848),r=n(28453);const i={title:"Change in behavior for Salt states for 5.6.16+, 6.1.12+, 6.2.8+, 6.3.x-r2+",date:new Date("2024-11-06T00:00:00.000Z"),tags:["saltstack, sip-alg"],hide_table_of_contents:!1},a=void 0,o={permalink:"/kb/2024/11/06/PLUGIN-2776",source:"@site/kb/2024-11-06-PLUGIN-2776.md",title:"Change in behavior for Salt states for 5.6.16+, 6.1.12+, 6.2.8+, 6.3.x-r2+",description:"In some cases, Salt states fail to be applied on routers after an upgrade to 5.6.16+, 6.1.12+, 6.2.8+, and 6.3.x-r2+. This will impact any salt states that rely on the CentOS name to detect or conditionally perform operations on the SSR.",date:"2024-11-06T00:00:00.000Z",formattedDate:"November 6, 2024",tags:[{label:"saltstack, sip-alg",permalink:"/kb/tags/saltstack-sip-alg"}],hasTruncateMarker:!0,authors:[],frontMatter:{title:"Change in behavior for Salt states for 5.6.16+, 6.1.12+, 6.2.8+, 6.3.x-r2+",date:"2024-11-06T00:00:00.000Z",tags:["saltstack, sip-alg"],hide_table_of_contents:!1},unlisted:!1,prevItem:{title:"IPSec algorithms dh2 (modp1024) and dh22 are being deprecated",permalink:"/kb/2024/12/12/PLUGIN-2835"},nextItem:{title:"Unable to upgrade second HA Conductor to 6.3.0",permalink:"/kb/2024/08/30/I95-56628"}},l={authorsImageUrls:[]},d=[{value:"Problem",id:"problem",level:3},{value:"Release Notes",id:"release-notes",level:3},{value:"Severity",id:"severity",level:3},{value:"Status",id:"status",level:3},{value:"Resolved In",id:"resolved-in",level:3},{value:"Product",id:"product",level:3},{value:"Functional Area",id:"functional-area",level:3},{value:"Workaround",id:"workaround",level:3},{value:"Example Remediation",id:"example-remediation",level:4}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["In some cases, Salt states fail to be applied on routers after an upgrade to 5.6.16+, 6.1.12+, 6.2.8+, and 6.3.x-r2+. This will impact any salt states that rely on the ",(0,s.jsx)(t.code,{children:"CentOS"})," name to detect or conditionally perform operations on the SSR."]}),"\n",(0,s.jsxs)(t.p,{children:["For example, the following ",(0,s.jsx)(t.code,{children:"top.sls"})," would be impacted:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"base:\n  '*':\n    - dummy\n\n  'os:CentOS':\n    - match: grain\n    - centos_example\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Issue ID:"})," PLUGIN-2776"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Last Updated:"})," 2024-11-06"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Introduced in SSR Version:"})," 5.6.16, 6.1.12, 6.2.8, 6.3.x-r2"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Impacted Plugin version:"})," 128T-sip-alg-4.0.1 and below"]}),"\n",(0,s.jsx)(t.h3,{id:"problem",children:"Problem"}),"\n",(0,s.jsx)(t.p,{children:"The SSR is migrating the underlying Linux distribution in an effort to remain agile and to reduce the surface area of CVEs."}),"\n",(0,s.jsxs)(t.p,{children:["Because the OS version is now reported as ",(0,s.jsx)(t.code,{children:"Oracle Linux"})," instead of ",(0,s.jsx)(t.code,{children:"CentOS"}),", there is an impact to the SIP ALG plugin, as well as any packages that may have an OS dependency, such as SaltStack."]}),"\n",(0,s.jsxs)(t.p,{children:["Once a router is upgraded to SSR version 5.6.16+ or 6.1.12+, the 128T-SIP-ALG plugin version 4.0.1 (or earlier) is impacted by this issue. To avoid this issue, ",(0,s.jsx)(t.strong,{children:"the plugin must be upgraded to 4.0.2 before upgrading the SSR"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["For customer deployments implementing custom salt states that leverage OS-specific salt grains for ",(0,s.jsx)(t.code,{children:"CentOS Linux 7"}),", those salt states may fail to apply after upgrading to 5.6.16+ and 6.1.12+."]}),"\n",(0,s.jsxs)(t.p,{children:["Please see the ",(0,s.jsx)(t.a,{href:"#workaround",children:"workaround"})," for steps to determine whether your environment is impacted and to remediate the issue."]}),"\n",(0,s.jsx)(t.h3,{id:"release-notes",children:"Release Notes"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Resolved the salt state issues for the SIP ALG plugin."}),"\n",(0,s.jsx)(t.li,{children:"Use the Workaround procedure below to scan salt states prior to Conductor and Router upgrades."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"severity",children:"Severity"}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)(t.p,{children:"The potential impact of a software defect if encountered. Severity levels are:"}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system."}),"\n",(0,s.jsx)(t.li,{children:"Major: Could seriously affect system operation, maintenance, administration and related tasks."}),"\n",(0,s.jsx)(t.li,{children:"Minor: Would not significantly impair the functioning or affect service."}),"\n"]})]}),"\n",(0,s.jsx)(t.p,{children:"Major"}),"\n",(0,s.jsx)(t.h3,{id:"status",children:"Status"}),"\n",(0,s.jsx)(t.p,{children:"In Progress"}),"\n",(0,s.jsx)(t.h3,{id:"resolved-in",children:"Resolved In"}),"\n",(0,s.jsx)(t.p,{children:"128T-sip-alg-4.0.2"}),"\n",(0,s.jsx)(t.h3,{id:"product",children:"Product"}),"\n",(0,s.jsx)(t.p,{children:"SSR Routers"}),"\n",(0,s.jsx)(t.h3,{id:"functional-area",children:"Functional Area"}),"\n",(0,s.jsx)(t.p,{children:"SaltStack"}),"\n",(0,s.jsx)(t.h3,{id:"workaround",children:"Workaround"}),"\n",(0,s.jsx)(n,{children:(0,s.jsx)(t.p,{children:"Juniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues."})}),"\n",(0,s.jsx)(t.p,{children:"Salt states are configuration files used to deploy and manage extensible behaviors on the SSR routers via the salt-minion. They are used by the product to implement certain features, by plugins, and in some cases, to implement customer specific use-cases not otherwise supported by the SSR."}),"\n",(0,s.jsx)(t.p,{children:"For customers that implement custom salt states, use the following procedure to scan your salt states and identify issues that could arise during or after an upgrade."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Log in to the Conductor CLI as the admin user."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Enter the linux shell; type ",(0,s.jsx)(t.code,{children:"shell"})," to suspend the CLI."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Run the following command to scan the custom salt states for ",(0,s.jsx)(t.code,{children:"Centos 7"}),":"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.code,{children:"grep -riE 'cent[-]?os' /srv/salt"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"If the above command returns no hits, none of the custom salt states leverage the OS specific salt grain features."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"There exists a possibility that a custom salt state is impacted despite the scan returning an empty result. In this case, please contact your Juniper support representative for support on the matter."})}),"\n",(0,s.jsxs)(t.ol,{start:"5",children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"If the above command results in non-empty output, remediate the salt states to be OS agnostic."}),"\n",(0,s.jsx)(t.p,{children:"The exact changes will depend on the business logic of the salt state. Customers should work with their subject matter experts to properly remediate and test any changes."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"example-remediation",children:"Example Remediation"}),"\n",(0,s.jsx)(t.p,{children:"Salt state found during scan:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"{% set defaults = salt['grains.filter_by']({\n    'CentOS Linux-7': {\n        'network_routes_target_filedir': '/etc/sysconfig/network-scripts/route-',\n    },\n}, grain='osfinger', merge=salt['pillar.get']('repo_map:merge'), base=None) %}\n"})}),"\n",(0,s.jsx)(t.p,{children:"The remediated salt state:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"{% set defaults = {\n    'network_routes_target_filedir': '/etc/sysconfig/network-scripts/route-',\n    }\n%}\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(96540);const r={},i=s.createContext(r);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);