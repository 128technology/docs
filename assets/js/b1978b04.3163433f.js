"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[8162],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return f}});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var d=a.createContext({}),s=function(e){var n=a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=s(e.components);return a.createElement(d.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,d=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(t),f=i,m=u["".concat(d,".").concat(f)]||u[f]||c[f]||r;return t?a.createElement(m,o(o({ref:n},p),{},{components:t})):a.createElement(m,o({ref:n},p))}));function f(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var l={};for(var d in n)hasOwnProperty.call(n,d)&&(l[d]=n[d]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},38916:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return d},default:function(){return f},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return c}});var a=t(87462),i=t(63366),r=(t(67294),t(3905)),o=["components"],l={title:"Link Aggregation and LACP",sidebar_label:"Link Aggregation and LACP"},d=void 0,s={unversionedId:"config_lacp",id:"config_lacp",title:"Link Aggregation and LACP",description:"This feature is currently in Beta. Support for LAG has been added for a limited number of use cases. Please refer to the Caveats section for details.",source:"@site/docs/config_lacp.md",sourceDirName:".",slug:"/config_lacp",permalink:"/docs/config_lacp",draft:!1,tags:[],version:"current",lastUpdatedAt:1693421765,formattedLastUpdatedAt:"Aug 30, 2023",frontMatter:{title:"Link Aggregation and LACP",sidebar_label:"Link Aggregation and LACP"},sidebar:"docs",previous:{title:"Multicast",permalink:"/docs/config_multicast"},next:{title:"Dual Node High Availability",permalink:"/docs/config_ha"}},p={},c=[{value:"How It Works",id:"how-it-works",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Supported Platforms",id:"supported-platforms",level:3},{value:"Caveats",id:"caveats",level:3},{value:"Configuring LAG and LACP",id:"configuring-lag-and-lacp",level:2},{value:"Configuration using the PCLI",id:"configuration-using-the-pcli",level:3},{value:"Configuration Using the GUI",id:"configuration-using-the-gui",level:3},{value:"Configuring LLDP",id:"configuring-lldp",level:3},{value:"Show Commands",id:"show-commands",level:3}],u={toc:c};function f(e){var n=e.components,l=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},u,l,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{type:"important"},(0,r.kt)("p",{parentName:"admonition"},"This feature is currently in Beta. Support for LAG has been added for a limited number of use cases. Please refer to the ",(0,r.kt)("a",{parentName:"p",href:"#caveats"},"Caveats")," section for details.")),(0,r.kt)("p",null,"A Link Aggregation Group (LAG) enables the grouping Ethernet interfaces to form a single link layer interface. LAGs are formed by connecting multiple ports in parallel between two devices. As more links are added between the two devices, bandwidth expands. Traffic is automatically load-balanced, and in a network failure scenario, there is link-level redundancy. "),(0,r.kt)("p",null,"LACP is the protocol that defines how the group of interfaces operates. LACP enables dynamic LAG, allowing the exchange of information between the members of the LAG network, monitoring bundle endpoints, and adding or removing new or unused individual links.  "),(0,r.kt)("p",null,"A Link Aggregation Group (LAG) that does not have LACP enabled operates as a static LAG, where the interfaces do not communicate state information."),(0,r.kt)("p",null,"For a deeper look at LAG and LACP, see ",(0,r.kt)("a",{parentName:"p",href:"https://www.juniper.net/documentation/us/en/software/junos/interfaces-ethernet-switches/topics/topic-map/switches-interface-aggregated.html"},"Aggregated Ethernet Interfaces"),"."),(0,r.kt)("h2",{id:"how-it-works"},"How It Works"),(0,r.kt)("p",null,"The LAG is created by defining a device interface as a ",(0,r.kt)("inlineCode",{parentName:"p"},"bond"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"bond")," interface is configured with a network-interface. Members of the ",(0,r.kt)("inlineCode",{parentName:"p"},"bond")," are configured as ethernet device interfaces, and have the ",(0,r.kt)("inlineCode",{parentName:"p"},"parent-bond")," setting defined as the ",(0,r.kt)("inlineCode",{parentName:"p"},"bond")," device interface. ",(0,r.kt)("inlineCode",{parentName:"p"},"bond")," members (the device interfaces) are not allowed to be configured with their own network-interfaces."),(0,r.kt)("h3",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"LAG/LACP has the following requirements:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"LAG/LACP must be configured on the devices on each end of the link."),(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," must have between 1 and 8 members. Members are device-interfaces that reference the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," interface as their ",(0,r.kt)("inlineCode",{parentName:"li"},"parent-bond"),"."),(0,r.kt)("li",{parentName:"ul"},"All members of the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," must be of the type ",(0,r.kt)("inlineCode",{parentName:"li"},"ethernet"),"."),(0,r.kt)("li",{parentName:"ul"},"All members of the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," must be the same speed and support full duplex.")),(0,r.kt)("h3",{id:"supported-platforms"},"Supported Platforms"),(0,r.kt)("p",null,"LAG is currently supported on the following platforms:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"SSR120"),(0,r.kt)("li",{parentName:"ul"},"SSR130")),(0,r.kt)("h3",{id:"caveats"},"Caveats"),(0,r.kt)("p",null,"The following caveats have been identified:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Dynamic reconfiguration is supported for changing LACP settings on the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," device, however adding or removing bonds and/or bond members from the LAG is not currently supported. Any time these changes are made, you must restart the 128T service."),(0,r.kt)("li",{parentName:"ul"},"High Availability has not been fully tested, and may not be fully functional. ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"VRRP with LAG is not supported"),(0,r.kt)("li",{parentName:"ul"},"Shared physical addresses are not allowed.")))),(0,r.kt)("h2",{id:"configuring-lag-and-lacp"},"Configuring LAG and LACP"),(0,r.kt)("p",null,"LACP is enabled by default on the ",(0,r.kt)("inlineCode",{parentName:"p"},"bond")," device interface, and must be configured on each end of the link. The following device interface configuration shows a ",(0,r.kt)("inlineCode",{parentName:"p"},"bond")," interface and ",(0,r.kt)("inlineCode",{parentName:"p"},"lacp-enabled")," as true (default). The interfaces that are part of the LAG are configured as ethernet interfaces and the ",(0,r.kt)("inlineCode",{parentName:"p"},"parent-bond")," is identified as the name of the ",(0,r.kt)("inlineCode",{parentName:"p"},"bond")," interface. "),(0,r.kt)("p",null,"Please note that after any changes to the LAG configuration, you must restart the 128T service. "),(0,r.kt)("h3",{id:"configuration-using-the-pcli"},"Configuration using the PCLI"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create the LAG by configuring the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," device-interface.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Name the interface"),(0,r.kt)("li",{parentName:"ul"},"Set the ",(0,r.kt)("inlineCode",{parentName:"li"},"type")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"lacp-enable")," is enabled by default")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"              device-interface  bond0\n                    name               bond0\n                    type               bond\n\n                    bond-settings\n                        lacp-enable  true\n                    exit  \n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Configure the network interface used by the LAG.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"                    network-interface  bond-nw\n                        name       bond-nw\n                        global-id  1\n                        tenant     red\n\n                        address    1.1.1.1\n                            ip-address     1.1.1.1\n                            prefix-length  24\n                            gateway        1.1.1.100\n                        exit\n                    exit\n             exit\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Configure at least one device interface to be part of the LAG.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Be sure to configure the ",(0,r.kt)("inlineCode",{parentName:"li"},"parent-bond")," with the device name of the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," interface."),(0,r.kt)("li",{parentName:"ul"},"The only configuration allowed on the bond-members are ",(0,r.kt)("inlineCode",{parentName:"li"},"pci-address")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"parent-bond"),". All other settings must be configured on the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," interface.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"             device-interface  ge-0-1\n                    name         ge-0-1\n                    type         ethernet\n                    pci-address  0000:04:00.0\n                    parent-bond  bond0\n             exit\n\n             device-interface  ge-0-0\n                    name         ge-0-0\n                    type         ethernet\n                    pci-address  0000:04:00.1\n                    parent-bond  bond0\n             exit\n")),(0,r.kt)("h3",{id:"configuration-using-the-gui"},"Configuration Using the GUI"),(0,r.kt)("p",null,"These same settings are accessed from the GUI at the Authority > Router > Node > Device Interface level. "),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create the LAG by configuring the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," device-interface.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Name the interface"),(0,r.kt)("li",{parentName:"ul"},"Set the ",(0,r.kt)("inlineCode",{parentName:"li"},"type")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"lacp-enable")," is enabled by default")))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Configuring the Bond Interface",src:t(67489).Z,width:"2160",height:"940"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Configure the network interface used by the LAG.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Configure the Network Interface",src:t(64990).Z,width:"2086",height:"1080"})),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Configure at least one device interface to be part of the LAG.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Be sure to configure the ",(0,r.kt)("inlineCode",{parentName:"li"},"parent-bond")," with the device name of the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," interface."),(0,r.kt)("li",{parentName:"ul"},"The only configuration allowed on the bond-members are ",(0,r.kt)("inlineCode",{parentName:"li"},"pci-address")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"parent-bond"),". All other settings must be configured on the ",(0,r.kt)("inlineCode",{parentName:"li"},"bond")," interface.")))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Configure LAG devices",src:t(89719).Z,width:"1066",height:"1896"})),(0,r.kt)("h3",{id:"configuring-lldp"},"Configuring LLDP"),(0,r.kt)("p",null,"LLDP allows other devices in the network to discover the SSR. It is not required for LAG, but when enabled it provides information about the LAG interface in the network. It should be noted that when enabled as part of LAG, it is configured for the entirety of the ",(0,r.kt)("inlineCode",{parentName:"p"},"bond"),", not on the individual interfaces within the group. For additional information about using the LLDP command, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/config_reference_guide#lldp"},(0,r.kt)("inlineCode",{parentName:"a"},"lldp"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"              device-interface  bond0\n                    name               bond0\n                    type               bond\n                    bond-settings\n                        lacp-enable  true\n                    exit\n                    lldp mode        enabled\n                    exit\n            exit         \n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Configuring LLDP mode",src:t(73203).Z,width:"2084",height:"1100"})),(0,r.kt)("h3",{id:"show-commands"},"Show Commands"),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"show device-interface name <name>")," command to troubleshoot or view the status of the LAG/LACP interface."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"admin@sn2028220232.router# show device-interface name bond0\nMon 2023-06-26 19:03:32 UTC\nRetrieving device interface information...\n\n=======================================================================================================\n sn2028220232:bond0\n=======================================================================================================\n Type:                bond\n Forwarding:          true\n MAC Address:         90:ec:77:32:e3:f6\n\n Admin Status:        up\n Operational Status:  up\n Provisional Status:  up\n Redundancy Status:   non-redundant\n Speed:               2 Gb/s\n Duplex:              full\n\n in-octets:                    73018210\n in-unicast-pkts:                 86729\n in-errors:                           0\n out-octets:                    5611232\n out-unicast-pkts:                45281\n out-errors:                          0\n\n Bond Information:\n   mode:                       LACP\n   device_port:                1\n   dpdk_port:                  3\n   member_count:               2\n   active_members:             2\n   xmit_policy:                LAYER34\n   bond_members:\n       aggregator_port_id:     1\n       selection:              SELECTED\n       actor_detail_info:\n        system_priority:      65535\n         system_mac_address:   90:ec:77:32:e3:f6\n         port_key:             17\n         port_priority:        255\n         port_number:          2\n         port_state:           ACTIVE, TIMEOUT, AGGREGATION, SYNCHRONIZATION, COLLECTING, DISTRIBUTING\n       partner_detail_info:\n         system_priority:      127\n         system_mac_address:   88:0a:a3:e6:5d:d4\n         port_key:             1\n         port_priority:        127\n         port_number:          1\n         port_state:           ACTIVE, TIMEOUT, AGGREGATION, SYNCHRONIZATION, COLLECTING, DISTRIBUTING\n       aggregator_port_id:     1\n       selection:              SELECTED\n       actor_detail_info:\n         system_priority:      65535\n         system_mac_address:   90:ec:77:32:e3:f5\n         port_key:             17\n         port_priority:        255\n         port_number:          1\n         port_state:           ACTIVE, TIMEOUT, AGGREGATION, SYNCHRONIZATION, COLLECTING, DISTRIBUTING\n       partner_detail_info:\n         system_priority:      127\n         system_mac_address:   88:0a:a3:e6:5d:d4\n         port_key:             1\n         port_priority:        127\n         port_number:          2\n         port_state:           ACTIVE, TIMEOUT, AGGREGATION, SYNCHRONIZATION, COLLECTING, DISTRIBUTING\n\n\n Plugin Info:         unavailable\n\nCompleted in 0.18 seconds\n\n\n")))}f.isMDXComponent=!0},67489:function(e,n,t){n.Z=t.p+"assets/images/config_lacp_bond-ff176107c84562222564005232136d04.png"},89719:function(e,n,t){n.Z=t.p+"assets/images/config_lacp_dev-inf-parent-bond-afb19c5262f07fc2828cf1aae439dffb.png"},64990:function(e,n,t){n.Z=t.p+"assets/images/config_lacp_network-intf-bond-802042de65cd09e94dc73209408ee49c.png"},73203:function(e,n,t){n.Z=t.p+"assets/images/config_lldp_lacp-51004b03c300bf9e9f9861eb8cb51bd0.png"}}]);