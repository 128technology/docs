"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[5110],{3905:function(e,t,i){i.d(t,{Zo:function(){return p},kt:function(){return u}});var n=i(67294);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var s=n.createContext({}),c=function(e){var t=n.useContext(s),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var i=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(i),u=a,f=m["".concat(s,".").concat(u)]||m[u]||d[u]||r;return i?n.createElement(f,o(o({ref:t},p),{},{components:i})):n.createElement(f,o({ref:t},p))}));function u(e,t){var i=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=i.length,o=new Array(r);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<r;c++)o[c]=i[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}m.displayName="MDXCreateElement"},93995:function(e,t,i){i.r(t),i.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var n=i(87462),a=i(63366),r=(i(67294),i(3905)),o=["components"],l={title:"Rate Limiting"},s=void 0,c={unversionedId:"config_rate_limiting",id:"config_rate_limiting",title:"Rate Limiting",description:"Rate limiting, when configured, is applied to packets entering the data path prior to any packet transformations so as to prevent an individual flow from consuming more bandwidth than allowed.",source:"@site/docs/config_rate_limiting.md",sourceDirName:".",slug:"/config_rate_limiting",permalink:"/docs/config_rate_limiting",draft:!1,tags:[],version:"current",lastUpdatedAt:1702560058,formattedLastUpdatedAt:"Dec 14, 2023",frontMatter:{title:"Rate Limiting"},sidebar:"docs",previous:{title:"NAT",permalink:"/docs/config_nat"},next:{title:"Configuring Role-Based Access Control",permalink:"/docs/config_RBAC"}},p={},d=[{value:"Per-Flow Rate Limiting",id:"per-flow-rate-limiting",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Per-Service Rate Limiting",id:"per-service-rate-limiting",level:2},{value:"Configuration",id:"configuration-1",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Caveats",id:"caveats",level:3}],m={toc:d};function u(e){var t=e.components,i=(0,a.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Rate limiting, when configured, is applied to packets entering the data path prior to any packet transformations so as to prevent an individual flow from consuming more bandwidth than allowed."),(0,r.kt)("h2",{id:"per-flow-rate-limiting"},"Per-Flow Rate Limiting"),(0,r.kt)("p",null,'The SSR has the ability to apply rate limiting to individual flows within a session for a service. This provides the ability to ensure that each flow to and from a service conforms to a specific "shape".  This can be particularly useful if the sessions of a service are used for high bandwidth applications such as downloading or uploading content.  Each flow can be restricted to use only a specific amount of bandwidth. This capability in turn can be used to limit the amount of traffic egressing the SSR, regulating the traffic entering the traffic scheduler.'),(0,r.kt)("p",null,"Individual flow rate limiting, can prevent bad actors and lead to a more desirable overall system performance. Accurate rate limiting can be a bit of an art to configure properly per flow, as it is highly dependent on the application."),(0,r.kt)("h3",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Rate limiting can be configured for a particular service, by way of its associated service-class and is applied individually to each flow."),(0,r.kt)("p",null,"There are two parameters that affect the shape of a flow:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"max-flow-rate")," defined in bits/second, regulates the average rate of traffic.",(0,r.kt)("admonition",{parentName:"li",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Rate is calculated on a interval relative to the arrival of flows. Some bursts may appear, but not greater than the configured ",(0,r.kt)("inlineCode",{parentName:"p"},"max-burst-rate")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"max-flow-burst")," defined in bits/seconds, serves to minimize bursts of traffic within a flow.")),(0,r.kt)("p",null,"Sample configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"service-class   rate-policy-class\n    name                         rate-policy-class\n    rate-limit                   true\n    max-flow-rate                100000\n    max-flow-burst               100000\nexit\n\nservice-policy  shaped-service-policy\n    name           shaped-service-policy\n    service-class  rate-policy-class\nexit\n\nservice         shaped-service\n    name            shaped-service\n    service-policy  shaped-service-policy\nexit\n")),(0,r.kt)("p",null,"This example will limit bursts as well as the bandwidth per flow to 100Kbps."),(0,r.kt)("h2",{id:"per-service-rate-limiting"},"Per-Service Rate Limiting"),(0,r.kt)("p",null,"Rate limiting per service affords the administrator the ability to configure the maximum aggregate incoming bandwidth allowed for a service. ",(0,r.kt)("a",{parentName:"p",href:"/docs/concepts_glossary#services"},"Services"),", being a global construct, can be applied across all routers. Each router therefore has the ability to define an individual policy, which can then be applied to the service directly on a specific router by leveraging ",(0,r.kt)("a",{parentName:"p",href:"/docs/bcp_service_and_service_policy_design#routerrouter-group-based-services"},"router-group")," syntax."),(0,r.kt)("p",null,"For example, in a hub and spoke topology, if a service is defined between an SSR located within a data center and all branch locations, the aggregate rate limit configured ",(0,r.kt)("em",{parentName:"p"},"locally")," on the data center router would be applied to all incoming traffic for this service entering the data center. No rate limiting will be applied at the branch sites."),(0,r.kt)("p",null,"For a service defined from a branch site to the data center, the aggregate rate limit would be applied at the branch site, using the locally defined rate limiting policy, and would not be applied at the data center."),(0,r.kt)("h3",{id:"configuration-1"},"Configuration"),(0,r.kt)("p",null,"Rate limiting policy can be defined in one of two ways:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"shared")," - the profile is shared across multiple services that have the profile defined in their ",(0,r.kt)("em",{parentName:"li"},"service-class"),", where all sessions that belong to all matching services get a slice of the bandwidth on a first-come first-serve basis."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"per-service")," - each service has its own rate-limiter, and the bandwidth is only shared across sessions that belong to that service. Multiple service-classes can use the same profile, but the bandwidth will not be shared across services.")),(0,r.kt)("p",null,"Since SSR services are directional, it is important to be able to control the direction in which the traffic is being rate-limited. For example, if the service being limited is a software update service and if the updates are being pushed, configuring the ",(0,r.kt)("inlineCode",{parentName:"p"},"upload-settings")," of the rate-limit profile will control the bandwidth of the incoming traffic. If the updates are being pulled, configuring the ",(0,r.kt)("inlineCode",{parentName:"p"},"download-settings")," will control the rate. Upload and download settings can be configured simultaneously."),(0,r.kt)("p",null,"Once the rate-limit-policy is defined, in order for it to be applied to a service, ",(0,r.kt)("inlineCode",{parentName:"p"},"aggregate-rate-limit-policy")," must be defined in the ",(0,r.kt)("inlineCode",{parentName:"p"},"service-class"),"."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"rate-limit")," field in a ",(0,r.kt)("inlineCode",{parentName:"p"},"service-class")," is only used when configuring ",(0,r.kt)("em",{parentName:"p"},"per-flow rate limiting"),", it is not necessary to set this to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," to enable ",(0,r.kt)("em",{parentName:"p"},"per-service rate limiting"),".")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Flow rate limiting and aggregate rate limiting can configured independently of each other. When both ",(0,r.kt)("inlineCode",{parentName:"p"},"rate-limit")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"aggregate-rate-limit-policy")," are enabled in the ",(0,r.kt)("inlineCode",{parentName:"p"},"service-class"),", flow rate limiting will be applied first, before aggregate rate limiting.")),(0,r.kt)("p",null,"Sample configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"rate-limit-policy    rate-limiting\n    name               rate-limiting\n    mode               shared\n    upload-settings\n        max-rate   300000\n        max-burst  300000\n    exit\n    download-settings\n        max-rate   300000\n        max-burst  300000\n    exit\nexit\n\nservice-class   rate-policy-class\n    name                         rate-policy-class\n    aggregate-rate-limit-policy  rate-limiting\nexit\n\nservice-policy  shaped-service-policy\n    name           shaped-service-policy\n    service-class  rate-policy-class\nexit\n\nservice         shaped-service\n    name            shaped-service\n    service-policy  shaped-service-policy\nexit\n\n")),(0,r.kt)("h3",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("p",null,"To determine the number of packets meeting the rate limit check, execute the command on the PCLI:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"show stats packet-processing action success rate-limit-check\n")),(0,r.kt)("p",null,"To determine the number of packets dropped as a result of exceeding flow rate check, execute the command on the PCLI:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"show stats packet-processing action failure rate-limit-check flow-rate-exceeded\n")),(0,r.kt)("p",null,"To determine the number of packets dropped as a result of exceeding shared flow rate check, execute the command on the PCLI:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"show stats packet-processing action failure rate-limit-check shared-rate-exceeded\n")),(0,r.kt)("h3",{id:"caveats"},"Caveats"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Enabling rate-limiting at a service level does have an impact on system performance and requires additional memory."),(0,r.kt)("li",{parentName:"ul"},"Using ",(0,r.kt)("em",{parentName:"li"},"rate-limit-policy")," in ",(0,r.kt)("em",{parentName:"li"},"shared")," mode on systems with multiple CPU cores where packet processing worker threads are provisioned on both cores will have a greater impact on system performance as locking is necessary to ensure consistency in aggregate calculations."),(0,r.kt)("li",{parentName:"ul"},"Shared rate limiting is shared across all sessions within an SSR node and is not shared across nodes of a HA pair."),(0,r.kt)("li",{parentName:"ul"},"Shared rate limiting is not shared across multiple routers processing sessions for the same service.")))}u.isMDXComponent=!0}}]);