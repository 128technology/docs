"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[5676],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),h=i,m=u["".concat(c,".").concat(h)]||u[h]||d[h]||a;return n?r.createElement(m,o(o({ref:t},p),{},{components:n})):r.createElement(m,o({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<a;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},77379:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return u}});var r=n(87462),i=n(63366),a=(n(67294),n(3905)),o=["components"],s={title:"Configuring Service and Topology Exchange Protocol (STEP)",sidebar_label:"Configuring STEP"},c=void 0,l={unversionedId:"config_STEP",id:"config_STEP",title:"Configuring Service and Topology Exchange Protocol (STEP)",description:"Use the information in this section to enable routers to connect to the STEP repository on the conductor and build their STEP documents. Additionally, information about configuring reporting parameters, and using the show commands to view STEP details is provided.",source:"@site/docs/config_STEP.md",sourceDirName:".",slug:"/config_STEP",permalink:"/docs/config_STEP",tags:[],version:"current",lastUpdatedAt:1673280982,formattedLastUpdatedAt:"1/9/2023",frontMatter:{title:"Configuring Service and Topology Exchange Protocol (STEP)",sidebar_label:"Configuring STEP"},sidebar:"docs",previous:{title:"Troubleshooting IDP",permalink:"/docs/ts_idp"},next:{title:"STEP High Availability",permalink:"/docs/config_step_ha"}},p=[{value:"Enable STEP",id:"enable-step",children:[{value:"Configuring Peer Path Advertisement Settings",id:"configuring-peer-path-advertisement-settings",children:[],level:3},{value:"Router District Settings",id:"router-district-settings",children:[],level:3},{value:"Hierarchical Services",id:"hierarchical-services",children:[{value:"Example",id:"example",children:[],level:4}],level:3},{value:"Route Computation",id:"route-computation",children:[],level:3}],level:2},{value:"Configurable Parameters",id:"configurable-parameters",children:[],level:2}],d={toc:p};function u(e){var t=e.components,s=(0,i.Z)(e,o);return(0,a.kt)("wrapper",(0,r.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Use the information in this section to enable routers to connect to the STEP repository on the conductor and build their STEP documents. Additionally, information about configuring reporting parameters, and using the show commands to view STEP details is provided. "),(0,a.kt)("h2",{id:"enable-step"},"Enable STEP"),(0,a.kt)("p",null,"The STEP repository is located on the Conductor, and the repository process runs by default. Use the ",(0,a.kt)("inlineCode",{parentName:"p"},"step-repo")," command to assign the IP Address for the repository on the conductor. The routers use this address to connect to the repository and build the STEP document. "),(0,a.kt)("p",null,"Use the following command to enable the STEP repository on the Conductor. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'config authority\n    step-repo 11.1.1.1\n        address 11.1.1.1\n        description "STEP Repository on the Conductor"\n    exit\n')),(0,a.kt)("p",null,"When STEP is enabled on an existing router, it is a best practice to clear all existing sessions so the routers begin using the STEP-based routes. This is especially important for EoSVR configurations, to prevent stuck flows and traffic from being dropped. Use the command ",(0,a.kt)("inlineCode",{parentName:"p"},"delete sessions service <service-name>")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"delete sessions service <eosvr-service-name>")," to clear sessions."),(0,a.kt)("p",null,"When configuring STEP repositories for high availability, the above configuration must be created on both repositories. See ",(0,a.kt)("a",{parentName:"p",href:"/docs/config_step_ha"},"STEP Repository High Availability")," for more information. "),(0,a.kt)("h3",{id:"configuring-peer-path-advertisement-settings"},"Configuring Peer Path Advertisement Settings"),(0,a.kt)("p",null,"The weighted moving average and reporting delay parameters can be configured per neighborhood:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"config\n  authority\n    router        NorthEast\n        node                  node1\n            device-interface          wan3\n                network-interface  wan3\n                    neighborhood           broadband\n\n                        step-peer-path-advertisement\n                            sla-metrics\n                                moving-average-sample-size  3\n\n                                significance-threshold\n                                    min-loss     0.1\n                                    min-latency  5\n                                    min-jitter   2\n                                exit\n\n                                increase-report-delay       1\n                                    percentage  1\n                                    delay       1800\n                                exit\n                                increase-report-delay       10\n                                    percentage  10\n                                    delay       240\n                                exit\n                                increase-report-delay       20\n                                    percentage  20\n                                    delay       150\n                                exit\n                                increase-report-delay       50\n                                    percentage  50\n                                    delay       30\n                                exit\n                                increase-report-delay       100\n                                    percentage  100\n                                    delay       15\n                                exit\n                                increase-report-delay       200\n                                    percentage  200\n                                    delay       1\n                                exit\n\n                                decrease-report-delay       1\n                                    percentage  1\n                                    delay       1800\n                                exit\n                                decrease-report-delay       10\n                                    percentage  10\n                                    delay       240\n                                exit\n                                decrease-report-delay       50\n                                    percentage  50\n                                    delay       15\n                                exit\n")),(0,a.kt)("p",null,"Any auto-generated adjacency in the neighborhood reflects the same configuration values:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"config\n  authority\n    router        NorthEast\n        node                  node1\n            device-interface          wan3\n                network-interface  wan3\n                    adjacency              10.0.3.23 West\n\n                        step-peer-path-advertisement\n                            sla-metrics\n                                moving-average-sample-size  3\n\n                                significance-threshold\n                                    min-loss     0.1\n                                    min-latency  5\n                                    min-jitter   2\n                                exit\n\n                                increase-report-delay       1\n                                    percentage  1\n                                    delay       1800\n                                exit\n                                increase-report-delay       10\n                                    percentage  10\n                                    delay       240\n                                exit\n                                increase-report-delay       20\n                                    percentage  20\n                                    delay       150\n                                exit\n                                increase-report-delay       50\n                                    percentage  50\n                                    delay       30\n                                exit\n                                increase-report-delay       100\n                                    percentage  100\n                                    delay       15\n                                exit\n                                increase-report-delay       200\n                                    percentage  200\n                                    delay       1\n                                exit\n\n                                decrease-report-delay       1\n                                    percentage  1\n                                    delay       1800\n                                exit\n                                decrease-report-delay       10\n                                    percentage  10\n                                    delay       240\n                                exit\n                                decrease-report-delay       50\n                                    percentage  50\n                                    delay       15\n                                exit\n")),(0,a.kt)("p",null,"Note that the effective values are those in the adjacency. The adjacency configuration may be auto-generated or manually configured. The values configured in the neighborhood have no direct effect on the router behavior, they only provide the input for instantiating adjacency objects."),(0,a.kt)("p",null,"If ",(0,a.kt)("inlineCode",{parentName:"p"},"moving-average-sample-size")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"significance-threshold")," is not configured, the default values will be used. Likewise, if ",(0,a.kt)("inlineCode",{parentName:"p"},"increase-report-delay")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"decrease-report-delay")," is not configured, the default configuration is in effect."),(0,a.kt)("h3",{id:"router-district-settings"},"Router District Settings"),(0,a.kt)("p",null,"The rate limit parameters for peer path SLA updates to the STEP router document can be configured for each router from within the default-district parameters:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"config\n    authority\n        router        NorthEast\n            district-settings     default-district\n                district-name                 default-district\n\n                step-peer-path-sla-metrics-advertisement\n                    update-rate-limit        180\n                    minimum-update-interval  30\n                    update-burst-size        2\n                exit\n            exit\n")),(0,a.kt)("p",null,"Only the default district parameters have any effect. If no ",(0,a.kt)("inlineCode",{parentName:"p"},"district-settings")," are configured, or if any of the ",(0,a.kt)("inlineCode",{parentName:"p"},"step-peer-path-advertisement")," values are not provided, the default values will be used."),(0,a.kt)("h3",{id:"hierarchical-services"},"Hierarchical Services"),(0,a.kt)("p",null,"It is possible to configure a child service that is only visible to a subset of routers in the authority. A router configured with the child service (and a local service-route that applies to it) may advertise the availability of this child service in its STEP router document."),(0,a.kt)("p",null,"A router without the child service visible in its configuration will calculate a STEP route for the service, but only if the parent service is available. The route calculation for the child service is based on the parent\u2019s service-policy. The resulting STEP route is visible via the ",(0,a.kt)("inlineCode",{parentName:"p"},"show step route")," command, but it is not used for forwarding because it is not installed in the FIB and load-balancer. "),(0,a.kt)("p",null,"Instead, the transit router forwards based on the parent\u2019s service-paths. This only works when the access tenant for the child service is also allowed in the parent\u2019s service configuration. "),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Sample Hierarchical Configuration",src:n(65573).Z})),(0,a.kt)("h4",{id:"example"},"Example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"config\n    authority\n        router Ingress\n            router-group BranchRouters\n        exit\n\n        router Egress\n            router-group BranchRouters\n            service-route InetServiceRoute\n                service-name inet\n                next-hop combo-west intf11\n                    vector net2\n                exit\n            exit\n        exit\n\n        router Transit\n        exit\n\n        service inet\n            scope private\n            transport udp\n                port-range 443\n                    start-port 443\n                exit\n            exit\n            address 0.0.0.0/0\n            access-policy red\n                permission allow\n            exit\n            service-policy InetServicePolicy\n        exit\n\n        service branch.inet\n            applies-to router-group\n                group-name BranchRouters\n            exit\n            address 172.16.2.201\n        exit\n\n        service-policy InetServicePolicy\n            vector mpls\n                priority 100\n            exit\n            vector lte\n                priority 500\n            exit\n            vector net2\n                priority 7\n            exit\n            session-resiliency revertible-failover\n        exit\n    exit\nexit\n")),(0,a.kt)("p",null,"The transit router has a STEP route for the child service ",(0,a.kt)("inlineCode",{parentName:"p"},"branch.inet")," but forwarding is performed based on the parent service ",(0,a.kt)("inlineCode",{parentName:"p"},"inet"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"admin@conductor-node-1.Conductor# show step routes router Transit\n============= ============= =================\n Node Name     Service       IP Prefix\n============= ============= =================\n transit       branch.inet   172.16.2.201/32\n transit       inet          0.0.0.0/0\n \nadmin@conductor-node-1.Conductor# show service-path router Transit node transit\n========= ================================ ====== =============== ============ =========== ======== ====== ====== ============= ========\n Service   Service-Route                    Type   Destination     Next-Hop     Interface   Vector   Cost   Rate   Capacity      State\n========= ================================ ====== =============== ============ =========== ======== ====== ====== ============= ========\n inet      __inet_0.0.0.0/0_Egress:egress   step   172.16.3.3/32   172.16.3.3   intf10      lte       500      0   0/unlimited   Up(Up)\n inet      __inet_0.0.0.0/0_Egress:egress   step   172.16.4.3/32   172.16.4.3   intf12      mpls      100      0   0/unlimited   Up(Up)\n \n")),(0,a.kt)("p",null,"The ingress router has both a STEP route, and ",(0,a.kt)("inlineCode",{parentName:"p"},"service-paths")," for the child service ",(0,a.kt)("inlineCode",{parentName:"p"},"branch.inet"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"admin@conductor-node-1.Conductor# show step routes router Ingress\n============ ============= =================\n Node Name    Service       IP Prefix\n============ ============= =================\n ingress      branch.inet   172.16.2.201/32\n ingress      inet          0.0.0.0/0\n \nadmin@conductor-node-1.Conductor# show fib router Ingress hierarchy-service-name inet\n==================== ====== ======= ======== ===== ============= ============ ======== ======\n IP Prefix            Port   Proto   Tenant   VRF   Service       Next Hops    Vector   Cost\n==================== ====== ======= ======== ===== ============= ============ ======== ======\n 0.0.0.0/0             443   UDP     red      -     inet          172.16.4.4   mpls      100\n                                                                  172.16.3.3   lte       500\n 172.16.2.201/32       443   UDP     red      -     branch.inet   172.16.4.4   mpls      100\n                                                                  172.16.3.3   lte       500\n\nadmin@conductor-node-1.Conductor# show service-path router Ingress node ingress\n============= ============================================= ====== =============== ============ =========== ======== ====== ====== ============= ========\n Service       Service-Route                                 Type   Destination     Next-Hop     Interface   Vector   Cost   Rate   Capacity      State\n============= ============================================= ====== =============== ============ =========== ======== ====== ====== ============= ========\n branch.inet   __branch.inet_172.16.2.201/32_Egress:egress   step   172.16.3.3/32   172.16.3.3   intf11      lte       500      0   0/unlimited   Up(Up)\n branch.inet   __branch.inet_172.16.2.201/32_Egress:egress   step   172.16.4.4/32   172.16.4.4   intf12      mpls      100      0   0/unlimited   Up(Up)\n inet          __inet_0.0.0.0/0_Egress:egress                step   172.16.3.3/32   172.16.3.3   intf11      lte       500      0   0/unlimited   Up(Up)\n inet          __inet_0.0.0.0/0_Egress:egress                step   172.16.4.4/32   172.16.4.4   intf12      mpls      100      0   0/unlimited   Up(Up)\n")),(0,a.kt)("h3",{id:"route-computation"},"Route Computation"),(0,a.kt)("p",null,"When STEP determines the best route to use, it takes the following information from the ",(0,a.kt)("inlineCode",{parentName:"p"},"service-policy")," into consideration.  "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Best Path Selection Criteria")," in the ",(0,a.kt)("inlineCode",{parentName:"p"},"service-policy")," selection options are now considered: vector and average-latency. MOS is not supported for STEP route computation. In releases prior to 5.6, STEP assumed the ",(0,a.kt)("inlineCode",{parentName:"p"},"vector")," value.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Path Quality Measure")," is considered during the STEP route computation when ",(0,a.kt)("strong",{parentName:"p"},"Service Level Agreement")," is enabled in the ",(0,a.kt)("inlineCode",{parentName:"p"},"service-policy")," (",(0,a.kt)("strong",{parentName:"p"},"Path Quality Filter")," is set to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"). Peer-paths that do not meet the SLA are penalized during the route computation. When the ",(0,a.kt)("strong",{parentName:"p"},"Use Best-Effort Paths")," is set to ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),", those peer-paths are not used at all."))),(0,a.kt)("h2",{id:"configurable-parameters"},"Configurable Parameters"),(0,a.kt)("p",null,"See ",(0,a.kt)("a",{parentName:"p",href:"/docs/config_reference_guide#step-peer-path-advertisement-adjacency"},(0,a.kt)("inlineCode",{parentName:"a"},"step-peer-path-advertisement (adjacency)"))," for configuration details. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"step peer path advertisement\n    sla-metrics\n        moving average sample size\n        significance threshold\n            min-loss\n            min-latency\n            min-jitter\n        increase report delay\n            percentage\n            delay\n        decrease-report-delay\n            percentage\n            delay\n")),(0,a.kt)("p",null,"See ",(0,a.kt)("a",{parentName:"p",href:"/docs/config_reference_guide#step-peer-path-advertisement-district"},(0,a.kt)("inlineCode",{parentName:"a"},"step-peer-path-advertisement (district)"))," for configuration details."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"district-settings\n    default-district\n    district-name\n    step-peer-path-sla-metrics-advertisement\n        update-rate-limit\n        minimum-update-interval\n        update-burst-size        \n")))}u.isMDXComponent=!0},65573:function(e,t,n){t.Z=n.p+"assets/images/config_step_hier_svcs-ed371501068ba7417395c0e01b41c313.png"}}]);