"use strict";(self.webpackChunk_128t_docs=self.webpackChunk_128t_docs||[]).push([[3202],{21697:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>a});var i=t(74848),s=t(28453);const r={title:"Highway stuck on startup when IPsec is enabled",date:new Date("2024-08-05T00:00:00.000Z"),tags:["ipsec-client-3.6.1"],hide_table_of_contents:!1},o=void 0,l={permalink:"/kb/2024/08/05/PLUGIN-2550",source:"@site/kb/2024-08-05-PLUGIN-2550.md",title:"Highway stuck on startup when IPsec is enabled",description:"Highway process can get stuck on startup due to DNS related race conditions for IPSec tunnels.",date:"2024-08-05T00:00:00.000Z",formattedDate:"August 5, 2024",tags:[{label:"ipsec-client-3.6.1",permalink:"/kb/tags/ipsec-client-3-6-1"}],hasTruncateMarker:!0,authors:[],frontMatter:{title:"Highway stuck on startup when IPsec is enabled",date:"2024-08-05T00:00:00.000Z",tags:["ipsec-client-3.6.1"],hide_table_of_contents:!1},unlisted:!1,nextItem:{title:"Memory Allocation Exception in Device Disabled Error output",permalink:"/kb/2024/06/25/I95-54838"}},c={authorsImageUrls:[]},a=[{value:"Problem",id:"problem",level:3},{value:"Release Notes",id:"release-notes",level:3},{value:"Severity",id:"severity",level:3},{value:"Status",id:"status",level:3},{value:"Resolved In",id:"resolved-in",level:3},{value:"Product",id:"product",level:3},{value:"Functional Area",id:"functional-area",level:3},{value:"Workaround",id:"workaround",level:3},{value:"Disable IPSec client",id:"disable-ipsec-client",level:4},{value:"Monitor and restart the IPSec controller",id:"monitor-and-restart-the-ipsec-controller",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Highway process can get stuck on startup due to DNS related race conditions for IPSec tunnels."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue ID:"})," PLUGIN-2550"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Last Updated:"})," 2024-08-05"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Introduced in Plugin Version:"})," 128T-ipsec-client-3.6.1"]}),"\n",(0,i.jsx)(n.h3,{id:"problem",children:"Problem"}),"\n",(0,i.jsx)(n.p,{children:"The IPSec client plugin (3.6.1) attempted to correct a run time race condition between IPSec tunnel starting before DNS was fully operational in the IPSec namespace. Two changes were made to resolve this issue:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"A verification step was added to ensure successful DNS resolution before starting IPsec tunnel."}),"\n",(0,i.jsx)(n.li,{children:"A watch dog service was added to monitor IPSec tunnel services and restart them every 30 seconds if not."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"During the initial boot process of a router with the IPSec plugin enabled, the WAN interfaces can take some time to fully come up, creating two interactions with the IPSec controller:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Each call to verify DNS resolution can take up to 6 mins 40 seconds to timeout since the network is unreachable."}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"During normal operation this verification process ranges from a few hundred milliseconds to a few seconds."})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The watchdog, in an attempt to start the failed IPsec tunnel service, initiates another verify DNS resolution API call."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Due to the delayed initialization of the WAN interfaces, the IPSec controller would get backed up with health-check tasks. This backlog prevented the forwarding plane from initializing the device interfaces. In the instance of the reproduction, there was a backlog of 9 hours before the API call from the forwarding plane could be processed. This was verified by letting the reproduction system stay in the stuck state for more than 9 hours. The device interfaces eventually updated the operational status of the Broadband interfaces."}),"\n",(0,i.jsx)(n.h3,{id:"release-notes",children:"Release Notes"}),"\n",(0,i.jsx)(n.p,{children:"Resolved the startup race condition by enforcing stricter default timeouts for DNS operations."}),"\n",(0,i.jsx)(n.h3,{id:"severity",children:"Severity"}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)(n.p,{children:"The potential impact of a software defect if encountered. Severity levels are:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system."}),"\n",(0,i.jsx)(n.li,{children:"Major: Could seriously affect system operation, maintenance, administration and related tasks."}),"\n",(0,i.jsx)(n.li,{children:"Minor: Would not significantly impair the functioning or affect service."}),"\n"]})]}),"\n",(0,i.jsx)(n.p,{children:"Major"}),"\n",(0,i.jsx)(n.h3,{id:"status",children:"Status"}),"\n",(0,i.jsx)(n.p,{children:"Resolved"}),"\n",(0,i.jsx)(n.h3,{id:"resolved-in",children:"Resolved In"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"/docs/plugin_ipsec_client#release-362",children:"IPSEC Client Plugin Release 3.6.2"})}),"\n",(0,i.jsx)(n.h3,{id:"product",children:"Product"}),"\n",(0,i.jsx)(n.p,{children:"SSR"}),"\n",(0,i.jsx)(n.h3,{id:"functional-area",children:"Functional Area"}),"\n",(0,i.jsx)(n.p,{children:"IPSec Client Plugin"}),"\n",(0,i.jsx)(n.h3,{id:"workaround",children:"Workaround"}),"\n",(0,i.jsx)(t,{children:(0,i.jsx)(n.p,{children:"Juniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues."})}),"\n",(0,i.jsx)(n.h4,{id:"disable-ipsec-client",children:"Disable IPSec client"}),"\n",(0,i.jsx)(n.p,{children:"While the issue does not happen in every environment, one option is to temporarily disable the IPSec plugin for planned reboot of devices."}),"\n",(0,i.jsx)(n.h4,{id:"monitor-and-restart-the-ipsec-controller",children:"Monitor and restart the IPSec controller"}),"\n",(0,i.jsx)(n.p,{children:"Once the system is in the problem state, the following steps can be performed from the linux shell to unblock the highway process:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"systemctl stop ipsec-controller"})}),"\n",(0,i.jsx)(n.li,{children:"Wait for the interfaces and peers over WAN interfaces to come up"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"touch /var/lib/128technology/plugins/ipsec/config.json"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This will restart the IPSec controller and other necessary services"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);