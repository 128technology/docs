(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{215:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return u}));var a=n(2),i=n(6),r=(n(0),n(222)),o={title:"LTE and Dual LTE Configuration",sidebar_label:"LTE and Dual LTE Configuration"},c={unversionedId:"howto_lte",id:"howto_lte",isDocsHomePage:!1,title:"LTE and Dual LTE Configuration",description:"History",source:"@site/docs/howto_lte.md",slug:"/howto_lte",permalink:"/docs/howto_lte",version:"current",lastUpdatedAt:1625019078,sidebar_label:"LTE and Dual LTE Configuration",sidebar:"docs",previous:{title:"Extending Web UI Navigation Bar",permalink:"/docs/howto_extend_gui_nav"},next:{title:"Configuring Dual PPPoE",permalink:"/docs/howto_config_PPPoE"}},l=[{value:"LTE Connectivity",id:"lte-connectivity",children:[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Hardware Identification",id:"hardware-identification",children:[]},{value:"Configuration",id:"configuration",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]}]},{value:"Special Considerations",id:"special-considerations",children:[]}],s={rightToc:l};function u(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h4",{id:"history"},"History"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Release"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Modification"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"4.3.3"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"This feature was introduced")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"5.0.0"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Enhanced for Dual LTE")))),Object(r.b)("h2",{id:"lte-connectivity"},"LTE Connectivity"),Object(r.b)("p",null,"LTE connectivity is a valuable means of providing an alternate path for multi-path routing; either as a primary path in locations that have no access to circuits or as a path of last resort in the event that the primary circuit has failed."),Object(r.b)("p",null,"Dual LTE support is valuable when connecting to two discrete wireless carriers where there is a need for an active/active LTE connection.  This is commonly used in remote ATMs or kiosks as a replacement for 56K DSL lines."),Object(r.b)("h3",{id:"prerequisites"},"Prerequisites"),Object(r.b)("p",null,"Of the many LTE modules on the market, 128 Technology has standardized on those modules that utilize QMI (Qualcomm MSM Interface Protocol)."),Object(r.b)("p",null,"When running with a single LTE module, there are no restrictions on how the adapter is connected within the hardware platform.  When running with two LTE cards, it is required that the second module be connected via USB interface over MiniPCIe, M.2 or even USB dongle."),Object(r.b)("h3",{id:"hardware-identification"},"Hardware Identification"),Object(r.b)("p",null,"In order to identify the LTE module we need to know on what bus and device it is connected within Linux. Verify the existence of the second LTE module by scanning the USB bus. At the linux shell, execute the command ",Object(r.b)("inlineCode",{parentName:"p"},"lsusb")," to output the list of connected USB devices."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"[root@SOL_SCM920420006 ~]# lsusb\nBus 001 Device 003: ID 1199:9071 Sierra Wireless, Inc.\nBus 001 Device 002: ID 8087:07db Intel Corp.\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n")),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"QMI-based LTE modules that exist within the 128T platform will load the ",Object(r.b)("inlineCode",{parentName:"p"},"qmi_wwan")," linux driver."))),Object(r.b)("p",null,"Scan the path ",Object(r.b)("inlineCode",{parentName:"p"},"/sys/bus/usb/drivers/qmi_wwan/*/net")," to detect the QMI supported interface names.  It is these interface names that will be used within the 128T configuration."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"[root@SOL_SCM920420006 ~]# ls /sys/bus/usb/drivers/qmi_wwan/*/net/\n/sys/bus/usb/drivers/qmi_wwan/1-3:1.8/net/:wwp0s21u3i8\n/sys/bus/usb/drivers/qmi_wwan/1-4:1.10/net/:wwp0s21u4i10\n/sys/bus/usb/drivers/qmi_wwan/1-4:1.8/net/:wwp0s21u4i8\n/sys/bus/usb/drivers/qmi_wwan/2-1:1.8/net/:wwp0s21u1i8\n")),Object(r.b)("p",null,"From the output of ",Object(r.b)("inlineCode",{parentName:"p"},"lsusb")," above, the Sierra Wireless adapter (2nd LTE card), we can tell is connected to ",Object(r.b)("inlineCode",{parentName:"p"},"Bus 001 Device 003"),".  This corresponds to QMI interface ",Object(r.b)("inlineCode",{parentName:"p"},"wwp0s21u3i8"),"."),Object(r.b)("h3",{id:"configuration"},"Configuration"),Object(r.b)("p",null,"Use the following configuration fields under network-interface to configure this feature:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"default-route"),": enable/disable default-route via LTE interface in linux"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"management-vector")," contains the following two fields:",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"name"),": name of the vector"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"priority"),": the metric of default-route")))),Object(r.b)("p",null,"Below is an example configuration with two LTE modules. The first module has an AT&T SIM and the second one has a Verizon SIM. Both have default-route enabled; the AT&T interface has a metric of 300 and the Verizon interface has a metric of 500."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-128T"}),"device-interface lte-dev-1\n    name lte-dev-1\n    type lte\n    target-interface wwp0s21u1i8\n    lte\n        apn-name broadband\n        authentication\n            user-name foo\n            password foo\n            authentication-protocol chap\n        exit\n    exit\n    network-interface lte-intf-1\n        name lte-intf-1\n        source-nat true\n        dhcp v4\n        default-route true\n        management-vector lte-route-1\n            name lte-route-1\n            priority 300\n        exit\n    exit\nexit\ndevice-interface lte-dev-2\n    name lte-dev-2\n    type lte\n    target-interface wwp0s21u4i8\n    lte\n        apn-name vzwinternet\n        authentication\n            user-name bar\n            password bar\n            authentication-protocol pap\n        exit\n    exit\n    network-interface lte-intf-2\n        name lte-intf-2\n        source-nat true\n        dhcp v4\n        default-route true\n        management-vector lte-route-2\n            name lte-route-2\n            priority 500\n        exit\n    exit\nexit\n")),Object(r.b)("p",null,"When the 128T is not running, both LTE interfaces will be returned to linux. When this handover happens, a default-route is added to each interface in linux with an associated metric taken from the ",Object(r.b)("em",{parentName:"p"},"management_vector")," priority. This is a result of the ",Object(r.b)("em",{parentName:"p"},"management-vector")," configuration defined above."),Object(r.b)("p",null,"After committing this configuration and shutting down 128T, the linux route table will look like:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"[root@SOL_SCM920420006 ~]# ip route\ndefault via 172.17.0.1 dev enp4s0f0 proto static metric 100\ndefault dev wwp0s21u1i8 scope link metric 300\ndefault dev wwp0s21u4i8 scope link metric 500\n10.66.101.176/29 dev wwp0s21u4i8 proto kernel scope link src 10.66.101.179\n10.195.40.224/28 dev wwp0s21u1i8 proto kernel scope link src 10.195.40.232\n172.17.0.0/16 dev enp4s0f0 proto kernel scope link src 172.17.200.166 metric 100\n")),Object(r.b)("p",null,"This is the only configuration that is necessary to utilize both LTE adapters.  Once the configuration is committed, the LTE interfaces can be used for routing just like any other interface."),Object(r.b)("h3",{id:"troubleshooting"},"Troubleshooting"),Object(r.b)("p",null,"The output of the ",Object(r.b)("inlineCode",{parentName:"p"},"show device-interface")," command contains extensive information in the event of failure regarding LTE connectivity.  Of note, the following can be used to determine the cause of any failure:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Last known failure type, code, reason, and timestamp"),Object(r.b)("li",{parentName:"ul"},"Total attempts that have been made"),Object(r.b)("li",{parentName:"ul"},"An estimate of when the next attempt would be made based on the corresponding backoff configuration")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"admin@128t-node.128t-router# show device-interface name lte-dev\nThu 2019-12-19 15:22:54 UTC\n\n======================================================\n 128t-node:lte-dev\n======================================================\n Type:                lte\n Forwarding:          true\n Mode:                host\n MAC Address:         da:d1:54:e1:4e:54\n\n Admin Status:        up\n Operational Status:  down\n Redundancy Status:   non-redundant\n Speed:               0\n\n in-octets:                       16450\n in-unicast-pkts:                   225\n in-errors:                           0\n out-octets:                          0\n out-unicast-pkts:                    0\n out-errors:                          0\n\n LTE:\n   Active Profile:\n     APN:             broadband\n     Auth:            none\n     PDP type:        ipv4-or-ipv6\n   Connection Status:     disconnected\n   Current Ipv4 Settings: Error Retrieving Information\n   Failure Context:\n     attempt:            19\n     code:               33\n     last-failure-time:  Thu Dec 19 15:08:04 2019\n     next-retry-time:    Thu Dec 19 16:08:04 2019\n     reason:             option-unsubscribed\n     type:               6\n   Packet Stats:         Error Retrieving Information\n   RSSI Signal Strength: -48 dBm\n   Radio Interface:      lte\n   Registration Status:  registered\n   Signal Strength:      excellent\n   usb-port:             /dev/ttyUSB8\n\n\nCompleted in 0.08 seconds\n")),Object(r.b)("p",null,"In addition to the PCLI, standalone ",Object(r.b)("inlineCode",{parentName:"p"},"qmicli")," and ",Object(r.b)("inlineCode",{parentName:"p"},"serial-command")," scripts are also available for troubleshooting from the Linux shell:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"lte-state <interface-name>")," returns a  JSON string that contains dynamic information regarding the LTE connection status, such as IP address, signal strength, carrier, etc."),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"lte-info <interface-name>")," returns a JSON string that contains static information regarding the LTE module, such as firmware version, band capabilities, hardware model, etc."),Object(r.b)("p",null,"These scripts can be utilized through the salt infrastructure to remotely monitor the health of the interfaces."),Object(r.b)("p",null,"The output of ",Object(r.b)("inlineCode",{parentName:"p"},"show device-interface")," includes ",Object(r.b)("inlineCode",{parentName:"p"},"usb-port")," to identify the device to which the LTE adapter is connected. While the majority of the communication between the 128T and the LTE module is over QMI, AT commands are used for certain operations, such as a card reset."),Object(r.b)("p",null,"To determine which devices support AT commands, scan the path ",Object(r.b)("inlineCode",{parentName:"p"},"/sys/class/net/{interface}/device/../*/ttyUSB*/"),".  With the information retrieved from the ",Object(r.b)("inlineCode",{parentName:"p"},"ls")," command, you can then create a serial connection to the device to issues AT commands."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"[root@SOL_SCM920420006 ~]# ls /sys/class/net/wwp0s21u4i8/device/../*/ttyUSB*/\n/sys/class/net/wwp0s21u4i8/device/../1-4:1.0/ttyUSB6/:driver  port_number  power  subsystem  tty  uevent\n/sys/class/net/wwp0s21u4i8/device/../1-4:1.2/ttyUSB7/:driver  port_number  power  subsystem  tty  uevent\n/sys/class/net/wwp0s21u4i8/device/../1-4:1.3/ttyUSB8/:driver  port_number  power  subsystem  tty  uevent\n")),Object(r.b)("p",null,"Use the ",Object(r.b)("inlineCode",{parentName:"p"},"serial-command port <usb-port> <at-command>")," to run AT commands. Issue the ",Object(r.b)("inlineCode",{parentName:"p"},"ATQ0")," command and check that an ",Object(r.b)("inlineCode",{parentName:"p"},"OK")," reply is returned."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"qmicli -d /dev/cdc-wdm0 --uim-get-card-status\n")),Object(r.b)("p",null,"To get the firmeware loaded on the adapater, issue the command:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"lte-image-preference --interface=wwp0s21u1i8 get\n")),Object(r.b)("p",null,"To set the firmware on the adapater, issue the command:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"lte-image-preference --interface=wwp0s21u1i8 set ATT\n")),Object(r.b)("h2",{id:"special-considerations"},"Special Considerations"),Object(r.b)("p",null,"Prior to 4.3.3, on a single LTE system, a default-route within linux with a metric of 128 was always added. For backward compatibility and consistency of default behavior, after an upgrade to 4.3.3:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"A default-route with a metric of 128 will be added to the 128T configuration if:",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"default-route is not set ",Object(r.b)("strong",{parentName:"li"},"OR")," set to false"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"AND")," management-vector is ",Object(r.b)("strong",{parentName:"li"},"NOT")," configured")))),Object(r.b)("p",null,"A validation warning (as shown below) is issued when these conditions have not been met."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"*admin@SOL_SCM920420006.SOL_SCM920420006# commit\nAre you sure you want to commit the candidate config? [y/N]: y\n\u26a0 Validating, then committing...\nWarnings:\n1. System is running a config without a default-route and a management-vector configured, a default-route with a metric of 128 will be added after 128T shutdown. To disable, set default-route to false and configure a management-vector.\n\n    config\n        authority\n            router SOL_SCM920420006\n                node SOL_SCM920420006\n                    device-interface lte-dev-1\n                        network-interface lte-intf-1\n                            default-route\n\nConfiguration committed\n*admin@SOL_SCM920420006.SOL_SCM920420006# q\n")),Object(r.b)("p",null,"After the 128T shutdown, you\u2019ll see that default route with metric 128 is set within linux."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"[root@SOL_SCM920420006 ~]# systemctl stop 128T\n[root@SOL_SCM920420006 ~]# ip route\ndefault via 172.17.0.1 dev enp4s0f0 proto static metric 100\ndefault dev wwp0s21u1i8 scope link metric 128\n")),Object(r.b)("p",null,"If you need to disable the default route, within the 128T configuration, you need to:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"set ",Object(r.b)("inlineCode",{parentName:"li"},"default-route")," to ",Object(r.b)("em",{parentName:"li"},"false")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"AND")," configure a not-empty ",Object(r.b)("inlineCode",{parentName:"li"},"management-vector"))))}u.isMDXComponent=!0},222:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),u=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=u(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},p=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),b=u(n),p=a,m=b["".concat(o,".").concat(p)]||b[p]||d[p]||r;return n?i.a.createElement(m,c(c({ref:t},s),{},{components:n})):i.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=p;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<r;s++)o[s]=n[s];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);