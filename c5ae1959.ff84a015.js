(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{186:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return b}));var a=n(2),r=n(6),i=(n(0),n(222)),o={title:"Wireguard Plugin",sidebar_label:"Wireguard"},c={unversionedId:"plugin_wireguard",id:"plugin_wireguard",isDocsHomePage:!1,title:"Wireguard Plugin",description:"The wireguard plugin allows your 128T router to peer with other endpoints using wireguard.  With this plugin you can securely connect endpoints to your 128T fabric, extending services and network tenancy.",source:"@site/docs/plugin_wireguard.md",slug:"/plugin_wireguard",permalink:"/docs/plugin_wireguard",version:"current",lastUpdatedAt:1622196748,sidebar_label:"Wireguard",sidebar:"docs",previous:{title:"SIP ALG Plugin",permalink:"/docs/plugin_sip_alg"},next:{title:"Kernel Network Namespace Scripts",permalink:"/docs/plugin_kni_namespace_scripts"}},l=[{value:"Wireguard Basics",id:"wireguard-basics",children:[]},{value:"Basic Configuration",id:"basic-configuration",children:[]},{value:"Services and Tenants with Wireguard",id:"services-and-tenants-with-wireguard",children:[]},{value:"Connecting Remote Endpoints",id:"connecting-remote-endpoints",children:[{value:"Profile Configuration",id:"profile-configuration",children:[]},{value:"Remote Endpoint Configuration",id:"remote-endpoint-configuration",children:[]},{value:"Network Tenant For Endpoints",id:"network-tenant-for-endpoints",children:[]}]},{value:"Remote Service Agent",id:"remote-service-agent",children:[{value:"Profile Configuration",id:"profile-configuration-1",children:[]},{value:"Remote Endpoint Configuration",id:"remote-endpoint-configuration-1",children:[]},{value:"Service Routing",id:"service-routing",children:[]}]},{value:"Configuration Reference",id:"configuration-reference",children:[{value:"wireguard-profile",id:"wireguard-profile",children:[]},{value:"private-network",id:"private-network",children:[]},{value:"peer",id:"peer",children:[]},{value:"endpoint",id:"endpoint",children:[]}]},{value:"Troubleshooting",id:"troubleshooting",children:[]},{value:"Release Notes",id:"release-notes",children:[{value:"Release 2.0.2, 1.2.2",id:"release-202-122",children:[]},{value:"Release 2.0.1, 1.2.1",id:"release-201-121",children:[]},{value:"Caveat",id:"caveat",children:[]},{value:"Release 1.2.0",id:"release-120",children:[]},{value:"Caveat",id:"caveat-1",children:[]},{value:"Release 1.1.0",id:"release-110",children:[]}]}],d={rightToc:l};function b(e){var t=e.components,o=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},d,o,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"The wireguard plugin allows your 128T router to peer with other endpoints using ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.wireguard.com/"}),"wireguard"),".  With this plugin you can securely connect endpoints to your 128T fabric, extending services and network tenancy."),Object(i.b)("p",null,Object(i.b)("img",{alt:"Wireguard overview",src:n(839).default})),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"See instructions for ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/plugin_intro#installation-and-management"}),"installing and managing")," plugins."))),Object(i.b)("h2",{id:"wireguard-basics"},"Wireguard Basics"),Object(i.b)("p",null,"Wireguard operates using ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.wireguard.com/#cryptokey-routing"}),"cryptokey routing"),", which provides device-to-edge security with a 128T service centric fabric. For any wireguard peer to securely communicate with another, a ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://tools.ietf.org/html/rfc7748"}),"Curve25519")," public/private keypair is generated. Each endpoint wishing to form a peering relationship must be configured minimally with the public key of the peer, and the prefixes that are allowed to be sent to the peer."),Object(i.b)("p",null,"When a 128T router is configured for wireguard, it will generate a public key which can be configured in remote endpoints that are to peer with it. Additionally service prefixes that should be sent to the 128T router by a wireguard peer, can be configured as allowed IPs. More information on wireguard configuration can be found ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.wireguard.com/quickstart/"}),"here"),"."),Object(i.b)("h2",{id:"basic-configuration"},"Basic Configuration"),Object(i.b)("p",null,"To configure your 128T router for wireguard peering, you first create a wireguard profile on the router. For example, the following defines a profile called ",Object(i.b)("inlineCode",{parentName:"p"},"wg-profile-1"),". Each wireguard endpoint will use a unique address from the prefix ",Object(i.b)("inlineCode",{parentName:"p"},"10.10.10.0/24")," as defined in the profile and the router wireguard instance will use the first address of ",Object(i.b)("inlineCode",{parentName:"p"},"10.10.10.1"),".:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"config\n  authority\n    router             r1\n      wireguard-profile    wg-profile-1\n        name             wg-profile-1\n\n        private-network\n            neighborhood  remote\n            address       10.10.10.1/24\n        exit\n      exit\n    exit\n  exit\nexit\n")),Object(i.b)("p",null,"With a profile configured, the next step is to reference the wireguard profile on a network-interface address that you want to use for wireguard peering. For example, this sets ",Object(i.b)("inlineCode",{parentName:"p"},"eth1-net")," address ",Object(i.b)("inlineCode",{parentName:"p"},"192.168.128.1")," to function as a wireguard peering endpoint:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"config\n  authority\n    router             r1\n      node                 node1\n        device-interface  eth1\n          network-interface  eth1-net\n            address     192.168.128.1\n              wireguard-profile wg-profile-1\n            exit\n          exit\n        exit\n      exit\n    exit\n  exit\nexit\n")),Object(i.b)("p",null,"With the profile configured and set on an interface, the router will install the required components for wireguard peering."),Object(i.b)("h2",{id:"services-and-tenants-with-wireguard"},"Services and Tenants with Wireguard"),Object(i.b)("p",null,"Configuration of a wireguard profile on a 128T router interface does ",Object(i.b)("strong",{parentName:"p"},"not")," provide access to network services. It simply allows the endpoint to connect to the router using wireguard for secure transport, and all sessions will still be subject to the rules of ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/concepts_glossary#service-layer"}),"tenants and services"),". To facilitate network tenancy being given to traffic coming from wireguard peers, a profile is configured with a neighborhood. The neighborhood in the wireguard profile will function as a named Layer 3 network, and used in defining ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/bcp_tenants#per-neighborhood-tenancy"}),"neighborhood based tenancy")," to provide access to services."),Object(i.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"If you do not have a pre-defined tenant to use for wireguard endpoints, you can optionally configure a ",Object(i.b)("inlineCode",{parentName:"p"},"tenant")," in the profile, and one will be automatically generated for you."))),Object(i.b)("h2",{id:"connecting-remote-endpoints"},"Connecting Remote Endpoints"),Object(i.b)("p",null,"You have devices that are remote from your 128T fabric, but you want to give them network tenancy and access to services. In this example use case, assume you have two datacenter routers ",Object(i.b)("inlineCode",{parentName:"p"},"dc1")," and ",Object(i.b)("inlineCode",{parentName:"p"},"dc2"),", hosting services for ",Object(i.b)("inlineCode",{parentName:"p"},"172.16.1.0/24")," and ",Object(i.b)("inlineCode",{parentName:"p"},"172.16.2.0/24")," respectively. You want your remote devices to connect directly to each datacenter for these services, and be given a tenant called ",Object(i.b)("inlineCode",{parentName:"p"},"remote"),". ",Object(i.b)("inlineCode",{parentName:"p"},"dc1")," has a network-interface address of ",Object(i.b)("inlineCode",{parentName:"p"},"1.1.1.1"),", and ",Object(i.b)("inlineCode",{parentName:"p"},"dc2")," has a network-interface address of ",Object(i.b)("inlineCode",{parentName:"p"},"2.2.2.2")," that will be used to allow wireguard peers to connect."),Object(i.b)("p",null,Object(i.b)("img",{alt:"Wireguard remote endpoints",src:n(840).default})),Object(i.b)("p",null,"Each peer is assigned an address out of a ",Object(i.b)("inlineCode",{parentName:"p"},"10.10.10.0/24")," private network, which they can use when sending sessions on to the fabric. Also every peer will end up having a public/private wirguard keypair. For this use case example, each peers have the following info assigned to them:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"peer"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"private address"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"public key"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"p1"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"10.10.10.2")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"cScVKF4nTbdDcGoZgbkNMRFhSEC0dVqdufIBBnCNvCk="))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"p2"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"10.10.10.3")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"4uXibv7XeeTxYhc5clp0G4cIYicvY03RQGxLwDNCCEY="))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"p3"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"10.10.10.4")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"lqvXPuopoYfVcVgpUEtF8Y6BXn8n6YXXAhRGhS50vU8="))))),Object(i.b)("h3",{id:"profile-configuration"},"Profile Configuration"),Object(i.b)("p",null,"The following config sets up profiles on each of the ",Object(i.b)("inlineCode",{parentName:"p"},"dc1")," and ",Object(i.b)("inlineCode",{parentName:"p"},"dc2")," routers, and provisions each peer."),Object(i.b)("h4",{id:"router-dc1"},"Router dc1"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"config\n  authority\n    router             dc1\n      wireguard-profile    wg-profile-1\n        name             wg-profile-1\n\n        private-network\n            neighborhood  remote\n            address       10.10.10.1/24\n        exit\n\n        peer             p1\n            name        p1\n            public-key  cScVKF4nTbdDcGoZgbkNMRFhSEC0dVqdufIBBnCNvCk=\n            allowed-ip  10.10.10.2/32\n        exit\n\n        peer             p2\n            name        p2\n            public-key  4uXibv7XeeTxYhc5clp0G4cIYicvY03RQGxLwDNCCEY=\n            allowed-ip  10.10.10.3/32\n        exit\n\n        peer             p3\n            name        p3\n            public-key  lqvXPuopoYfVcVgpUEtF8Y6BXn8n6YXXAhRGhS50vU8=\n            allowed-ip  10.10.10.4/32\n        exit\n      exit\n\n      node                 node1\n        device-interface  eth1\n          network-interface  eth1-net\n            address     1.1.1.1\n              wireguard-profile wg-profile-1\n            exit\n          exit\n        exit\n      exit\n    exit\n  exit\nexit\n")),Object(i.b)("h4",{id:"router-dc2"},"Router dc2"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"config\n  authority\n    router             dc2\n      wireguard-profile    wg-profile-1\n        name             wg-profile-1\n\n        private-network\n            neighborhood  remote\n            address       10.10.10.1/24\n        exit\n\n        peer             p1\n            name        p1\n            public-key  cScVKF4nTbdDcGoZgbkNMRFhSEC0dVqdufIBBnCNvCk=\n            allowed-ip  10.10.10.2/32\n        exit\n\n        peer             p2\n            name        p2\n            public-key  4uXibv7XeeTxYhc5clp0G4cIYicvY03RQGxLwDNCCEY=\n            allowed-ip  10.10.10.3/32\n        exit\n\n        peer             p3\n            name        p3\n            public-key  lqvXPuopoYfVcVgpUEtF8Y6BXn8n6YXXAhRGhS50vU8=\n            allowed-ip  10.10.10.4/32\n        exit\n      exit\n    exit\n\n    node                 node1\n      device-interface  eth1\n        network-interface  eth1-net\n          address     2.2.2.2\n            wireguard-profile wg-profile-1\n          exit\n        exit\n      exit\n    exit\n  exit\nexit\n")),Object(i.b)("p",null,"With this config committed, wireguard will be installed and set up on ",Object(i.b)("inlineCode",{parentName:"p"},"dc1")," and ",Object(i.b)("inlineCode",{parentName:"p"},"dc2"),", and it will generate a wireguard keypair automatically. Once the interface is fully installed, you can view the public wireguard key of the profile by using the CLI command ",Object(i.b)("inlineCode",{parentName:"p"},"show device-interface router <router_name> name <profile_name>"),". Example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"admin@node1.dev-conductor# show device-interface router dc1 name wg-profile-1\nWed 2020-08-05 16:46:41 UTC\n\n===================================================================\n node1.dc1:wg-profile-1\n===================================================================\n Type:                host\n Forwarding:          true\n Mode:                host\n MAC Address:         6a:ca:96:7b:e3:4c\n\n Admin Status:        up\n Operational Status:  up\n Redundancy Status:   non-redundant\n Speed:               1 Gb/s\n Duplex:              full\n\n in-octets:                       99768\n in-unicast-pkts:                  1653\n in-errors:                           0\n out-octets:                      67788\n out-unicast-pkts:                 1614\n out-errors:                          0\n\n wireguard:\n   interface:\n     listening port:  12800\n     name:            wg0\n     public key:      lV8egtiC8AKNh+DawkSM6G8t4x6BMFCsz8m48ToxHyA=\n   number of peers:   3\n   peers:\n       peer#1 - p1:\n         allowed ips: 10.10.10.2/32\n         public key:  cScVKF4nTbdDcGoZgbkNMRFhSEC0dVqdufIBBnCNvCk=\n       peer#2 - p2:\n         allowed ips: 10.10.10.3/32\n         public key:  4uXibv7XeeTxYhc5clp0G4cIYicvY03RQGxLwDNCCEY=\n       peer#3 - p3:\n         allowed ips: 10.10.10.4/32\n         public key:  lqvXPuopoYfVcVgpUEtF8Y6BXn8n6YXXAhRGhS50vU8=\n\nCompleted in 0.27 seconds\n")),Object(i.b)("h3",{id:"remote-endpoint-configuration"},"Remote Endpoint Configuration"),Object(i.b)("p",null,"Now the remote peer endpoints can be configured to peer with the ",Object(i.b)("inlineCode",{parentName:"p"},"dc1")," and ",Object(i.b)("inlineCode",{parentName:"p"},"dc2")," routers at their respective interface addresses, and route the corresponding service prefixes of ",Object(i.b)("inlineCode",{parentName:"p"},"172.16.1.0/24")," and ",Object(i.b)("inlineCode",{parentName:"p"},"172.16.2.0/24")," to each. For example, a wireguard config for peer ",Object(i.b)("inlineCode",{parentName:"p"},"p1")," might look like the following:"),Object(i.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"See ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.wireguard.com/quickstart/"}),"wireguard documentation")," for more on configuring wireguard on other endpoints."))),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"[Interface]\n# p1\nAddress = 10.10.10.2/32\nPrivateKey = kLbzfaAMMn1Nen3zZ+LreKCglYJuBgdvy/fFNgIZxHk=\n\n[Peer]\n# dc1\nPublicKey = lV8egtiC8AKNh+DawkSM6G8t4x6BMFCsz8m48ToxHyA=\nAllowedIPs = 172.16.1.0/24\nEndpoint = 1.1.1.1:12800\n\n[Peer]\n# dc2\nPublicKey = uB/YI6A/UZtLCLsnOuoWI+lopiwBO0/QdbdN5ryBsm4=\nAllowedIPs = 172.16.2.0/24\nEndpoint = 2.2.2.2:12800\n")),Object(i.b)("h3",{id:"network-tenant-for-endpoints"},"Network Tenant For Endpoints"),Object(i.b)("p",null,"In the remote endpoint example, traffic coming from endpoints will be transported to the appropriate 128T ",Object(i.b)("inlineCode",{parentName:"p"},"dc1")," or ",Object(i.b)("inlineCode",{parentName:"p"},"dc2")," routers using wireguard, and then be sent into the fabric sourced from each endpoint's assigned private address in the ",Object(i.b)("inlineCode",{parentName:"p"},"10.10.10.0/24")," network. To assign these endpoints a tenant, thus giving them access to services, the profile is configured with a ",Object(i.b)("inlineCode",{parentName:"p"},"neighborhood")," of ",Object(i.b)("inlineCode",{parentName:"p"},"remote"),". Based on this, you can define tenant membership for each endpoint in the private network."),Object(i.b)("p",null,"For example, the following could be used to give endpoints in the network a tenant of ",Object(i.b)("inlineCode",{parentName:"p"},"remote-worker")," (including ",Object(i.b)("inlineCode",{parentName:"p"},"p1")," and ",Object(i.b)("inlineCode",{parentName:"p"},"p2"),"), but give just ",Object(i.b)("inlineCode",{parentName:"p"},"p3")," tenant ",Object(i.b)("inlineCode",{parentName:"p"},"engineering"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"config\n  authority\n    tenant             remote-worker\n      name    remote-worker\n\n      member  remote\n          neighborhood  remote\n          address       10.10.10.0/24\n      exit\n    exit\n\n    tenant             engineering\n      name    engineering\n\n      member  remote\n          neighborhood  remote\n          address       10.10.10.4/32\n      exit\n    exit\n  exit\nexit\n")),Object(i.b)("h2",{id:"remote-service-agent"},"Remote Service Agent"),Object(i.b)("p",null,"You have a remote device that needs to be accessed as an agent of a service in your 128T network. In this example use case you have a remote IoT device that hosts a ",Object(i.b)("inlineCode",{parentName:"p"},"thing")," service with address ",Object(i.b)("inlineCode",{parentName:"p"},"128.128.128.128/32"),", which must be accessed by a tenant ",Object(i.b)("inlineCode",{parentName:"p"},"technician"),"."),Object(i.b)("p",null,"A remote IoT device has a wireguard peer with a public key of ",Object(i.b)("inlineCode",{parentName:"p"},"Jihom426SSceUCPpS1147NSNzZcY1wl40Sf+OQ1rjGU="),". It will be given an address of ",Object(i.b)("inlineCode",{parentName:"p"},"10.10.10.2")," from the private network, and it will peer with the 128T router ",Object(i.b)("inlineCode",{parentName:"p"},"r1")," on the  ",Object(i.b)("inlineCode",{parentName:"p"},"1.1.1.1")," network-interface address."),Object(i.b)("p",null,Object(i.b)("img",{alt:"Wireguard service agent",src:n(841).default})),Object(i.b)("h3",{id:"profile-configuration-1"},"Profile Configuration"),Object(i.b)("p",null,"The following configuration sets up the wireguard profile, along with the IoT device wireguard peer:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"config\n  authority\n    router             r1\n      wireguard-profile    wg-profile-1\n        name             wg-profile-1\n\n        private-network\n          neighborhood  remote\n          address       10.10.10.1/24\n        exit\n\n        peer             iot-dev-1\n          name        iot-dev-1\n          public-key  Jihom426SSceUCPpS1147NSNzZcY1wl40Sf+OQ1rjGU=\n          allowed-ip  10.10.10.2/32\n        exit\n      exit\n\n      node                 node1\n        device-interface  eth1\n          network-interface  eth1-net\n            address     1.1.1.1\n              wireguard-profile wg-profile-1\n            exit\n          exit\n        exit\n      exit\n    exit\n  exit\nexit\n")),Object(i.b)("h3",{id:"remote-endpoint-configuration-1"},"Remote Endpoint Configuration"),Object(i.b)("p",null,"The wireguard configuration on the IoT device might look like the following:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"[Interface]\n# IoT device\nAddress = 10.10.10.2/32\nPrivateKey = MEAtlWq4Ou7++yxjYGtTa85gzDj3mbbCy76J5oWPaG8=\n\n[Peer]\n# r1\nPublicKey = lV8egtiC8AKNh+DawkSM6G8t4x6BMFCsz8m48ToxHyA=\nAllowedIPs = 0.0.0.0/0\nEndpoint = 1.1.1.1:12800\nPersistentKeepalive = 30\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"The ",Object(i.b)("inlineCode",{parentName:"p"},"PersistentKeepalive")," in this wireguard configuration causes the peer to keep the connection to the peer alive by sending periodic traffic. This has the effect of allowing the 128T to originate sessions to the peer at any time. See ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.wireguard.com/quickstart/"}),"wireguard documentation")," for more on configuring wireguard on other endpoints."))),Object(i.b)("p",null,"With the profile and peer configured on the 128T router ",Object(i.b)("inlineCode",{parentName:"p"},"r1"),", and wireguard configured on the remote IoT device, you can verify the device is keeping the connection alive by reviewing the ",Object(i.b)("inlineCode",{parentName:"p"},"latest handshake")," output of ",Object(i.b)("inlineCode",{parentName:"p"},"show device-interface router <router_name> name <profile_name>"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"admin@node1.dev-conductor# show device-interface router r1 name wg-profile-1\nWed 2020-08-05 23:33:02 UTC\n\n===================================================================\n node1.r1:wg-profile-1\n===================================================================\n Type:                host\n Forwarding:          true\n Mode:                host\n MAC Address:         6a:ca:96:7b:e3:4c\n\n Admin Status:        up\n Operational Status:  up\n Redundancy Status:   non-redundant\n Speed:               1 Gb/s\n Duplex:              full\n\n in-octets:                      493467\n in-unicast-pkts:                  7115\n in-errors:                           0\n out-octets:                     356373\n out-unicast-pkts:                 7218\n out-errors:                          0\n\n wireguard:\n   interface:\n     listening port:  12800\n     name:            wg0\n     public key:      lV8egtiC8AKNh+DawkSM6G8t4x6BMFCsz8m48ToxHyA=\n   number of peers:   4\n   peers:\n       peer#1 - iot-dev-1:\n         allowed ips: 10.10.10.2/32\n         endpoint:    192.168.128.222:42948\n         latest handshake: 21 seconds ago\n         public key:  Jihom426SSceUCPpS1147NSNzZcY1wl40Sf+OQ1rjGU=\n         transfer:    17.96 KiB received, 67.58 KiB sent\n\nCompleted in 0.25 seconds\n")),Object(i.b)("h3",{id:"service-routing"},"Service Routing"),Object(i.b)("p",null,"Finally the ",Object(i.b)("inlineCode",{parentName:"p"},"thing")," service must be routed to the remote wireguard peer."),Object(i.b)("h4",{id:"service"},"Service"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'config\n  authority\n    service            thing\n      name           thing\n      description    "IoT sensor data service"\n      address        128.128.128.128/32\n\n      access-policy  technician\n        source      technician\n        permission  allow\n      exit\n    exit\n  exit\nexit\n')),Object(i.b)("h4",{id:"service-route"},"Service-route"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"config\n  authority\n    router             r1\n      service-route        static-thing\n        name          static-thing\n        service-name  thing\n        nat-target    10.10.10.2\n\n        next-hop      node1 wg-profile-1-intf\n          node-name   node1\n          interface   wg-profile-1-intf\n          gateway-ip  169.254.140.129\n        exit\n      exit\n    exit\n  exit\nexit\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"The ",Object(i.b)("inlineCode",{parentName:"p"},"interface")," and ",Object(i.b)("inlineCode",{parentName:"p"},"gateway-ip")," in this configuration are automatically generated as part of the profile configuration on the router, and can be seen with ",Object(i.b)("inlineCode",{parentName:"p"},"show network-interface"),"."))),Object(i.b)("p",null,"With this configuration, sessions sent from the ",Object(i.b)("inlineCode",{parentName:"p"},"technician")," tenant to ",Object(i.b)("inlineCode",{parentName:"p"},"128.128.128.128")," will be given access as part of the ",Object(i.b)("inlineCode",{parentName:"p"},"thing")," service, and routed with a destination NAT to the wireguard interface of ",Object(i.b)("inlineCode",{parentName:"p"},"10.10.10.2")," on the IoT device peer."),Object(i.b)("h2",{id:"configuration-reference"},"Configuration Reference"),Object(i.b)("h3",{id:"wireguard-profile"},"wireguard-profile"),Object(i.b)("h4",{id:"path"},"Path"),Object(i.b)("p",null,"authority > router > wireguard-profile"),Object(i.b)("h4",{id:"description"},"Description"),Object(i.b)("p",null,"A profile describing an instance of wireguard on the router."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Element"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Type"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"name")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"string"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"A string identifier for wireguard profile. This identifier is used as a device interface name in the host, therefore it can only use alphanumerics, underscores, or dashes, and cannot exceed 12 characters.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"description")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"string"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"A description about the wireguard profile.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"loopback-address")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"ipv4-prefix"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"An internal address prefix for KNI connectivity between wireguard and the data plane.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"port")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"l4-port"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The UDP port for the wireguard instance to recieve connections on.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"inactivity-timeout")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"milliseconds"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Inactivity timeout for wireguard sessions. By default this uses 180000 ms UDP timeout value. If customized to a non-default value, a new session-type will be automatically generated.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"service-class")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"string"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The service-class to associate with the generated session-type for this wireguard profile. Wireguard sessions arriving at the router will be given this service-class.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"access-policy")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"access-policy"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"List of access policies for the wireguard service. Packets allowed by this access policy will additionally be subject to wireguard security validation. See ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/config_reference_guide#access-policy-service"}),"service access policy"),".")))),Object(i.b)("h3",{id:"private-network"},"private-network"),Object(i.b)("h4",{id:"path-1"},"Path"),Object(i.b)("p",null,"authority > router > wireguard-profile > private-network"),Object(i.b)("h4",{id:"description-1"},"Description"),Object(i.b)("p",null,"A network to be associated with router the wireguard network-interface. This network handles packets after they have been decrypted from a wireguard peer connection, or prior to being encrypted and sent to a wireguard peer connection. The router wireguard instance will use the address given, and other peers can send or receive sessions using the remaining addresses in the network."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Element"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Type"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"neighborhood")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"neighborhood-id"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Neighborhood to be associated with the wireguard network. Addresses assigned to peers can be made members of an appropriate existing tenant based on this neighborhood.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"tenant-name")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"string"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"A tenant to be associated with addresses in the network. If configured, a tenant will be automatically generated with the addresses in the neighborhood set as members. If not configured, no tenant will be generated, and peer addresses in the network will need to be defined as members of existing tenants.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"address")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"ip prefix"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The address and prefix associated with the wireguard profile. The wireguard interface created on the router will use the address defined, and other peers can send or receive sessions using the remaining addresses in the network.")))),Object(i.b)("h3",{id:"peer"},"peer"),Object(i.b)("h4",{id:"path-2"},"Path"),Object(i.b)("p",null,"authority > router > wireguard-profile > peer"),Object(i.b)("h4",{id:"description-2"},"Description"),Object(i.b)("p",null,"Set of allowed wireguard peers."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Element"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Type"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"name")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"string"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Name identifier for the peer.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"public-key")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"string"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The peer's base64 encoded 32 byte Curve25519 public wireguard key.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"preshared-key")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"string"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The peer's optional base64 encoded 32 byte Curve25519 pre-shared wireguard key.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"persistent-keepalive")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"seconds"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Interval in seconds at which to send keepalive messages to the peer. Keepalives are optional. No configuration or a setting of '0' disables keepalives.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"allowed-ip")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"ip prefix"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The prefixes that are allowed to be sent to the peer. When the peer is an endpoint, typically the allowed-ip is the /32 of the peer's wireguard interface. If the peer is a gateway device, the allowed-ip list would include any prefixes reachable as services via the peer, or prefixes from which traffic may be sourced.")))),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Disabled keepalives on the router does not mean keepalives cannot be generated by the remote peer. If keepalives are desired, a typical configuration is to have keepalives disabled on the router, but enabled on the remote peer."))),Object(i.b)("h3",{id:"endpoint"},"endpoint"),Object(i.b)("h4",{id:"path-3"},"Path"),Object(i.b)("p",null,"authority > router > wireguard-profile > peer > endpoint"),Object(i.b)("h4",{id:"description-3"},"Description"),Object(i.b)("p",null,"IP and port of the endpoint. If not set, the endpoint of the peer will establish dynamically based on the source address discovered during the wireguard handshake."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Element"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Type"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"ip")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"ip address"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Static IP address where the peer can be reached to connect.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"port")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"port number"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Port at which the peer can be reached to connect.")))),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"If an endpoint is configured, wireguard on the 128T may attempt to send outbound sessions to the IP and port defined. The sessions will originate from the profile loopback-address. A tenant and service must be created to route the outbound wireguard session to the defined peer endpoint."))),Object(i.b)("h2",{id:"troubleshooting"},"Troubleshooting"),Object(i.b)("h4",{id:"interface-status"},"Interface status"),Object(i.b)("p",null,"To view the status of a wireguard interface, and its peers, use the following PCLI command:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"show device-interface router <router_name> name <profile_name>\n")),Object(i.b)("p",null,"Example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"admin@node1.dev-conductor# show device-interface router r1 name wg-profile-1\nFri 2020-08-07 13:35:22 UTC\n\n===================================================================\n node1.r1:wg-profile-1\n===================================================================\n Type:                host\n Forwarding:          true\n Mode:                host\n MAC Address:         6a:ca:96:7b:e3:4c\n\n Admin Status:        up\n Operational Status:  up\n Redundancy Status:   non-redundant\n Speed:               1 Gb/s\n Duplex:              full\n\n in-octets:                     4349806\n in-unicast-pkts:                 50978\n in-errors:                           0\n out-octets:                    4793736\n out-unicast-pkts:                63193\n out-errors:                          0\n\n wireguard:\n   interface:\n     listening port:  12800\n     name:            wg0\n     public key:      lV8egtiC8AKNh+DawkSM6G8t4x6BMFCsz8m48ToxHyA=\n   number of peers:   5\n   peers:\n       peer#1 - iot-dev-1:\n         allowed ips: 10.10.10.5/32\n         endpoint:    192.168.128.222:42948\n         latest handshake:1 minute, 2 seconds ago\n         public key:  Jihom426SSceUCPpS1147NSNzZcY1wl40Sf+OQ1rjGU=\n         transfer:    368.22 KiB received, 177.72 KiB sent\n       peer#2 - p1:\n         allowed ips: 10.10.10.2/32, 192.168.8.0/24\n         endpoint:    192.168.128.30:58608\n         latest handshake:11 hours, 35 minutes, 38 seconds ago\n         public key:  cScVKF4nTbdDcGoZgbkNMRFhSEC0dVqdufIBBnCNvCk=\n         transfer:    775.50 KiB received, 771.83 KiB sent\n       peer#3 - p2:\n         allowed ips: 10.10.10.3/32\n         public key:  4uXibv7XeeTxYhc5clp0G4cIYicvY03RQGxLwDNCCEY=\n       peer#4 - p3:\n         allowed ips: 10.10.10.4/32\n         public key:  lqvXPuopoYfVcVgpUEtF8Y6BXn8n6YXXAhRGhS50vU8=\n\n")),Object(i.b)("h4",{id:"interface-and-profile-configuration-logging"},"Interface and profile configuration logging"),Object(i.b)("p",null,"Logging of new configuration sent to the router can be viewed in the Linux shell using the system journal."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"journalctl -u 128T-handle-wireguard-config\n")),Object(i.b)("p",null,"Example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"[t128@dev-fitlet ~]$ sudo journalctl -u 128T-handle-wireguard-config\n-- Logs begin at Sun 2012-01-01 00:37:26 UTC, end at Fri 2020-08-07 13:38:00 UTC. --\nJul 30 02:06:25 dev-fitlet systemd[1]: Starting Handler for 128T wireguard config...\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote' does not exist\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote' created\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote/init' does not exist\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote/reinit' does not exist\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote/shutdown' does not exist\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote/startup' does not exist\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote/init' symlink to '/etc/128technology/plugins/network-scripts/default/kni_namespace/init' created\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote/reinit' symlink to '/etc/128technology/plugins/network-scripts/default/kni_namespace/reinit' created\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote/shutdown' symlink to '/etc/128technology/plugins/network-scripts/default/kni_namespace/shutdown' created\nJul 30 02:06:25 dev-fitlet node[2602]: '/etc/128technology/plugins/network-scripts/host/remote/startup' symlink to '/etc/128technology/plugins/network-scripts/default/kni_namespace/startup' created\n")),Object(i.b)("h4",{id:"peer-configuration-logging"},"Peer configuration logging"),Object(i.b)("p",null,"Looging of peer configuration handling can be viewed in the Linux shell using the system journal."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"journalctl -u 128T-handle-wireguard-peer-config@<profile_name>\n")),Object(i.b)("p",null,"Example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"[t128@dev-fitlet ~]$ sudo journalctl -u 128T-handle-wireguard-peer-config@wg-profile-1\n-- Logs begin at Sun 2012-01-01 00:37:26 UTC, end at Fri 2020-08-07 13:36:42 UTC. --\nAug 05 14:32:40 dev-fitlet systemd[1]: Starting Handler for wireguard peer and network config wg/profile/1...\nAug 05 14:32:40 dev-fitlet node[32315]: '/etc/128technology/plugins/network-scripts/host/wg-profile-1/wg0.conf' written\n")),Object(i.b)("h4",{id:"wireguard-not-installed-on-the-router"},"Wireguard not installed on the router"),Object(i.b)("p",null,"In some cases, it is possible that the version of 128T router is not compatible with wireguard. In such a case you will see the log messages like below in the journal"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"Dec 18 20:56:03 t211-dut2.openstacklocal python3.6[28707]: __main__ - Could not validate wireguard packages: Could not query package kmod-wireguard, Command '['rpm', '-q', 'kmod-wireguard']' returned non-zero exit status 1.\n")),Object(i.b)("p",null,"In some upgrade and rollback scenarios, it is possible that an older version of the module is installed on the router but that version is not compatible. Typically in such scenarios, a new version will be installed by the conductor but in some scenarios a compatible version might not be available. The following log messages in the journal can help troubleshoot these errors."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"Dec 18 20:56:03 t211-dut2.openstacklocal python3.6[26711]: __main__ - Running startup check commands for ns: wg-profile-1\nDec 18 20:56:03 t211-dut2.openstacklocal python3.6[26711]: __main__ - Executing command: ['/usr/libexec/wireguard/startup-check']\nDec 18 20:56:03 t211-dut2.openstacklocal python3.6[28707]: __main__ - Could not validate wireguard packages: Invalid kmod-wireguard for kernel version 3.10.0-1160.el7\nDec 18 20:56:03 t211-dut2.openstacklocal python3.6[26711]: __main__ - not starting wg-profile-1: startup check error: Command '['/usr/libexec/wireguard/startup-check']' returned non-zero exit status 1.\n")),Object(i.b)("h2",{id:"release-notes"},"Release Notes"),Object(i.b)("h3",{id:"release-202-122"},"Release 2.0.2, 1.2.2"),Object(i.b)("h4",{id:"issues-fixed"},"Issues Fixed"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"PLUGIN-1089")," Add support for kernel version ",Object(i.b)("inlineCode",{parentName:"li"},"3.10.0-1160.11.1"),".")),Object(i.b)("h3",{id:"release-201-121"},"Release 2.0.1, 1.2.1"),Object(i.b)("h4",{id:"issues-fixed-1"},"Issues Fixed"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"PLUGIN-1072")," Allow wireguard to start when the required version of ",Object(i.b)("inlineCode",{parentName:"li"},"kmod-wireguard")," is installed along with versions not used by the active kernel."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"PLUGIN-611")," Added support for plugin state. Plugin state information can be accessed on the PCLI using ",Object(i.b)("inlineCode",{parentName:"li"},"show plugins state [router <router>] [node <node>] [{detail | summmary}] 128T-wireguard")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"PLUGIN-768")," Support the Wireguard plugin on conductors running 128T versions ",Object(i.b)("inlineCode",{parentName:"li"},"5.1.0")," and greater.")),Object(i.b)("h3",{id:"caveat"},"Caveat"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"I95-38622")," The plugin is not supported on routers running 128T version ",Object(i.b)("inlineCode",{parentName:"li"},"5.1.0"),".")),Object(i.b)("h3",{id:"release-120"},"Release 1.2.0"),Object(i.b)("h4",{id:"issues-fixed-2"},"Issues Fixed"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"PLUGIN-922")," Support multiple kernel versions for 128T Wireguard plugin and allow for graceful upgrade and rollback of the 128T software releases. The enhancement currently supports the following kernel versions: ",Object(i.b)("inlineCode",{parentName:"li"},"3.10.0-1062.9.1"),", ",Object(i.b)("inlineCode",{parentName:"li"},"3.10.0-1127.18.2"),", ",Object(i.b)("inlineCode",{parentName:"li"},"3.10.0-1160"),", and ",Object(i.b)("inlineCode",{parentName:"li"},"3.10.0-1160.6.1"),".")),Object(i.b)("h3",{id:"caveat-1"},"Caveat"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"PLUGIN-987")," A 128T software downgrade might fail when the currently installed wireguard kernel module and the new kernel being downgraded to are not compatible. The following procedure may be used to work around this issue")),Object(i.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"The process below will cause the wireguard tunnels to be torn down and the peers to disconnect. Please perform the operations during a maintenance window only."))),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Create a backup of the current running configuration to be restored later."),Object(i.b)("li",{parentName:"ul"},"Before rolling back the 128T version, remove all references to ",Object(i.b)("inlineCode",{parentName:"li"},"wireguard-profile")," from ",Object(i.b)("inlineCode",{parentName:"li"},"authority > router > device-interface > network-interface > address"),". Once these changes are committed, the wireguard rpms will be removed from the router."),Object(i.b)("li",{parentName:"ul"},"Rollback the 128T software to the desired version."),Object(i.b)("li",{parentName:"ul"},"Restore the backup created in the first step. Once the changes are committed, the correct wireguard rpm's will be installed on the router.")),Object(i.b)("h3",{id:"release-110"},"Release 1.1.0"),Object(i.b)("h4",{id:"issues-fixed-3"},"Issues Fixed"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"PLUGIN-863")," A kernel panic condition occurs when running Wireguard with the kernel version ",Object(i.b)("inlineCode",{parentName:"li"},"3.10.0-1127.18.2")," or above.")))}b.isMDXComponent=!0},222:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return h}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var d=r.a.createContext({}),b=function(e){var t=r.a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},s=function(e){var t=b(e.components);return r.a.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),s=b(n),u=a,h=s["".concat(o,".").concat(u)]||s[u]||p[u]||i;return n?r.a.createElement(h,c(c({ref:t},d),{},{components:n})):r.a.createElement(h,c({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var d=2;d<i;d++)o[d]=n[d];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},839:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/plugin_wireguard_1-8d117d6e489cf7c0bf29195ce4da31da.png"},840:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/plugin_wireguard_2-ecce2bc126cd93e9845df9687d5579f4.png"},841:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/plugin_wireguard_3-e84322f7e06be8206d02132a36825bf5.png"}}]);