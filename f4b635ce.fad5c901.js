(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{238:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return s}));var a=n(2),i=n(9),o=(n(0),n(247)),r={title:"DNS App Id Plugin",sidebar_label:"DNS App Id"},c={id:"plugin_dns_app_id",title:"DNS App Id Plugin",description:"The DNS App ID plugin will identify traffic passing through your 128T router by applying pattern matching to FQDN names. You can then configure 128T services and associate application names to influence routing policy. You can read more about 128T and its application identification concept here.",source:"@site/docs/plugin_dns_app_id.md",permalink:"/docs/plugin_dns_app_id",lastUpdatedAt:1593103850,sidebar_label:"DNS App Id",sidebar:"docs",previous:{title:"DNS Cache Plugin",permalink:"/docs/plugin_dns_cache"},next:{title:"128T-4.2.0",permalink:"/docs/api_rest_4.2.0"}},l=[{value:"Installation",id:"installation",children:[]},{value:"Configuration",id:"configuration",children:[{value:"Built-In Patterns",id:"built-in-patterns",children:[]},{value:"Custom Patterns",id:"custom-patterns",children:[]}]},{value:"Troubleshooting",id:"troubleshooting",children:[]}],p={rightToc:l};function s(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The DNS App ID plugin will identify traffic passing through your 128T router by applying pattern matching to FQDN names. You can then configure 128T services and associate application names to influence routing policy. You can read more about 128T and its application identification concept ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/concepts_appid"}),"here"),"."),Object(o.b)("p",null,"This plugin will rely on the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/plugin_dns_cache"}),"DNS Cache")," plugin for hostname resolution."),Object(o.b)("h2",{id:"installation"},"Installation"),Object(o.b)("p",null,"The following versions are available for corresponding 128T software versions:"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"DNS App Id"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"128T"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"128T-dns-app-id-1.0.0"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"128T >= 3.2.8; 128T < 4.3.0")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"128T-dns-app-id-2.0.0"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"128T >= 4.3.0")))),Object(o.b)("p",null,"Installing this plugin will automatically install the required DNS Cache plugin too."),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"It is recommended to use the conductor GUI > Plugins page for installing plugins. This allows the system to select the correct version of plugin based on the 128T version."))),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"After installing the plugin, the 128T service on the conductor should be restarted for the changes to take effect."))),Object(o.b)("h2",{id:"configuration"},"Configuration"),Object(o.b)("p",null,"In addition to the configuration snippet from the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/plugin_dns_cache"}),"dns-cache")," plugin, the below configuration shows an example of dns-app-id configuration:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"configure\n    authority\n        router ${DUT2_ROUTER}\n            application-identification mode\n            dns-app-id\n                enabled true\n                builtin-apps gmail\n                builtin-apps windows-update\n                custom-apps cnn\n                    name cnn\n                    patterns cnn.com\n                    patterns .*\\\\.cnn.com\n                exit\n            exit\n        exit\n    exit\nexit\n")),Object(o.b)("h3",{id:"built-in-patterns"},"Built-In Patterns"),Object(o.b)("p",null,"The plugin contains built in application patterns for Gmail, Google Drive, and Windows Update. The patterns were generated from the following published documents:"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Application"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Document"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Gmail"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://support.google.com/a/answer/9497877?hl=en"}),"link"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Google Drive"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://support.google.com/a/answer/2589954?hl=en"}),"link"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Windows Update"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://docs.microsoft.com/en-us/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#211-connection-from-the-wsus-server-to-the-internet"}),"link 1")," ",Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"https://docs.microsoft.com/en-us/windows/deployment/update/windows-update-troubleshooting#device-cannot-access-update-files"}),"link 2"))))),Object(o.b)("p",null,"As you can see in the configuration snippet above, all you need to configure for the builtin-apps are the names of the apps you wish to include in our pattern matching. The values you can configure are ",Object(o.b)("inlineCode",{parentName:"p"},"gmail"),", ",Object(o.b)("inlineCode",{parentName:"p"},"google-drive"),", and ",Object(o.b)("inlineCode",{parentName:"p"},"windows-update"),"."),Object(o.b)("h3",{id:"custom-patterns"},"Custom Patterns"),Object(o.b)("p",null,"Also shown in the configuration snippet is the custom-app ",Object(o.b)("inlineCode",{parentName:"p"},"cnn")," that includes a list of patterns to be applied. Each pattern must be a valid regex that will be applied to a FQDN to identify the application. The identification is dynamic so you just need to update the configuration on the conductor to include new apps or patterns for your routers."),Object(o.b)("h4",{id:"example"},"Example"),Object(o.b)("p",null,"This example shows our builtin gmail application's pattern matching configured as a custom-app. You should not use this example in production, but is intended to document how to build out complicated pattern matching for an application."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"custom-apps gmail\n    name gmail\n    patterns .*\\\\.client-channel\\\\.google\\\\.com\n    patterns accounts\\\\.google\\\\.com\n    patterns apis\\\\.google\\\\.com\n    patterns clients.*\\\\.google\\\\.com\n    patterns contacts\\\\.google\\\\.com\n    patterns hangouts\\\\.google\\\\.com\n    patterns .*\\\\.googleusercontent\\\\.com\n    patterns mail\\\\.google\\\\.com\n    patterns www\\\\.google\\\\.com\n    patterns .*\\\\.gstatic\\\\.com\n    patterns ogs\\\\.google\\\\.com\n    patterns play\\\\.google\\\\.com\nexit\n")),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"If you configure invalid regex patterns, you will see the log message ",Object(o.b)("inlineCode",{parentName:"p"},"invalid pattern for {name}, will never match!"),". This means the pattern you configured is not a valid regex therefore the pattern matching will fail for the app until the configuration is fixed."))),Object(o.b)("h2",{id:"troubleshooting"},"Troubleshooting"),Object(o.b)("p",null,"Verify the services of the 128T-dns-app-id plugin:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"systemctl status 128T-dns-app-id"))),Object(o.b)("p",null,"Watch the journal for logging:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"journalctl -u 128T-dns-app-id -f"))),Object(o.b)("p",null,"You can modify the systemd service unit manually to update the log-level of the application from INFO to DEBUG."),Object(o.b)("p",null,"You can use ",Object(o.b)("inlineCode",{parentName:"p"},"show device-interface dns-cache")," to see all available fqdn and IP addresses found by this plugin."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"========================================\n tnode:dns-cache\n========================================\n Type:                host\n Forwarding:          true\n Mode:                host\n MAC Address:         76:23:37:ed:5c:ae\n\n Admin Status:        up\n Operational Status:  up\n Redundancy Status:   non-redundant\n Speed:               1000\n Duplex:              full\n\n in-octets:                     3618779\n in-unicast-pkts:                 57795\n in-errors:                           0\n out-octets:                    2641623\n out-unicast-pkts:                57722\n out-errors:                          0\n\n records:\n   Gmail:\n     172.217.165.141/32\n")),Object(o.b)("p",null,"Similarly you can use ",Object(o.b)("inlineCode",{parentName:"p"},"show application names"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"admin@dc.router# show application names\nSat 2020-03-28 03:28:43 UTC\n\n================== =============== ================ ===================== =====================\n Application Name   Session Count   Ip Tuple Count   Date Discovered       Last Updated\n================== =============== ================ ===================== =====================\n Gmail                          0               15   2020-06-20 03:28:40   2020-06-20 03:28:40\n GoogleDrive                    0                9   2020-06-20 03:28:40   2020-06-20 03:28:40\n WindowsUpdate                  0                1   2020-06-20 03:28:40   2020-06-20 03:28:40\n")))}s.isMDXComponent=!0},247:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=i.a.createContext({}),s=function(e){var t=i.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=s(e.components);return i.a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},u=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),b=s(n),u=a,m=b["".concat(r,".").concat(u)]||b[u]||d[u]||o;return n?i.a.createElement(m,c(c({ref:t},p),{},{components:n})):i.a.createElement(m,c({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var p=2;p<o;p++)r[p]=n[p];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);