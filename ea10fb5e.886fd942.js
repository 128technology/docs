(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{228:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(2),i=n(9),o=(n(0),n(239)),r={title:"128T Monitoring Agent",sidebar_label:"Monitoring"},c={id:"plugin_monitoring_agent",title:"128T Monitoring Agent",description:"The 128T Monitoring Agent is an entity for collecting data from a node running 128T software and to push it to a collector. It is capable of collecting the data from several sources such as metrics, events etc. The current mechanism of monitoring a 128T router involves performing REST or GraphQL queries from the conductor. At scale, this can become inefficient and be problematic in terms of the performance of the conductor. Additionally it is important to interact with 3rd party monitoring platforms as means for organizations to collect, analyze and report using various KPIs available from 128T software and other application in the network.",source:"@site/docs/plugin_monitoring_agent.md",permalink:"/docs/plugin_monitoring_agent",lastUpdatedAt:1588089519,sidebar_label:"Monitoring",sidebar:"docs",previous:{title:"Command Line Reference",permalink:"/docs/cli_reference"},next:{title:"GRE Plugin",permalink:"/docs/plugin_gre"}},l=[{value:"Installation",id:"installation",children:[]},{value:"Configuration",id:"configuration",children:[]},{value:"Directory Structure",id:"directory-structure",children:[{value:"Inputs",id:"inputs",children:[]},{value:"Outputs",id:"outputs",children:[]},{value:"Config",id:"config",children:[]},{value:"Samples",id:"samples",children:[]}]},{value:"Config Examples",id:"config-examples",children:[{value:"Inputs",id:"inputs-1",children:[]},{value:"Outputs",id:"outputs-1",children:[]}]},{value:"Monitoring Agent CLI",id:"monitoring-agent-cli",children:[{value:"Validation",id:"validation",children:[]},{value:"Sample Config",id:"sample-config",children:[]},{value:"Generate",id:"generate",children:[]},{value:"Configuration",id:"configuration-1",children:[]},{value:"Testing and Validation",id:"testing-and-validation",children:[]}]},{value:"128T Collectors",id:"128t-collectors",children:[{value:"Metric collector",id:"metric-collector",children:[]},{value:"Event Collector",id:"event-collector",children:[]},{value:"Device interface state collector",id:"device-interface-state-collector",children:[]},{value:"Peer Path State collector",id:"peer-path-state-collector",children:[]},{value:"LTE Collector",id:"lte-collector",children:[]},{value:"Top Analytics Collector",id:"top-analytics-collector",children:[]}]}],s={rightToc:l};function p(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The 128T Monitoring Agent is an entity for collecting data from a node running 128T software and to push it to a collector. It is capable of collecting the data from several sources such as metrics, events etc. The current mechanism of monitoring a 128T router involves performing REST or GraphQL queries from the conductor. At scale, this can become inefficient and be problematic in terms of the performance of the conductor. Additionally it is important to interact with 3rd party monitoring platforms as means for organizations to collect, analyze and report using various KPIs available from 128T software and other application in the network."),Object(o.b)("p",null,"The monitoring agent at its core is designed to be able to push data to external platforms. It currently leverages the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.influxdata.com/time-series-platform/telegraf/"}),"Telegraf")," collection stack on every 128T router. However, the monitoring agent is designed with other tools and scale in mind. The monitoring agent is composed of the following:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"monitoring-agent-cli"),Object(o.b)("br",null),"\nUsed for configuring and interacting with the underlying application")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"collectors"),Object(o.b)("br",null),"\nA set of inputs designed to collect data from several sources such as metrics, events etc.")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"targets"),Object(o.b)("br",null),"\nA set of outputs for collecting and pushing the data to various data sinks such as external monitoring platforms, files on disk etc."))),Object(o.b)("h2",{id:"installation"},"Installation"),Object(o.b)("p",null,"The 128T Monitoring Agent can be obtained from the official 128T software repository. The following versions of the ",Object(o.b)("strong",{parentName:"p"},"monitoring-agent")," are available for corresponding 128T software version."),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Monitoring Agent"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"128T"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"128T-monitoring-agent-1.1.1"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"128T >= 4.1.0; 128T < 4.3.0")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"128T-monitoring-agent-2.0.1"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"128T >= 4.3.0")))),Object(o.b)("p",null,"The agent can be install using dnf utility. For example."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"# dnf install 128T-monitoring-agent\nLast metadata expiration check: 0:00:31 ago on Tue 28 Apr 2020 02:40:10 PM UTC.\nDependencies resolved.\n==============================================================================================================================================================================================================================================================\n Package                                                               Arch                                                   Version                                                   Repository                                                       Size\n==============================================================================================================================================================================================================================================================\nInstalling:\n 128T-monitoring-agent                                                 x86_64                                                 2.0.1-2                                                   plugins-staging                                                 5.0 M\nInstalling dependencies:\n telegraf-128tech                                                      x86_64                                                 1.14.0-1                                                  128tech                                                          20 M\n\nTransaction Summary\n==============================================================================================================================================================================================================================================================\nInstall  2 Packages\n\nTotal download size: 25 M\nInstalled size: 92 M\nIs this ok [y/N]: y\nDownloading Packages:\n(1/2): 128T-monitoring-agent-2.0.1-2.x86_64.rpm                                                                                                                                                                                24 MB/s | 5.0 MB     00:00\n(2/2): telegraf-128tech-1.14.0-1.x86_64.rpm                                                                                                                                                                                    41 MB/s |  20 MB     00:00\n--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\nTotal                                                                                                                                                                                                                          40 MB/s |  25 MB     00:00\nRunning transaction check\nTransaction check succeeded.\nRunning transaction test\nTransaction test succeeded.\nRunning transaction\n  Preparing        :                                                                                                                                                                                                                                      1/1\n  Running scriptlet: telegraf-128tech-1.14.0-1.x86_64                                                                                                                                                                                                     1/2\n  Installing       : telegraf-128tech-1.14.0-1.x86_64                                                                                                                                                                                                     1/2\n  Running scriptlet: telegraf-128tech-1.14.0-1.x86_64                                                                                                                                                                                                     1/2\nCreated symlink from /etc/systemd/system/multi-user.target.wants/telegraf.service to /usr/lib/systemd/system/telegraf.service.\n  Installing       : 128T-monitoring-agent-2.0.1-2.x86_64                                                                                                                                                                                                 2/2\n  Running scriptlet: 128T-monitoring-agent-2.0.1-2.x86_64                                                                                                                                                                                                 2/2\n  Running scriptlet: telegraf-128tech-1.14.0-1.x86_64                                                                                                                                                                                                     2/2\n  Running scriptlet: 128T-monitoring-agent-2.0.1-2.x86_64                                                                                                                                                                                                 2/2\nRemoved symlink /etc/systemd/system/multi-user.target.wants/telegraf.service.\n  Verifying        : 128T-monitoring-agent-2.0.1-2.x86_64                                                                                                                                                                                                 1/2\n  Verifying        : telegraf-128tech-1.14.0-1.x86_64                                                                                                                                                                                                     2/2\n\nInstalled:\n  128T-monitoring-agent.x86_64 2.0.1-2                                                                                            telegraf-128tech.x86_64 1.14.0-1\n\nComplete!\n")),Object(o.b)("h2",{id:"configuration"},"Configuration"),Object(o.b)("p",null,"The monitoring agent has its own set of configurations and looks for inputs from specific directories on disk. By default, the configuration for the agent should be present in ",Object(o.b)("inlineCode",{parentName:"p"},"/etc/128t-monitoring/config.yaml")," and uses YAML format which looks something like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"enabled: true\ntags:\n-  key: router\n   value: ${ROUTER}\nsample-interval: 60\npush-interval: 300\ninputs:\n- name: events\n- name: t128_metrics\n  include-outputs: [message_queue]\n- name: t128_device_state\n- name: t128_peer_path\n- name: lte_metric\n  exclude-outputs: [file]\noutputs:\n- name: file\n- name: message_queue\n")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"enabled")," field is meant as global toggle for applying the monitoring agent functionality.  When set to ",Object(o.b)("inlineCode",{parentName:"p"},"disabled")," the monitoring agent will remain dormant on the 128T."),Object(o.b)("p",null,"Each of the ",Object(o.b)("inlineCode",{parentName:"p"},"tags"),", a collection of key/value pairs, are used to add meta information to the collected metrics. This data makes it easier to identify the origin, and to provide filtering by the collectors. By default, the agent includes the ",Object(o.b)("inlineCode",{parentName:"p"},"${HOSTNAME}"),", ",Object(o.b)("inlineCode",{parentName:"p"},"${ROUTER}")," and ",Object(o.b)("inlineCode",{parentName:"p"},"${NODE}")," tags to every collected input. The corresponding values are derived from the running system. The same config can ideally be used for each node in the authority, as their respective values are evaluated at runtime."),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"sample-interval")," and ",Object(o.b)("inlineCode",{parentName:"p"},"push-interval")," indicate the frequency (in seconds) for how often the data is collected and subsequently pushed to the collection target. When the ",Object(o.b)("inlineCode",{parentName:"p"},"push-interval")," value is greater than the ",Object(o.b)("inlineCode",{parentName:"p"},"sample-interval"),", the agent will produce ",Object(o.b)("inlineCode",{parentName:"p"},"ceiling(push-interval/sample-interval)")," samples collected within the push duration.  It is recommended to configure the ",Object(o.b)("inlineCode",{parentName:"p"},"push-interval")," as a multiple of ",Object(o.b)("inlineCode",{parentName:"p"},"sample-interval"),"."),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"inputs")," represent a single unit of collection. This can be a combination of inputs available from ",Object(o.b)("inlineCode",{parentName:"p"},"telegraf")," as well as other inputs developed by 128T. The function and configuration of each of the 128T provided inputs can be found in subsequent sections. For ",Object(o.b)("inlineCode",{parentName:"p"},"telegraf")," inputs please refer to the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.influxdata.com/telegraf/v1.13/plugins/plugin-list/#input-plugins"}),"influx documentation online"),". Each ",Object(o.b)("inlineCode",{parentName:"p"},"input")," can be a combination of one or more collectors and can contain other collector specific information. For each of the inputs, a user can also configure an ",Object(o.b)("inlineCode",{parentName:"p"},"include-outputs")," which is a list of outputs to send the collected information to. This allows the user to build a matrix of inputs and outputs and provides a granular control over which input should be sent to what output. Similarly, the user can also configure an ",Object(o.b)("inlineCode",{parentName:"p"},"exclude-outputs")," which will include all defined outputs except the one specified."),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"outputs")," represent a data sink where the collected information is to be delivered. By virtue of using ",Object(o.b)("inlineCode",{parentName:"p"},"telegraf"),", the monitoring agent gets automatic support of the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.influxdata.com/telegraf/v1.13/plugins/plugin-list/#output-plugins"}),"available outputs supported by telegraf"),". Each ",Object(o.b)("inlineCode",{parentName:"p"},"input")," can be configured to be delivered to one or more ",Object(o.b)("inlineCode",{parentName:"p"},"output"),"."),Object(o.b)("h2",{id:"directory-structure"},"Directory Structure"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"monitoring-agent")," uses a well-defined directory structure where it derives the inputs from various configuration. The following directories are especially important:"),Object(o.b)("h3",{id:"inputs"},"Inputs"),Object(o.b)("p",null,"Path: ",Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/inputs/")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"inputs")," directory contains config files for the various inputs that are enabled in the monitoring-agent configuration. The monitoring agent expects to see a file called ",Object(o.b)("inlineCode",{parentName:"p"},"<input-name.conf>")," in this directory. Users can override the file name by specifying ",Object(o.b)("inlineCode",{parentName:"p"},"conf: <filename.conf>")," in the input definition within the config above. This file should only contain the telegraf definition for the input(s) that belong and not any other configuration. Configuration for all the 128T inputs will automatically be staged in the inputs directory. See the Config Examples section below for more details."),Object(o.b)("h3",{id:"outputs"},"Outputs"),Object(o.b)("p",null,"Path: ",Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/outputs/")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"outputs")," directory will contain the config files for the various data sink configured in the monitoring-agent configuration. For each ",Object(o.b)("inlineCode",{parentName:"p"},"output")," the conf file should contain the telegraf configuration for that one output only. This allows the monitoring-agent to create a telegraf config per input and include the appropriate outputs."),Object(o.b)("h3",{id:"config"},"Config"),Object(o.b)("p",null,"Path: ",Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/config")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"config")," directory contains the fully formed telegraf config files created by the monitoring agent. These file are generated based on the contents of ",Object(o.b)("inlineCode",{parentName:"p"},"config.yaml")," and the ",Object(o.b)("inlineCode",{parentName:"p"},"inputs")," and ",Object(o.b)("inlineCode",{parentName:"p"},"outputs")," directories."),Object(o.b)("p",null,"For example, the using the ",Object(o.b)("inlineCode",{parentName:"p"},"t128_metrics")," input and the ",Object(o.b)("inlineCode",{parentName:"p"},"file")," output in the examples section below will result in a configuration file such as:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[global_tags]\nrouter = "lte-router"\nnode = "lte-node"\n\n[agent]\ninterval = 10\nflush_interval = 20\n\n[inputs]\n[[inputs.exec]]\ntimeout = "15s"\ncommands = [ "/usr/bin/metricCollector128t --config /etc/128t-monitoring/collectors/t128_metrics/default_config.toml",]\ndata_format = "influx"\n\n[outputs]\n[[outputs.file]]\nfiles = ["stdout", "/tmp/metrics.out"]\ndata_format = "influx"\n')),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Users should not make changes to these files as they will be overwritten by the ",Object(o.b)("inlineCode",{parentName:"p"},"monitoring-agent-cli configure")," command."))),Object(o.b)("h3",{id:"samples"},"Samples"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/samples/")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"samples")," directory contains example configurations for the included 128T collectors. You can also display these using the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"#sample-config"}),Object(o.b)("inlineCode",{parentName:"a"},"monitoring-agent-cli")),"."),Object(o.b)("h2",{id:"config-examples"},"Config Examples"),Object(o.b)("p",null,"The following examples higlight just a few ways the monitoring agent can be configured. Be sure to reference the Telegraf documentation for the full ecosystem of input and outputs that are supported."),Object(o.b)("h3",{id:"inputs-1"},"Inputs"),Object(o.b)("h4",{id:"t128_metrics"},"t128_metrics"),Object(o.b)("p",null,"This example configures the ",Object(o.b)("inlineCode",{parentName:"p"},"t128_metrics")," collector to gather a set of default metrics from the 128T. This file is also included in the samples directory."),Object(o.b)("p",null,"Path: ",Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/inputs/t128_metrics.conf")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[inputs.t128_metrics]]\n    ## When configured, the metric collector input will pull KPIs from the 128T system\n    ## running on the current node. Depending on the KPI, the information can be used for\n    ## monitoring various aspects of the running system such as services, interfaces, errors etc.\n\n    ## By default, if no configuration is present, the set of metrics defined in\n    ## /etc/128t-monitoring/collectors/t128_metrics/default_config.toml will be used\n    ## for monitoring. Here\'s a sample configuration on how to define custom metrics.\n    ##\n    ## [[inputs.t128_metric.metric]]\n    ## name = "peer_path"\n    ##\n    ## [inputs.t128_metric.metric.fields]\n    ## Refer to the 128T REST swagger documentation for the list of available metrics\n    ##     key_name = "stats/<path_to_metric>"\n    ##     latency = "stats/bfd/peer-path/latency"\n    ##\n    ## [inputs.t128_metric.metric.parameters]\n    ##     parameter_name = ["value1", "value2"]\n    ##     peer_path = ["path1"]\n\n    timeout = "15s"\n')),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Depending on the number of metrics you have enabled, you may need to increase the timeout to allow collection to complete. This can also influence your minimum polling interval."))),Object(o.b)("h4",{id:"linux-system"},"Linux System"),Object(o.b)("p",null,"This example gathers cpu, disk, and memory metrics from the linux host using native telegraf collectors:"),Object(o.b)("p",null,"Path: ",Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/inputs/system.conf")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[inputs.cpu]]\n  ## Whether to report per-cpu stats or not\n  percpu = true\n  ## Whether to report total system cpu stats or not\n  totalcpu = true\n  ## If true, collect raw CPU time metrics.\n  collect_cpu_time = false\n  ## If true, compute and report the sum of all non-idle CPU states.\n  report_active = false\n\n[[inputs.disk]]\n  ## Ignore mount points by filesystem type.\n  ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]\n\n[[inputs.mem]]\n')),Object(o.b)("h3",{id:"outputs-1"},"Outputs"),Object(o.b)("h4",{id:"local-filesystem"},"Local Filesystem"),Object(o.b)("p",null,"Configuring the file output will write metrics to the local filesystem. This can be useful for testing or as a backup data source in case network connectivity issues prevent data from reaching the intended collection endpoint."),Object(o.b)("p",null,"Path: ",Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/outputs/file.conf")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[outputs.file]]\n  ## Files to write to, "stdout" is a specially handled file.\n  files = ["stdout", "/tmp/metrics.out"]\n\n  ## Use batch serialization format instead of line based delimiting.  The\n  ## batch format allows for the production of non line based output formats and\n  ## may more efficiently encode metric groups.\n  # use_batch_format = false\n\n  ## The file will be rotated after the time interval specified.  When set\n  ## to 0 no time based rotation is performed.\n  # rotation_interval = "0d"\n\n  ## The logfile will be rotated when it becomes larger than the specified\n  ## size.  When set to 0 no size based rotation is performed.\n  # rotation_max_size = "0MB"\n\n  ## Maximum number of rotated archives to keep, any older logs are deleted.\n  ## If set to -1, no archives are removed.\n  # rotation_max_archives = 5\n\n  ## Data format to output.\n  ## Each data format has its own unique set of configuration options, read\n  ## more about them here:\n  ## https://github.com/influxdata/telegraf/blob/master/docs/DATA_FORMATS_OUTPUT.md\n  data_format = "influx"\n')),Object(o.b)("h4",{id:"kafka"},"Kafka"),Object(o.b)("p",null,"This example sends data to a kafka broker:"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/outputs/kafka.conf")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[outputs.kafka]]\n  ## URLs of kafka brokers\n  brokers = ["<ip>:9092"]\n  ## Kafka topic for producer messages\n  topic = "telegraf"\n  max_retry = 3\n  data_format = "json"\n')),Object(o.b)("h4",{id:"syslog"},"Syslog"),Object(o.b)("p",null,"In this example data is sent via syslog:"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/outputs/syslog.conf")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[outputs.syslog]]\n  address = "udp://<ip>:514"\n  default_sdid = "128T"\n')),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"For syslog output, not specifying the ",Object(o.b)("inlineCode",{parentName:"p"},"default_sdid")," parameter can result in empty or truncated messages"))),Object(o.b)("h2",{id:"monitoring-agent-cli"},"Monitoring Agent CLI"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"monitoring-agent-cli")," is a utility for validating and executing the configuration for the monitoring-agent. The various components of the CLI as follows:"),Object(o.b)("h3",{id:"validation"},"Validation"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"monitoring-agent validate")," command will ensure that the monitoring-agent config along with other inputs and outputs are correctly setup and flag any particular errors to the user. The ",Object(o.b)("inlineCode",{parentName:"p"},"validate")," command will not make any changes to the running system."),Object(o.b)("h3",{id:"sample-config"},"Sample Config"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"monitoring-agent-cli sample")," command can be used to view the various collectors that are created as part of the 128T monitoring agent. The ",Object(o.b)("inlineCode",{parentName:"p"},"list-available")," command will simply show the set of available inputs (and outputs) that are packaged as part of the 128T monitoring-agent. These are in addition to the ones available natively via telegraf. For example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"# monitoring-agent-cli sample list-available\ninputs:\n- t128_device_state\n- t128_metrics\n- t128_peer_path\n- t128_events\n- t128_lte_metric\n- t128_top_analytics\n")),Object(o.b)("p",null,"The configuration for each of these inputs can be viewed via ",Object(o.b)("inlineCode",{parentName:"p"},"monitoring-agent-cli sample view <plugin_name>")," command such as:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'# monitoring-agent-cli sample view t128_metrics\n[[inputs.t128_metrics]]\n    ## When configured, the metric collector input will pull KPIs from the 128T system\n    ## running on the current node. Depending on the KPI, the information can be used for\n    ## monitoring various aspects of the running system such as services, interfaces, errors etc.\n\n    ## By default, if no configuration is present, the set of metrics defined in\n    ## /etc/128t-monitoring/collectors/t128_metrics/default_config.toml will be used\n    ## for monitoring. Here\'s a sample configuration on how to define custom metrics.\n    ##\n    ## [[inputs.t128_metric.metric]]\n    ## name = "peer_path"\n    ##\n    ## [inputs.t128_metric.metric.fields]\n    ## Refer to the 128T REST swagger documentation for the list of available metrics\n    ##     key_name = "stats/<path_to_metric>"\n    ##     latency = "stats/bfd/peer-path/latency"\n    ##\n    ## [inputs.t128_metric.metric.parameters]\n    ##     parameter_name = ["value1", "value2"]\n    ##     peer_path = ["path1"]\n')),Object(o.b)("h3",{id:"generate"},"Generate"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"monitoring-agent-cli generate")," command can be used to (re-)generate the telegraf configuration files. This command does not restart the telegraf services and is a good way to pre-stage configuration for testing."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"# monitoring-agent-cli generate\nThe command does not start/restart 128T-telegraf services but can still impact already running instances. Do you want to continue? [Y/n]: y\nGenerating t128_top_analytics\nGenerating t128_device_state\n")),Object(o.b)("h3",{id:"configuration-1"},"Configuration"),Object(o.b)("p",null,"When the ",Object(o.b)("inlineCode",{parentName:"p"},"monitoring-agent-cli configure")," command is run, it will first validate and report any errors to the user. Once valid configuration is in place, the configure command does the following at a high level:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"For each of the configured and enabled inputs, generate a telegraf config file in the ",Object(o.b)("inlineCode",{parentName:"p"},"/var/lib/128t-monitoring/config")," directory")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Launch an instance of the ",Object(o.b)("inlineCode",{parentName:"p"},"128T-telegraf")," service for each of the configured inputs which allows us to collect each input independently."))),Object(o.b)("p",null,"At this point, each input will be running a telegraf instance and will allow the collection of inputs & outputs to run on the system."),Object(o.b)("h3",{id:"testing-and-validation"},"Testing and Validation"),Object(o.b)("p",null,"Once the Monitoring Agent has configured and started the ",Object(o.b)("inlineCode",{parentName:"p"},"128T-telegraf"),"services, you can use the command ",Object(o.b)("inlineCode",{parentName:"p"},"systemctl list-units 128T-telegraf*")," to list them out."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"#systemctl list-units 128T-telegraf*\nUNIT                                    LOAD   ACTIVE SUB     DESCRIPTION\n128T-telegraf@events.service            loaded active running 128T telegraf service for events\n128T-telegraf@system.service            loaded active running 128T telegraf service for system\n128T-telegraf@t128_device_state.service loaded active running 128T telegraf service for t128_device_state\n128T-telegraf@t128_metrics.service      loaded active running 128T telegraf service for t128_metrics\n128T-telegraf@t128_peer_path.service    loaded active running 128T telegraf service for t128_peer_path\n")),Object(o.b)("p",null,"Additionally, its often useful to test the input configuration before full rollout. This can be easily accomplished by the ",Object(o.b)("inlineCode",{parentName:"p"},"test-input")," command."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'# monitoring-agent-cli test-input t128_device_state\nTesting input t128_device_state\n2020-04-15T06:51:17Z I! Starting Telegraf 1.14.0\n2020-04-15T06:51:17Z D! [agent] Initializing plugins\n> device-interface-state,device-interface=dpdk1-lan,host=t127-dut2.openstacklocal,router=router1 adminStatus="ADMIN_UP",enabled=true,operationalStatus="OPER_UP",redundancyStatus="NON_REDUNDANT" 1586933478000000000\n')),Object(o.b)("h2",{id:"128t-collectors"},"128T Collectors"),Object(o.b)("p",null,"The 128T monitoring-agent comes pre-packaged with a set of collectors to assist in the monitoring of the 128T platform. Here are the various collectors and how to use them:"),Object(o.b)("h3",{id:"metric-collector"},"Metric collector"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"metricCollector128t")," python executable is responsible for collecting the configured metrics from a running system. By default, the metrics specified in ",Object(o.b)("inlineCode",{parentName:"p"},"/etc/128t-monitoring/collectors/t128_metrics/default_config.toml")," will be used by the collector. This represents a set of pre-configured metrics that 128T recommends a network operator to monitor. The configuration file in a ",Object(o.b)("inlineCode",{parentName:"p"},"TOML")," definition of metrics and has the following format:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[metric]]\n  name = "service"\n  [metric.fields]\n    packets-received = "stats/aggregate-session/service/packets-received"\n    packets-transmitted = "stats/aggregate-session/service/packets-transmitted"\n    session-arrival-rate = "stats/aggregate-session/service/session-arrival-rate"\n    session-departure-rate = "stats/aggregate-session/service/session-departure-rate"\n    bandwidth-received = "stats/aggregate-session/service/bandwidth-received"\n    bandwidth-transmitted = "stats/aggregate-session/service/bandwidth-transmitted"\n    tcp-retransmissions = "stats/aggregate-session/service/tcp-retransmissions"\n    session-count = "stats/aggregate-session/service/session-count"\n  [metric.parameters]\n    service = []\n')),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"name")," becomes the name of the measurement in the context of influxdb format. The ",Object(o.b)("inlineCode",{parentName:"p"},"metric.fields")," represent the various metrics to be collected. The ",Object(o.b)("inlineCode",{parentName:"p"},"packets-received")," in the above example will be field-name for the ",Object(o.b)("inlineCode",{parentName:"p"},"stats/aggregate-session/service/packets-received")," KPI which is the path of that KPI from the 128T REST API documentation. Finally, the ",Object(o.b)("inlineCode",{parentName:"p"},"metric.parameters")," can be used to configure key parameters such as ",Object(o.b)("inlineCode",{parentName:"p"},"service")," to be used for filtering the set of collected stats. In the above example, the metrics would be collected for all services but the ",Object(o.b)("inlineCode",{parentName:"p"},"service")," parameter can be used to specify a subset of services to monitor instead."),Object(o.b)("h3",{id:"event-collector"},"Event Collector"),Object(o.b)("p",null,"The event collector can be used for collecting and pushing events for various categories such as admin, alarm, system, traffic and provisioning as they occur on the system. The type of the event is available via a ",Object(o.b)("inlineCode",{parentName:"p"},"tag")," and can be used for filtering only specific events as desired. For example, the following configuration can be used for pushing just the ",Object(o.b)("inlineCode",{parentName:"p"},"alarm")," and ",Object(o.b)("inlineCode",{parentName:"p"},"admin")," event"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[inputs.execd]]\n  ## Create a stream of 128T events for alarm, audit etc. This information is useful for\n  ## monitoring the health of the system.\n  command = "/usr/bin/eventCollector128t"\n  signal = "none"\n  data_format = "influx"\n\n  ## input event filtering based on type (admin, alarm, system, traffic, provisioning)\n  ## NOTE: For information on filtering severity refer to the output configuration example\n  [inputs.execd.tagpass]\n  type = ["alarm", "admin"]\n')),Object(o.b)("h3",{id:"device-interface-state-collector"},"Device interface state collector"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"deviceInterfaceStateCollector128t")," collector can be used for monitoring the admin, oper and redundancy status of various device-interfaces configured on the node. The name is available as ",Object(o.b)("inlineCode",{parentName:"p"},"device-interface")," tag and telegraf ",Object(o.b)("inlineCode",{parentName:"p"},"tagpass")," can be used to filter specific interfaces as needed. For example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[inputs.exec]]\n  ## Collect information about the 128T device-interface admin, operational and\n  ## redundancy status. This information is useful for monitoring the system health.\n  commands = ["/usr/bin/deviceInterfaceStateCollector128t"]\n\n  ## Timeout for the device-interface state collector to finish\n  timeout = "5s"\n\n  ## Data format to consume.\n  ## Each data format has its own unique set of configuration options, read\n  ## more about them here:\n  ## https://github.com/influxdata/telegraf/blob/master/docs/DATA_FORMATS_INPUT.md\n  data_format = "influx"\n\n  ## To filter on select device interfaces, you can use the `tagpass` and `tagdrop` concepts\n  ## from telegraf. For example:\n  ## [[inputs.exec.tagpass]]\n  ##     device-interface = ["wan1"]\n')),Object(o.b)("h3",{id:"peer-path-state-collector"},"Peer Path State collector"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"peerPathStateCollector128t")," collector can be used for monitoring the up/down status of all the peer paths on the node. The various part of a peer-path such as ",Object(o.b)("inlineCode",{parentName:"p"},"adjacentAddress")," and ",Object(o.b)("inlineCode",{parentName:"p"},"networkInterface")," are available as tags which can be filtered. For example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[inputs.exec]]\n  ## Collect information about the 128T adjacency peer-path status. This information\n  ## is useful to monitoring the secure WAN connectivity to the peers\n  commands = ["/usr/bin/peerPathStateCollector128t"]\n\n  ## Timeout for the peer-path state collector to finish\n  timeout = "5s"\n\n  ## Data format to consume.\n  ## Each data format has its own unique set of configuration options, read\n  ## more about them here:\n  ## https://github.com/influxdata/telegraf/blob/master/docs/DATA_FORMATS_INPUT.md\n  data_format = "influx"\n\n  ## To filter on select peer-paths, you can use the `tagpass` and `tagdrop` concepts\n  ## from telegraf. For example:\n  ## [[inputs.exec.tagpass]]\n  ##     adjacentAddress = ["10.10.10.10"]\n  ##     networkInterface = ["wan1"]\n\n')),Object(o.b)("h3",{id:"lte-collector"},"LTE Collector"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"lteMetricCollector128t")," collector when run will scan the current node configuration for any 128T supported and configured LTE devices. This collector can be used for pushing the ",Object(o.b)("inlineCode",{parentName:"p"},"signal-strength")," and ",Object(o.b)("inlineCode",{parentName:"p"},"carrier")," information to the monitoring stack. For example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[inputs.exec]]\n  ## Collect the signal-strength and carrier information from configured LTE card(s) on\n  ## the system. This information is useful for monitoring any fluctuations in carrier\n  ## signal causing loss of connectivity.\n  commands = ["/usr/bin/lteMetricCollector128t"]\n\n  ## Timeout for the LTE metric collector to finish\n  timeout = "10s"\n\n  ## Data format to consume.\n  ## Each data format has its own unique set of configuration options, read\n  ## more about them here:\n  ## https://github.com/influxdata/telegraf/blob/master/docs/DATA_FORMATS_INPUT.md\n  data_format = "influx"\n')),Object(o.b)("h3",{id:"top-analytics-collector"},"Top Analytics Collector"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"topAnalyticsCollector128t")," collector can be used for monitoring the top sources, top sessions and top applications on the router. The different aspects of each of these data sources are easily tunable using the input configuration."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'[[inputs.top_analytics]]\n    # # By default all the data sources below are enabled along with their default properties.\n    # [[inputs.top_analytics.sessions]]\n    #     enabled = true\n\n    # [[inputs.top_analytics.sources]]\n    #     enabled = true\n    #     max_rows = 10\n    #     category = "TOTAL_DATA"\n\n    # [[inputs.top_analytics.applications]]\n    #     enabled = true\n    #     max_rows = 10\n    #     filter = "<word to search for in application names>"\n    #     # Minimum number of active session for the application to be reported\n    #     min-session-count = 1\n')),Object(o.b)("p",null,"The ",Object(o.b)("strong",{parentName:"p"},"top sessions")," input above can be used to stream the view of the top 10 sessions by bandwidth utilization. The ",Object(o.b)("strong",{parentName:"p"},"enabled")," flag can be used to turn off the collection of top sessions."),Object(o.b)("p",null,"The ",Object(o.b)("strong",{parentName:"p"},"top sources")," input can be used to capture the list of source IP addresses by either ",Object(o.b)("strong",{parentName:"p"},"TOTAL_DATA")," (default) or by ",Object(o.b)("strong",{parentName:"p"},"SESSION_COUNT"),". In addition, the user can configure the maximum number of top data samples to collect as configured by the ",Object(o.b)("strong",{parentName:"p"},"max_rows")," configuration above. Finally the ",Object(o.b)("strong",{parentName:"p"},"enabled")," flag can be used to turn off the top sources collection is need be."),Object(o.b)("p",null,"The ",Object(o.b)("strong",{parentName:"p"},"top applications")," input is useful when application identification in terms of module or tls have been configured on the router. By default, all the discovered sessions will be reported by the input. The user can tune the collection by setting up a search filter in the form of ",Object(o.b)("strong",{parentName:"p"},"filter")," or eliminate the applications that have some minimum number of sessions via ",Object(o.b)("strong",{parentName:"p"},"min-session-count"),". The ",Object(o.b)("strong",{parentName:"p"},"max-rows")," will limit the reporting to the first N rows. The collection can be turned off by setting ",Object(o.b)("strong",{parentName:"p"},"enabled")," to be false."))}p.isMDXComponent=!0},239:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),p=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},u=function(e){var t=p(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=a,m=u["".concat(r,".").concat(d)]||u[d]||b[d]||o;return n?i.a.createElement(m,c(c({ref:t},s),{},{components:n})):i.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=d;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var s=2;s<o;s++)r[s]=n[s];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);