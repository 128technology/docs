(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{204:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var o=n(2),a=n(9),r=(n(0),n(256)),i={title:"Asset Connection Resiliency",sidebar_label:"Asset Connection Resiliency"},s={id:"config_asset_connection_resiliency",title:"Asset Connection Resiliency",description:"128T provides path resiliency to a destination when multiple paths exist between peering 128T routers. However, not every destination may not have another 128T peered in its path. Specifically, a 128T conductor may be deployed on the public internet without a front-ended 128T.",source:"@site/docs/config_asset_connection_resiliency.md",permalink:"/docs/config_asset_connection_resiliency",lastUpdatedAt:1595254277,sidebar_label:"Asset Connection Resiliency",sidebar:"docs",previous:{title:"Glossary",permalink:"/docs/concepts_glossary"},next:{title:"Configuration Management on the 128T",permalink:"/docs/config_basics"}},c=[{value:"Configuration",id:"configuration",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]}],l={rightToc:c};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"128T provides path resiliency to a destination when multiple paths exist between peering 128T routers. However, not every destination may not have another 128T peered in its path. Specifically, a 128T conductor may be deployed on the public internet without a front-ended 128T."),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(o.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(o.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(o.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(o.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(r.b)("div",Object(o.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Read the ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"/docs/bcp_conductor_deployment"}),"BCP on Conductor Deployment")," for recommendations on how to deploy a Conductor."))),Object(r.b)("p",null,"Without a peering 128T router, or without the use of dynamic routing protocols, the 128T considers all next hops equally, even though some paths may not provide a path to the destination. The following diagram depicts a case where two of the three paths to the Conductor are not available, even though the next hop gateway is responsive."),Object(r.b)("p",null,Object(r.b)("img",Object(o.a)({parentName:"p"},{src:"/img/config_asset_connection_resiliency.png",alt:"Topology"}))),Object(r.b)("p",null,"One of the ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"/docs/concepts_machine_communication"}),"connections a 128T router establishes to a Conductor")," is that of the salt-minion (router) connecting to a salt-master (Conductor).  The salt-minion and salt-master maintain a persistent TCP connection on port 4505 which the salt-master uses to publish requests to all salt-minions. When a salt-minion completes a request, it creates a transient connection on port 4506 back to the salt-master, sends an event with the result, then closes the connection."),Object(r.b)("p",null,"The effect this problem has on salt is that if an event is sent to an invalid next hop, the request will never make it back to the salt-master. Since 128T load balances Conductor traffic between all possible paths, some percentage of salt events will fail to be returned to the salt-master, resulting in state inconsistencies between router and Conductor."),Object(r.b)("p",null,"In order to avoid these intermittent failures, the 128T can optionally create a long-lived SSH session to the salt-master utilizing FIPS OpenSSH. Long-lived SSH sessions mitigate downstream network failures by ensuring the SSH session is established on at least one of the paths before the salt events are transmitted. As network failures occur, the SSH session will be reestablished on the next available, working path. Salt transactions are instead instantiated within the long-lived SSH connection. The 128T creates SSH sessions for both the salt publish port (4505) and return port (4506).",Object(r.b)("sup",Object(o.a)({parentName:"p"},{id:"fnref-1"}),Object(r.b)("a",Object(o.a)({parentName:"sup"},{href:"#fn-1",className:"footnote-ref"}),"1"))),Object(r.b)("h2",{id:"configuration"},"Configuration"),Object(r.b)("p",null,"Asset connection resiliency is configured both at the ",Object(r.b)("inlineCode",{parentName:"p"},"authority > asset-connection-resiliency")," level (so as to apply to every router within an ",Object(r.b)("em",{parentName:"p"},"authority"),") as well as at the ",Object(r.b)("inlineCode",{parentName:"p"},"router > asset-connection-resiliency")," level (so as to provide an override to the value set at the ",Object(r.b)("em",{parentName:"p"},"authority"),"). These SSH connections are unnecessary if the network topology already affords reliable salt connectivity."),Object(r.b)("h2",{id:"troubleshooting"},"Troubleshooting"),Object(r.b)("p",null,"In order to determine if the long-lived SSH sessions are established, executing ",Object(r.b)("inlineCode",{parentName:"p"},"show system services")," will display if the service is running properly:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{}),"Retrieving system services...\n================== ==================================== ==============\n Node               Service                              Active State\n================== ==================================== ==============\n T114_DUT3.Router   128TWeb.service                     active\n T114_DUT3.Router   auditd.service                      active\n T114_DUT3.Router   prank.service                       active\n T114_DUT3.Router   salt-ssh@192.168.1.14-4505.service  active\n T114_DUT3.Router   salt-ssh@192.168.1.14-4506.service  active\n T114_DUT3.Router   salt-ssh@192.168.1.6-4505.service   active\n T114_DUT3.Router   salt-ssh@192.168.1.6-4506.service   active\n T114_DUT3.Router   t128-process-metrics.service        active\n T114_DUT3.Router   tank.service                        active\n T114_DUT4.Router   128TWeb.service                     active\n T114_DUT4.Router   auditd.service                      active\n T114_DUT4.Router   prank.service                       active\n T114_DUT4.Router   salt-ssh@192.168.1.14-4505.service  active\n T114_DUT4.Router   salt-ssh@192.168.1.14-4506.service  active\n T114_DUT4.Router   salt-ssh@192.168.1.6-4505.service   active\n T114_DUT4.Router   salt-ssh@192.168.1.6-4506.service   active\n T114_DUT4.Router   t128-process-metrics.service        active\n T114_DUT4.Router   tank.service                        active\n\nCompleted in 0.04 seconds\n")),Object(r.b)("p",null,"This output shows a total of four SSH connections, one SSH connection per salt port per node of a HA router."),Object(r.b)("div",{className:"footnotes"},Object(r.b)("hr",{parentName:"div"}),Object(r.b)("ol",{parentName:"div"},Object(r.b)("li",Object(o.a)({parentName:"ol"},{id:"fn-1"}),"Salt does not have a way to configure different IP addresses for the publish and return ports.",Object(r.b)("a",Object(o.a)({parentName:"li"},{href:"#fnref-1",className:"footnote-backref"}),"\u21a9")))))}p.isMDXComponent=!0},256:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var o=n(0),a=n.n(o);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),p=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),d=o,h=u["".concat(i,".").concat(d)]||u[d]||b[d]||r;return n?a.a.createElement(h,s(s({ref:t},l),{},{components:n})):a.a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);