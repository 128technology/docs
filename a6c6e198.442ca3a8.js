(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{166:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return m}));var i=n(2),r=n(6),a=(n(0),n(224)),o={title:"Configuring In-Memory Metrics",sidebar_label:"In-Memory Metrics"},s={unversionedId:"config_in-memory_metrics",id:"config_in-memory_metrics",isDocsHomePage:!1,title:"Configuring In-Memory Metrics",description:"Support for persisting in-memory 128T metrics allows you historical access to longer term system measurements. The feature also provides greater control over which combinations of those in-memory metrics should be persisted and for how long.",source:"@site/docs/config_in-memory_metrics.md",slug:"/config_in-memory_metrics",permalink:"/docs/config_in-memory_metrics",version:"current",lastUpdatedAt:1628560762,sidebar_label:"In-Memory Metrics",sidebar:"docs",previous:{title:"Native GRE Tunnels",permalink:"/docs/config_gre_tunnel"},next:{title:"Configuring High Availability (128T Router)",permalink:"/docs/config_ha"}},c=[{value:"Metrics Profile",id:"metrics-profile",children:[{value:"Metrics",id:"metrics",children:[]},{value:"Filters",id:"filters",children:[]},{value:"Profile References",id:"profile-references",children:[]},{value:"Profile Retention",id:"profile-retention",children:[]},{value:"In-Memory Metrics Sample Configuration",id:"in-memory-metrics-sample-configuration",children:[]}]}],l={rightToc:c};function m(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Support for persisting in-memory 128T metrics allows you historical access to longer term system measurements. The feature also provides greater control over which combinations of those in-memory metrics should be persisted and for how long."),Object(a.b)("h2",{id:"metrics-profile"},"Metrics Profile"),Object(a.b)("p",null,"To use In-Memory Metrics, specify the metrics intended for persistence as part of a Metrics Profile. Profiles are configured at the Authority level and referenced by the relevant routers. Each Profile specifies a number of metrics and the desired parameter filters."),Object(a.b)("h3",{id:"metrics"},"Metrics"),Object(a.b)("p",null,"An individual metric indicates one 128T metric to be part of the profile. Each profile must contain at least one metric to be valid. The metric\u2019s ID matches the description in the REST API/Swagger documentation for the statistic."),Object(a.b)("h3",{id:"filters"},"Filters"),Object(a.b)("p",null,"Filters are optional, but are important in their ability to limit the resources consumed by the metrics subsystem. Filters allow you to indicate your interest in a particular interface or peer-path without the necessity to persist all of the instances of the metric. If no filters are indicated, all instances are persisted."),Object(a.b)("p",null,"When using filters, the parameters and values must be relevant for all metrics in the profile. If one of the metrics does not have the specified parameter, or has none of the values, that metric will produce no data."),Object(a.b)("p",null,"Example of Simple Grouping with Filtering:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),'config\n\n    authority\n\n        metrics-profile  internet-reachability-metrics\n            name    internet-reachability-metrics\n\n            metric  /stats/highway/destination-reachability/icmp/time-to-establishment/max\n                id           /stats/highway/destination-reachability/icmp/time-to-establishment/max\n                description  "Max ICMP time to establish"\n            exit\n\n            metric  /stats/highway/destination-reachability/tcp/time-to-establishment/max\n                id           /stats/highway/destination-reachability/tcp/time-to-establishment/max\n                description  "Max TCP time to establish"\n            exit\n\n            metric  /stats/highway/destination-reachability/icmp/time-to-establishment/mean\n                id           /stats/highway/destination-reachability/icmp/time-to-establishment/mean\n                description  "Avg ICMP time to establish"\n            exit\n\n            metric  /stats/highway/destination-reachability/tcp/time-to-establishment/mean\n                id           /stats/highway/destination-reachability/tcp/time-to-establishment/mean\n                description  "Avg TCP time to establish"\n            exit\n\n            filter  service\n                parameter  service\n                value      internet\n            exit\n\n            filter  traffic-class\n                parameter  traffic-class\n                value      best-effort\n            exit\n        exit\n    exit\nexit\n')),Object(a.b)("p",null,"When the above profile is referenced by a router, the various reachability metrics are persisted but only for the ",Object(a.b)("inlineCode",{parentName:"p"},"internet")," service and ",Object(a.b)("inlineCode",{parentName:"p"},"best-effort")," traffic-class. These metrics are available as time-series from the GraphQL API or in the GUI."),Object(a.b)("h3",{id:"profile-references"},"Profile References"),Object(a.b)("p",null,"Once a profile is configured on the Authority, it is availble to the routers, and each router may reference any number of relevant profiles. With each reference to a profile, the router configuration must specify the retention for the profile. The Profile Retention value determines how long the profile\u2019s metrics are retained."),Object(a.b)("h3",{id:"profile-retention"},"Profile Retention"),Object(a.b)("p",null,"Profile Retention can be configured as any of four values: ",Object(a.b)("strong",{parentName:"p"},"in-memory"),", ",Object(a.b)("strong",{parentName:"p"},"short"),", ",Object(a.b)("strong",{parentName:"p"},"intermediate"),", and ",Object(a.b)("strong",{parentName:"p"},"long"),". "),Object(a.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(a.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-heading"}),Object(a.b)("h5",{parentName:"div"},Object(a.b)("span",Object(i.a)({parentName:"h5"},{className:"admonition-icon"}),Object(a.b)("svg",Object(i.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(a.b)("path",Object(i.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(a.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-content"}),Object(a.b)("p",{parentName:"div"},"Metrics cascade from one retention value to the next; the use of any one value implies all values before it are also in effect. For example, using ",Object(a.b)("strong",{parentName:"p"},"intermediate")," implies that ",Object(a.b)("strong",{parentName:"p"},"short")," is also used."))),Object(a.b)("p",null,"Retention values are not configurable. The list below indicates the configuration order."),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"in-memory"),Object(a.b)("li",{parentName:"ul"},"short"),Object(a.b)("li",{parentName:"ul"},"intermediate"),Object(a.b)("li",{parentName:"ul"},"long")),Object(a.b)("p",null,"The current implementation of the ",Object(a.b)("inlineCode",{parentName:"p"},"in-memory")," retention value is limited.  "),Object(a.b)("h4",{id:"example-profile-native-output"},"Example Profile: Native Output"),Object(a.b)("p",null,"The following example configuration takes metrics specified in the ",Object(a.b)("inlineCode",{parentName:"p"},"internet-reachability-metrics")," profile and stores them through the ",Object(a.b)("strong",{parentName:"p"},"intermediate")," retention time period."),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),"configure\n    authority\n        router           MyRouter\n            name MyRouter\n            system\n                metrics\n                    profile  internet-reachability-metrics\n                        name       internet-reachability-metrics\n                        retention  intermediate\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n\n")),Object(a.b)("h3",{id:"in-memory-metrics-sample-configuration"},"In-Memory Metrics Sample Configuration"),Object(a.b)("p",null,"The following example provides a sample configuration that makes use of several aspects of the Metrics Profile feature."),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Multiple metrics in the same profile"),Object(a.b)("li",{parentName:"ul"},"Filtered profile (peer-metrics)"),Object(a.b)("li",{parentName:"ul"},"Unfiltered profile (events)"),Object(a.b)("li",{parentName:"ul"},"Multiple profiles for the same router (MyRouter)"),Object(a.b)("li",{parentName:"ul"},"Different retention targets for different profiles (MyRouter)")),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),"config\n    authority\n        metrics-profile  peer-metrics\n            name    peer-metrics\n\n            metric  /stats/bfd/peer-path/async/sent/success\n                id  /stats/bfd/peer-path/async/sent/success\n            exit\n\n            metric  /stats/bfd/peer-path/async/received/miss\n                id  /stats/bfd/peer-path/async/received/miss\n            exit\n\n            filter  peer-name\n                parameter  peer-name\n                value      MyOtherRouter\n            exit\n        exit\n\n        metrics-profile  events\n            name    events\n\n            metric  /stats/audit/events/produced\n                id  /stats/audit/events/produced\n            exit\n        exit\n\n        router           MyRouter\n            name MyRouter\n            system\n                metrics\n                    profile  events\n                        name       events\n                        retention  long\n                    exit\n\n                    profile  peer-metrics\n                        name       peer-metrics\n                        retention  short\n                    exit\n                exit\n            exit\n        exit\n\n        router           MyConductor\n            name MyConductor\n            system\n                metrics\n                    profile  events\n                        name       events\n                        retention  long\n                    exit\n                exit\n            exit\n        exit\n    exit\nexit\n\n")))}m.isMDXComponent=!0},224:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f}));var i=n(0),r=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),m=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=m(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=m(n),u=i,f=p["".concat(o,".").concat(u)]||p[u]||b[u]||a;return n?r.a.createElement(f,s(s({ref:t},l),{},{components:n})):r.a.createElement(f,s({ref:t},l))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<a;l++)o[l]=n[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);