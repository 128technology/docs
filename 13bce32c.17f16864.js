(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{202:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u}));var a=i(0),n=i.n(a);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var s=n.a.createContext({}),p=function(e){var t=n.a.useContext(s),i=t;return e&&(i="function"==typeof e?e(t):c(c({},t),e)),i},d=function(e){var t=p(e.components);return n.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},m=n.a.forwardRef((function(e,t){var i=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=p(i),m=a,u=d["".concat(o,".").concat(m)]||d[m]||b[m]||r;return i?n.a.createElement(u,c(c({ref:t},s),{},{components:i})):n.a.createElement(u,c({ref:t},s))}));function u(e,t){var i=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=i.length,o=new Array(r);o[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<r;s++)o[s]=i[s];return n.a.createElement.apply(null,o)}return n.a.createElement.apply(null,i)}m.displayName="MDXCreateElement"},65:function(e,t,i){"use strict";i.r(t),i.d(t,"frontMatter",(function(){return o})),i.d(t,"metadata",(function(){return c})),i.d(t,"rightToc",(function(){return l})),i.d(t,"default",(function(){return p}));var a=i(2),n=i(6),r=(i(0),i(202)),o={title:"Rate Limiting"},c={unversionedId:"config_rate_limiting",id:"config_rate_limiting",isDocsHomePage:!1,title:"Rate Limiting",description:"Rate limiting, when configured, is applied to packets entering the data path prior to any packet transformations so as to prevent an individual flow from consuming more bandwidth than allowed.",source:"@site/docs/config_rate_limiting.md",slug:"/config_rate_limiting",permalink:"/docs/config_rate_limiting",version:"current",lastUpdatedAt:1593706112,sidebar:"docs",previous:{title:"Open Shortest Path First (OSPF)",permalink:"/docs/config_ospf"},next:{title:"Simple Network Management Protocol (SNMP)",permalink:"/docs/config_snmp"}},l=[{value:"Per-Flow Rate Limiting",id:"per-flow-rate-limiting",children:[{value:"Configuration",id:"configuration",children:[]}]},{value:"Per-Service Rate Limiting",id:"per-service-rate-limiting",children:[{value:"Configuration",id:"configuration-1",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]},{value:"Caveats",id:"caveats",children:[]}]}],s={rightToc:l};function p(e){var t=e.components,i=Object(n.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,i,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Rate limiting, when configured, is applied to packets entering the data path prior to any packet transformations so as to prevent an individual flow from consuming more bandwidth than allowed."),Object(r.b)("h2",{id:"per-flow-rate-limiting"},"Per-Flow Rate Limiting"),Object(r.b)("p",null,'The 128T has the ability to apply rate limiting to individual flows within a session for a service. This provides the ability to ensure that each flow to and from a service conforms to a specific "shape".  This can be particularly useful if the sessions of a service are used for high bandwidth applications such as downloading or uploading content.  Each flow can be restricted to use only a specific amount of bandwidth. This capability in turn can be used to limit the amount of traffic egressing the 128T, regulating the traffic entering the traffic scheduler.'),Object(r.b)("p",null,"Individual flow rate limiting, can prevent bad actors and lead to a more desirable overall system performance. Accurate rate limiting can be a bit of a black art to configure properly per flow, as it is highly dependent on the application."),Object(r.b)("h3",{id:"configuration"},"Configuration"),Object(r.b)("p",null,"Rate limiting can be configured for a particular service, by way of its associated service-class and is applied individually to each flow."),Object(r.b)("p",null,"There are two parameters that affect the shape of a flow:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"max-flow-rate")," defined in bits/second, regulates the average rate of traffic.",Object(r.b)("div",Object(a.a)({parentName:"li"},{className:"admonition admonition-note alert alert--secondary"}),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Rate is calculated on a interval relative to the arrival of flows. Some bursts may appear, but not greater than the configured ",Object(r.b)("inlineCode",{parentName:"p"},"max-burst-rate"))))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"max-flow-burst")," defined in bits/seconds, serves to minimize bursts of traffic within a flow.")),Object(r.b)("p",null,"Sample configuration:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"service-class   rate-policy-class\n    name                         rate-policy-class\n    rate-limit                   true\n    max-flow-rate                100000\n    max-flow-burst               100000\nexit\n\nservice-policy  shaped-service-policy\n    name           shaped-service-policy\n    service-class  rate-policy-class\nexit\n\nservice         shaped-service\n    name            shaped-service\n    service-policy  shaped-service-policy\nexit\n")),Object(r.b)("p",null,"This example will limit bursts as well as the bandwidth per flow to 100Kbps."),Object(r.b)("h2",{id:"per-service-rate-limiting"},"Per-Service Rate Limiting"),Object(r.b)("p",null,"Rate limiting per service affords the administrator the ability to configure the maximum aggregate incoming bandwidth allowed for a service. ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/concepts_glossary#services"}),"Services"),", being a global construct, can be applied across all routers. Each router therefore has the ability to define an individual policy, which can then be applied to the service directly on a specific router by leveraging ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/bcp_service_and_service_policy_design#routerrouter-group-based-services"}),"router-group")," syntax."),Object(r.b)("p",null,"For example, in a hub and spoke topology, if a service is defined between a 128T router located within a data center and all branch locations, the aggregate rate limit configured ",Object(r.b)("em",{parentName:"p"},"locally")," on the data center router would be applied to all incoming traffic for this service entering the data center. No rate limiting will be applied at the branch sites."),Object(r.b)("p",null,"For a service defined from a branch site to the data center, the aggregate rate limit would be applied at the branch site, using the locally defined rate limiting policy, and would not be applied at the data center."),Object(r.b)("h3",{id:"configuration-1"},"Configuration"),Object(r.b)("p",null,"Rate limiting policy can be defined in one of two ways:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"shared")," - the profile is shared across multiple services that have the profile defined in their ",Object(r.b)("em",{parentName:"li"},"service-class"),", where all sessions that belong to all matching services get a slice of the bandwidth on a first-come first-serve basis."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"per-service")," - each service has its own rate-limiter, and the bandwidth is only shared across sessions that belong to that service. Multiple service-classes can use the same profile, but the bandwidth will not be shared across services.")),Object(r.b)("p",null,"Since 128T services are directional, it is important to be able to control the direction in which the traffic is being rate-limited. For example, if the service being limited is a software update service and if the updates are being pushed, configuring the ",Object(r.b)("inlineCode",{parentName:"p"},"upload-settings")," of the rate-limit profile will control the bandwidth of the incoming traffic. If the updates are being pulled, configuring the ",Object(r.b)("inlineCode",{parentName:"p"},"download-settings")," will control the rate. Upload and download settings can be configured simultaneously."),Object(r.b)("p",null,"Once the rate-limit-policy is defined, in order for it to be applied to a service, ",Object(r.b)("inlineCode",{parentName:"p"},"aggregate-rate-limit-policy")," must be defined in the ",Object(r.b)("inlineCode",{parentName:"p"},"service-class"),"."),Object(r.b)("p",null,"Flow rate limiting and aggregate rate limiting can configured independently of each other. When both ",Object(r.b)("inlineCode",{parentName:"p"},"rate-limit")," and ",Object(r.b)("inlineCode",{parentName:"p"},"aggregate-rate-limit-policy")," are enabled in the ",Object(r.b)("inlineCode",{parentName:"p"},"service-class"),", flow rate limiting will be applied first, before aggregate rate limiting."),Object(r.b)("p",null,"Sample configuration:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"rate-limit-policy    rate-limiting\n    name               rate-limiting\n    mode               shared\n    upload-settings\n        max-rate   300000\n        max-burst  300000\n    exit\n    download-settings\n        max-rate   300000\n        max-burst  300000\n    exit\nexit\n\nservice-class   rate-policy-class\n    name                         rate-policy-class\n    rate-limit                   true\n    aggregate-rate-limit-policy  rate-limiting\nexit\n\nservice-policy  shaped-service-policy\n    name           shaped-service-policy\n    service-class  rate-policy-class\nexit\n\nservice         shaped-service\n    name            shaped-service\n    service-policy  shaped-service-policy\nexit\n\n")),Object(r.b)("h3",{id:"troubleshooting"},"Troubleshooting"),Object(r.b)("p",null,"To determine the number of packets meeting the rate limit check, execute the command on the PCLI:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"show stats packet-processing action success rate-limit-check\n")),Object(r.b)("p",null,"To determine the number of packets dropped as a result of exceeding flow rate check, execute the command on the PCLI:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"show stats packet-processing action failure rate-limit-check flow-rate-exceeded\n")),Object(r.b)("p",null,"To determine the number of packets dropped as a result of exceeding shared flow rate check, execute the command on the PCLI:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"show stats packet-processing action failure rate-limit-check shared-rate-exceeded\n")),Object(r.b)("h3",{id:"caveats"},"Caveats"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Enabling rate-limiting at a service level does have an impact on system performance and requires additional memory."),Object(r.b)("li",{parentName:"ul"},"Using ",Object(r.b)("em",{parentName:"li"},"rate-limit-policy")," in ",Object(r.b)("em",{parentName:"li"},"shared")," mode on systems with multiple CPU cores where packet processing worker threads are provisioned on both cores will have a greater impact on system performance as locking is necessary to ensure consistency in aggregate calculations."),Object(r.b)("li",{parentName:"ul"},"Shared rate limiting is shared across all sessions within a 128T node and is not shared across nodes of a HA pair."),Object(r.b)("li",{parentName:"ul"},"Shared rate limiting is not shared across multiple routers processing sessions for the same service.")))}p.isMDXComponent=!0}}]);