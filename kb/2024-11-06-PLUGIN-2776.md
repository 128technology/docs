---
title: Change in behavior for Salt states for 5.6.16+, 6.1.12+
date: 2024-11-06
tags: ['salt-stack, sip-alg']
hide_table_of_contents: false
---

Salt states can potentially fail to apply on certain routers post upgrade to 5.6.16, 6.1.12 or above

<!-- truncate -->

**Issue ID:** PLUGIN-2776

**Last Updated:** 2024-11-06

**Introduced in SSR Version:** 5.6.16, 6.1.12

**Impacted Plugin version:** 128T-sip-alg-4.0.1 and below

### Problem
SSR is migrating its underlying Linux distribution in an effort to remain agile and to reduce the surface area of CVEs. This change has an impact on certain packages that have an OS dependency such as salt stack. When customers have custom salt states which leverage OS specific salt grains for `CentOS Linux 7`, after upgrading to 5.6.16 (or beyond), those salt states would fail to apply as the OS version is now reported as Oracle Linux instead of CentOS.

Similar to custom salt states, the SIP ALG plugin was also leveraging the same feature. Any version of the 128T-sip-alg plugin 4.0.1 or below will face this issue when the router is upgraded to 5.6.16. The fix for the issue is being released in 4.0.2 version of the plugin in the near future. The fix will be compatible with both pre and post 5.6.16 versions.

### Release Notes
* Resolved the salt state issues for the SIP ALG plugin
* Provide a procedure for customers to scan their salt states prior to upgrade to avoid problems during router upgrades.

### Severity
<details>
The potential impact of a software defect if encountered. Severity levels are:
* Critical: Could severely affect service, capacity/traffic, and maintenance capabilities. May have a prolonged impact to the entire system.
* Major: Could seriously affect system operation, maintenance, administration and related tasks.
* Minor: Would not significantly impair the functioning or affect service.
</details>
Major

### Status
In Progress

### Resolved In
TBD

### Product
SSR

### Functional Area
Salt Stack

### Workaround
<details>
Juniper may provide a method to temporarily circumvent a problem; workarounds do not exist for all issues.
</details>

For customer that implement custom salt states, they should follow the procedure below to scan their salt states to identify any potential problems they could run into during upgrades.

1. Scan the custom salt states for Centos 7 by doing `grep -riE 'cent[-]?os' /srv/salt`
2. If the above command results in no hits, that means none of the custom salt states leverage the OS specific salt grain features.
:::note
@Chris - insert some text about potential unknown issues that users could face etc
:::
3. If the above command results in hits, please remediate the salt states to be OS agnostic. Here's an example of one possible remediation stragety. Please note, the exact changes would depend on the situation and customers should work with their subject matter experts to properly remediate and test these changes

Example salt state before the change
```
{% set defaults = salt['grains.filter_by']({
    'CentOS Linux-7': {
        'network_routes_target_filedir': '/etc/sysconfig/network-scripts/route-',
    },
}, grain='osfinger', merge=salt['pillar.get']('repo_map:merge'), base=None) %}
```

The remediated version look as follows in this instance
```
{% set defaults = {
    'network_routes_target_filedir': '/etc/sysconfig/network-scripts/route-',
    }
%}
```

