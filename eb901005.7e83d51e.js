(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{238:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return o})),r.d(t,"metadata",(function(){return c})),r.d(t,"rightToc",(function(){return l})),r.d(t,"default",(function(){return s}));var n=r(2),a=r(9),i=(r(0),r(251)),o={title:"PCLI Packet Capture"},c={id:"ts_packet_capture",title:"PCLI Packet Capture",description:"In troubleshooting issues in a network, time is of the utmost importance.  With that, PCAPs are one of the most useful tools to debug traffic issues on a 128T Router(s) as well as wider networking issues.  Given those two factors, there\u2019s often a need to quickly add or remove a capture filter without a need to make it persistent.",source:"@site/docs/ts_packet_capture.md",permalink:"/docs/ts_packet_capture",lastUpdatedAt:1587822188,sidebar:"docs",previous:{title:"MAC Address Uniqueness on 128T",permalink:"/docs/ts_mac_uniqueness"},next:{title:"T1 Troubleshooting",permalink:"/docs/ts_t1_troubleshooting"}},l=[{value:"create capture-filter",id:"create-capture-filter",children:[]},{value:"delete capture-filter",id:"delete-capture-filter",children:[]},{value:"show capture-filter",id:"show-capture-filter",children:[]}],u={rightToc:l};function s(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},u,r,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"In troubleshooting issues in a network, time is of the utmost importance.  With that, PCAPs are one of the most useful tools to debug traffic issues on a 128T Router(s) as well as wider networking issues.  Given those two factors, there\u2019s often a need to quickly add or remove a capture filter without a need to make it persistent."),Object(i.b)("p",null,"Without this feature's functionality the only way to enable capture filters is through configuration.  The ",Object(i.b)("inlineCode",{parentName:"p"},"capture-filter")," list must be added to the configuration of the device interface and then configuration must be applied for capture filters to take effect, which in turn, makes them persistent across reboots.  While straight forward and easily configured, when configuration grow in scale and size this process can become time consuming to perform and gather the necessary information in time available.  Additionally, there may be configuration that has been staged that is not ready to commit.  This staged configuration would need to be rolled back in order to enable pcaps - a most undesirable workflow."),Object(i.b)("p",null,"There are some caveats to note when using this functionality:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Creating or removing a capture filter in this way does not persist and will not survive a reboot or restart of the 128T software"),Object(i.b)("li",{parentName:"ul"},"There is an interaction with configured capture filters when creating and removing capture filters manually",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"If capture filters exist within the configuration and a configuration change happens that does not impact static capture-filters, the configuration change will not affect dynamic capture-filters."),Object(i.b)("li",{parentName:"ul"},"If static capture-filters exist within the configuration, and if a configuration change modifies the static capture-filters, all dynamic capture-filters will be removed.")))),Object(i.b)("p",null,"Three CLI Commands have been added to perform these functions:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/cli_reference#create-capture-filter"}),"create capture-filter")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/cli_reference#delete-capture-filter"}),"delete capture-filter")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/cli_reference#show-capture-filters"}),"show capture-filter"))),Object(i.b)("h3",{id:"create-capture-filter"},"create capture-filter"),Object(i.b)("p",null,"The capture-filter uses BPF (Berkeley Packet Filter) syntax, exactly the same as the configured capture filters. If the syntax is not correct, the filter will be rejected. Please refer to online BPF documentation for syntax help. If a capture filter already exists, the create will simply be ignored."),Object(i.b)("p",null,"An example of creating a capture filter is below:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),">> create capture-filter\n  usage: capture-filter [force] [router <router>] [node <node>]\n                         device-interface <device-interface> <capture-filter>\n  Creates capture-filter from highway at the specified node\n  keyword arguments:\n  device-interface    The device interface on which to create the capture\n                      filter\n  force               Skip confirmation prompt\n  node                The node on which to create the capture filter\n  router              The router on which to create the capture filter\n  positional arguments:\n  capture-filter      The capture-filter to create (Uses BPF syntax)\n")),Object(i.b)("h3",{id:"delete-capture-filter"},"delete capture-filter"),Object(i.b)("p",null,"This command can be used to remove the temporarily added capture filters as well as temporarily removing any added through configuration.  The command will return an error if the capture filter is not present."),Object(i.b)("p",null,"An example of removing a capture filter is below:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),">> delete capture-filter\n  usage: capture-filter [force] [router <router>] [node <node>]\n                        device-interface <device-interface> <capture-filter>\n  Deletes capture-filter from highway at the specified node\n  keyword arguments:\n  device-interface    The device interface on which to delete the capture\n                      filter\n  force               Skip confirmation prompt\n  node                The node on which to remove the capture filter\n  router              The router on which to remove the capture filter\n\n  positional arguments:\n  capture-filter    The capture-filter to remove (Uses BPF syntax)\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"device-interface all")," can be used to remove all capture filters on a particular node/router.  Omitting ",Object(i.b)("inlineCode",{parentName:"p"},"capture-filter")," from the command will remove all capture filters for a specified device interface."),Object(i.b)("h3",{id:"show-capture-filter"},"show capture-filter"),Object(i.b)("p",null,"Since the configuration of the system may no longer represent what's been manually added or removed, a corresponding show command is being added, which will display all temporary capture filters as well as the ones added through configuration"),Object(i.b)("p",null,"An example of showing a capture filter is below:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),">> show capture-filters\n  usage: capture-filters [device-interface <device-interface>]\n                         [force] [router <router>] [node <node>]\n  Show active capture-filters\n  keyword arguments:\n  device-interface    Device interface on which to show capture-filters\n  force               Skip confirmation prompt\n  node                The node on which to show capture-filters\n  router              The router on which to show capture-filters\n")))}s.isMDXComponent=!0},251:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return h}));var n=r(0),a=r.n(n);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var u=a.a.createContext({}),s=function(e){var t=a.a.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},p=function(e){var t=s(e.components);return a.a.createElement(u.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=s(r),d=n,h=p["".concat(o,".").concat(d)]||p[d]||f[d]||i;return r?a.a.createElement(h,c(c({ref:t},u),{},{components:r})):a.a.createElement(h,c({ref:t},u))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,o=new Array(i);o[0]=d;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:n,o[1]=c;for(var u=2;u<i;u++)o[u]=r[u];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,r)}d.displayName="MDXCreateElement"}}]);