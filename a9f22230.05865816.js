(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{166:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return a})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return f}));var r=n(2),o=n(6),i=(n(0),n(223)),a={title:"Troubleshooting VRF",sidebar_label:"Troubleshooting VRF"},c={unversionedId:"ts_troubleshooting_vrf",id:"ts_troubleshooting_vrf",isDocsHomePage:!1,title:"Troubleshooting VRF",description:"The show rib vrf command can be used to check for the presence of VRF route entries.",source:"@site/docs/ts_troubleshooting_vrf.md",slug:"/ts_troubleshooting_vrf",permalink:"/docs/ts_troubleshooting_vrf",version:"current",lastUpdatedAt:1626701358,sidebar_label:"Troubleshooting VRF",sidebar:"docs",previous:{title:"T1 Troubleshooting",permalink:"/docs/ts_t1_troubleshooting"},next:{title:"Alarms and Events",permalink:"/docs/events_overview"}},s=[{value:"Linux Kernel State",id:"linux-kernel-state",children:[]}],l={rightToc:s};function f(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"show rib vrf")," command can be used to check for the presence of VRF route entries.\nIf expected VRF route entries are not present, the following steps may be used to troubleshoot the problem:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"The ",Object(i.b)("inlineCode",{parentName:"p"},"show vrf")," command will display all the VRFs that were created based on the running configuration. A missing or incorrect VRF entry is likely due to a configuration issue.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"The ",Object(i.b)("inlineCode",{parentName:"p"},"show bgp summary vrf")," command displays an overview of the status of the BGP VRF peering sessions. Any non-established session can then be investigated further.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"The ",Object(i.b)("inlineCode",{parentName:"p"},"show network-interface")," command can be used to check all interfaces associated with the VRF (via their tenant assignment). The BGP VRF peering might not be able to become established due to a down interface."))),Object(i.b)("h3",{id:"linux-kernel-state"},"Linux Kernel State"),Object(i.b)("p",null,"Any configured VRF will be present as a VRF table in the Linux kernel within the routingEngine namespace. A VRF in the kernel is represented by a pseudo interface of type \u201cvrf\u201d. Any network interface associated with the VRF (via its tenant) is represented by a kernel interface that is linked to the VRF pseudo interface:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"[root@t190-dut2 ~]# ip netns exec routingEngine ip link show type vrf\n4: vrfA: <NOARP,MASTER,UP,LOWER_UP> mtu 65536 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 1a:4b:90:bb:a7:e3 brd ff:ff:ff:ff:ff:ff\n5: vrfB: <NOARP,MASTER,UP,LOWER_UP> mtu 65536 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 86:a7:3c:07:53:dc brd ff:ff:ff:ff:ff:ff\n12: vrfC: <NOARP,MASTER,UP,LOWER_UP> mtu 65536 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0e:25:f1:5a:c4:bd brd ff:ff:ff:ff:ff:ff\n\n[root@t190-dut2 ~]# ip netns exec routingEngine ip link show vrf vrfA\n14: g111: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master vrfA state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether ac:de:48:50:ba:73 brd ff:ff:ff:ff:ff:ff\n")),Object(i.b)("p",null,"In the above example, g111 is a vlan network-interface configured with a tenant that is part of vrfA. So the g111 link has the master vrfA attribute.\nThe kernel VRF table is the basis for connecting to the VRF BGP neighbor and enables redistribution of services into the VRF: "),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"[root@t190-dut2 ~]# ip netns exec routingEngine ip route show vrf vrfA\nblackhole 10.4.0.0/16 metric 4262412864 \nblackhole 10.5.0.0/16 metric 4262412864 \n10.111.1.5 via 172.16.111.6 dev g111 proto 186 metric 20 \nblackhole 11.1.1.1 metric 4262412864 \n172.16.111.0/24 dev g111 proto kernel scope link src 172.16.111.2\n")),Object(i.b)("p",null,"In the above example, the three blackhole routes represent services with service-routes that are available in the VRF. These are picked up by the VRF BGP instance and re-distributed if redistribute service is configured."),Object(i.b)("p",null,"The 172.16.111.0/24 entry is the connected route for the VLAN network-interface bound to the VRF. 10.111.1.5 is a route learned from the VRF BGP peer."))}f.isMDXComponent=!0},223:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var r=n(0),o=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),f=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},u=function(e){var t=f(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,a=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=f(n),p=r,d=u["".concat(a,".").concat(p)]||u[p]||b[p]||i;return n?o.a.createElement(d,c(c({ref:t},l),{},{components:n})):o.a.createElement(d,c({ref:t},l))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=p;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,a[1]=c;for(var l=2;l<i;l++)a[l]=n[l];return o.a.createElement.apply(null,a)}return o.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);