<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-plugin_http_probe" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">HTTP Probe Reachability Detection Plugin | SSN Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.128technology.com/docs/plugin_http_probe"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="HTTP Probe Reachability Detection Plugin | SSN Docs"><meta data-rh="true" name="description" content="The http-probe plugin is designed to leverage the reachability detection APIs that were introduced in the SSR as of 5.2.0 version of software. More documentation on the core product feature can be found here"><meta data-rh="true" property="og:description" content="The http-probe plugin is designed to leverage the reachability detection APIs that were introduced in the SSR as of 5.2.0 version of software. More documentation on the core product feature can be found here"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.128technology.com/docs/plugin_http_probe"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/plugin_http_probe" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/plugin_http_probe" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/kb/rss.xml" title="SSR Knowledge Base Articles RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/kb/atom.xml" title="SSR Knowledge Base Articles Atom Feed">
<link rel="alternate" type="application/json" href="/kb/feed.json" title="SSR Knowledge Base Articles JSON Feed"><link rel="stylesheet" href="/assets/css/styles.b50a304b.css">
<script src="/assets/js/runtime~main.15726a69.js" defer="defer"></script>
<script src="/assets/js/main.57ae2a92.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a class="navbar__item navbar__link" href="/kb">Knowledge Base</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cc_fips_titlepage">SSR Common Criteria Install and Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_upgrade_considerations">Upgrading the SSR</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation">Installation Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation_univ-iso">SSR Universal ISO Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/supported_cloud_platforms">Cloud / Hypervisor Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation_legacy">Legacy Install Information</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concepts_fib">Understanding the Forwarding Information Base</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/wan_overview">WAN Assurance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/config_basics">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/bcp_sdwan_design_guide">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/plugin_intro">Plugins</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_bgp_community_services">BGP Community Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_cloud_ha">Cloud HA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_dns_app_id">DNS App Id</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_dns_cache">DNS Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_gre">GRE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_ha_sync_redundancy">HA Sync Redundancy Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/plugin_http_probe">HTTP Probe Reachability Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_icmp_reachability_detection">ICMP Reachability Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_ipsec_client">IPsec Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_loopback_static_routes">Loopback Static Routes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_m800_watchdog">M800 Watchdog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_monitoring_agent">Monitoring Agent Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_mosh">Mosh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_set_hostname">Set Hostname</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_sip_alg">SIP ALG</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_wireguard">Wireguard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_kni_namespace_scripts">KNI Namespace Scripts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/release_notes_128t_6.3">Release Notes</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Plugins</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">HTTP Probe Reachability Detection</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>HTTP Probe Reachability Detection Plugin</h1></header><p>The http-probe plugin is designed to leverage the reachability detection APIs that were introduced in the SSR as of 5.2.0 version of software. More documentation on the core product feature can be found <a href="/docs/config_service_health">here</a></p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The instructions for installing and managing the plugin can be found <a href="/docs/plugin_intro#installation-and-management">here</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>Once installed and configured properly, the plugin will do the following operations on the router.</p>
<ul>
<li>Launch a set of HTTP(s) monitor services which will probe the configured HTTP or HTTPs URL at the configured frequency</li>
<li>Periodically update the load-balancer APIs with the up/down status on service-paths associated with the http-probes</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>For HTTPS probes, the client will allow self-signed certificates for inspecting the reachability status of the service.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-snippet">Configuration Snippet<a href="#configuration-snippet" class="hash-link" aria-label="Direct link to Configuration Snippet" title="Direct link to Configuration Snippet">​</a></h2>
<p>The plugin leverages the existing SSR reachability detection and enforcement configuration within the service-route on the router.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="http-probe-profile-configuration">HTTP Probe Profile configuration<a href="#http-probe-profile-configuration" class="hash-link" aria-label="Direct link to HTTP Probe Profile configuration" title="Direct link to HTTP Probe Profile configuration">​</a></h3>
<ul>
<li>Config Path: authority &gt; router[name] &gt; http-probe-profile</li>
<li>Config Fields:</li>
</ul>
<table><thead><tr><th>Name</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>key</td><td>The name of the http probe profile</td></tr><tr><td>url</td><td>string</td><td>max: 2048</td><td>A valid http or https URL to be used for availability checking</td></tr><tr><td>probe-interval</td><td>uint32</td><td>default: 10</td><td>The duration (in seconds) of how often to perform a link test to the destination</td></tr><tr><td>number-of-attempts</td><td>uint32</td><td>default: 4</td><td>The number of consecutive HTTP(s) requests to be sent within the probe-duration before deciding that destination is unreachable</td></tr><tr><td>probe-duration</td><td>uint32</td><td>default: 5</td><td>The duration (in seconds) within which to reach the destination. Each attempt will be made in (probe-duration / number-of-attempts) interval</td></tr><tr><td>valid-status-code</td><td>list</td><td>at least 1 value required</td><td>The list of valid status codes to be expected from the server</td></tr><tr><td>sla</td><td>container</td><td>optional</td><td>SLA requirements for http probe. See <a href="#sla">SLA</a> for more information.</td></tr><tr><td>up-delay-timer</td><td>uint32</td><td>default: 0</td><td>The duration (in seconds) a probe is held down before transitioning from down to up state</td></tr></tbody></table>
<ul>
<li>Example:</li>
</ul>
<div class="language-config codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-config codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">            http-probe-profile  http-probe-1</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                name               http-probe-1</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                url                http://172.16.2.5:5060/</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                probe-interval     60</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                number-of-attempts 5</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                probe-duration     20</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                valid-status-code  202</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                valid-status-code  200</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Above configuration runs http probe as follow:
<img decoding="async" loading="lazy" alt="Http Probe Timeline" src="/assets/images/http-probe-timeline-73f1ce42782ac9b0e07c49066c27bfea.png" width="2475" height="771" class="img_ev3q">
Based on the configuration, every test runs five probe attempts. Each attempt runs with a two second hard timeout, calculated by the <code>probe-duration</code> divided by the <code>number-of-attempts</code>. Each probe may fail due to a request failure, timeout reached, or an invalid response code. Service path status is determined at the end of the probe duration and the current status will remain until the end of the next test.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Each router can configure up to 10 http probe profiles.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sla">SLA<a href="#sla" class="hash-link" aria-label="Direct link to SLA" title="Direct link to SLA">​</a></h3>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="version-history">Version History<a href="#version-history" class="hash-link" aria-label="Direct link to Version History" title="Direct link to Version History">​</a></h5>
<table><thead><tr><th>Release</th><th>Modification</th></tr></thead><tbody><tr><td>1.2.0</td><td><code>http-probe-profile &gt; sla</code> introduced</td></tr></tbody></table>
<p>SLA can be configured to add additional criteria to determine probe test success. The result of a probe test is based on number of probe attempts defined in the <code>http probe profile</code> configuration. Certain validations are applied to SLA configuration. <code>max-loss</code> should be less than <code>number-of-attempts</code>, <code>max-jitter</code> and <code>average-rtt</code> should be less than the single probe timeout calculated by <code>probe-duration</code> / <code>number-of-attempts</code>.</p>
<p>The below example sets SLA on the probe test; with these settings, the test will be triggered every 10 seconds, 3 probes with a single probe timeout of 2 seconds will be applied and max-loss of 2 is considered for every test.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    http-probe-profile      http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name                http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        url                 http://172.16.2.5:5060/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        valid-status-code   202</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        valid-status-code   200</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        probe-duration      6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        probe-interval      10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        number-of-attemps   3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sla</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            max-loss       2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Example:</li>
</ul>
<div class="language-config codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-config codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    http-probe-profile  http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sla</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            max-jitter     300</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            max-loss       2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            average-rtt    200</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>max-jitter</td><td>uint32</td><td>Maximum difference between the maximum and minimum RTT of the HTTP probe in milliseconds</td></tr><tr><td>average-rtt</td><td>unit32</td><td>Maximum average RTT for an HTTP probe test to be up in milliseconds</td></tr><tr><td>max-loss</td><td>unit8</td><td>Number of failed HTTP(s) probe requests to mark the test down</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="http-probe-log-level">HTTP Probe Log Level<a href="#http-probe-log-level" class="hash-link" aria-label="Direct link to HTTP Probe Log Level" title="Direct link to HTTP Probe Log Level">​</a></h3>
<ul>
<li>Config Path: authority &gt; router[name] &gt; http-probe</li>
<li>Config Fields:</li>
</ul>
<table><thead><tr><th>Name</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>log-level</td><td>enum</td><td>default: info</td><td>Http Probe Log Level</td></tr></tbody></table>
<ul>
<li>Example:</li>
</ul>
<div class="language-config codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-config codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            http-probe</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                log-level debug</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-route-configuration">Service Route Configuration<a href="#service-route-configuration" class="hash-link" aria-label="Direct link to Service Route Configuration" title="Direct link to Service Route Configuration">​</a></h3>
<p>Once the profile is created, the next step is to enable the reachability enforcement and probe detection for a non SVR service-route and reference the profile in that config.</p>
<ul>
<li>
<p>Config Path: authority &gt; router[name] &gt; service-route[name] &gt; reachability-detection</p>
</li>
<li>
<p>Config Fields:
The following fields should be enabled for the probe based detection to work. The http-probe mechanism is based on the concept of health probes described <a href="https://docs.128technology.com/docs/config_service_health/#health-probes" target="_blank" rel="noopener noreferrer">here</a>. The configuration fields below are required for the system to react to the loadbalancer API calls that the plugin makes.</p>
</li>
</ul>
<table><thead><tr><th>Name</th><th>Type</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>enforcement</td><td>boolean</td><td>true</td><td>Toggle the configuration to be enabled for the reachability enforcement to take effect.</td></tr><tr><td>probe-type</td><td>enumeration</td><td>always</td><td>For probe based reachability detection to take effect the probe-type must be set to <code>always</code>.</td></tr><tr><td>probe &gt; probe-type</td><td>enumeration</td><td>http-probe</td><td>The probe-type must be set to <code>http-probe</code> in order to leverage the HTTP(s) based probing</td></tr><tr><td>probe &gt; http-probe-profile</td><td>reference</td><td>-</td><td>Reference to a previously configured http-probe-profile on the router</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The <code>reachability-detection &gt; probe</code> configuration allows for multiple probes of various types to be configured. All the probes for a given service-route must be up for the route to be considered as up.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="probe-reachability">Probe reachability<a href="#probe-reachability" class="hash-link" aria-label="Direct link to Probe reachability" title="Direct link to Probe reachability">​</a></h3>
<p>The router should have a distinct path for the probe traffic. It is recommended that the user create dedicated services and service routes for this purpose. At this time, the plugin does not generate any configuration to ensure the reachability of the probe traffic to the destination. The probe will be originated in the default linux environment. In case of in-band management, the probe traffic will be associated with the <code>_internal_</code> tenant so care must be taken to allow the tenant when creating such config. As a reference the following configuration represents a service and route to reach one of the HTTP probes in this document.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  5060</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  5060</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address               172.16.2.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route  http-probe-rte-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name          http-probe-rte-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      node1 wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name  node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface  wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="up-delay-timer">Up Delay Timer<a href="#up-delay-timer" class="hash-link" aria-label="Direct link to Up Delay Timer" title="Direct link to Up Delay Timer">​</a></h3>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="version-history-1">Version History<a href="#version-history-1" class="hash-link" aria-label="Direct link to Version History" title="Direct link to Version History">​</a></h5>
<table><thead><tr><th>Release</th><th>Modification</th></tr></thead><tbody><tr><td>2.1.0</td><td><code>http-probe-profile &gt; up-delay-timer</code> introduced</td></tr></tbody></table>
<p>An <code>up-delay-timer</code> can be configured on a probe to prevent a probe watching an unstable service path from coming up right away. When a probe state transitions from down to up, instead of bringing that probe up, if an <code>up-delay-timer</code> is configured the probe will be kept down until the timer finishes. If the probe goes back down while the timer is running, the timer will cancel and the probe will remain down. If it is set to the default value (0) then the timer is disabled.</p>
<p>It is recommended that a probe&#x27;s <code>up-delay-timer</code> has a value greater than the <code>probe-interval</code> field. This configuration allows the probe to run at least one more time while the timer is active. A warning will be produced if a probe is configured with an <code>up-delay-timer</code> value less than the <code>probe-interval</code>. If a configuration reload occurs while a probe timer is active, the timer is honored with the previous config.</p>
<p>The below example shows a probe with a configured <code>up-delay-timer</code>; with these settings, the test will be triggered every 10 seconds, 3 probes with a single probe timeout of 2 seconds will be applied and when the probe transitions from down &gt; up it will be held down for 15 seconds.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    http-probe-profile      http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name                http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        url                 http://172.16.2.5:5060/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        valid-status-code   202</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        valid-status-code   200</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        probe-duration      6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        probe-interval      10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        number-of-attemps   3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        up-delay-timer      15</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases">Use Cases<a href="#use-cases" class="hash-link" aria-label="Direct link to Use Cases" title="Direct link to Use Cases">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="path-selection">Path selection<a href="#path-selection" class="hash-link" aria-label="Direct link to Path selection" title="Direct link to Path selection">​</a></h3>
<p>One of the primary use cases of the plugin would be to monitor the internet or some other service reachability by pinging an HTTP server over a given service path. This is very much similar in concept to the native ICMP probe functionality that exists in the product.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="proportional-load-balancing-via-destination-nats">Proportional Load balancing via destination NATs<a href="#proportional-load-balancing-via-destination-nats" class="hash-link" aria-label="Direct link to Proportional Load balancing via destination NATs" title="Direct link to Proportional Load balancing via destination NATs">​</a></h3>
<p>In this use case, a particular service or workflow is designed to be load balanced across several upstream servers by doing a proportional load balancing along with destination NAT. In this use case, the SSR http-probe plugin can be used to monitor the service status of each of those upstream servers to determine if the particular server should be in service or not from routing perspective. The following configuration snippet builds on the example above to demonstrate this scenario.</p>
<p>In this example, both <code>test-app-route-1</code> and <code>test-app-route-2</code> are equal cost routes used for proportional load balancing.</p>
<div class="language-config codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-config codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route  test-app-route-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name                    test-app-route-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name            test-app</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                vector                  path1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                nat-target              172.16.2.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop                node1 wan-bb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name  node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface  wan-bb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                reachability-detection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled               true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enforcement           true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    reachability-profile  dummy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    probe-type            always</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    probe                 probe1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name                probe1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        http-probe-profile  http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route  test-app-route-2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name                    test-app-route-2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name            test-app</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                vector                  path2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                nat-target              172.16.3.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop                node1 wan-lte</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name  node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface  wan-lte</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                reachability-detection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled               true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enforcement           true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    reachability-profile  dummy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    probe-type            always</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    probe                 probe2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name                probe2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        http-probe-profile  http-probe-2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor1#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Each service-route is designed to probe a unique URL for that server and monitor the health of the service at the TCP socket level as well as the HTTP stack. When one of the servers either cannot be reached, responds with an unsuccessful status code (e.g. 404, 504 etc), or the configured <a href="#sla">SLA</a> is not met, the service path is taken out of service.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>When all the service routes associated with the same service are down, the default system behavior is to operates in a <code>best-effort</code> mode in which the physical link and L2 connectivity is used to determine the health of the path. In this case, it is possible that sessions are routed to paths that are down from a probe perspective. As soon as one of the paths comes back in service, the load balancer will start using that path for all subsequent new sessions. The <code>best-effort</code> flag can be set to false for the associated service-policy to disable this behavior.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="checking-the-probe-status">Checking the probe status<a href="#checking-the-probe-status" class="hash-link" aria-label="Direct link to Checking the probe status" title="Direct link to Checking the probe status">​</a></h3>
<p>The <code>show service-path</code> command can be used to view the current status of the probe and to view how the load balancer is interpreting the current status. For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor1# show service-path router my-router node node1 service-name test-app</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Sun 2021-11-07 03:19:33 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node: node1.my-router Page 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========== ================== =============== =============== ============ =========== ======== ====== ====== ========== ==========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Service    Service-Route      Type            Destination     Next-Hop     Interface   Vector   Cost   Rate   Capacity   State</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========== ================== =============== =============== ============ =========== ======== ====== ====== ========== ==========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> test-app   test-app-route-1   service-agent   172.16.2.5/32   172.16.2.5   wan-bb      path1     100      0   0/100      Up(Up)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> test-app   test-app-route-2   service-agent   172.16.3.5/32   172.16.3.5   wan-lte     path2     100      0   0/100      Up(Down)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.05 seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor1#admin@node1.conductor1#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>show plugins state router &lt;router-name&gt; summary 128T-http-probe</code> command can be used to view the current status of the probe and whether the probe is being held down. For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor1# show plugins state router my-router summary 128T-http-probe</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wed 2024-10-02 03:19:33 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Target: node1.my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============= ======== =========== =================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Probe         Status   Held Down   Time Left (sec)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============= ======== =========== =================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> test-probe1   up       True                      8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> test-probe2   down     False                     0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Retrieved state data.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.05 seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In addition, the probe&#x27;s running status in linux can be found by inspecting the <code>128T-http-probe-status-change-notifier@&lt;probe-name&gt;.service</code>. For example,</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># systemctl status 128T-http-probe-status-change-notifier@http-probe-2.service -l</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">● 128T-http-probe-status-change-notifier@http-probe-2.service - HTTP Monitor Status change observer for destination http-probe-2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Loaded: loaded (/usr/lib/systemd/system/128T-http-probe-status-change-notifier@.service; static; vendor preset: disabled)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Active: inactive (dead) since Sun 2021-11-07 03:22:43 UTC; 8s ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Process: 24823 ExecStart=/usr/libexec/128T-http-probe/scripts/loadbalancer_cli --probe-name ${NAME} determine-status --status ${STATUS} --code ${CODE} (code=exited, status=0/SUCCESS)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Main PID: 24823 (code=exited, status=0/SUCCESS)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:22:42 my-router.openstacklocal systemd[1]: Starting HTTP Monitor Status change observer for destination http-probe-2...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:22:43 my-router.openstacklocal loadbalancer_cli[24823]: Determine status for probe http-probe-2 with status down and code 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:22:43 my-router.openstacklocal loadbalancer_cli[24823]: Skipping service-route test-app-route-1 with profile {&#x27;validStatusCode&#x27;: [202, 200], &#x27;probeDuration&#x27;: 5, &#x27;numberOfAttempts&#x27;: 4, &#x27;probeInterval&#x27;: 10, &#x27;name&#x27;: &#x27;http-probe-1&#x27;, &#x27;url&#x27;: &#x27;http://172.16.2.5:5060/&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:22:43 my-router.openstacklocal loadbalancer_cli[24823]: Processing service-route test-app-route-2 with profile {&#x27;validStatusCode&#x27;: [202, 200], &#x27;probeDuration&#x27;: 5, &#x27;numberOfAttempts&#x27;: 4, &#x27;probeInterval&#x27;: 10, &#x27;name&#x27;: &#x27;http-probe-2&#x27;, &#x27;url&#x27;: &#x27;http://172.16.3.5:5061/&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:22:43 my-router.openstacklocal loadbalancer_cli[24823]: http-probe-2: Setting service-path test-app-route-2 for service test-app as down</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:22:43 my-router.openstacklocal systemd[1]: Started HTTP Monitor Status change observer for destination http-probe-2.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="triggering-manual-failover-or-recovery">Triggering Manual Failover Or Recovery<a href="#triggering-manual-failover-or-recovery" class="hash-link" aria-label="Direct link to Triggering Manual Failover Or Recovery" title="Direct link to Triggering Manual Failover Or Recovery">​</a></h2>
<p>In some situations, it might be desirable to forcefully trigger a failover or recovery for an otherwise healthy path. In the above example, the primary <code>http-probe-1</code> can be brought down by doing the following:</p>
<ul>
<li>Stop the http-monitor service for the path instance</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># systemctl stop http-monitor@http-probe-1.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Edit the <code>/var/run/128technology/plugins/http_monitor/{probe-name}.state</code> and set the <code>STATUS=down</code></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># echo &quot;STATUS=down&quot; &gt;&gt; /var/run/128technology/plugins/http_monitor/http-probe-1.state</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># systemctl status 128T-http-probe-status-change-notifier@http-probe-1.service -l</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">● 128T-http-probe-status-change-notifier@http-probe-1.service - HTTP Monitor Status change observer for destination http-probe-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Loaded: loaded (/usr/lib/systemd/system/128T-http-probe-status-change-notifier@.service; static; vendor preset: disabled)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Active: inactive (dead) since Sun 2021-11-07 03:27:34 UTC; 45s ago</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Process: 29533 ExecStart=/usr/libexec/128T-http-probe/scripts/loadbalancer_cli --probe-name ${NAME} determine-status --status ${STATUS} --code ${CODE} (code=exited, status=0/SUCCESS)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Main PID: 29533 (code=exited, status=0/SUCCESS)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:27:34 my-router.openstacklocal systemd[1]: Starting HTTP Monitor Status change observer for destination http-probe-1...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:27:34 my-router.openstacklocal loadbalancer_cli[29533]: Determine status for probe http-probe-1 with status down and code 200</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:27:34 my-router.openstacklocal loadbalancer_cli[29533]: Processing service-route test-app-route-1 with profile {&#x27;validStatusCode&#x27;: [202, 200], &#x27;probeDuration&#x27;: 5, &#x27;numberOfAttempts&#x27;: 4, &#x27;probeInterval&#x27;: 10, &#x27;name&#x27;: &#x27;http-probe-1&#x27;, &#x27;url&#x27;: &#x27;http://172.16.2.5:5060/&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:27:34 my-router.openstacklocal loadbalancer_cli[29533]: http-probe-1: Setting service-path test-app-route-1 for service test-app as down</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:27:34 my-router.openstacklocal loadbalancer_cli[29533]: Skipping service-route test-app-route-2 with profile {&#x27;validStatusCode&#x27;: [202, 200], &#x27;probeDuration&#x27;: 5, &#x27;numberOfAttempts&#x27;: 4, &#x27;probeInterval&#x27;: 10, &#x27;name&#x27;: &#x27;http-probe-2&#x27;, &#x27;url&#x27;: &#x27;http://172.16.3.5:5061/&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nov 07 03:27:34 my-router.openstacklocal systemd[1]: Started HTTP Monitor Status change observer for destination http-probe-1.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The same steps can be used to bring <code>up</code> a path that is currently <code>down</code> by changing <code>STATUS=up</code> in the steps above.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics">Metrics<a href="#metrics" class="hash-link" aria-label="Direct link to Metrics" title="Direct link to Metrics">​</a></h3>
<p>In-memory metrics were added for http probe SLA values</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># show stats http-probe</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wed 2024-04-17 02:52:35 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Retrieving statistics...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Http Probe Stats Metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===================== ======= ==================== ====================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Metric                Node    Probe-profile-name                Value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===================== ======= ==================== ====================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> average-rtt           test2   http-probe-1                       0.12</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> dns-resolution-time   test2   http-probe-1         2.1130787988658994</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> jitter                test2   http-probe-1                       0.02</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> loss                  test2   http-probe-1                          0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> max-rtt               test2   http-probe-1                       0.13</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> min-rtt               test2   http-probe-1                       0.11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> updated               test2   http-probe-1         1718376794.8707266</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.21 seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="release-notes">Release Notes<a href="#release-notes" class="hash-link" aria-label="Direct link to Release Notes" title="Direct link to Release Notes">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="release-210">Release 2.1.0<a href="#release-210" class="hash-link" aria-label="Direct link to Release 2.1.0" title="Direct link to Release 2.1.0">​</a></h3>
<p><strong>Release Date:</strong> Oct 31, 2024</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-features-and-improvements">New Features and Improvements<a href="#new-features-and-improvements" class="hash-link" aria-label="Direct link to New Features and Improvements" title="Direct link to New Features and Improvements">​</a></h4>
<ul>
<li><strong>PLUGIN-2510</strong> Implement an up-delay-timer</li>
</ul>
<p>The plugin allows users to configure an up-delay-timer which holds a path down for a set duration before bringing the path up.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="issues-fixed">Issues Fixed<a href="#issues-fixed" class="hash-link" aria-label="Direct link to Issues Fixed" title="Direct link to Issues Fixed">​</a></h4>
<ul>
<li><strong>PLUGIN-2629</strong> Display stats in older (5.X) SSR releases</li>
<li><strong>PLUGIN-2721</strong> Resolve on plugin downgrade config removal</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="release-200">Release 2.0.0<a href="#release-200" class="hash-link" aria-label="Direct link to Release 2.0.0" title="Direct link to Release 2.0.0">​</a></h3>
<p>Image based install and upgrade (IBU) support for SSR 6.3.0.</p>
<p><strong>Release Date:</strong> Sep 30, 2024</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="release-120">Release 1.2.0<a href="#release-120" class="hash-link" aria-label="Direct link to Release 1.2.0" title="Direct link to Release 1.2.0">​</a></h3>
<p><strong>Release Date:</strong> Aug 20, 2024</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-features-and-improvements-1">New Features and Improvements<a href="#new-features-and-improvements-1" class="hash-link" aria-label="Direct link to New Features and Improvements" title="Direct link to New Features and Improvements">​</a></h4>
<ul>
<li><strong>PLUGIN-2300</strong> Implement SLA monitoring per probe</li>
</ul>
<p>The plugin allows users to configure the following SLA settings: max-loss, max-jitter, average-rtt. These settings are considered as part of the probe success criteria. Additionally, these values are available through metrics.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="release-102">Release 1.0.2<a href="#release-102" class="hash-link" aria-label="Direct link to Release 1.0.2" title="Direct link to Release 1.0.2">​</a></h3>
<p><strong>Release Date:</strong> Apr 29, 2022</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="issues-fixed-1">Issues Fixed<a href="#issues-fixed-1" class="hash-link" aria-label="Direct link to Issues Fixed" title="Direct link to Issues Fixed">​</a></h4>
<ul>
<li>
<p><strong>PLUGIN-1680</strong> The HTTP probe status takes a very long time to detect upstream failure</p>
<p><em><strong>Resolution:</strong></em> The logic for detecting upstream failures for combination of very small duration and retry has been improved upon.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="release-101">Release 1.0.1<a href="#release-101" class="hash-link" aria-label="Direct link to Release 1.0.1" title="Direct link to Release 1.0.1">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="issues-fixed-2">Issues Fixed<a href="#issues-fixed-2" class="hash-link" aria-label="Direct link to Issues Fixed" title="Direct link to Issues Fixed">​</a></h4>
<ul>
<li>
<p><strong>PLUGIN-1640</strong> Error downloading router components when http-probe plugin enabled on a router</p>
<p><em><strong>Resolution:</strong></em> Updated the salt states to provide the correct router components.</p>
</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/plugin_ha_sync_redundancy"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">HA Sync Redundancy Plugin</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/plugin_icmp_reachability_detection"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ICMP Reachability Detection</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#configuration-snippet" class="table-of-contents__link toc-highlight">Configuration Snippet</a><ul><li><a href="#http-probe-profile-configuration" class="table-of-contents__link toc-highlight">HTTP Probe Profile configuration</a></li><li><a href="#sla" class="table-of-contents__link toc-highlight">SLA</a></li><li><a href="#http-probe-log-level" class="table-of-contents__link toc-highlight">HTTP Probe Log Level</a></li><li><a href="#service-route-configuration" class="table-of-contents__link toc-highlight">Service Route Configuration</a></li><li><a href="#probe-reachability" class="table-of-contents__link toc-highlight">Probe reachability</a></li><li><a href="#up-delay-timer" class="table-of-contents__link toc-highlight">Up Delay Timer</a></li></ul></li><li><a href="#use-cases" class="table-of-contents__link toc-highlight">Use Cases</a><ul><li><a href="#path-selection" class="table-of-contents__link toc-highlight">Path selection</a></li><li><a href="#proportional-load-balancing-via-destination-nats" class="table-of-contents__link toc-highlight">Proportional Load balancing via destination NATs</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#checking-the-probe-status" class="table-of-contents__link toc-highlight">Checking the probe status</a></li></ul></li><li><a href="#triggering-manual-failover-or-recovery" class="table-of-contents__link toc-highlight">Triggering Manual Failover Or Recovery</a><ul><li><a href="#metrics" class="table-of-contents__link toc-highlight">Metrics</a></li></ul></li><li><a href="#release-notes" class="table-of-contents__link toc-highlight">Release Notes</a><ul><li><a href="#release-210" class="table-of-contents__link toc-highlight">Release 2.1.0</a></li><li><a href="#release-200" class="table-of-contents__link toc-highlight">Release 2.0.0</a></li><li><a href="#release-120" class="table-of-contents__link toc-highlight">Release 1.2.0</a></li><li><a href="#release-102" class="table-of-contents__link toc-highlight">Release 1.0.2</a></li><li><a href="#release-101" class="table-of-contents__link toc-highlight">Release 1.0.1</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Juniper Networks, Inc.</div></div></div></footer></div>
</body>
</html>