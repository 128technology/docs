<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-167298415-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="128T Docs" href="/opensearch.xml"><title data-react-helmet="true">DNS Cache Plugin | 128T Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/plugin_dns_cache"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="DNS Cache Plugin | 128T Docs"><meta data-react-helmet="true" name="description" content="The 128T-dns-cache plugin provides a DNS caching service on your 128T router by forwarding all traffic on a configured ingress-service and tenant to dnsmasq. By default it uses existing system configuration for nameserver resolution, but supports optionally configuring custom server addresses. The plugin is implemented as a service function chain (SFC) where the DNS traffic received on an ingress interface is detoured through a Kernel Network Interface (KNI) to be cached by dnsmasq. A typical flow of the packets for the plugin is illustrated below:"><meta data-react-helmet="true" property="og:description" content="The 128T-dns-cache plugin provides a DNS caching service on your 128T router by forwarding all traffic on a configured ingress-service and tenant to dnsmasq. By default it uses existing system configuration for nameserver resolution, but supports optionally configuring custom server addresses. The plugin is implemented as a service function chain (SFC) where the DNS traffic received on an ingress interface is detoured through a Kernel Network Interface (KNI) to be cached by dnsmasq. A typical flow of the packets for the plugin is illustrated below:"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/plugin_dns_cache"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/plugin_dns_cache" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/plugin_dns_cache" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.db35fe54.css">
<link rel="preload" href="/assets/js/runtime~main.16cf9ddf.js" as="script">
<link rel="preload" href="/assets/js/main.f8547a3e.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Interchange<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment Considerations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Installation Process</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cloud Installations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Supporting Information - Appendix</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Administration</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CLI Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Installer/Initializer Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Plugins</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_bgp_community_services">BGP Community Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_aws_tgw_connect">AWS Transit Gateway Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_cloud_ha">Cloud HA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_dns_app_id">DNS App Id</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/plugin_dns_cache">DNS Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_gre">GRE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_ha_sync_redundancy">HA Sync Redundancy Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_icmp_reachability_detection">ICMP Reachability Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_ipsec_client">IPsec Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_loopback_static_routes">Loopback Static Routes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_m800_watchdog">M800 Watchdog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_monitoring_agent">Monitoring Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_mosh">Mosh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_set_hostname">Set Hostname</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_sip_alg">SIP ALG</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_wireguard">Wireguard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_kni_namespace_scripts">KNI Namespace Scripts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">REST APIs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Release Notes</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DNS Cache Plugin</h1></header><p>The 128T-dns-cache plugin provides a DNS caching service on your 128T router by forwarding all traffic on a configured <code>ingress-service</code> and <code>tenant</code> to <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html" target="_blank" rel="noopener noreferrer">dnsmasq</a>. By default it uses existing system configuration for nameserver resolution, but supports optionally configuring custom server addresses. The plugin is implemented as a <a href="/docs/plugin_intro#service-function-chaining">service function chain</a> (SFC) where the DNS traffic received on an ingress interface is detoured through a <a href="/docs/concepts_kni">Kernel Network Interface</a> (KNI) to be cached by <code>dnsmasq</code>. A typical flow of the packets for the plugin is illustrated below:</p><p>lan-intf (lan-tenant) &gt; <code>ingress-service</code> &gt; <code>dnsmasq</code> &gt; dns-kni (<code>tenant</code>) &gt; egress-service &gt; wan-intf</p><p>By enabling this plugin, you can provide DNS caching with fast resolution times to your network.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The instructions for installing and managing the plugin can be found <a href="/docs/plugin_intro#installation-and-management">here</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="configuration">Configuration<a aria-hidden="true" class="hash-link" href="#configuration" title="Direct link to heading">​</a></h2><p>Assuming the below 128T configuration:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name Authority128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        conductor-address labconductor.acme.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant dns-cache-plugin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name dns-cache-plugin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant lan-clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name lan-clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security aes1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address 0.0.0.0/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy lan-clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source lan-clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy dns-cache-plugin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source dns-cache-plugin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service dns-catcher</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name dns-catcher</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range 53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port 53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address 0.0.0.0/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy lan-clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source lan-clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router labrouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name labrouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            node node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                role combo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface LAN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name LAN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface vlan0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name vlan0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant lan-clients</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        dhcp v4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can apply the following DNS cache plugin configuration:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router lab-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name lab-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            dns-cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                tenant dns-cache-plugin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ingress-service dns-catcher</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th>Element</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>enabled</td><td>boolean</td><td>true</td><td>Governs whether the DNS cache is operationally enabled or not.</td></tr><tr><td>name</td><td>128T device name</td><td><code>dns-cache</code></td><td>This controls the name of the service function chain interface.</td></tr><tr><td>addresses</td><td>IPv4 address</td><td>N/A</td><td>Multiple instance object. This will specify the upstream DNS resolvers to use, overriding the ones normally used by the Linux host operating system on the machine.</td></tr><tr><td>ingress-service</td><td>reference</td><td>N/A</td><td>This refers to a configured <code>service</code> within the authority that will be used to &quot;trap&quot; inbound DNS requests, to divert them to dnsmasq. Generally, this is a service that has an address of 0.0.0.0/0 and restricted to UDP/53.</td></tr><tr><td>plugin-network</td><td>CIDR</td><td>169.254.141.128/30</td><td>This controls the IP addresses used for the internal SFC network to detour packets to and from the on-board DNS cache. This should only be changed if there is a conflict with another IP block in use on this same host system.</td></tr><tr><td>tenant</td><td>reference</td><td>N/A</td><td>This is the tenant that will be assigned to the SFC interface (of type KNI). All packets leaving the DNS cache and heading toward an upstream DNS resolver will be associated with this tenant. For this reason, it is important that your 128T configuration also includes a <code>service</code> that allows this <code>tenant</code> to reach the upstream resolvers. Typically, this is an <code>internet</code> service (0.0.0.0/0).</td></tr><tr><td>ingress-source-nat-pool</td><td>reference</td><td>N/A</td><td>This refers to a configured <code>source-nat-pool</code>, and will be used when forwarding the traffic through the DNS cache/service function chain.</td></tr><tr><td>max-ttl</td><td>seconds</td><td>1500</td><td>The configured maximum TTL will be advertised to clients instead of the true TTL value if it is lower. The true TTL value is however kept in the cache to avoid flooding the upstream DNS servers. See <a href="#release-120-220">release notes for details</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_31ik" id="notes-about-the-sample-configuration">Notes about the Sample Configuration<a aria-hidden="true" class="hash-link" href="#notes-about-the-sample-configuration" title="Direct link to heading">​</a></h3><p>The <code>ingress-service</code> we have configured is <code>dns-catcher</code>. This is a simple service that matches any IP address (0.0.0.0/0) and has a destination protocol and port of UDP/53. Our <code>dns-catcher</code> service is set to allow the <code>lan-clients</code> tenant (which is assigned to the LAN <code>network-interface</code>), so any traffic arriving on this interface destined for UDP/53 will be detoured to the DNS cache.</p><p>The DNS cache will either respond locally (if there&#x27;s an existing cache entry), or will forward the request to an upstream resolver. For the latter case, it will reenter the 128T&#x27;s forwarding plane via the KNI interface (a.k.a. the &quot;service function chain&quot; interface) and be affiliated with the <code>tenant</code> named <code>dns-cache-plugin</code>.</p><p>Once in the 128T&#x27;s data plane, this traffic will match the <code>internet</code> service (we&#x27;ve added an <code>allow</code> statement for the <code>dns-cache-plugin</code> tenant), and be forwarded out to the upstream server(s).</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="custom-dns-servers">Custom DNS Servers<a aria-hidden="true" class="hash-link" href="#custom-dns-servers" title="Direct link to heading">​</a></h3><p>To configure custom server addresses for dnsmasq instead of the ones affiliated with the host machine that the plugin is running on, add the <code>addresses</code> field:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dns-cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enabled          true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    addresses        1.1.1.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    addresses        2.2.2.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tenant           dns-cache-plugin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ingress-service  dns-catcher</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="redirecting-and-blocking-domains">Redirecting and blocking domains<a aria-hidden="true" class="hash-link" href="#redirecting-and-blocking-domains" title="Direct link to heading">​</a></h3><h5 class="anchor anchorWithStickyNavbar_31ik" id="version-history">Version History<a aria-hidden="true" class="hash-link" href="#version-history" title="Direct link to heading">​</a></h5><table><thead><tr><th>Release</th><th>Modification</th></tr></thead><tbody><tr><td>1.1.0, 2.1.0</td><td><code>dns-cache &gt; redirect-domains</code> and <code>dns-cache &gt; block-domains</code> were introduced</td></tr></tbody></table><p>The DNS cache plugin will send all requests it processes to the list of servers provided in its configuration. Generally, these are configured as public DNS servers. However, many enterprises commonly host their own authoritative name server for their own domain (e.g., some-private-domain.com). The redirect-domains configuration lets administrators specify a distinct DNS server for a given domain, and 128T will use this when issuing queries for any host within that domain.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly config"><pre tabindex="0" class="prism-code language-config codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name       router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            dns-cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                tenant dns-cache-plugin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ingress-service dns-catcher</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                redirect-domains  some-private-domain.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    domain   some-private-domain.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    address  192.168.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                block-domains     block-domain.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>block-domains</code> configuration allows the DNS server to block those domains by replying back with NXDOMAIN indicating that the domain name doesn&#x27;t exist.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="third-party-software-and-licenses">Third Party Software and Licenses<a aria-hidden="true" class="hash-link" href="#third-party-software-and-licenses" title="Direct link to heading">​</a></h2><ul><li>dnsmasq (GNU GPL v2, v3)</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="troubleshooting">Troubleshooting<a aria-hidden="true" class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h2><p>To verify that the services are running properly on the 128T router:</p><ul><li><code>systemctl status 128T-dns-cache-forwarder.service</code></li><li><code>systemctl status 128T-dns-cache-matcher.service</code></li></ul><p>Verify that the dns-cache network interface (default <code>dns-cache-intf</code>) is UP.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="release-notes">Release Notes<a aria-hidden="true" class="hash-link" href="#release-notes" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="release-310">Release 3.1.0<a aria-hidden="true" class="hash-link" href="#release-310" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="issues-fixed">Issues Fixed<a aria-hidden="true" class="hash-link" href="#issues-fixed" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-768</strong> Support the DNS Cache plugin in 128T versions <code>5.1.0</code> and greater.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="release-120-220">Release 1.2.0, 2.2.0<a aria-hidden="true" class="hash-link" href="#release-120-220" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="issues-fixed-1">Issues Fixed<a aria-hidden="true" class="hash-link" href="#issues-fixed-1" title="Direct link to heading">​</a></h4><ul><li><p><strong>PLUGIN-952</strong> FIB entry for dns-app-id based applications was deleted before the advertised TTL causing traffic to be blackholed</p><p><em><strong>Resolution:</strong></em> The TTL value advertised to the clients is made configurable and is also set to 1500 seconds by default to match the internal DNS cache timers.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="release-110-210">Release 1.1.0, 2.1.0<a aria-hidden="true" class="hash-link" href="#release-110-210" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="new-features-and-improvements">New Features and Improvements<a aria-hidden="true" class="hash-link" href="#new-features-and-improvements" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-641</strong> Provide support for redirecting and blocking domains</li></ul><p>Added support for redirecting domains to a different upstream domain server. In addition, added support for blocking domains that the user should not be able to access.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="issues-fixed-2">Issues Fixed<a aria-hidden="true" class="hash-link" href="#issues-fixed-2" title="Direct link to heading">​</a></h4><ul><li><p><strong>PLUGIN-684</strong> DNS cache plugin fails to apply configuration on initial installation</p><p><em><strong>Resolution:</strong></em> Make config handling on the router dependent on a successful plugin router RPM installation.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="release-101-201">Release 1.0.1, 2.0.1<a aria-hidden="true" class="hash-link" href="#release-101-201" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="issues-fixed-3">Issues Fixed<a aria-hidden="true" class="hash-link" href="#issues-fixed-3" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-402</strong> Ensure the application restarts with 128T</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-11-03T19:49:06.000Z">11/3/2021</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/plugin_dns_app_id"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->DNS App Id</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/plugin_gre"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GRE<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#notes-about-the-sample-configuration" class="table-of-contents__link toc-highlight">Notes about the Sample Configuration</a></li><li><a href="#custom-dns-servers" class="table-of-contents__link toc-highlight">Custom DNS Servers</a></li><li><a href="#redirecting-and-blocking-domains" class="table-of-contents__link toc-highlight">Redirecting and blocking domains</a></li></ul></li><li><a href="#third-party-software-and-licenses" class="table-of-contents__link toc-highlight">Third Party Software and Licenses</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#release-notes" class="table-of-contents__link toc-highlight">Release Notes</a><ul><li><a href="#release-310" class="table-of-contents__link toc-highlight">Release 3.1.0</a></li><li><a href="#release-120-220" class="table-of-contents__link toc-highlight">Release 1.2.0, 2.2.0</a></li><li><a href="#release-110-210" class="table-of-contents__link toc-highlight">Release 1.1.0, 2.1.0</a></li><li><a href="#release-101-201" class="table-of-contents__link toc-highlight">Release 1.0.1, 2.0.1</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.16cf9ddf.js"></script>
<script src="/assets/js/main.f8547a3e.js"></script>
</body>
</html>