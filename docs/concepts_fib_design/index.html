<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts_fib_design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">FIB Design Considerations | SSN Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.128technology.com/docs/concepts_fib_design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="FIB Design Considerations | SSN Docs"><meta data-rh="true" name="description" content="This section covers some things to consider when designing your network, services, and service routes."><meta data-rh="true" property="og:description" content="This section covers some things to consider when designing your network, services, and service routes."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.128technology.com/docs/concepts_fib_design"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/concepts_fib_design" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/concepts_fib_design" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/kb/rss.xml" title="SSR Knowledge Base Articles RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/kb/atom.xml" title="SSR Knowledge Base Articles Atom Feed">
<link rel="alternate" type="application/json" href="/kb/feed.json" title="SSR Knowledge Base Articles JSON Feed"><link rel="stylesheet" href="/assets/css/styles.b50a304b.css">
<script src="/assets/js/runtime~main.d21f17ac.js" defer="defer"></script>
<script src="/assets/js/main.ecb6bbfb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a class="navbar__item navbar__link" href="/kb">Knowledge Base</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cc_fips_titlepage">SSR Common Criteria Install and Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_upgrade_considerations">Upgrading the SSR</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation">Installation Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/rma_wan_assurance">RMA Workflows</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation_univ-iso">SSR Universal ISO Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/supported_cloud_platforms">Cloud / Hypervisor Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation_legacy">Legacy Install Information</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/concepts_fib">Understanding the Forwarding Information Base</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts_fib">FIB Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts_fib_construction">How the FIB is Constructed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/concepts_fib_design">FIB Design Considerations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_fib_design">FIB Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_fib">FIB Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/wan_overview">WAN Assurance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/config_basics">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/bcp_sdwan_design_guide">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/release_notes_128t_6.3">Release Notes</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Understanding the Forwarding Information Base</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">FIB Design Considerations</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FIB Design Considerations</h1></header><p>This section covers some things to consider when designing your network, services, and service routes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bgp-over-svr">BGP over SVR<a href="#bgp-over-svr" class="hash-link" aria-label="Direct link to BGP over SVR" title="Direct link to BGP over SVR">​</a></h3>
<p>One interesting aspect of using BGP over SVR is that because the FIB uses route updates to construct the next-hop for FIB entries, it is possible to configure services with broad address ranges larger than the scope of an individual peer router, and utilize BGP to update next hops for the individually created FIB entries based on the routing-interface address returned by BGP. When using pure service-routing, services are generally required to be tied to a specific site/SSR.</p>
<p>In cases where a service-route is configured for the service, the next-hop for each FIB entry for the service comes from the service-route (either a service-agent next hop interface/gateway, or peer router adjacencies) and overrides the next-hop from the RIB.</p>
<p>A service-agent, peer, or next-peer service route also creates a null kernel route in the RIB. They exist for internal purposes, and can be observed in the RIB but are no cause for concern. These kernel routes will not influence the way the FIB is built for other services when building the FIB. They will not trigger additional FIB entries with more specific prefixes for other services, and there is no danger of creating a null next-hop entry.</p>
<p>There is however, one very specific scenario where an auto-generated kernel route can influence the FIB. It is related to BGP over SVR and routing interface addresses.</p>
<p>When a BGP over SVR neighbor is configured, the system generates a (non-null) kernel route towards the local routing interface. This kernel route is treated like other routes in the RIB and therefore influences FIB entries. In the example RIB and FIB output below, the local router has a BGP neighbor using routing interface address of 10.0.0.128/32 who advertises the network 10.0.0.0/24. The kernel route results in an extra FIB entry for service hub with a next-hop of <code>None</code>. The practical implication is that if the user desired to use this address for additional services on the router such as SNMP polling, SSH, or simply allowing ICMP ping, these services would not follow the broader route advertised by BGP. In fact, these services would require a peer service route pointing to the remote router.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security       none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        10.0.0.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  spoke</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  spoke</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RIB:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======= ============= ========== ========== ========= ======== ====== ============ =============== ==================== ============= ============= ===========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Vrf     Prefix        Protocol   Selected  Distance   Metric  Uptime  Ip          Interface name   Directly connected   Recursive     Blackhole     Fib</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======= ============= ========== ========== ========= ======== ====== ============ =============== ==================== ============= ============= ===========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> default 10.0.0.0/24   bgp        true            20        0   30485  10.0.0.128  unavailable      unavailable          true          unavailable   unavailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> default 10.0.0.0/24   bgp        true            20        0   30485  10.0.0.128  lo0              unavailable          unavailable   unavailable   true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> default 10.0.0.128/32 kernel     true           254        0   30502  unavailable lo0              true                 unavailable   unavailable   true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> default 10.0.0.128/32 kernel     unavailable    254  1000000   30502  unavailable unavailable      unavailable          unavailable   true          true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FIB:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=============== ====== ======= ======== ===== ========= ============ ======== ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> IP Prefix       Port   Proto   Tenant   VRF   Service   Next Hops    Vector   Cost</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=============== ====== ======= ======== ===== ========= ============ ======== ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 10.0.0.0/24        0   None    spoke    -     hub       172.16.0.2   -           0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 10.0.0.128/32      0   None    spoke    -     hub       None         -           -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fib-sprawl">FIB Sprawl<a href="#fib-sprawl" class="hash-link" aria-label="Direct link to FIB Sprawl" title="Direct link to FIB Sprawl">​</a></h3>
<p>The amount of RAM present in the system dictates the maximum number of entries allowed in the FIB table. Therefore, FIB space is a limited resource on the platform and should be considered during configuration design. Design decisions of the tenant/service model for a deployment have a major impact on the size of the FIB. The number of service addresses, transport/port-ranges, and tenant access-policies configured have a major influence on how the FIB is built, as do the number of routes seen in the RIB.</p>
<p>Here are some general suggestions for reducing the size of the FIB:</p>
<ul>
<li>
<p>Limit the number of tenants in the configuration: While it is important to use as many tenants as required to enforce policy on the network, these should be limited to general categories of devices/users existing throughout the network. Unique tenants per site are generally not a good idea. The SSR does support the concept of tenant hierarchy, however it is important to not overuse this construct. An access policy for a parent tenant results in a FIB entry for each child tenant of this parent which can quickly lead to FIB sprawl. It is suggested to limit the use of hierarchy to no more than three tiers.</p>
</li>
<li>
<p>Limit the number of routes in the RIB: As shown in the section of <a href="/docs/concepts_fib_construction">How the FIB is Constructed</a>, the routes in the RIB can have a major impact on the resulting FIB table. Receiving a large number of routes via dynamic routing protocols can quickly lead to FIB sprawl. It is suggested to use route filtering to only accept aggregate routes and to drop any more specific routes that point to the same next-hop destination.</p>
</li>
<li>
<p>Use <code>service applies-to</code> logic: The use of <code>applies-to</code> logic in the services ensures that services are installed only on their respective routers. This logic can minimize the impact of unneeded services on a router. For example, in a hub and spoke deployment, it is not necessary for one spoke to see the services targeting another spoke. Traffic may follow a more generic service to the hub (which presumably is a larger device with more memory), and the hub can then see the more specific service targeting the destination spoke.</p>
</li>
<li>
<p>In a BGP over SVR design, it may be possible to use broader service definitions covering the address scope of all spoke sites instead of site-specific services. This coupled with limiting the amount of spoke routes in the RIB can greatly reduce the size of the FIB table.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-policies">Access Policies<a href="#access-policies" class="hash-link" aria-label="Direct link to Access Policies" title="Direct link to Access Policies">​</a></h3>
<p>It is important to discuss access policies configured on services. An access-policy with permission set to <code>deny</code> will generate FIB entries. However, the permit/deny action is only evaluated on the ingress router of an SSR fabric. In scenarios where traffic flows via SVR and applies-to service logic results in FIB entries being created on the next-SVR-hop SSR for deny policies, the traffic will not be denied. The next-hop in the FIB entry of the subsequent router will be used, a session will be installed in the session table, and packets for the session will be forwarded. To illustrate this, consider the example below.</p>
<p>There is a service that matches all traffic to a spoke router’s LAN. This service is applied to both the hub and spoke router. Traffic is allowed from the hub to this full address range.</p>
<p>Later, it is determined that there is a specific server in this LAN that we want to deny access to from the hub. Another service named <code>deny-server</code> was added for the specific server address, with a deny access policy for the hub tenant. In order to reduce FIB consumption on the hub, <code>applies-to</code> logic was used to block this traffic at the spoke.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service          spoke1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           spoke1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to     router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  spoke1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security       internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        10.0.1.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service          deny-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           deny-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to     router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  spoke1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security       internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        10.0.1.10/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  deny</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The expectation is that this configuration satisfies the design intent. However, this configuration <strong>does</strong> allow hub traffic to hit the server. In fact, traffic using the service <code>deny-server</code> with tenant hub will be seen in the spoke’s session table. While this configuration is a simple, contrived scenario to illustrate the point, it can be encountered in real world deployments, particularly when sending spoke-to-spoke traffic through a hub when certain traffic is allowed and other traffic denied.</p>
<p>The exception to this situation is one that uses a service hierarchy. If the FIB lookup on the next-SVR-hop SSR results in a service within the same hierarchy as the original service signaled via SVR metadata, then the access-policies will be evaluated and any using <code>permission deny</code> will prevent the session from being established. In the example above, if the service <code>deny-server</code> were simply defined as hierarchical from the parent spoke1 service as shown below, the deny access-policy would be evaluated and traffic to the server would be denied by the spoke.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  deny-server.spoke1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           deny-server.spoke1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to     router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  spoke1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        10.0.1.10/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      hub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  deny</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/concepts_fib_construction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How the FIB is Constructed</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/bcp_fib_design"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FIB Best Practices</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#bgp-over-svr" class="table-of-contents__link toc-highlight">BGP over SVR</a></li><li><a href="#fib-sprawl" class="table-of-contents__link toc-highlight">FIB Sprawl</a></li><li><a href="#access-policies" class="table-of-contents__link toc-highlight">Access Policies</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Juniper Networks, Inc.</div></div></div></footer></div>
</body>
</html>