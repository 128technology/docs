<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-167298415-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="128T Docs" href="/opensearch.xml"><title data-react-helmet="true">VRF Learning via BGP | 128T Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/config_vrf_learning"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="VRF Learning via BGP | 128T Docs"><meta data-react-helmet="true" name="description" content="The following configuration procedures can be used to initiate VRF learning using BGP."><meta data-react-helmet="true" property="og:description" content="The following configuration procedures can be used to initiate VRF learning using BGP."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/config_vrf_learning"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_vrf_learning" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_vrf_learning" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.db35fe54.css">
<link rel="preload" href="/assets/js/runtime~main.cf1060a5.js" as="script">
<link rel="preload" href="/assets/js/main.f8547a3e.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Interchange<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment Considerations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Installation Process</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cloud Installations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Supporting Information - Appendix</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Administration</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Configuration</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_basics">Configuration Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_access_mgmt">Access Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_asset_connection_resiliency">Asset Connection Resiliency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_bgp">Configuring BGP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/config_vrf_learning">VRF Learning via BGP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_reference_guide">Element Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_audit_event">Audit Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dhcp">DHCP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_management_over_forwarding">Management over Forwarding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_domain-based_web_filter">Configuring Domain-based Web Filtering/Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_EthoSVR">Configuring Ethernet Over Secure Vector Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_service_health">Service Health Learning and Fault Avoidance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_gre_tunnel">Native GRE Tunnels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_in-memory_metrics">In-Memory Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ha">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dual_router_ha">High Availability (Dual Router)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_non_forwarding_ha_interfaces">Non-forwarding HA Interfaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_adding_interfaces_to_ha_team">Adding Interfaces to HA Team Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_transition_standalone_to_ha">Transitioning a Conductor from Standalone to HA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_nat">NAT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ospf">OSPF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_rate_limiting">Rate Limiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_RBAC">Configuring Role-Based Access Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp">SNMP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_static_hostname_mapping">Static Hostname Mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_STEP">Configuring Service and Topology Exchange Protocol (STEP)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_tenants">Tenants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_templates">Configuration Templates</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Security</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How To</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CLI Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Installer/Initializer Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Plugins</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">REST APIs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Release Notes</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>VRF Learning via BGP</h1></header><p>The following configuration procedures can be used to initiate VRF learning using BGP. </p><h2 class="anchor anchorWithStickyNavbar_31ik" id="add-vrf-objects">Add VRF Objects<a aria-hidden="true" class="hash-link" href="#add-vrf-objects" title="Direct link to heading">​</a></h2><p>To add VRF learning using BGP, add VRF objects to the <code>routing default-instance</code>, and configure BGP as the routing protocol. This allows the 128T BGP instance to peer with a remote peer and learn routes for the VRF.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router         Test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    routing    default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        vrf    red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name    red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            routing-protocol        bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type                bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                local-as            1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-id 10.1.1.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                neighbor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    neighbor-address  10.1.1.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    neighbor-as       3000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the example above, all routes learned via BGP will be installed within the VRF table Red. </p><h3 class="anchor anchorWithStickyNavbar_31ik" id="vrf-support-for-static-routes">VRF Support for Static Routes<a aria-hidden="true" class="hash-link" href="#vrf-support-for-static-routes" title="Direct link to heading">​</a></h3><p>Static route configuration is configured in the respective VRF instance.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router         Test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    routing               default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        vrf               red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            static-route      11.1.1.1/32 10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop-interface  node1 wan5          </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="redistributing-static-routes">Redistributing Static Routes<a aria-hidden="true" class="hash-link" href="#redistributing-static-routes" title="Direct link to heading">​</a></h3><p>When VRF static routes are redistributed into BGP (using <code>redistribute-static</code>), only the static routes within that VRF are redistributed into BGP. When BGP is configured outside a VRF directly under <code>routing default-instance</code>, the static routes from the global (default) route table are distributed. The <code>static-route</code> command is used to populate static routes in the respective VRF table.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="tenant-to-vrf-mapping">Tenant to VRF Mapping<a aria-hidden="true" class="hash-link" href="#tenant-to-vrf-mapping" title="Direct link to heading">​</a></h3><p>128T routers use Tenants to segment L3 traffic in the forwarding plane. VRF provides L3 segmentation at the routing layer. A 128T router does not have any VRF definitions associated with an interface. Instead, an interface can be assigned a tenant to denote all traffic coming from that interface to be classified as that tenant. The VRF-Tenant mapping is used for redistributing connected routes and for mapping services.</p><p>Use the following example to create a basic configuration for mapping a tenant to a VRF:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router Test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            vrf red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                tenant-name finance</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A tenant can only be mapped to one VRF.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="service-mapping">Service Mapping<a aria-hidden="true" class="hash-link" href="#service-mapping" title="Direct link to heading">​</a></h2><p>Each Service prefix is matched against the routing table that corresponds to the tenant (using the VRF <code>tenant-name</code> mapping configuration). If no VRF tenant mapping exists for the tenant, the service prefix is matched against the global routing table. If no match is found, no FIB entries are installed for that service and tenant.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="services-with-different-tenants">Services with Different Tenants<a aria-hidden="true" class="hash-link" href="#services-with-different-tenants" title="Direct link to heading">​</a></h3><p>The VRF mapping below has a tenant per VRF, and there are 2 services; each with a different tenant access policy.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router         Test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    routing     default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        vrf         red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            tenant-name     finance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        vrf                 blue</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            tenant-name     eng</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Service  web</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address 10.1.1.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy tenant finance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Service  database</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address 10.1.1.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy tenant eng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The prefix is the same for both the services, but the service <code>web</code> is matched against the routes in VRF <code>red</code>, while the service database is matched against routes in VRF <code>blue</code>.
FIB entries are installed for each tenant based on where the best matched route is in the respective VRF route table.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="single-service-with-multiple-tenants-associated-with-different-vrfs">Single Service with Multiple Tenants Associated with Different VRFs<a aria-hidden="true" class="hash-link" href="#single-service-with-multiple-tenants-associated-with-different-vrfs" title="Direct link to heading">​</a></h3><p>In this example the VRF mapping has a tenant per VRF, but only one service with access to both tenants.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router         Test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    routing               default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        vrf               red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            tenant-name       finance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        vrf               blue</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            tenant-name       eng</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Service  web</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address 10.1.1.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy tenant finance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy tenant eng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>With the VRF associations to a single service, the tenants (<code>finance</code> and <code>eng</code>) use the same prefix (<code>10.1.1.0/24</code>) but are located in different VRFs (red/finance, blue/eng). In this configuration the same service can lead to 2 different next hops for different tenants. </p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In the following cases, a single service with multiple tenants associated with different VRFs is not currently supported. </p><ul><li>If the service has a service-route with a NAT target not bound to a specific next-hop.</li><li>If the service is a multicast service.</li></ul><p>In these cases, validation will ensure that all access-policy tenants are associated with <strong>the same, or no VRF.</strong></p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="service-with-no-tenant-vrf-association">Service with no Tenant VRF Association<a aria-hidden="true" class="hash-link" href="#service-with-no-tenant-vrf-association" title="Direct link to heading">​</a></h3><p>A service with access to tenants that have no VRF association will default to the global routing table for route matches.
VRF serves as a routing table for each tenant to ensure that there is a route to the destination. Multiple tenants can have access to this VRF table via Services. If a service is not defined with a prefix that matches the routing table, no FIB entries are installed. </p><h2 class="anchor anchorWithStickyNavbar_31ik" id="show-commands">Show Commands<a aria-hidden="true" class="hash-link" href="#show-commands" title="Direct link to heading">​</a></h2><p>The following show commands have been extended to specify <code>vrf</code>. For specific use examples, refer to the linked section in the Command Line Reference guide.</p><p><a href="/docs/cli_reference#show-bgp"><code>show bgp</code></a></p><p><a href="/docs/cli_reference#show-bgp-neighbors"><code>show bgp neighbors</code></a></p><p><a href="/docs/cli_reference#show-bgp-summary"><code>show bgp summary</code></a></p><p><a href="/docs/cli_reference#show-fib"><code>show fib</code></a></p><p><a href="/docs/cli_reference#show-rib"><code>show rib</code></a></p><p><a href="/docs/cli_reference#show-vrf"><code>show vrf</code></a></p><p><a href="/docs/cli_reference#clear-bgp"><code>clear bgp vrf</code></a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-11-08T19:51:27.000Z">11/8/2021</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/config_bgp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Configuring BGP</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/config_reference_guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Element Reference<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#add-vrf-objects" class="table-of-contents__link toc-highlight">Add VRF Objects</a><ul><li><a href="#vrf-support-for-static-routes" class="table-of-contents__link toc-highlight">VRF Support for Static Routes</a></li><li><a href="#redistributing-static-routes" class="table-of-contents__link toc-highlight">Redistributing Static Routes</a></li><li><a href="#tenant-to-vrf-mapping" class="table-of-contents__link toc-highlight">Tenant to VRF Mapping</a></li></ul></li><li><a href="#service-mapping" class="table-of-contents__link toc-highlight">Service Mapping</a><ul><li><a href="#services-with-different-tenants" class="table-of-contents__link toc-highlight">Services with Different Tenants</a></li><li><a href="#single-service-with-multiple-tenants-associated-with-different-vrfs" class="table-of-contents__link toc-highlight">Single Service with Multiple Tenants Associated with Different VRFs</a></li><li><a href="#service-with-no-tenant-vrf-association" class="table-of-contents__link toc-highlight">Service with no Tenant VRF Association</a></li></ul></li><li><a href="#show-commands" class="table-of-contents__link toc-highlight">Show Commands</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cf1060a5.js"></script>
<script src="/assets/js/main.f8547a3e.js"></script>
</body>
</html>