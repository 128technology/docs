---
title: OTP Router Install Process
sidbar_label: OTP Router Install Process
--- 

The simplest deployment of the One Touch Provisioning (OTP) solution is highly automated and leverages just two components, the Conductor and at least one SSR. For many customers, the SSR platform is ordered and delivered as a pre-integrated, off-the-shelf solution through the Juniper SSR partner network. 

The OTP installation process produces a Router installed with SSR software set to factory defaults. Upon completing the OTP installation process, the default behavior is to provision the device with a DHCP client on the first ethernet port and DHCP server listening on all other ports. The user connects to the SSR via ethernet cable and uses the QuickStart file generated by the Conductor to finalize the SSR configuration. After performing the QuickStart operation, the SSR has connectivity to the conductor and downloads the latest configuration (if necessary) to begin operation.

This process assumes you have already created a bootable device using a USB. Instructions for downloading and creating a bootable device are available in [Downloading an SSR ISO](https://www.juniper.net/documentation/us/en/software/session-smart-router/docs/intro_downloading_iso) and [Creating a Bootable USB](https://www.juniper.net/documentation/us/en/software/session-smart-router/docs/intro_creating_bootable_usb).

Router installation can be performed using either the Interactive Installation, or the OTP process. **The steps in this section describes the OTP process.**

:::note
The Conductor installation must be completed before installing a Session Smart Router or routers using the ISO. The same ISO is used for all installations.
:::

### QuickStart Provisioning
Basic configuration parameters are encoded within an encrypted file. For each node, a custom file can be exported from the Conductor and minimally contains the following configuration encoded parameters:
- WAN IP address, subnet mask and gateway
- Conductor IP address
- Asset ID

### Before you Begin

Before beginning the Router installation, you must have a Conductor operationally deployed and reachable by the router.

This diagram is one possible topology for a standalone SSR deployed at the edge of the network.

![QuickStart network diagram](/img/intro_ztp_quickstart_network_diagram.png)

## Installation

After imaging the ISO onto removable media, insert it into the SSR device and power it on.

### Booting from the USB

Use the steps appropriate for your device to direct the device to boot from the USB for installation. 

#### SSR100 Series Devices

1. At the instruction in the terminal window: `Press ESC for boot menu`, do so. 
 ![Boot Menu prompt](/img/onboard_otp_boot_menu.png)
2. From the boot menu, enter the boot device number corresponding to the USB, and press Enter. 

 ![Select Boot Device](/img/onboard_otp_boot_device.png)
3. When the USB installer boot menu is displayed, continue with the [OTP Router Installation](#otp-router-installation).

#### SSR1000 Series Devices

1. At the instruction in the terminal window: `Press <Tab> or <DEL> to enter Setup`, do so.
 ![Setup Menu Prompt](/img/1x00_setup_menu.png)
2. When the Setup Utility window appears, use the left and right arrow keys to navigate to the `Save & Exit` tab.

 ![Setup Utility](/img/setup-menu-prompt.png)
3. Use the up and down arrow keys to highlight the boot device in the the Boot Override list.

 ![Boot Override list](/img/1x00_boot-override.png)
4. Press Enter to confirm boot from the USB device.
5. When the USB installer boot menu is displayed, continue with the [OTP Router Installation](#otp-router-installation).

### OTP Router Installation 

Upon boot, the following screen is displayed. The default selection is booting to the serial console (115200 baud). You must manually choose the installation process suited for your environment.

1. Use the Up/Down keys to select the `OTP Install 128T Routing Software Serial Console` option. This is a supported installation option for Common Criteria. It uses `/dev/ttyS0` 115200 baud as the serial console for interacting with the installer. 

  ![Serial Install Selection](/img/cc_fips_otp_serial.png)

  Selecting the wrong type of console may result in garbled characters being displayed. If allowed to continue it will result in an incorrect installation. If the wrong console is selected, reboot the target system and select the correct line for the target hardware.

  For serial console issues please refer to [Serial Console Troubleshooting](https://www.juniper.net/documentation/us/en/software/session-smart-router/docs/ts_serial_console_tsing).

2. Press the TAB key to edit the configuration.

  To enable FIPS Enforcement for SSR software version 6.2.3-14R2, add the `fips=1` kernel option  to the kernel command line during system installation as shown in the steps below. This ensures that key generation is done with FIPS approved algorithms and continuous monitoring tests in place.

  :::important
  FIPS mode is required for Common Criteria compliance. Failure to configure FIPS mode, or the use of any other cryptographic engine nullifies compliance.
  :::

3. Add `fips=1` to the end of the `vmlinuz` parameters.

  ![FIPS Parameter](/img/cc_fips_serial_install2.png)

4. Press **Enter** to start the install. 

### SSR Installation

This installation process is an automated workflow which does not require user interaction after selecting and initiating the OTP menu option. The system will power off after installation.

### Bootstrapping

After the initial installation and poweroff, the system is generic - it has no specific configuration. Once the platform is started again, an automated script performs bootstrapping of the platform. This script is a single run service unit that executes **once** during the first bootup, and automatically performs the following steps:

#### 1. Configure Hostname and Salt Minion Identifier

The hostname and salt minion identifier are set to the same value during the bootstrapping process.

If the system serial number is provisioned (seen by `dmidecode --string system-serial-number`) this value will be used. Otherwise use the first MAC address found in the format of: `mac-<address>`

#### 2. Configure the SSR and Network Interfaces

The Bootstrapper sets the SSR configuration via the QuickStart file found in one of the following locations:

- The root of an attached USB drive. i.e. `/bootstrap.quickstart`. The USB drive MUST be named "BOOTSTRAP" in all caps.

- In `/etc/128technology/bootstrap.quickstart`.

If no file source is present in either location, the Bootstrapper executes HTTP GET requests to the following endpoints to download the QuickStart File from a server. The REST response is explained in [REST details](#quickstart-file-via-rest).
    1. `http://quickstart.128t-bootstrap.local/quickstart/<identifier>`
    2. `http://192.168.128.128/quickstart/<identifier>`

The `<identifier>` is the minion-id as determined by the algorithm discussed in [Configure Hostname and Salt Minion Identifier](#configure-hostname-and-salt-minion-identifier). Typically, it is the system serial number.

If none of the above are successful, the OTP defaults are used. This configures the DHCP client on the first ethernet port and a DHCP server listening on all other ports.

#### 3. Enable the SSR and Salt-Minion Service

The quickstart file configures and enables the SSR and the associated salt-minion service.

#### 4. Write a Result Report

Once the platform is rebooted after bootstrapping, the bootstrap validation report can be found at the root filesystem (`/root/128T-bootstrap.txt`) containing details about the steps taken. The `/root/128T-bootstrap.json` file contains the same information in JSON format. The report contains a message that includes additional details for each step.

Shown below is the location of the bootstrap report as well as an example of the contents.
```
[root@sn123456789 ~]# cat /root/128T-bootstrap.txt
+--------------------+--------+---------------------------------+
| Label              | Result | Message                         |
+--------------------+--------+---------------------------------+
| Minion ID          | True   | mac-000000                      |
| Hostname           | True   | mac-000000                      |
| Clock Sync         | True   |                                 |
| Initialize 128T    | True   | node.Router                     |
| Enable 128T        | True   |                                 |
| Enable salt-minion | True   |                                 |
| Factory Defaults   | True   | http://192.168.0.100/quickstart |
| Ifgcfg files       | True   |                                 |
+--------------------+--------+---------------------------------+
```

#### 5. Reboot

After reboot, the SSR service will be configured and running.

:::info
It is important to note that after the OS installation the dhclient is configured across all network interfaces until the platform has completed Bootstrapping.
:::

### Change the Default Passwords after Installation

The following user accounts and passwords are created during the ISO installation process:

| Username | Password   |
| -------- | ---------- |
| root     | 128tRoutes |
| t128     | 128tRoutes |

Change these passwords immediately. Use the `passwd` command from the UNIX window.

```
[t128@test-router ~]$ passwd
Changing password for user t128
Changing password for t128
(current)UNIX password:
New password:
Retype new password: 
passwd: all authentication tokens updated successfully.
[t128@test-router ~]$ su - 
Password:
[root@test-router ~]# passwd
Changing password for user root.
New password:
Retype new password: 
passwd: all authentication tokens updated successfully.
[root@test-router ~]#
```

### PCLI Access Post Install

Use the following procedure to access the pcli at any time after installation. 

1. Open a terminal window and ssh to the conductor's IP address. 
2. Use your login credentials to log in to the conductor, and run the `pcli` command to start the SSR PCLI. 

Common Criteria certification does not require any restrictions on executing commands. See the [Configuration Command Reference Guide](https://www.juniper.net/documentation/us/en/software/session-smart-router/docs/config_command_guide) for command information and usage.
