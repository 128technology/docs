<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">IPsec Client plugin | SSN Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/plugin_ipsec_client"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="IPsec Client plugin | SSN Docs"><meta data-react-helmet="true" name="description" content="The 128T-ipsec-client plugin provides a way to send and encrypt traffic to IPsec endpoints through the 128T router. It is possible to configure the plugin for each router to have multiple destination IPsec endpoints and thus the 128T will failover between them. This is accomplished by performing a Service Function Chain (SFC) with Libreswan, a third-party IPsec client. By enabling this plugin, you can provide IPsec tunnel connectivity to third party providers from your 128T router."><meta data-react-helmet="true" property="og:description" content="The 128T-ipsec-client plugin provides a way to send and encrypt traffic to IPsec endpoints through the 128T router. It is possible to configure the plugin for each router to have multiple destination IPsec endpoints and thus the 128T will failover between them. This is accomplished by performing a Service Function Chain (SFC) with Libreswan, a third-party IPsec client. By enabling this plugin, you can provide IPsec tunnel connectivity to third party providers from your 128T router."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/plugin_ipsec_client"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/plugin_ipsec_client" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/plugin_ipsec_client" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.21b25f22.css">
<link rel="preload" href="/assets/js/runtime~main.986d1a64.js" as="script">
<link rel="preload" href="/assets/js/main.8fa91905.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Session Smart Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation">Installation Process</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_image">Image-Based Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_quickstart_aws">Cloud Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_upgrade_considerations">Upgrades and Rollback</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_installer">Supporting Install Information - Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/wan_overview">WAN Assurance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/config_basics">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/bcp_att_avpn_configuration">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/plugin_intro">Plugins</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_aws_tgw_connect">AWS Transit Gateway Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_bgp_community_services">BGP Community Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_cloud_ha">Cloud HA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_dns_app_id">DNS App Id</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_dns_cache">DNS Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_gre">GRE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_ha_sync_redundancy">HA Sync Redundancy Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_http_probe">HTTP Probe Reachability Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_icmp_reachability_detection">ICMP Reachability Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/plugin_ipsec_client">IPsec Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_loopback_static_routes">Loopback Static Routes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_m800_watchdog">M800 Watchdog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_monitoring_agent">Monitoring Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_mosh">Mosh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_set_hostname">Set Hostname</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_sip_alg">SIP ALG</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_wireguard">Wireguard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_kni_namespace_scripts">KNI Namespace Scripts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/release_notes_128t_6.0">Release Notes</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>IPsec Client plugin</h1></header><p>The 128T-ipsec-client plugin provides a way to send and encrypt traffic to IPsec endpoints through the 128T router. It is possible to configure the plugin for each router to have multiple destination IPsec endpoints and thus the 128T will failover between them. This is accomplished by performing a <a href="/docs/plugin_intro#service-function-chaining">Service Function Chain (SFC)</a> with Libreswan, a third-party IPsec client. By enabling this plugin, you can provide IPsec tunnel connectivity to third party providers from your 128T router.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The instructions for installing and managing the plugin can be found <a href="/docs/plugin_intro#installation-and-management">here</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuration">Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">​</a></h2><p>The IPsec plugin setup has the following key parts to the configuration.</p><ul><li><code>ipsec-profile</code> describing the mechanism with which to connect to the server.</li><li><code>ipsec-client</code> represent the remote endpoints or server with which the ipsec client communicates.</li><li><code>service-route</code>&#x27;s to route the traffic through the tunnels</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="profiles">Profiles<a class="hash-link" href="#profiles" title="Direct link to heading">​</a></h3><p>The <code>router &gt; ipsec-profile</code>&#x27;s are reusable IPsec settings that can be used across multiple nodes in a router and multiple IPsec endpoint <code>remote</code>s. The table below represents the most common configuration elements for a valid ipsec profile.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ipsec-profile  zscaler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name                     zscaler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ike-encryption           aes256</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ike-digest               sha2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ike-modp                 modp1024</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        authentication-protocol  esp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        phase2-encryption        aes_gcm128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        phase2-digest            sha2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        phase2-modp              modp1024</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ike-lifetime             1h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        connection-lifetime      8h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        perfect-forward-secrecy  true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dpddelay                 20</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dpdtimeout               100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dpdaction                restart</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        local-id                 [local-id@domain.com]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pre-shared-key           (removed)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The above configuration example represents a typical profile used for a IPSec provider such as Zscaler. Please tune the settings to match the settings recommended by your provider.</p><table><thead><tr><th>Config</th><th>Type</th><th>Recommended</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>-</td><td>The name of the profile</td></tr><tr><td>ike-encryption</td><td>enum</td><td>aes256</td><td>Algorithm used for IKE encryption</td></tr><tr><td>ike-digest</td><td>enum</td><td>sha2</td><td>Hash algorithm used for IKE encryption</td></tr><tr><td>ike-modp</td><td>enum</td><td>modp1024</td><td>Modp group used for IKE encryption</td></tr><tr><td>authentication-protocol</td><td>enum</td><td>esp</td><td>The type of SA to be produced for authentication</td></tr><tr><td>phase2-encryption</td><td>enum</td><td>aes_gcm128</td><td>Algorithm used for phase 2 encryption</td></tr><tr><td>phase2-digest</td><td>enum</td><td>sha2</td><td>Hash algorithm used for phase 2 encryption</td></tr><tr><td>phase2-modp</td><td>enum</td><td>modp1024</td><td>Modp group used for phase 2 encryption</td></tr><tr><td>ike-lifetime</td><td>time</td><td>1h</td><td>Lifetime of the keying channel for a connection</td></tr><tr><td>connection-lifetime</td><td>time</td><td>8h</td><td>Lifetime for the security association</td></tr><tr><td>perfect-forward-secrecy</td><td>bool</td><td>yes</td><td>Whether Perfect Forward Secrecy of keys is required on the connection</td></tr><tr><td>dpddelay</td><td>seconds</td><td>20</td><td>Delay between DPP keepalives on the connection</td></tr><tr><td>dpdtimeout</td><td>seconds</td><td>100</td><td>After the period has elapsed with no traffic including DPD traffic, the connection will be declared dead</td></tr><tr><td>dpdaction</td><td>enum</td><td>restart</td><td>Action taken once the enabled peer is detected as dead</td></tr><tr><td>local-id</td><td>string</td><td>user-defined</td><td>How to identify the router for authentication. Can be an IP address of FQDN. Must be preceded with an <code>@</code> symbol to prevent resolution as shown in the example</td></tr><tr><td>pre-shared-key</td><td>string</td><td>user-defined</td><td>pre-shared key used for authentication</td></tr></tbody></table><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>This plugin can only connect to IPsec endpoints that support pre-shared key authentication.</p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="custom-options">Custom Options<a class="hash-link" href="#custom-options" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_y2LR" id="version-history">Version History<a class="hash-link" href="#version-history" title="Direct link to heading">​</a></h5><table><thead><tr><th>Release</th><th>Modification</th></tr></thead><tbody><tr><td>3.3.0</td><td><code>profile &gt; custom-option</code> introduced</td></tr></tbody></table><p>The <code>custom-option</code> allows the user to configure additional obscure libreswan options that are not exposed via the profile and remote configuration.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  myRouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           myRouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ipsec-profile  myProfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name           myProfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                custom-option  key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name   key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    value  value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th>Config</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>The name of the libreswan option</td></tr><tr><td>value</td><td>The value of the option</td></tr></tbody></table><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>The <code>custom-option</code> is added to the libreswan config file; any invalid option could prevent the application from starting up.</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="clients">Clients<a class="hash-link" href="#clients" title="Direct link to heading">​</a></h3><p>Clients are a collection of remote endpoints which can be used for connection and failover purposes.</p><p>The main config properties of a remote endpoint are as follows.</p><table><thead><tr><th>Config</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>The name of the remote client to be used for sending traffic to the tunnel.</td></tr><tr><td>host</td><td>ip-or-fqdn</td><td>The address or FQDN of the remote endpoint.</td></tr><tr><td>profile</td><td>reference</td><td>The name of the profile to be used for this remote endpoint.</td></tr><tr><td>remote-id</td><td>string</td><td>The optional remote identifier used during authentication.</td></tr><tr><td>subnet</td><td>ip-prefix</td><td>The remote subnet behind the tunnel.</td></tr><tr><td>tunnel-monitor</td><td>container</td><td>Properties for monitoring the phase-2 connection. See <a href="/docs/plugin_ipsec_client#tunnel-monitoring">Tunnel Monitoring</a> for more information.</td></tr></tbody></table><p>Example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router myRouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    node</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name    myRouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ipsec-client client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            tenant ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            remote primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                host &lt;primary-address&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                profile myProfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                remote-id prisma@paloalto.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                subnet 0.0.0/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                tunnel-monitor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    destination 8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        address 8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        timeout 10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        max-retries 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        interval 60</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            remote secondary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                host &lt;primary-address&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                profile myProfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                remote-id prisma@paloalto.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                subnet 0.0.0/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                tunnel-monitor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    destination 8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        address 8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        timeout 10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        max-retries 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        interval 60</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Only one <code>ipsec-client</code> can be configured per node, but two <code>remote</code>s can be configured per client.</p></div></div><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>The <code>ipsec-client &gt; name</code> cannot start with <code>ipsec</code> or <code>mast</code>. See notes <a href="/docs/plugin_ipsec_client#release-340">here</a>.</p></div></div><p>Each <code>remote</code> represents a unique tunnel destination and can be used to route traffic in/out of the tunnels. Typically each node has two tunnels to act as primary and backup.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="tunnel-monitoring">Tunnel Monitoring<a class="hash-link" href="#tunnel-monitoring" title="Direct link to heading">​</a></h3><h5 class="anchor anchorWithStickyNavbar_y2LR" id="version-history-1">Version History<a class="hash-link" href="#version-history-1" title="Direct link to heading">​</a></h5><table><thead><tr><th>Release</th><th>Modification</th></tr></thead><tbody><tr><td>3.2.0</td><td><code>remote &gt; tunnel-monitor</code> introduced</td></tr></tbody></table><p>Tunnel monitoring is a way to monitor the health of individual tunnels and have them automatically restart if they become unhealthy. An ICMP ping is used for the traffic. For each <code>remote</code>, you can specify a destination, interval, timeout, and the number of max retries for each interval.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">node</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ipsec-client client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        remote c1gateway1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            tunnel-monitor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                destination 8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    address 8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    timeout 10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    max-retries 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interval 120</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tunnel-monitor-nat-network 10.128.128.0/28</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th>Config</th><th>Description</th></tr></thead><tbody><tr><td><code>enabled</code></td><td>Allows you to switch tunnel monitoring on and off for a <code>remote</code>.</td></tr><tr><td><code>address</code></td><td>The IP or hostname where traffic is sent. This address must be reachable after traversing the  tunnel.</td></tr><tr><td><code>timeout</code></td><td>Duration (in seconds) within which to reach the destination. Each attempt will be made in this duration / <code>max-retries</code> interval.</td></tr><tr><td><code>max-retries</code></td><td>Number of consecutive missed ICMP ping responses from the destination within the interval before deciding that the tunnel is unhealthy.</td></tr><tr><td><code>interval</code></td><td>Duration (in seconds) of how often to perform an ICMP probe test to the probe-address.</td></tr><tr><td><code>tunnel-monitor-nat-network</code></td><td>The subnet where traffic originates. The corresponding ingress KNI&#x27;s fourth octet is used. By default, the subnet <code>10.128.128.0/28</code> is used.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-services-for-tunnel-traffic">Configuring services for tunnel traffic<a class="hash-link" href="#configuring-services-for-tunnel-traffic" title="Direct link to heading">​</a></h3><p>The user can define up to four <code>ipsec-client &gt; remote</code> endpoints per node. In addition, the user must also define the necessary service and service-routes to route the tunnel traffic over the desired WAN interface.</p><p>The following example shows a configuration for capturing the tunnel traffic and allows the <code>ipsec</code> tenant as defined in <code>router &gt; ipsec-client &gt; tenant</code> config above.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  ipsec-tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           ipsec-tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope          private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        &lt;remote-address-1&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        &lt;remote-address-2&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport      udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  4500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  4500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>&lt;remote-address-1&gt;</code> and <code>&lt;remote-address-2&gt;</code> represent the <code>node &gt; ipsec-client &gt; remote &gt; host</code> address. The <code>ipsec</code> tenant is allowed as per the tenant defined under <code>ipsec-client &gt; tenant</code>. The user can split the tunnels into separate services per the routing requirements.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="directing-traffic-through-the-tunnel">Directing traffic through the tunnel<a class="hash-link" href="#directing-traffic-through-the-tunnel" title="Direct link to heading">​</a></h3><p>The user can leverage standard SSR service and service-route to direct intended traffic over the ipsec tunnel. In the example below, all guest internet traffic is sent over the ipsec tunnel for break and inspect. This can be accomplished as follows:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router   myRouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           myRouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route  guest-internet-rte-primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name          guest-internet-rte-primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  guest-internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      combo-east-1 primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name  combo-east-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface  primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route  guest-internet-rte-secondary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name          guest-internet-rte-secondary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  guest-internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      combo-east-1 secondary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name  combo-east-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface  secondary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant   guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name  guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  guest-internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           guest-internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            description    &quot;guest-internet access&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope          private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        0.0.0.0/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>service-route &gt; next-hop &gt; interface</code> must point to the corresponding <code>ipsec-client &gt; remote &gt; name</code>-intf to route the traffic through the tunnel. All available SSR routing techniques including using vectors, service-policy, etc., can be leveraged to define how the untrusted traffic is sent over the tunnels, and how to route the traffic. The SSR routes the packets through the appropriate IPSec tunnels and manages the failover as per the policy. On the return path, the encrypted traffic is processed, decrypted, and send back to the client that originated the session.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="thirdparty-software--licenses">Thirdparty Software &amp; Licenses<a class="hash-link" href="#thirdparty-software--licenses" title="Direct link to heading">​</a></h2><ul><li>Libreswan v3.23-5.el7_5 (GNU GPLv2)</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="data-model">Data Model<a class="hash-link" href="#data-model" title="Direct link to heading">​</a></h3><p>If the data model doesn’t appear in the PCLI or GUI, make sure that you have restarted the 128T service.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="logging">Logging<a class="hash-link" href="#logging" title="Direct link to heading">​</a></h3><p>The <code>/var/log/128technology/persistentDataManager.log</code> file at trace level will hold whether the configuration generation was run as well as output and return code.
The <code>/var/log/128technology/automatedProvisioner.log</code> file at trace level will hold whether the pillar generation was run as well as output and return code.
Configuration and pillar generation logs can be found on the conductor under <code>/var/log/128technology/plugins/ipsec-client-config-generation.log</code> and <code>/var/log/128technology/plugins/ipsec-client-pillar-generation.log</code> respectively.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="salt">Salt<a class="hash-link" href="#salt" title="Direct link to heading">​</a></h3><p>Salt status can be found on the conductor by utilizing the PCLI’s <code>show assets</code> and <code>show assets &lt;asset-id&gt;</code> commands.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="pcli-enhancements">PCLI Enhancements<a class="hash-link" href="#pcli-enhancements" title="Direct link to heading">​</a></h3><p>To check the status of the IPsec tunnels for a given ingress KNI, extra IPsec tunnel related output will be found in the <code>show device-interface</code> command as well as the <code>show plugin state</code> command.</p><p>Example output for a healthy tunnel:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@combo-west.RTR_WEST_COMBO# show device-interface name rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tue 2020-06-30 16:44:39 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=========================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> combo-west:rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=========================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Type:                host</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Forwarding:          true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Mode:                host</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> MAC Address:         22:ee:4e:b6:37:a8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Admin Status:        up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Operational Status:  up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Redundancy Status:   non-redundant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Speed:               1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Duplex:              full</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> in-octets:                        9992</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> in-unicast-pkts:                   161</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> in-errors:                           0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> out-octets:                       6986</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> out-unicast-pkts:                  161</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> out-errors:                         11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> IPSec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Tunnel Status:   Up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Tunnel Details:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         Name:        ipsec-client-tunnel-secondary-rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         Remote id:   172.16.5.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         SA creation time:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           2020-06-30 16:37:50</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         In bytes:    0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         Out bytes:   336</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SA Count:        1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.12 seconds</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Example output for a tunnel that is down:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">========================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> combo-west:rem1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Type:                host</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Forwarding:          true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Mode:                host</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> MAC Address:         76:78:79:fc:eb:69</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Admin Status:        up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Operational Status:  down</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Redundancy Status:   non-redundant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Speed:               0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Duplex:              unknown</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> in-octets:                     1962932</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> in-unicast-pkts:                 32710</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> in-errors:                           0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> out-octets:                    1373442</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> out-unicast-pkts:                32701</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> out-errors:                          6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> IPSec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Tunnel Status:     Down</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="tunnel-monitor-state">Tunnel Monitor State<a class="hash-link" href="#tunnel-monitor-state" title="Direct link to heading">​</a></h4><p>If tunnel monitoring is enabled for a remote, corresponding tunnel monitoring state is included in the pcli commands.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> IPSec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Tunnel Status:   Up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Tunnel Details:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         Name:        ipsec-client-tunnel-primary-rem1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         Remote id:   172.16.4.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         SA Details:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             Add time:2022-02-14 15:41:15</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             In bytes:60</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             Out bytes:60</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         Ingress Total (bytes):60</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         Egress Total (bytes):60</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     SA Count:        1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Tunnel Monitoring:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           Destination:8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           Status:    up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           Last Attempt:2022-02-14 15:42:34</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           Last Restart:2022-02-14 15:41:15</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="commands">Commands<a class="hash-link" href="#commands" title="Direct link to heading">​</a></h3><h5 class="anchor anchorWithStickyNavbar_y2LR" id="version-history-2">Version History<a class="hash-link" href="#version-history-2" title="Direct link to heading">​</a></h5><table><thead><tr><th>Release</th><th>Modification</th></tr></thead><tbody><tr><td>3.3.0</td><td><code>restart ipsec remote</code> command was introduced</td></tr></tbody></table><p>The <code>restart ipsec remote</code> command can be used to restart an individual IPSec tunnel via the conductor PCLI and UI.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# restart ipsec remote router router-1 node node-1 remote-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Retrieving 0/1 targets complete....</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Target: node1.conductor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">002 &quot;ipsec-client-tunnel-primary-remote-1&quot;: terminating SAs using this connection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">002 &quot;ipsec-client-tunnel-primary-remote-1&quot; #8261: deleting state (STATE_PARENT_I1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">002 &quot;ipsec-client-tunnel-primary-remote-1&quot; #8262: initiating v2 parent SA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">133 &quot;ipsec-client-tunnel-primary-remote-1&quot; #8262: STATE_PARENT_I1: initiate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully retrieved info.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>From the conductor UI, the command can be accessed as shown in the screenshot below.</p><p><img alt="IPsec Tunnel Restart Command" src="/assets/images/ipsec_tunnel_restart-148ecaf788dacf7fc5a9cfd2ef6ead65.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="systemd-services">Systemd Services<a class="hash-link" href="#systemd-services" title="Direct link to heading">​</a></h3><p>To check the status of the IPsec client service on the router, you can run <code>show system services</code> which will show all 128T related services running on the specified node. The one for this plugin is named <code>128t-ipsec</code>.</p><p>To verify that the services are running properly on the 128T router:</p><ul><li><code>systemctl status 128t-ipsec@&lt;client&gt;.service</code></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="failover-alarms">Failover Alarms<a class="hash-link" href="#failover-alarms" title="Direct link to heading">​</a></h3><p>If a tunnel goes down, we set the corresponding ingress KNI to be operationally down. An alarm will be created when this happens.</p><p>Example output when the tunnel for <code>rem1</code> goes down:</p><div class="codeBlockContainer_J+bg language-admin@combo-west.RTR_WEST_COMBO# theme-code-block"><div class="codeBlockContent_csEI admin@combo-west.RTR_WEST_COMBO#"><pre tabindex="0" class="prism-code language-admin@combo-west.RTR_WEST_COMBO# codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tue 2020-06-30 16:42:50 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============== ===================== ========== ============= =========== ==================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ID             Time                  Severity   Source        Category    Message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============== ===================== ========== ============= =========== ==================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> combo-west:8   2020-06-30 16:32:42   critical   unavailable   interface   Intf rem1 (4) operationally down</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">There are 0 shelved alarms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.10 seconds</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="appendix">Appendix<a class="hash-link" href="#appendix" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="generated-128t-configuration">Generated 128T Configuration<a class="hash-link" href="#generated-128t-configuration" title="Direct link to heading">​</a></h3><p>A KNI per remote is created with the name of the <code>remote</code> and a single egress KNI is created with the name of the <code>ipsec-client</code>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="user-specific-128t-configuration">User-Specific 128T Configuration<a class="hash-link" href="#user-specific-128t-configuration" title="Direct link to heading">​</a></h3><p>To allow the maximum flexibility on getting the traffic into the plugin&#x27;s network namespace and getting the traffic out, we rely on the user to configure those means (usually through services and service routes).</p><p>You will need to have the IPsec endpoint bound traffic sent into the KNIs with the names of the <code>remote</code>s. You can use builtin 128T failover techniques due to the KNIs being reported operationally down when the corresponding tunnel is down. You will also need to configure a way for the traffic to be routed towards the IPsec endpoint after being encrypted. All of this encrypted traffic will be assigned to the <code>tenant</code> configured under <code>ipsec-client</code>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="complete-example-configuration">Complete Example Configuration<a class="hash-link" href="#complete-example-configuration" title="Direct link to heading">​</a></h3><p>Below is an example of a complete, but minimal configuration entered by the user.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>This example configuration is good to understand all of the concepts but should not be used on a system as is.</p></div></div><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service         cleartext</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name            cleartext</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address         1.1.1.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy   lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service         ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        172.16.4.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router               router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ipsec-profile         primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name                 primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pre-shared-key       somekey1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ipsec-profile         secondary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name                 secondary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pre-shared-key       somekey2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            node node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  lanintf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name          lanintf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant        lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        address       172.16.1.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     172.16.1.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        2.2.2.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wanintf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name          wanintf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        address       172.16.3.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     172.16.3.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        172.16.3.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ipsec-client              client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name     client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled  true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    tenant   ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    remote   rem1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name     rem1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        host     172.16.4.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        profile  primary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    remote   rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name     rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        host     172.16.5.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        profile  secondary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route         rem1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name          rem1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  cleartext</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      router1 rem1-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name   router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface   rem1-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    gateway-ip  169.254.129.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route         rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name          rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  cleartext</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      router1 rem2-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name   router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface   rem2-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    gateway-ip  169.254.129.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route         ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name          ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      router1 wanintf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name   router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface   wanintf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    gateway-ip  172.16.3.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Upon commit, the plugin will generate other configuration as shown below:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            node node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    description        &quot;Auto-generated host interface for use with ipsec-client&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               host</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-namespace  client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  client1-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name       client1-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        type       external</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant     ipsec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        address    169.254.129.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     169.254.129.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  30</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        169.254.129.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          rem1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               rem1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    description        &quot;Auto-generated host interface for use with ipsec-client&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               host</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-namespace  client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  rem1-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name       rem1-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        type       external</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant     _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        address    169.254.129.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     169.254.129.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  30</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        169.254.129.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               rem2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    description        &quot;Auto-generated host interface for use with ipsec-client&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               host</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-namespace  client1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  rem2-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name       rem2-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        type       external</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant     _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        address    169.254.129.9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     169.254.129.9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  30</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        169.254.129.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="release-notes">Release Notes<a class="hash-link" href="#release-notes" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-340">Release 3.4.0<a class="hash-link" href="#release-340" title="Direct link to heading">​</a></h3><p><strong>Release Date:</strong> Jul 13, 2022</p><p><strong>Router Version</strong> 128T-ipsec-2.2.4-2</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="new-features-and-improvements">New Features and Improvements<a class="hash-link" href="#new-features-and-improvements" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-1720</strong> Added support for new ciphers for Phase-1 and Phase-2 security</li></ul><p>The plugin now support aes-256-gcm, dh-20, sha512 and no-auth encryption schemes.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed">Issues Fixed<a class="hash-link" href="#issues-fixed" title="Direct link to heading">​</a></h4><ul><li><p><strong>PLUGIN-880</strong> IPSec client connection is not initiated for certain config combinations</p><p><em><strong>Resolution:</strong></em> The ipsec client names beginning with ipsec and mast are not supported by libreswan. As part of the fix, a new config rule was added to enforce this requirement.</p></li><li><p><strong>PLUGIN-1807</strong> IPSec health monitoring configuration does not report correct status</p><p><em><strong>Resolution:</strong></em> The monitoring scripts were writing data to a non-persistent path resulting in the failure across reboots. The state directory will not be automatically re-generated on system reboots.</p></li><li><p><strong>PLUGIN-1810</strong> Trace logging in configuration results in IPSec failures</p><p><em><strong>Resolution:</strong></em> Trace level logging is now converted appropriately for IPSec configuration to prevent underlying failures.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-331">Release 3.3.1<a class="hash-link" href="#release-331" title="Direct link to heading">​</a></h3><p><strong>Release Date:</strong> May 25, 2022</p><p><strong>Router Version</strong> 128T-ipsec-2.2.2-1</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-1">Issues Fixed<a class="hash-link" href="#issues-fixed-1" title="Direct link to heading">​</a></h4><ul><li><p><strong>PLUGIN-1730</strong> Invalid libreswan configuration was being generated when multiple local or remote subnets were configured.</p><p><em><strong>Resolution</strong></em> The issue with the libreswan configuration generation has been resolved.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-330">Release 3.3.0<a class="hash-link" href="#release-330" title="Direct link to heading">​</a></h3><p><strong>Release Date:</strong> Apr 27, 2022</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="new-features-and-improvements-1">New Features and Improvements<a class="hash-link" href="#new-features-and-improvements-1" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-630</strong> Raise the number of supported IPSec client tunnels from 2 to 4</li></ul><p>The plugin now supports up to 4 IPSec tunnels per node.</p><ul><li><strong>PLUGIN-1641</strong> Optimize the initial IPSec environment setup</li></ul><p>The majority of the IPSec config and environment management is performed locally on the router thereby minimizing the interaction with salt states.</p><ul><li><strong>PLUGIN-1533</strong> Create a command to restart an individual tunnel</li></ul><p>A new command was added to allow the user to restart an individual tunnel. More details can be found in the <a href="#commands">commands section</a></p><ul><li><strong>PLUGIN-1532</strong> Enable additional configuration options for IPSec tunnels.</li></ul><p>The <code>encapsulation</code> and <code>remote-peer-type</code> options are now available for configuration.</p><ul><li><strong>PLUGIN-1554</strong> Collect ipsec-client plugin data as part of tech support info</li></ul><p>The detailed tech support info bundle will now include the necessary logs and data for troubleshooting ipsec-client plugin related problems.</p><ul><li><strong>PLUGIN-1598</strong> - Support custom options for obscure libreswan config fields</li></ul><p>A new config option has been added to enable libreswan features that are not made available as first class configuration.</p><ul><li><strong>PLUGIN-1591</strong> Add cpu, memory, and  status tracking for ipsec services.</li></ul><p>The system will now track the cpu, memory and usage information for various IPSec client related processes.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-2">Issues Fixed<a class="hash-link" href="#issues-fixed-2" title="Direct link to heading">​</a></h4><ul><li><p><strong>PLUGIN-1628</strong> Incorrect network-script path was being used in the auto generated device-interface configuration</p><p><em><strong>Resolution</strong></em> The auto configuration was updated to use the correct script path.</p></li><li><p><strong>PLUGIN-1610</strong> The IPSec environment setup can fail on first time plugin install</p><p><em><strong>Resolution</strong></em> The salt states were improved to have better interdependencies to avoid the first time boot failure.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-320">Release 3.2.0<a class="hash-link" href="#release-320" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="new-features-and-improvements-2">New Features and Improvements<a class="hash-link" href="#new-features-and-improvements-2" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-1509</strong> Ability to configure tunnel monitors</li></ul><p>The feature adds support for configuring tunnel monitors using ping. See <a href="#tunnel-monitoring">the tunnel monitoring section</a> for more details.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-3">Issues Fixed<a class="hash-link" href="#issues-fixed-3" title="Direct link to heading">​</a></h4><ul><li><p><strong>PLUGIN-1389</strong> Corrupt encryption database caused tunnels to not come up.</p><p><em><strong>Resolution</strong></em> The service on the router will clean up these database files on startup.</p></li><li><p><strong>PLUGIN-1467</strong> Configuring <code>aes_gcm256</code> for <code>phase2-encryption</code> resulted in invalid libreswan configuration.</p><p><em><strong>Resolution</strong></em> The libreswan config generation will generate valid configuration for <code>aes_gcm256</code>.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-313">Release 3.1.3<a class="hash-link" href="#release-313" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-4">Issues Fixed<a class="hash-link" href="#issues-fixed-4" title="Direct link to heading">​</a></h4><ul><li><p><strong>PLUGIN-1480</strong> IPSec tunnels were removed from all previously configured routers after config commit</p><p><em><strong>Resolution:</strong></em> The config generation logic for the plugin will handle config with long lines correctly</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-220-310">Release 2.2.0, 3.1.0<a class="hash-link" href="#release-220-310" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="new-features-and-improvements-3">New Features and Improvements<a class="hash-link" href="#new-features-and-improvements-3" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-1289</strong> Ability to provision custom MSS on the remote tunnel interfaces</li></ul><p>The feature adds support for configuring a custom MSS value on the remote IPSec tunnel interface. The new configuration can be found under <code>router &gt; node &gt; ipsec-client &gt; remote &gt; enforced-mss</code>. The configuration follows the same format as the <a href="/docs/config_reference_guide#network-interface">network-interface &gt; enforced-mss</a>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-107-207-210-302">Release 1.0.7, 2.0.7, 2.1.0, 3.0.2<a class="hash-link" href="#release-107-207-210-302" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-5">Issues Fixed<a class="hash-link" href="#issues-fixed-5" title="Direct link to heading">​</a></h4><ul><li><p><strong>PLUGIN-1092</strong> IPSec left and right subnet configuration does not always work correctly</p><p><em><strong>Resolution:</strong></em> The non-default left and right subnet configuration is correctly translated to corresponding libreswan configuration.</p></li><li><p><strong>PLUGIN-1103</strong> IPSec remote host does not appear as link on the GUI</p><p><em><strong>Resolution:</strong></em> The GUI presentation model was updated to include the missing key field.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-301">Release 3.0.1<a class="hash-link" href="#release-301" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-6">Issues Fixed<a class="hash-link" href="#issues-fixed-6" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-1092</strong> Added fix for local and remote subnet configuration option to allow a single value or a list of values.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-300">Release 3.0.0<a class="hash-link" href="#release-300" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-7">Issues Fixed<a class="hash-link" href="#issues-fixed-7" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-768</strong> Support the IPSec client plugin in 128T versions <code>5.1.0</code> and greater.</li><li><strong>PLUGIN-611</strong> Added support for plugin state. Plugin state information can be accessed on the PCLI using <code>show plugins state [router &lt;router&gt;] [node &lt;node&gt;] [{detail | summmary}] 128T-ipsec-client</code></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-106-206">Release 1.0.6, 2.0.6<a class="hash-link" href="#release-106-206" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-8">Issues Fixed<a class="hash-link" href="#issues-fixed-8" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-1057</strong> Ensure all critical IPsec client directories are created during installation of the plugin.</li><li><strong>PLUGIN-1053</strong> Added an inactive IPsec client plugin state to allow seamless migration from zscaler. The inactive state is achieved by excluding <code>ipsec-client</code> from the configuration.</li><li><strong>PLUGIN-1046</strong> Provide IPsec client auto-upgrade capability while crossing the 128T version <code>4.3.0</code> boundary.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-105-205">Release 1.0.5, 2.0.5<a class="hash-link" href="#release-105-205" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-9">Issues Fixed<a class="hash-link" href="#issues-fixed-9" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-994</strong> The <code>ipsec-client &gt; remote-id</code> configuration is not being used correctly when generating the libreswan config.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-104-204">Release 1.0.4, 2.0.4<a class="hash-link" href="#release-104-204" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-10">Issues Fixed<a class="hash-link" href="#issues-fixed-10" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-384</strong> Added an MTU configuration option to the ipsec profile.</li><li><strong>PLUGIN-333</strong> The <code>plugin-network</code> ip prefix setting in the configuration was ignored and would instead use the default ip prefix setting.</li><li><strong>PLUGIN-336</strong> Using the <code>vector-name</code> configuration option would generate invalid configuration.</li><li><strong>PLUGIN-400</strong> Added a local subnet configuration option and enhanced the remote subnet configuration option to allow a list of values.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="release-101-201">Release 1.0.1, 2.0.1<a class="hash-link" href="#release-101-201" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="issues-fixed-11">Issues Fixed<a class="hash-link" href="#issues-fixed-11" title="Direct link to heading">​</a></h4><ul><li><strong>PLUGIN-47</strong> Created generic IPsec client plugin to provide connectivity to remote ipsec endpoints. This version supports a single client with up to two remote endpoints.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-18T20:19:59.000Z">8/18/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/plugin_icmp_reachability_detection"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ICMP Reachability Detection</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/plugin_loopback_static_routes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Loopback Static Routes</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#profiles" class="table-of-contents__link toc-highlight">Profiles</a></li><li><a href="#clients" class="table-of-contents__link toc-highlight">Clients</a></li><li><a href="#tunnel-monitoring" class="table-of-contents__link toc-highlight">Tunnel Monitoring</a></li><li><a href="#configuring-services-for-tunnel-traffic" class="table-of-contents__link toc-highlight">Configuring services for tunnel traffic</a></li><li><a href="#directing-traffic-through-the-tunnel" class="table-of-contents__link toc-highlight">Directing traffic through the tunnel</a></li></ul></li><li><a href="#thirdparty-software--licenses" class="table-of-contents__link toc-highlight">Thirdparty Software &amp; Licenses</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#data-model" class="table-of-contents__link toc-highlight">Data Model</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#salt" class="table-of-contents__link toc-highlight">Salt</a></li><li><a href="#pcli-enhancements" class="table-of-contents__link toc-highlight">PCLI Enhancements</a></li><li><a href="#commands" class="table-of-contents__link toc-highlight">Commands</a></li><li><a href="#systemd-services" class="table-of-contents__link toc-highlight">Systemd Services</a></li><li><a href="#failover-alarms" class="table-of-contents__link toc-highlight">Failover Alarms</a></li></ul></li><li><a href="#appendix" class="table-of-contents__link toc-highlight">Appendix</a><ul><li><a href="#generated-128t-configuration" class="table-of-contents__link toc-highlight">Generated 128T Configuration</a></li><li><a href="#user-specific-128t-configuration" class="table-of-contents__link toc-highlight">User-Specific 128T Configuration</a></li><li><a href="#complete-example-configuration" class="table-of-contents__link toc-highlight">Complete Example Configuration</a></li></ul></li><li><a href="#release-notes" class="table-of-contents__link toc-highlight">Release Notes</a><ul><li><a href="#release-340" class="table-of-contents__link toc-highlight">Release 3.4.0</a></li><li><a href="#release-331" class="table-of-contents__link toc-highlight">Release 3.3.1</a></li><li><a href="#release-330" class="table-of-contents__link toc-highlight">Release 3.3.0</a></li><li><a href="#release-320" class="table-of-contents__link toc-highlight">Release 3.2.0</a></li><li><a href="#release-313" class="table-of-contents__link toc-highlight">Release 3.1.3</a></li><li><a href="#release-220-310" class="table-of-contents__link toc-highlight">Release 2.2.0, 3.1.0</a></li><li><a href="#release-107-207-210-302" class="table-of-contents__link toc-highlight">Release 1.0.7, 2.0.7, 2.1.0, 3.0.2</a></li><li><a href="#release-301" class="table-of-contents__link toc-highlight">Release 3.0.1</a></li><li><a href="#release-300" class="table-of-contents__link toc-highlight">Release 3.0.0</a></li><li><a href="#release-106-206" class="table-of-contents__link toc-highlight">Release 1.0.6, 2.0.6</a></li><li><a href="#release-105-205" class="table-of-contents__link toc-highlight">Release 1.0.5, 2.0.5</a></li><li><a href="#release-104-204" class="table-of-contents__link toc-highlight">Release 1.0.4, 2.0.4</a></li><li><a href="#release-101-201" class="table-of-contents__link toc-highlight">Release 1.0.1, 2.0.1</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.986d1a64.js"></script>
<script src="/assets/js/main.8fa91905.js"></script>
</body>
</html>