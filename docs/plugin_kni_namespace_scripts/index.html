<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-167298415-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="128T Docs" href="/opensearch.xml"><title data-react-helmet="true">Kernel Network Namespace Scripts | 128T Docs</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Kernel Network Namespace Scripts | 128T Docs"><meta data-react-helmet="true" name="description" content="As part of plugin development to extend the functionality of a 128T router, a very common model is to leverage KNI (Kernel Network Interface) along with Linux network namespaces. They allow for isolation of various networking components such as interfaces, routing table, iptables, etc., while running applications that leverage these networking namespaces. This is also very common method to deploy Service Function Chaining within the product."><meta data-react-helmet="true" property="og:description" content="As part of plugin development to extend the functionality of a 128T router, a very common model is to leverage KNI (Kernel Network Interface) along with Linux network namespaces. They allow for isolation of various networking components such as interfaces, routing table, iptables, etc., while running applications that leverage these networking namespaces. This is also very common method to deploy Service Function Chaining within the product."><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/plugin_kni_namespace_scripts"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/plugin_kni_namespace_scripts"><link rel="stylesheet" href="/styles.b64930b1.css">
<link rel="preload" href="/styles.9f458129.js" as="script">
<link rel="preload" href="/runtime~main.2cc20638.js" as="script">
<link rel="preload" href="/main.471b09cf.js" as="script">
<link rel="preload" href="/1.aca2b5e5.js" as="script">
<link rel="preload" href="/2.a07c9306.js" as="script">
<link rel="preload" href="/146.4d2db8b1.js" as="script">
<link rel="preload" href="/149.7a6b9f64.js" as="script">
<link rel="preload" href="/935f2afb.255165e4.js" as="script">
<link rel="preload" href="/17896441.51de29c3.js" as="script">
<link rel="preload" href="/e7f5cf85.1237a893.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Juniper Logo"><strong class="navbar__title">Session Smart</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Interchange</a><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Juniper Logo"><strong class="navbar__title">Session Smart</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Docs</a></li><li class="menu__list-item"><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="menu__link">Interchange</a></li><li class="menu__list-item"><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="menu__link">Company</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Kernel Network Namespace Scripts</h1></header><div class="markdown"><p>As part of plugin development to extend the functionality of a 128T router, a very common model is to leverage <a href="/docs/concepts_kni">KNI (Kernel Network Interface)</a> along with Linux network namespaces. They allow for isolation of various networking components such as interfaces, routing table, iptables, etc., while running applications that leverage these networking namespaces. This is also very common method to deploy <a href="/docs/plugin_intro#service-function-chaining">Service Function Chaining</a> within the product.</p><p>The goal of this package is to provide a set of scripts which do most of the tasks when it comes to setting up the namespaces and associated environment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scripts"></a>Scripts<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scripts" title="Direct link to heading">#</a></h2><p>The following scripts are part of the package and have a well-defined role as described <a href="/docs/concepts_kni#script-types">here</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="startup"></a>startup<a aria-hidden="true" tabindex="-1" class="hash-link" href="#startup" title="Direct link to heading">#</a></h3><p>This script is invoked at the beginning of the KNI creation and is intended to do clean-up. In the current implementation this script will stop the configured <a href="#application-definition">application</a> (if any).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="init"></a>init<a aria-hidden="true" tabindex="-1" class="hash-link" href="#init" title="Direct link to heading">#</a></h3><p>The <a href="/docs/concepts_kni#init">init script</a> is responsible for the majority of the setup. The script performs the following high-level function:</p><ul><li>Create the configured network-namespace in Linux as per 128T requirements.</li><li>Move and setup any configured target-interface into the namespace</li><li>Tune common parameters within the namespace such as ip-forwarding, arp-proxy, etc.</li><li>Start any configured application(s) within the namespace</li><li>Setup routes and iptable rules</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reinit"></a>reinit<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reinit" title="Direct link to heading">#</a></h3><p>The <a href="/docs/concepts_kni#reinit">reinit</a> script is called when the interface is deemed to be down for more than 10 seconds. For the sake of this implementation we simply symlink the <code>reinit</code> to <code>init</code> script</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="shutdown"></a>shutdown<a aria-hidden="true" tabindex="-1" class="hash-link" href="#shutdown" title="Direct link to heading">#</a></h3><p>The <a href="/docs/concepts_kni#shutdown">shutdown</a> script is called during 128T shutdown or deletion of the interface. This script will stop the configured <a href="#application-definition">application</a> (if any) and delete the network namespace</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="installation"></a>Installation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#installation" title="Direct link to heading">#</a></h3><p>The <code>t128-kni-namespace-scripts</code> package contains all the scripts mentioned <a href="#scripts">above</a>. Upon installation, the scripts in this package are placed under <code>/etc/128technology/plugins/network-scripts/default/kni_namespace/</code> with the right set of permissions and settings required for operation by 128T router.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="symlink-to-kni-scripts"></a>Symlink To KNI scripts<a aria-hidden="true" tabindex="-1" class="hash-link" href="#symlink-to-kni-scripts" title="Direct link to heading">#</a></h3><p>The package only contains a subset of the scripts provided by the <a href="/docs/concepts_kni#script-types">network-script design</a>. There are other scripts such as state, info, monitoring, etc., which are not covered in this package. As a result, the best practice is to symlink the host KNI scripts to the pre-packaged scripts listed <a href="#scripts">above</a>.</p><p>For example, for a configuration with a <code>host</code> kni called <code>test-sfc</code> the scripts above would be used as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-console codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ll /etc/128technology/plugins/network-scripts/host/test-sfc/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">lrwxrwxrwx 1 root root 69 Jan 21 04:09 init -&gt; /etc/128technology/plugins/network-scripts/default/kni_namespace/init</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">lrwxrwxrwx 1 root root 71 Jan 21 04:09 reinit -&gt; /etc/128technology/plugins/network-scripts/default/kni_namespace/reinit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">lrwxrwxrwx 1 root root 73 Jan 21 04:09 shutdown -&gt; /etc/128technology/plugins/network-scripts/default/kni_namespace/shutdown</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">lrwxrwxrwx 1 root root 72 Jan 21 04:09 startup -&gt; /etc/128technology/plugins/network-scripts/default/kni_namespace/startup</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration"></a>Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><p>A YAML based configuration is used to control various aspects of the KNIs and namespaces that are driven through this scripts. The configuration file is optional and the scripts will still perform the basic tasks as described <a href="#scripts">above</a>. The scripts looks for a file called <code>&lt;kni-name&gt;.conf</code> under <code>/var/lib/128technology/kni/host/</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">target-interface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;eth0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ip-address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;10.10.20.10&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">prefix-length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">gateway</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;10.10.20.11&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">default-route</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">True</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">application</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">startup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ifup test-tun0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ifdown test-tun0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">routing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default dev test-tun0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">route-tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">default</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">routes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default dev test-tun0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">gre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">table-id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">ingress-interface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> t0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">routes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default dev kni345&quot;</span></div></div></div></div></div><p>The above example shows all the possible configuration. All of these configuration are optional and reasonable defaults are assumed. Each of the sections below discuss the options in more details.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="variable-substitution"></a>Variable Substitution<a aria-hidden="true" tabindex="-1" class="hash-link" href="#variable-substitution" title="Direct link to heading">#</a></h3><p>The configuration supports basic variable substitutions which directly map to the <a href="/docs/concepts_kni#script-command-line-arguments">arguments passed to the network-scripts</a> by 128T router. The following keywords can be used in the config and will be substituted with the correct arguments at runtime.</p><p>Consider the following configuration</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-config codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">device-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    network-namespace test-ns</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    network-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name test-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        global-id  5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ip-address 169.254.140.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            prefix-length 30</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            gateway 169.254.140.2</span></div></div></div></div></div><table><thead><tr><th>Variable</th><th>Meaning</th><th>Config Example</th></tr></thead><tbody><tr><td><code>{kni_interface}</code></td><td>Name of the KNI interface</td><td><code>test</code></td></tr><tr><td><code>{namespace}</code></td><td>Name of the namespace the KNI belongs to (including the namespace-id)</td><td><code>testns:1073741829</code></td></tr><tr><td><code>{kni_ip}</code></td><td>Configured IP address for the KNI interface (corresponds to <code>address &gt; gateway</code></td><td><code>169.254.140.2</code></td></tr><tr><td><code>{kni_prefix_length}</code></td><td>Configured prefix-length for the KNI interface (corresponds to <code>address &gt; prefix-length</code></td><td>30</td></tr><tr><td><code>{kni_gateway}</code></td><td>Configured gateway address for the KNI interface (corresponds to <code>address &gt; ip-address</code></td><td><code>169.254.140.1</code></td></tr></tbody></table><p>The following YAML configurations</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">routing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default dev {kni_interface} via {kni_gateway}&quot;</span></div></div></div></div></div><p>will therefore be converted to the following at runtime:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">routing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default dev test via 169.254.140.1&quot;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="target-definition"></a>Target Definition<a aria-hidden="true" tabindex="-1" class="hash-link" href="#target-definition" title="Direct link to heading">#</a></h3><p>This configuration allows for another interface to be configured as part of the namespace. This is usually an interface in Linux which is used for forwarding the traffic through to an endpoint. Only a <code>single</code> target interface can be configured and it&#x27;s optional. The following snippet shows an example of setting parameters for the <code>target-interface</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">target-interface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;eth0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ip-address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;10.10.20.10&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">prefix-length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">gateway</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;10.10.20.11&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">default-route</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">True</span></div></div></div></div></div><p>The <code>default-route</code> flag is used to set the target-interface as a <code>default</code> route with zero metric in the namespace making it the preferred choice for routing all traffic.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="application-definition"></a>Application Definition<a aria-hidden="true" tabindex="-1" class="hash-link" href="#application-definition" title="Direct link to heading">#</a></h3><p>Any <a href="/docs/plugin_intro#service-function-chaining">SFC application</a> will require some applications to run within the namespace to consume the KNI and other network resources. This configuration provides a list of commands to be run within the namespace.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The scripts will automatically append <code>ip netns exec</code> for every configured command.</p></div></div><p>This configuration is optional. Consider this example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">application:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    startup:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;ifup test-tun0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    shutdown:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;ifdown test-tun0&quot;</span></div></div></div></div></div><p>In this case, the user can configure the logic to start and stop applications as needed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="routing-definition"></a>Routing Definition<a aria-hidden="true" tabindex="-1" class="hash-link" href="#routing-definition" title="Direct link to heading">#</a></h3><p>It&#x27;s useful to be able to influence the basic routing rules within the namespace. The <code>routing</code> config in its simplest form can be used to add routes to the default routing table. For most applications this is sufficient and acts as a way to create quick configuration of routes. For example</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">routing:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;192.168.0.0/16 via 169.254.140.1 dev test&quot;</span></div></div></div></div></div><p>The above example, will create a single route table entry for the prefix <code>192.168.0.0/16</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If a target interface is configured as default-route and no routing rules are specified, a default route for the target will be added.</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The <code>routing definition</code> section will override any other routes specified elsewhere in the config</p></div></div><p>For a more advanced use case, such as tunneling or NAT, a single routing table is not enough. For such applications, a <code>route-tables</code> definition can be used. The <code>route-tables</code> allow the user to do the following:</p><ul><li>Create a new routing table in the namespace</li><li>Specify the conditions under which to use this routing table</li><li>Create rules to be used for this new table.</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">route-tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">default</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">routes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default dev test-tun0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">gre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">table-id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">ingress-interface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> t0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">routes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default dev kni345&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>The <code>default</code> keyword is used to create route entries for the default route table in Linux. In the above example, the second entry for <code>gre</code> table will create a new table with the identifier <code>1024</code>. For each route-table, the user can configure the conditions and parameters for which the table can be used. These parameters translate to the options for the <code>ip rules add</code> command. The currently supported parameters include</p><ul><li>ingress-interface (iif)</li><li>egress-interface (off)</li><li>from-prefix (from)</li><li>to-prefix (to)</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The rules defined under <code>routing</code> will be applied before any <code>route-tables</code>. Since the <code>route-tables</code> supersede the functionality of <code>routing</code> it is not recommended to use both in the same config.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="usage"></a>Usage<a aria-hidden="true" tabindex="-1" class="hash-link" href="#usage" title="Direct link to heading">#</a></h2><p>In order to leverage these scripts, the user has to do at most two things:</p><ul><li><a href="#symlink-to-kni-scripts">Symlink to the kni scripts</a></li><li><a href="#configuration">Configure various aspects of the pre-packaged scripts</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-03-02T17:49:15.000Z" class="docLastUpdatedAt_217_">3/2/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#scripts" class="table-of-contents__link">Scripts</a><ul><li><a href="#startup" class="table-of-contents__link">startup</a></li><li><a href="#init" class="table-of-contents__link">init</a></li><li><a href="#reinit" class="table-of-contents__link">reinit</a></li><li><a href="#shutdown" class="table-of-contents__link">shutdown</a></li><li><a href="#installation" class="table-of-contents__link">Installation</a></li><li><a href="#symlink-to-kni-scripts" class="table-of-contents__link">Symlink To KNI scripts</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link">Configuration</a><ul><li><a href="#variable-substitution" class="table-of-contents__link">Variable Substitution</a></li><li><a href="#target-definition" class="table-of-contents__link">Target Definition</a></li><li><a href="#application-definition" class="table-of-contents__link">Application Definition</a></li><li><a href="#routing-definition" class="table-of-contents__link">Routing Definition</a></li></ul></li><li><a href="#usage" class="table-of-contents__link">Usage</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright © 2021 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/styles.9f458129.js"></script>
<script src="/runtime~main.2cc20638.js"></script>
<script src="/main.471b09cf.js"></script>
<script src="/1.aca2b5e5.js"></script>
<script src="/2.a07c9306.js"></script>
<script src="/146.4d2db8b1.js"></script>
<script src="/149.7a6b9f64.js"></script>
<script src="/935f2afb.255165e4.js"></script>
<script src="/17896441.51de29c3.js"></script>
<script src="/e7f5cf85.1237a893.js"></script>
</body>
</html>