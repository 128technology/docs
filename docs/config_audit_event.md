---
title: Configuring Audit Events
sidebar_label: Audit Events
---
The Session Smart Router can maintain a history of several different class of events in its *event log* , which can subsequently be used to support compliance audits, forensics on network issues related to configuration (misapplied or otherwise), and traceability. This document covers:
1. Types of events available on the router
2. Enabling the Audit events (using the PCLI or the GUI)
3. Using the Event Viewer in the GUI

## Event Types
The events generated by the router can be classified into the following categories:

### Traffic Events 
Traffic events are generated as sessions as created on the router and it includes details such as the protocol, source address, source port, destination address and destination port. In addition, the success or failure status along with a reason code for failure cases will also be included in the event.

### Administration Events
Various administration actions performed by a user such as SSH login will generate this category of events. The events will contain the details about the user action, whether or not the action was permitted and the reason for any failures.

### System Events
Various system level events such as service and process restarts are generated by this event category. The details will include information about the user and details about the underlying action.

### Alarm Events
All the 128T alarms generate an add event when the alarm is raised and a clear event when the alarm is cleared. The alarm events can be used to view the history of the events associated with the alarms. The alarm events are implicit events and cannot be disabled via configuration. More details on alarms and events can be found [here](events_overview.md) 

### Provisioning Events
The provisioning events are generated for software download and upgrades as well as for configuration changes that are processed on the router. For configuration changes the event will contain a diff of the configuration change that trigger the event. These are implicit events and cannot be disabled via configuration.

## Basic Configuration
The configuration for audit logging is done within the `system > audit` branch within a `router` hierarchy. In most cases, the only configuration that is required for enabling audit logging is to add it to the `router` element for your Authority's conductor. For cases where a 128T router is not managed by a conductor, its audit logging configuration is similarly added to the `system > audit` branch of its `router` hierarchy.

128T version 5.1.0 introduces capabilities to provide additional control over persistence and storage duration of the various events listed above. The table below shows all the various configuration options and the corresponding behavior pre and port 5.1.0 software.

| name | type | available version | default | description |
| ---- | ---- | ------- | ------- | ----------- |
| retention | duration | 5.1.0 | 180 days | How long to persist the events listed above |
| traffic > enabled | boolean | all | false | Enable/disable the generation of traffic events |
| traffic > persist | boolean | 5.1.0 | false | If enabled, whether or not to persist the events to the local storage for the configured retention duration |
| administration > enabled | boolean | all | true | Enable/disable the generation of administration events |
| administration > persist | boolean | 5.1.0 | true | If enabled, whether or not to persist the events to the local storage for the configured retention duration |
| system > enabled | boolean | all | true | Enable/disable the generation of system events |
| system > persist | boolean | 5.1.0 | true | If enabled, whether or not to persist the events to the local storage for the configured retention duration |

## Sample Configuration

:::note
Configuration not related to audit logging has been filtered out for illustrative purposes.
:::

### Enable basic audit logging

```
config
    authority
        router  my-router
            name    my-router
            system
                audit
                    administration
                        enabled  true
                    exit
                exit
            exit
        exit
    exit
exit
```

### Storing events for short durations
By default the 128T routers will store all except traffic events for up to six months on local disk. In some cases it might be desirable to shorten the length of time for these events to minimize the impact on local disk. This can be accomplished as follows

```
config
    authority
        router my-router
            system
                audit
                    retention 1d
                exit
            exit
        exit
    exit
exit
```

In the above example all the events available on the 128T router will only be retained for one day. The `retention` is of type duration and can take values in hours and days for example 24h or 1d.

### Sending traffic events to a syslog server
Traffic events are disabled and not persisted by default because they can produce a large volume of data. However, in situations where the traffic events need to be send off box for storage such as a syslog server, they can be enabled but not persisted to local storage. The following configuration snippet shows an example of how to do that.

```
config
    authority
        router my-router
            system
                audit
                    traffic
                        enabled true
                        persist false
                    exit
                exit
            exit
        exit
    exit
```

:::note
For in-depth explanations of how to configure the Monitoring Agent to handle audit events, refer to the [128T Monitoring Agent](plugin_monitoring_agent.md) documentation.
:::


First step is to use a event collector input to capture the traffic events. An example input configuration is shown below.

```toml
[[inputs.t128_events]]
    # It is a best practice to specify a custom index file location
    index-file = "/var/lib/128t-monitoring/state/events.index"
    topic = "events"
    [inputs.t128_events.tagpass]
        type = ["traffic"]
```

Next step is to define an output for where the events are to be sent. In this example, the events are sent to a syslog server and the sample configuration looks as follows.

```toml
[[outputs.syslog]]
  address = "udp://<ip>:514"
  default_sdid = "128T"
```

The input and output are placed in the input and output directories respectively and tied together by the [Monitoring Agent configuration](plugin_monitoring_agent.md/#configuration). Here's a sample monitoring agent configuration:

```yaml
enabled: true

inputs:
  - name: traffic-events
outputs:
  - name: my-syslog

```

Once those pieces are in place, starting the Monitoring Agent will send events to syslog. 


## Viewing the Audit Log

The only way at present to view the contents of the audit log is via the GUI (on the conductor or router as configured above).

To view the contents of the audit log, navigate to the **Tools** page and choose **Event History**. The Event History viewer shows all of the events that this 128T has accumulated, including audit log events. Audit log events are of type **ADMIN**; you can use the built-in filtering mechanism to limit the Event History search results to ADMIN type events to find events of interest.
