<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Automated Provisioner: Duplicate Asset ID Error | SSN Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/ts_ap_duplicate_assets"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Automated Provisioner: Duplicate Asset ID Error | SSN Docs"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/ts_ap_duplicate_assets"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/ts_ap_duplicate_assets" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/ts_ap_duplicate_assets" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.21b25f22.css">
<link rel="preload" href="/assets/js/runtime~main.2eff5894.js" as="script">
<link rel="preload" href="/assets/js/main.bf52851a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Session Smart Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation">Installation Process</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_aws">Cloud Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_installer">Supporting Information - Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/config_basics">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_basics">Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_ha">High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/sec_adaptive_encrypt">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/how_to_use_app_summary">How To</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/ts_applications">Troubleshooting</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_applications">Application Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/ts_ap_duplicate_assets">AP: Duplicate Asset ID Error</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_ap_salt_minion">AP: Salt Minion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_cpu_spikes">CPU Spikes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_forwarding_resource_pools">Forwarding Plane Resource Pools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_logs">Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_mac_uniqueness">MAC Address Uniqueness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_packet_capture">Packet Capture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_t1_troubleshooting">T1 Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_troubleshooting_vrf">Troubleshooting VRF</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/bcp_att_avpn_configuration">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/release_notes_128t_5.5">Release Notes</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Automated Provisioner: Duplicate Asset ID Error</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>This document describes the process for troubleshooting the duplicate asset ID error with Automated Provisioning (AP).</p><p>Here are a few situations that may cause a duplicate asset ID:</p><ul><li>128T SSR has been cloned from staging and has not completed the initialization procedure, creating a unique ID</li><li>The same quickstart file has been applied to multiple 128T SSRs</li><li>A user has manually entered the same asset ID into the salt-minion ID file on multiple 128T SSRs</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The terms &quot;salt-master&quot; and &quot;conductor&quot; are used interchangeably throughout this document. &quot;Salt-master&quot; refers to the salt-master process running on the conductor, which orchestrates tasks for AP.  Also the terms &quot;minion&quot;, &quot;salt-minion&quot; and &quot;asset&quot; are used interchangeably throughout this document. &quot;Minion&quot; runs on an &quot;asset&quot;, or system hosting a 128T router. Minions are responsible for carrying out tasks on the host, given to it by the salt-master.</p></div></div><p>This document will reference salt keys and salt grains. Some good resources for these topics are:</p><p><a href="https://docs.saltproject.io/en/latest/ref/cli/salt-key.html" target="_blank" rel="noopener noreferrer">Salt-Key Command</a></p><p><a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.grains.html" target="_blank" rel="noopener noreferrer">Salt Grains</a></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The <code>salt-key</code> command referenced above can be accessed from the Linux shell with <code>t128-salt-key</code>. All arguments to the command and behavior are identical.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="symptoms">Symptoms<a class="hash-link" href="#symptoms" title="Direct link to heading">​</a></h2><p>An asset that has a duplicate asset ID error can be seen from the conductor CLI using the <code>show assets</code> command with a provided asset-id. For example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show assets asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tue 2021-04-20 14:21:30 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===============================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===============================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Router:                  my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Node:                    node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Current Version:         4.5.8-1.debug.el7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Status:                  Running</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  First Connection Date:   2021-04-20 00:34:01</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Software Versions Information</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Refresh in Progress:     False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=====================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Duplicate Asset IDs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=====================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.10 seconds</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A duplicate asset ID error can also be seen as an alarm event from the conductor CLI using the <code>show events alarm</code>. For example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show events alarm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tue 2021-04-20 14:24:31 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=========== ======= ============ ============================= ========== ======== ========== =============================================================== ================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Router      Node    Event Type   Time                          Severity   Source   Category   Message                                                         Shelved Status</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=========== ======= ============ ============================= ========== ======== ========== =============================================================== ================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> conductor   node1   add          2021-04-20T14:16:08.039000Z   critical   asset1   asset      A duplicate asset with id &#x27;asset1&#x27;, which is configured as      not-shelved</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                               my-router, has been detected. Ensure all assets have a unique</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                               id and restart salt-minion on asset &#x27;asset1&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Lastly a denied key can be seen by querying the salt-master directly from the Linux command line:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[root@conductor ~]# t128-salt-key -L</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Accepted Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Denied Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Unaccepted Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Rejected Keys:</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The <code>t128-salt</code> and <code>t128-salt-key</code> commands can only be executed by the <code>root</code> user at the Linux shell.</p></div></div><p>There are multiple situations that may cause a duplicate asset ID error.</p><ol><li>A single salt-minion disconnected, had its key regenerated, and reconnected<ul><li>In this case, the asset will show as disconnected and have a duplicate asset ID error</li></ul></li><li>Two salt-minions with the same ID attempted to connect<ul><li>In this case, either the connected asset or the denied minion may be the correct one</li><li>The correct asset may also be disconnected when another minion with the same ID connects, making it difficult to distinguish which situation caused the asset ID error</li></ul></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="root-cause">Root Cause<a class="hash-link" href="#root-cause" title="Direct link to heading">​</a></h2><p>A denied key is a public key that is rejected automatically by the salt-master when the salt-minion tries to authenticate with its public key. A rejected key is a different state that indicates a user manually rejected a salt key. There are two different situations that can result in the salt-master denying a key:</p><ol><li>A salt-minion was rebuilt, reinstalled or the public/private key pair was wiped and new keys were automatically regenerated when the salt-minion service started. Now the minion&#x27;s keys do not match the salt keys previously associated with the minion ID on the conductor.</li><li>There are two salt-minions trying to authenticate with the same salt-minion ID.</li></ol><p>In the denied key state the salt-minion does not receive any communication from the salt-master. The conductor automatically creates a duplicate asset ID error when it detects that the salt-master has moved a salt key into the denied state.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="steps-to-rectify">Steps to Rectify<a class="hash-link" href="#steps-to-rectify" title="Direct link to heading">​</a></h2><p>There are two different procedures for rectifying the two different situations. If the user is unsure which situation they are in, then they should try the procedure for rectifying a salt-minion with new keys first, before moving onto locating multiple minions with the same ID.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="rectifying-a-salt-minion-with-new-keys">Rectifying A Salt-Minion with New Keys<a class="hash-link" href="#rectifying-a-salt-minion-with-new-keys" title="Direct link to heading">​</a></h3><p>The user needs to drop to the Linux shell and delete the accepted and denied keys with the same asset ID using the <code>t128-salt-key -d &lt;asset-id&gt;</code> command. For example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[root@conductor ~]# t128-salt-key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Accepted Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Denied Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Unaccepted Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Rejected Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[root@conductor ~]# t128-salt-key -d asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The following keys are going to be deleted:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Accepted Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Denied Keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Proceed? [N/y] y</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Key for minion asset1 deleted.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Key for minion asset1 deleted.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[root@conductor ~]#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If the conductor is in HA configuration then the salt keys need to be deleted from <em>both</em> conductors or the asset will be stuck in the <code>key-accepted</code> state.</p></div></div><p>The salt-minion may reach out again automatically and get accepted by the conductor if the asset ID matches an asset ID in the 128T configuration. If the salt-minion does not reach out then it needs to be restarted manually from the Linux command line with <code>systemctl restart salt-minion</code>.</p><p>If the root cause was indeed a salt-minion that regenerated new keys (situation #1 above) and not two different salt-minions with different keys and the same ID (situation #2 above), then this procedure will solve your problem. The asset will reconnect properly and no duplicate ID error will appear. If the duplicate asset ID error and the denied and accepted keys reappear, then the user knows they are dealing with multiple salt-minions with the same minion ID.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="rectifying-multiple-salt-minions-with-the-same-minion-id">Rectifying Multiple Salt-Minions with the Same Minion ID<a class="hash-link" href="#rectifying-multiple-salt-minions-with-the-same-minion-id" title="Direct link to heading">​</a></h3><p>If the user tried the procedure from the previous section and the duplicate ID error and denied keys have reappeared then the user is dealing with multiple salt-minions with the same ID. Unfortunately, the only course of action in this case is to track down the system with the improper ID. After tracking down the system the user simply needs to change the ID located at <code>/etc/salt/minion_id</code> and restart the salt minion with <code>systemctl restart salt-minion</code>. The denied key associated with the old salt-minion ID will be deleted by the conductor automatically after one minute when the old ID stops trying to authenticate.</p><p>Tracking down the asset with the duplicate ID is not always easy. Since the salt-master automatically denies the authentication attempt from this bad actor, the conductor has no insight into the IP address or any other information about this asset. Secondly, the user does not know if the key that is currently denied belongs to the asset with the incorrect ID, or the correct one. Whichever system tries to authenticate first will get accepted and the other system will get denied.</p><p>The user should start by trying to validate the currently connected router to ensure it is the correct one. The user can connect directly to the router&#x27;s PCLI via the conductor&#x27;s PCLI by using the <code>connect</code> command. This command allows the user to login to the router&#x27;s PCLI directly. The user can then run any PCLI command which will help them validate the currently connected router. For example, connecting to the remote router and checking the network interface IP addresses:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# connect router my-router node node1 username admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Connecting...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The authenticity of host &#x27;[127.127.0.1]:16386 ([127.127.0.1]:16386)&#x27; can&#x27;t be established.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RSA key fingerprint is SHA256:NwG6NUitnfSNQyOXSjXkjU3jOen+zjPSL1ZNiU6JfYk.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Are you sure you want to continue connecting (yes/no)? yes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Warning: Permanently added &#x27;[127.127.0.1]:16386&#x27; (RSA) to the list of known hosts.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@127.127.0.1&#x27;s password:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FIPS mode initialized. SSH client running in FIPS 140-2 mode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Starting the PCLI...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.my-router#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.my-router# show network-interface</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wed 2021-04-21 18:14:59 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=========== ====== ======== ======== ============ ====== ============= ========== ========== =============== ============== ========== ============== ============= ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Router      Node   Device   Name     Forwarding   VLAN   Device Type   Type       DHCP       Address         Gateway        Hostname   Admin Status   Oper Status   GIID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">=========== ====== ======== ======== ============ ====== ============= ========== ========== =============== ============== ========== ============== ============= ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> my-router   node1      10   intf10   true            0   ethernet      external   disabled   172.16.1.2/24   172.16.1.201   --         up             up               1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> my-router   node1      11   intf11   true            0   ethernet      external   disabled   172.16.3.2/24   172.16.3.3     --         up             up               2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.16 seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.my-router#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The user can also use the salt command line from the conductor&#x27;s Linux shell to try and retrieve information from the asset who has been accepted to determine if this is the bad actor or the correct asset. For example, running the salt command <code>grains.items</code> will return a large amount of information about the system. Or the command <code>grains.get</code> can return specific pieces of information about the system. This might give the user a clue if the currently connected system has the correct minion ID. In the example below, the hostname grain retrieved was <code>asset10</code>, and if the customer is matching asset IDs to hostnames, then this may be a clue that this system is causing the duplicate ID error because the minion ID should be <code>asset10</code>:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[root@t227-dut1 ~]# t128-salt asset1 grains.get host</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">asset1:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    asset10</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Unfortunately the user can only query information about the system with the key that is accepted. If the user has validated that the currently connected system is the correct system, then they could try the following procedure to locate the bad actor:</p><ol><li>Login to the correct system&#x27;s Linux shell directly and stop the salt-minion with <code>systemctl stop salt-minion</code><ul><li>Only do this if the user can maintain connectivity to this system so they can start the salt-minion again after this situation is resolved</li></ul></li><li>Delete both the accepted and denied salt-keys on the conductor(s) with <code>t128-salt-key</code> as stated above</li><li>Wait for the bad actor to connect successfully via salt</li><li>Use <code>t128-salt &#x27;&lt;asset-id&gt;&#x27; file.write /etc/salt/minion_id &quot;&lt;new-asset-id&gt;&quot;</code> to remotely update the salt-minion ID file then restart the salt-minion remotely with <code>t128-salt &#x27;&lt;asset-id&gt;&#x27; service.restart salt-minion</code></li><li>Delete the accepted salt key from the conductor(s)</li><li>Start the salt-minion on the correct system</li></ol><p>If this procedure does not work then the correct course of action is to deny both duplicate salt keys until the systems have been properly authenticated. Once the correct system is found, regenerate a new minion ID and keys for the authentic minion and keep the bad actor system&#x27;s key denied until it can be claimed.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-04-08T00:03:56.000Z">4/8/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/ts_applications"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Application Troubleshooting</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/ts_ap_salt_minion"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AP: Salt Minion</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#symptoms" class="table-of-contents__link toc-highlight">Symptoms</a></li><li><a href="#root-cause" class="table-of-contents__link toc-highlight">Root Cause</a></li><li><a href="#steps-to-rectify" class="table-of-contents__link toc-highlight">Steps to Rectify</a><ul><li><a href="#rectifying-a-salt-minion-with-new-keys" class="table-of-contents__link toc-highlight">Rectifying A Salt-Minion with New Keys</a></li><li><a href="#rectifying-multiple-salt-minions-with-the-same-minion-id" class="table-of-contents__link toc-highlight">Rectifying Multiple Salt-Minions with the Same Minion ID</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2eff5894.js"></script>
<script src="/assets/js/main.bf52851a.js"></script>
</body>
</html>