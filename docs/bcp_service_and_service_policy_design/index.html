<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Service and Service Policy Design | SSN Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/bcp_service_and_service_policy_design"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Service and Service Policy Design | SSN Docs"><meta data-react-helmet="true" name="description" content="Designing a service-oriented network with the 128T Session Smart router benefits from careful planning and thoughtful policy decisions. With the ability to steer traffic using the best path on a per-session basis, administrators have more control than ever before in deciding how their users maximize the network. This document discusses two fundamental, and related concepts: the service and the service-policy."><meta data-react-helmet="true" property="og:description" content="Designing a service-oriented network with the 128T Session Smart router benefits from careful planning and thoughtful policy decisions. With the ability to steer traffic using the best path on a per-session basis, administrators have more control than ever before in deciding how their users maximize the network. This document discusses two fundamental, and related concepts: the service and the service-policy."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/bcp_service_and_service_policy_design"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/bcp_service_and_service_policy_design" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/bcp_service_and_service_policy_design" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.21b25f22.css">
<link rel="preload" href="/assets/js/runtime~main.62ea3cd1.js" as="script">
<link rel="preload" href="/assets/js/main.310752e1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Session Smart Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation">Installation Process</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_quickstart_aws">Cloud Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_installer">Supporting Install Information - Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/config_basics">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/bcp_att_avpn_configuration">Best Practices</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_att_avpn_configuration">AT&amp;T AVPN Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_using_128T_as_ntp_server">Branch NTP Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_conductor_deployment">Conductor Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_per-adjacency_traffic_engineering">Per Adjacency Traffic Engineering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_qos_msft_expressroute">ExpressRoute QoS Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_lte_peering">LTE Peering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_monitoring_headends">Monitoring Head End Routers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_salt_pillars">Saltstack at Scale With 128T</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_sdwan_design_guide">SD-WAN Design Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/bcp_service_and_service_policy_design">Service and Service Policy Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_service-policy_defaults">Service Policy Baseline Defaults</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bcp_tenants">Tenancy Design</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/release_notes_128t_5.6">Release Notes</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Service and Service Policy Design</h1></header><p>Designing a service-oriented network with the 128T Session Smart router benefits from careful planning and thoughtful policy decisions. With the ability to steer traffic using the best path on a per-session basis, administrators have more control than ever before in deciding how their users maximize the network. This document discusses two fundamental, and related concepts: the <em>service</em> and the <em>service-policy</em>.</p><p>A service is a network destination of interest to your network&#x27;s users. It can represent a web server, a PBX system for your phones, a CRM system in the public cloud, or something specific only to you. The <code>service</code> data model in the 128T modeling language gives administrators great flexibility in defining what constitutes an &quot;interesting&quot; application that requires specific treatment as contrasted to bulk data. The <code>service-policy</code> affiliated with that <code>service</code> lets the administrator specify the treatment for the traffic of that service: where it should go, which path it should use to get there, how it gets treated along the way (marked and queued), and what to do in the event of network failures.</p><p>In this document we will cover the various types of services that are configurable in the 128T data model, and how to apply them. We will then discuss the predominant service-policy options for governing the traffic treatment for traffic steering, and give some rules of thumb for how to apply them.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="intended-audience">Intended Audience<a class="hash-link" href="#intended-audience" title="Direct link to heading">​</a></h2><p>This document is intended for network administrators and network architects responsible for designing 128T configurations for their end users. It provides a conceptual overview for the different options available for configuring <code>service</code> and <code>service-policy</code> data models, and guidance on when to use the various attributes.</p><p>This document is relevant to the day-to-day job of network operations and network support staff, to help them to interpret a configuration to understand its intent.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>In the 128T worldview, each IP destination that will receive traffic must be configured as a <em>service</em>. A service can be defined as broadly as a netmask (it is common for our customers to have a service representing the entire internet, as 0.0.0.0/0) or as specific as a transport protocol and single port. As traffic arrives at a 128T router, it (among other things) is associated with a configured service, which will in turn influence its path selection.</p><p>Path selection on the 128T is a decision process that considers several factors:</p><ul><li>Current network state. Are next hops reachable? Is a remote peer reachable? What are the current quality metrics for the various potential paths?</li><li>Administrative priorities. Which path should this traffic take in the &quot;sunny day scenario,&quot; when all paths are available? How should the 128T assess viability for a path for any given service?</li></ul><p>In the previous section of this document we discuss how 128T determines whether or not a remote peer is reachable (asynchronous BFD) and the quality of the path (echo BFD). These both pertain to the <em>current network state</em>. The <em>administrative priorities</em> of the 128T are described through the use of a <em>service-policy</em>, a configuration element that is associated with a service.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="service-types">Service Types<a class="hash-link" href="#service-types" title="Direct link to heading">​</a></h2><p>The <em>service</em> configuration element is the cornerstone of the 128T data model. It is what allows administrators to describe eligible destinations for traffic, to which they can subsequently define access controls, routing policy, and traffic treatment. There is a strong correlation between successful deployments of the 128T software and a deep understanding of the services on the target network.</p><p>A service&#x27;s configuration is very flexible, and can represent many different aspects of a network&#x27;s topology. The various data modeling variants of a service are described in the sections that follow.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="fully-qualified-services">Fully Qualified Services<a class="hash-link" href="#fully-qualified-services" title="Direct link to heading">​</a></h3><p>The most fundamental, and granular definition of a service is one which defines a specific application on your network. The goal of any 128T-powered configuration should be to configure <em>fully qualified</em> services with as much precision as possible. The key elements of a fully qualified service are:</p><ul><li>A narrow range of IP addresses that all serve the application</li><li>Specific transport protocols and ports that the application uses</li></ul><p>Example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running authority service cloudflare-dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  cloudflare-dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  cloudflare-dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                 private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address               1.1.1.1/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address               1.0.0.1/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         trusted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  trusted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Key to success</h5></div><div class="admonition-content"><p>Define the service as specifically as possible, using transport/port and specific IP addresses as appropriate.</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cidr-services">CIDR Services<a class="hash-link" href="#cidr-services" title="Direct link to heading">​</a></h3><p>Many deployments of the 128T software include a number of <em>CIDR services</em> which – in contrast to fully qualified services – are broad swaths of IP addresses, typically located behind a 128T at a specific location.</p><p>The hallmarks of a CIDR Service are that it seldom has transport protocols defined, and never has ports defined. (Administrators may configure transport protocols without ports to restrict a service to TCP, UDP, and ICMP only, and block other IP protocols such as GRE.)</p><p>Example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config run auth service burlington-guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  burlington-guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           burlington-guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope          private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security       internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        172.18.32.0/20</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  trusted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      trusted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            source-nat     network-interface</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="summary-and-spoke-services">Summary and Spoke Services<a class="hash-link" href="#summary-and-spoke-services" title="Direct link to heading">​</a></h3><p><em>Summary services</em> and <em>spoke services</em> work in conjunction with each another to provide coarse routes from one 128T to another, and specific routes from the receiving 128T router to the destination. It is commonly used in &quot;hub and spoke&quot; topologies, where a less-specific route will direct traffic to a location, and that location&#x27;s router has more specific routes to apply to the traffic.</p><p>For example, in a retail deployment it is common for each branch location to have a specific CIDR block allocated, e.g., 10.20.20.0/24 for &quot;site 2020.&quot; For traffic originating in a data center and destined for the branch, a summary service is configured using the address 10.20.20.0/24. The branch router has more specific spoke services for the individual applications at the branch; e.g., 10.20.20.128/32, 10.20.20.60/32 UDP/5060, etc.</p><p>Conceptually, summary services and spoke services are very similar to CIDR services and application-based services, respectively. However, there is one significant difference between a summary service and a CIDR service: the summary service <em>must include a transport section</em>. This is the &quot;trigger&quot; for the receiving 128T router to apply a more-specific spoke service.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>A second, common attribute of summary services is the inclusion of an <code>applies-to</code> block in the configuration. The purpose of this block is described in more detail in the <em>Router/Router Group-based Services</em> section below. Because summary and spoke services are generally at their most useful in massive deployments to reduce overall configuration overhead, this is a strong case for using Router/Router Group-based services whenever summary services are considered.</p></div></div><p>Example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service            site2020_summary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  site2020_summary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to            router-group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type        router-group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                group-name  datacenters</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                group-name  retail-site2020</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security              internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             icmp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  icmp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address               10.20.20.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         datacenter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  datacenter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy        core2store-retail</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="generated-services">Generated Services<a class="hash-link" href="#generated-services" title="Direct link to heading">​</a></h3><p>Various features within the 128T will cause services to be generated automatically when configured. This includes:</p><ul><li>Conductor Host Services</li><li>BGP over SVR</li><li>DHCP Relay</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The services generated by the 128T are created as fully qualified services.</p></div></div><p>Each of these service types shares one important attribute: they are created with the <code>generated</code> flag set to <code>true</code>. If you want to make any modifications to the generated services, you must first set <code>generated</code> to <code>false</code>, or else your configuration changes will be stripped upon the next time the configuration is committed. For more information on configuration workflows involving the <code>generated</code> flag, refer to the <a href="/docs/config_basics#generated-configuration">128T software documentation</a>.</p><p>Example (BGP over SVR):</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service            _bgp_dc1_loopback1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                     _bgp_dc1_loopback1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            description              &quot;Auto generated BGP Service for dc1 at 172.20.0.1&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            enabled                  true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                    private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security                 internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            tap-multiplexing         false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport                tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  179</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  179</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    179</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address                  172.20.0.1/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy-generated  false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy            _bgp_speaker_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _bgp_speaker_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy           MPLS-DIA-LTE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes     false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            source-nat               network-interface</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type         generic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            generated                true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="routerrouter-group-based-services">Router/Router Group-Based Services<a class="hash-link" href="#routerrouter-group-based-services" title="Direct link to heading">​</a></h3><p>Router- and router group-based services are not services unto themselves; rather, the term refers to the capability of limiting the scope of services to specific routers or sets of routers. By default, any service configured on a 128T conductor is pushed down to all routers it manages. This may result in unnecessary bloat on routers that will never have a calling for a specific service. E.g., in a typical retail deployment traffic generally goes in one of two directions: originating at a store and heading to a data center, or originating at a data center and heading to a store. Thus it is important for head end routers to have access to store services, and for a store to have the configuration corresponding to its own local services, but there will be no need for every store to have every other store&#x27;s local services in a full mesh.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In case a full mesh is a requirement, 128 Technology has the Summary and Spoke Services – which use router-based services to optimize the configuration.</p></div></div><p>Use the <code>applies-to</code> configuration within a <code>service</code> to restrict its scope:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running authority service lo_burlington</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  lo_burlington</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           lo_burlington</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to     router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  burlington</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  newton</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            description    &quot;burlington loopback&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope          private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security       interfabric</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address        172.31.0.2/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  trusted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  trusted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source  _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this example, the service will only be delivered to two routers: <code>burlington</code> and <code>newton</code>. When using the <code>applies-to router-group</code> configuration, the group name is configured within each router.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  core2store-default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name            core2store-default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to      router-group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type        router-group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                group-name  DC-routers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                group-name  retail-routers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            enabled         true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope           private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security        internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport       tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport       udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address         10.0.0.0/8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy   datacenter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      datacenter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy  DIA-MPLS-LTE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here&#x27;s a common sight in large retail deployments: a <code>core2store</code> service for traffic originating in the data center and destined for a retail store. It is applied to two router groups: <code>DC-routers</code> and <code>retail-routers</code>. By applying a <code>group</code> tag on a managed router that matches either (or both) of these two group names, it will receive a copy of this configuration from the conductor.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="application-module-services">Application-Module Services<a class="hash-link" href="#application-module-services" title="Direct link to heading">​</a></h3><p>Application-module services are dynamic and have two parts: a <code>service</code> configuration that references an <code>application-name</code>, and a script resident on the 128T&#x27;s host operating system with that <code>application-name</code> that generates forwarding rules (FIB entries, in the form of JSON configuration) that are installed onto the 128T. Application-module services give the ultimate flexibility to the 128T administrator: the ability to  define the forwarding logic of the 128T using the programming language of their choice.</p><p>To enable an application-module service, a router must have <code>application-identification</code> with <code>mode</code> set to <code>module</code>, as is shown here:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running auth router burlington application-identification</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  burlington</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                        burlington</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            application-identification</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                mode  module</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A service that references a module name is configured like this:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running auth service custom-service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  custom-service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  custom-service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            description           &quot;Custom service definition using Application Module&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                 private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            application-name      customsvc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Lastly, a file within <code>/etc/128technology/application-modules/</code> to be executed by the 128T software:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[pt@labsystem4 application-modules]$ cd /etc/128technology/application-modules/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[pt@labsystem4 application-modules]$ ls -ltr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">total 12</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lrwxrwxrwx  1 root root   21 Sep  1  2018 office365.py -&gt; defaults/office365.py</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x  2 root root 4096 Jan 29 16:46 app_module_utils</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x. 2 root root 4096 Jan 29 16:48 defaults</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rwxr-xr-x  1 root root 1372 Feb 26 06:35 customsvc.py</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here we can see the python script <code>customsvc.py</code> file, which matches the <code>application-name</code> configured in the <code>service</code> definition above. This is what creates the linkage between the service and the script.</p><p>For more information on creating your own custom <code>application-module</code>, review the documentation and browse the articles on Interchange.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="hierarchical-services">Hierarchical Services<a class="hash-link" href="#hierarchical-services" title="Direct link to heading">​</a></h3><p>Introduced in the 5.0 release, <em>hierarchical services</em> allow you to create groupings of services that, like <a href="/docs/config_tenants#subtenant-hierarchies">hierarchical tenants</a>, inherit properties from one another.</p><p>From a configuration standpoint, hierarchical services follow the same convention that other, hierarchically organized data model elements do within the 128T software: by using a <code>.</code> separator. They also follow the same principle of inheritance: &quot;children&quot; inherit the properties of the &quot;parent.&quot;</p><p>By way of example, consider the following configuration fragment:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running authority service internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            description           &quot;public internet&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                 private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            security              internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address               0.0.0.0/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         trusted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      trusted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy        data-best-effort</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This represents a standard, run of the mill &quot;default route&quot; service for basic internet traffic. Most deployments of the 128T software have something similar to this configured, along with the requisite <code>service-route</code> configuration to accompany them. Now consider this:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show conf running authority service ZOOM.internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  ZOOM.internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  ZOOM.internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            description           &quot;Zoom video conferencing&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            application-name      ZOOM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      guest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  deny</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy        voip-video</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here is an example of a <em>hierarchical service</em>, designed to carry Zoom video conferencing traffic. There are several notable elements to discuss.</p><ol><li>The name contains a reference to a parent service. In our case, the parent is <code>internet</code>. Thus it will <strong>inherit</strong> its properties, unless they are overridden. For instance, if we do not configure a specific <code>service-route</code> for <code>ZOOM.internet</code>, it will follow the same routes that <code>internet</code> does. (This is a common use case, since there are typically only a handful of egress interfaces and/or peers to send traffic to.)</li><li>The <code>access-policy</code> has been modified, and this one is blocks access by the <code>guest</code> tenant. Note that when configuring <code>access-policy</code> in a child tenant, it will always inherit the <code>access-policy</code> statements from the parent.</li><li>The <code>service-policy</code> has been overridden. The parent tenant treats all traffic as <code>data-best-effort</code>, but Zoom traffic will get much better treatment.</li></ol><p>Hierarchical services are an excellent way to organize services to avoid a bloated configuration due to highly duplicated patterns of data. (E.g., all internet-based services will generally follow the same local breakout paths; by organizing them into a hierarchy you need to configure far fewer <code>service-route</code> elements.)</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="inherited-attributes-of-hierarchical-services">Inherited Attributes of Hierarchical Services<a class="hash-link" href="#inherited-attributes-of-hierarchical-services" title="Direct link to heading">​</a></h4><p>The following table lists the inheritable traits passed from a parent to child.</p><table><thead><tr><th>Attribute</th><th>Notes</th></tr></thead><tbody><tr><td>access-policy</td><td>Inherited. Can be augmented, but not overridden.</td></tr><tr><td>multicast-sender-policy</td><td>Inherited. Can be augmented, but not overridden.</td></tr><tr><td>security</td><td>Inherited. Can be overridden.</td></tr><tr><td>service-group</td><td>Inherited. Can be overridden.</td></tr><tr><td>service-policy</td><td>Inherited. Can be overridden.</td></tr><tr><td>transport</td><td>Inherted. Can be overriden.</td></tr><tr><td>applies-to</td><td>Inherited. Can be overridden. Note that a configuration is considered invalid if an orphan child exists on a router without its parent.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_y2LR" id="template-services">Template Services<a class="hash-link" href="#template-services" title="Direct link to heading">​</a></h3><p>Introduced in 5.0 along with hierarchical services, <em>template services</em> represent a service that exists solely to contain inheritable elements by its children. Notably, it has no <code>address</code> of its own – merely inheritable attributes. They exist to reduce configuration bloat due to repetition.</p><p>Template services are characterized by an <code>application-type</code> set to <code>template</code>.</p><p>Consider the following configuration fragment:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service           core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name             core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description      “Template service for core traffic”</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    application-type template</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope            private</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    security         internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    service-policy   data-best-effort</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    applies-to       headend</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    applies-to       branch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy     lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        source         lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        permission     allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy     wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        source         wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        permission     allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service           branch-to-he.core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name           branch-to-he.core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description    “Forward business traffic to headend”</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address        128.66.0.0/16</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    applies-to     branch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service           voice.core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name             voice.core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description      “Voice traffic”</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address          128.66.1.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    service-policy   voip-audio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    applies-to       headend</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service           mgmt.core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     name            mgmt.core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     description     “Management traffic”</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     address         128.66.2.0/24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     applies-to      headend</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this example, the <code>core</code> service exists to define the default <code>scope</code>, <code>security</code>, <code>service-policy</code>, and <code>access-policy</code>. The <code>branch-to-he.core</code> service exists only on branch routers and acts as a summary service, pushing all relevant traffic to the headend. The child service <code>voice.core</code> provides the appropriate address definitions for voice, as well as overriding the default <code>service-policy</code>. The <code>mgmt.core</code> child service provides the appropriate address definitions, but does not override the default service characteristics from <code>core</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="service-policy">Service Policy<a class="hash-link" href="#service-policy" title="Direct link to heading">​</a></h2><p>Each service can have a <code>service-policy</code> associated with it, to govern its behavior through various configurable attributes. This can influence the service&#x27;s path selection and behavior in the event of path failures or path impairments as <em>administrative priorities</em>.</p><p>Here&#x27;s a representative <code>service-policy</code>, to provide context for discussion:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service-policy  MPLS-DIA-LTE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name                 MPLS-DIA-LTE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vector               mpls</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name      mpls</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        priority  5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vector               broadband</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name      broadband</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        priority  10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vector               lte</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name      lte</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        priority  15</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    session-resiliency   revertible-failover</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    path-quality-filter  true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    max-loss             1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    max-latency          300</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    max-jitter           100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>There are three principal controls within this service-policy:</p><ul><li>Vectors, which are used to indicate the administrative preference for path selection.</li><li>A session-resiliency choice, used to indicate the desired behavior in the event of path failures.</li><li>Path quality metrics, used to indicate the tolerance for loss, latency, and jitter on a path before it is declared ineligible for selection.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="vectors">Vectors<a class="hash-link" href="#vectors" title="Direct link to heading">​</a></h3><p>By configuring vectors and assigning <code>priority</code> to them, an administrator can influence the path selection for egress traffic by a 128T device. Each vector has two components: a <code>name</code> and a <code>priority</code>. The <code>name</code> listed is also applied to an adjacency (though typically configured within a <code>neighborhood</code> and triggering the generation of a peer adjacency) to associate to the preferred egress path.</p><p>By way of example, here is an adjacency on the broadband interface of an example branch location:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  site2020</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name  site2020</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            node  node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name       wan1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        adjacency  203.0.113.2 dc1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address             203.0.113.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            peer                   dc1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            peer-connectivity      bidirectional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            generated              true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            inter-router-security  interrouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            cost                   0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            qp-value               0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            vector                 broadband</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the configuration fragment, you can see that the broadband interface (named <code>wan1</code>) has an adjacency configured to connect to its data center (named <code>dc1</code>). This adjacency uses the vector <code>broadband</code>.</p><p>Consider the <code>MPLS-DIA-LTE</code> service-policy shown above, which lists five vectors. For services leveraging this service-policy, the adjacency with the <code>broadband</code> vector would be the second priority, behind adjacencies referencing <code>mpls</code> – since that has a lower cost (higher priority).</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="session-resiliency">Session Resiliency<a class="hash-link" href="#session-resiliency" title="Direct link to heading">​</a></h3><p>As shown in the <code>MPLS-DIA-LTE</code> service-policy, the session-resiliency is set to <code>revertible-failover</code>. This policy comes into play when traffic needs to move in the event of a failure to a transport circuit (either a path failure or a path quality threshold has been crossed). After a failure to a circuit, traffic using that path will migrate to the next best circuit. When that circuit&#x27;s quality is restored (the path returns to the <code>up</code> state, or the quality thresholds return to satisfactory values), <code>revertible-failover</code> <em>will migrate the traffic back to the preferred circuit</em>. Contrast this to the session-resiliency setting of <code>failover</code>, which will persist the traffic on the migrated circuit and not return it to the preferred circuit.</p><p>In general, 128 Technology recommends using the <code>revertible-failover</code> setting for long-lived session types, such as SIP registrations. By contrast, 128 Technology recommends using the <code>failover</code> setting for transient sessions (such as the audio associated with a telephone call).</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The vast majority of network sessions are transient, short-lived sessions, but you can validate this during your application discovery exercises.</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="path-quality-metrics">Path Quality Metrics<a class="hash-link" href="#path-quality-metrics" title="Direct link to heading">​</a></h3><p>The 128T supports four path quality metrics in its service-policy, all of which establish thresholds for determining a path&#x27;s eligibility for carrying traffic that references that service-policy. The metrics are:</p><ul><li><code>max-loss</code>, which will indicate the maximum percentage of packet loss before a path is ineligible</li><li><code>max-latency</code>, which indicates the maximum latency (half of the round trip time) before a path is unsuitable</li><li><code>max-jitter</code>, which indicates the maximum jitter before a path is unsuitable</li><li><code>min-mos</code> (not part of the example configuration), which indicates the minimum Mean Opinion Score before a path is considered unsuitable</li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The MOS value for a given path is a composite metric, computed based on loss, latency and jitter as its factors.</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="transport-state-enforcement">Transport State Enforcement<a class="hash-link" href="#transport-state-enforcement" title="Direct link to heading">​</a></h3><p>Within the service-policy configuration is the <a href="/docs/config_reference_guide#service-policy">transport-state-enforcement</a> parameter, which governs the behavior of the 128T&#x27;s TCP state machine for processing inbound TCP packets. As a stateful networking device, the 128T&#x27;s default behavior is to reject any mid-flow TCP packets (i.e., packets without the SYN flag set) unless it – or its paired node in a dual node HA router – participated in the TCP three-way handshake for that session. There are deployments where this behavior may be undesirable. </p><p>For example, when an environment includes systems that are deployed in a <a href="/docs/config_dual_router_ha"><em>dual router HA</em></a> configuration, any services used to send traffic to or from the dual router HA must reference a service-policy that has <code>transport-state-enforcement</code> set to <code>allow</code>.</p><p>This is because the dual router HA deployment model specifically does not share information between the 128T instances comprising the HA pair; thus, a router may receive mid-flow TCP packets if its counterpart fails (or if routing converges to the other node for any reason, etc.). Without access to any shared state about the in-progress TCP session, if <code>transport-state-enforcement</code> is left to its default value, this TCP session would get rejected by the router.</p><p>It is also reasonable to consider <code>transport-state-enforcement</code> for 128T instances deployed as transit routers. That is, when a router – even one deployed as a dual node HA pair – could receive traffic in the event of a failure somewhere else in the network. Consider a case where a branch office has two possible data centers it could leverage when sending traffic; if the primary data center becomes unreachable, then traffic may flow to the alternate data center, including packets associated with existing TCP sessions. Generally, for catastrophic failures such as disaster recovery sites, it is not unreasonable to expect that the network will &quot;hang up&quot; on existing TCP sessions to instigate a reconnection attempt by the client. (In fact, it often turns out to be <em>beneficial</em> to have the client(s) reconnect, to ensure consistency with application delivery, DPI, etc. at the new data center.)</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-07-06T13:05:52.000Z">7/6/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/bcp_sdwan_design_guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SD-WAN Design Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/bcp_service-policy_defaults"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Service Policy Baseline Defaults</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intended-audience" class="table-of-contents__link toc-highlight">Intended Audience</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#service-types" class="table-of-contents__link toc-highlight">Service Types</a><ul><li><a href="#fully-qualified-services" class="table-of-contents__link toc-highlight">Fully Qualified Services</a></li><li><a href="#cidr-services" class="table-of-contents__link toc-highlight">CIDR Services</a></li><li><a href="#summary-and-spoke-services" class="table-of-contents__link toc-highlight">Summary and Spoke Services</a></li><li><a href="#generated-services" class="table-of-contents__link toc-highlight">Generated Services</a></li><li><a href="#routerrouter-group-based-services" class="table-of-contents__link toc-highlight">Router/Router Group-Based Services</a></li><li><a href="#application-module-services" class="table-of-contents__link toc-highlight">Application-Module Services</a></li><li><a href="#hierarchical-services" class="table-of-contents__link toc-highlight">Hierarchical Services</a></li><li><a href="#template-services" class="table-of-contents__link toc-highlight">Template Services</a></li></ul></li><li><a href="#service-policy" class="table-of-contents__link toc-highlight">Service Policy</a><ul><li><a href="#vectors" class="table-of-contents__link toc-highlight">Vectors</a></li><li><a href="#session-resiliency" class="table-of-contents__link toc-highlight">Session Resiliency</a></li><li><a href="#path-quality-metrics" class="table-of-contents__link toc-highlight">Path Quality Metrics</a></li><li><a href="#transport-state-enforcement" class="table-of-contents__link toc-highlight">Transport State Enforcement</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.62ea3cd1.js"></script>
<script src="/assets/js/main.310752e1.js"></script>
</body>
</html>