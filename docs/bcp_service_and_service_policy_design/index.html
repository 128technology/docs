<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Service and Service Policy Design | 128T Docs</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="128T Docs"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="Designing a service-oriented network with the 128T Session Smart router benefits from careful planning and thoughtful policy decisions. With the ability to steer traffic using the best path on a per-session basis, administrators have more control than ever before in deciding how their users maximize the network. This document discusses two fundamental, and related concepts: the *service* and the *service-policy*."><meta data-react-helmet="true" property="og:description" content="Designing a service-oriented network with the 128T Session Smart router benefits from careful planning and thoughtful policy decisions. With the ability to steer traffic using the best path on a per-session basis, administrators have more control than ever before in deciding how their users maximize the network. This document discusses two fundamental, and related concepts: the *service* and the *service-policy*."><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/bcp_service_and_service_policy_design">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.7d43a3e9.css">


<link rel="preload" href="/styles.43423e3f.js" as="script">

<link rel="preload" href="/runtime~main.8f4e7589.js" as="script">

<link rel="preload" href="/main.87aa712d.js" as="script">

<link rel="preload" href="/1.42dfadb0.js" as="script">

<link rel="preload" href="/2.0d532cd3.js" as="script">

<link rel="preload" href="/85.a5cb72a5.js" as="script">

<link rel="preload" href="/20ac7829.cf1f5304.js" as="script">

<link rel="preload" href="/17896441.c363af26.js" as="script">

<link rel="preload" href="/0d226310.70e62f8a.js" as="script">

</head>
<body>

<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/128t_black.png" alt="128 Technology Logo"><strong class="navbar__title"></strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://community.128technology.com/home">Interchange</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.128technology.com/">Company</a><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/128t_black.png" alt="128 Technology Logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Docs</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://community.128technology.com/home">Interchange</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://www.128technology.com/">Company</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/img/128t_black.png" alt="128 Technology Logo"><strong></strong></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/about_128t">128T</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/CONTRIBUTING">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_downloading_iso">Downloading ISOs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_installation_installer">Installing 128T</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_installation_bootable_media">Installing From ISO</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_installation_aws">Installing in AWS</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_ztp">QuickStart</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_creating_bootable_usb">Creating Bootable USB</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_upgrading">Upgrading</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_rollback">Rollback</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_application_discovery">Application Discovery</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_appid">Application Identification</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_ha_theoryofoperation">HA - Theory of Operation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_interface_types">Interface Types</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_linux_host_networking">Linux Host Networking</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_network_planes">Forwarding Planes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_machine_communication">Machine Communication</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_pcli">PCLI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_session_timer">Session Timers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_glossary">Glossary</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Administration</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/config_basics">Basics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_reference_guide">Element Reference</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_audit_log">Audit Log</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_ldap">LDAP</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_ha">High Availability</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_non_forwarding_ha_interfaces">Non-forwarding HA Interfaces</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_adding_interfaces_to_ha_team">Adding Interfaces to HA Team Interface</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_transition_standalone_to_ha">Transitioning a Conductor from Standalone to HA</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_nat">NAT</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_ospf">OSPF</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_snmp">SNMP</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_tenants">Tenants</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_templates">Configuration Templates</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How To</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/howto_bgp">BGP</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/howto_conductor_migration">Conductor Migration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/howto_lte">LTE</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/howto_maintenance_mode">Maintenance Mode</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/howto_trusted_ca_certificate">Adding a Trusted Certificate</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/howto_tune_bfd">Tuning BFD</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/ts_applications">Application Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ts_ap_salt_minion">AP: Salt Minion</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ts_cpu_spikes">CPU Spikes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ts_forwarding_resource_pools">Forwarding Plane Resource Pools</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ts_logs">Logs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ts_mac_uniqueness">MAC Address Uniqueness</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/events_overview">Alarm and Events</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/events_alarms">Alarms</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/events_events">Events</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/bcp_conductor_deployment">Conductor Deployment</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/bcp_lte_peering">LTE Peering</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/bcp_service_and_service_policy_design">Service and Service Policy Design</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/bcp_tenants">Tenancy Design</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLI Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/cli_reference">Command Line Reference</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/plugin_monitoring_agent">Monitoring</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/plugin_gre">GRE Plugin</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">REST APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/api_rest_4.2.0">128T-4.2.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">128T</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_4.3">4.3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_4.2">4.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_4.1">4.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_4.0">4.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">128T Installer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_installer_2.4">2.4</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_installer_2.3">2.3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_installer_2.2">2.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_installer_2.1">2.1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">128T IPSEC Client</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_ipsec_client_2.0">2.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_ipsec_client_1.0">1.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">128T SIP ALG</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_sip_alg_2.1">2.1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">128T ZScaler</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes_128t_zscaler_1.1">1.1</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Service and Service Policy Design</h1></header><div class="markdown"><p>Designing a service-oriented network with the 128T Session Smart router benefits from careful planning and thoughtful policy decisions. With the ability to steer traffic using the best path on a per-session basis, administrators have more control than ever before in deciding how their users maximize the network. This document discusses two fundamental, and related concepts: the <em>service</em> and the <em>service-policy</em>.</p><p>A service is a network destination of interest to your network&#x27;s users. It can represent a web server, a PBX system for your phones, a CRM system in the public cloud, or something specific only to you. The <code>service</code> data model in the 128T modeling language gives administrators great flexibility in defining what constitutes an &quot;interesting&quot; application that requires specific treatment as contrasted to bulk data. The <code>service-policy</code> affiliated with that <code>service</code> lets the administrator specify the treatment for the traffic of that service: where it should go, which path it should use to get there, how it gets treated along the way (marked and queued), and what to do in the event of network failures.</p><p>In this document we will cover the various types of services that are configurable in the 128T data model, and how to apply them. We will then discuss the predominant service-policy options for governing the traffic treatment for traffic steering, and give some rules of thumb for how to apply them.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="intended-audience"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#intended-audience" title="Direct link to heading">#</a>Intended Audience</h2><p>This document is intended for network administrators and network architects responsible for designing 128T configurations for their end users. It provides a conceptual overview for the different options available for configuring <code>service</code> and <code>service-policy</code> data models, and guidance on when to use the various attributes.</p><p>This document is relevant to the day-to-day job of network operations and network support staff, to help them to interpret a configuration to understand its intent.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="overview"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#overview" title="Direct link to heading">#</a>Overview</h2><p>In the 128T worldview, each IP destination that will receive traffic must be configured as a <em>service</em>. A service can be defined as broadly as a netmask (it is common for our customers to have a service representing the entire internet, as 0.0.0.0/0) or as specific as a transport protocol and single port. As traffic arrives at a 128T router, it (among other things) is associated with a configured service, which will in turn influence its path selection.</p><p>Path selection on the 128T is a decision process that considers several factors:</p><ul><li>Current network state. Are next hops reachable? Is a remote peer reachable? What are the current quality metrics for the various potential paths?</li><li>Administrative priorities. Which path should this traffic take in the &quot;sunny day scenario,&quot; when all paths are available? How should the 128T assess viability for a path for any given service?</li></ul><p>In the previous section of this document we discuss how 128T determines whether or not a remote peer is reachable (asynchronous BFD) and the quality of the path (echo BFD). These both pertain to the <em>current network state</em>. The <em>administrative priorities</em> of the 128T are described through the use of a <em>service-policy</em>, a configuration element that is associated with a service.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="service-types"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#service-types" title="Direct link to heading">#</a>Service Types</h2><p>The <em>service</em> configuration element is the cornerstone of the 128T data model. It is what allows administrators to describe eligible destinations for traffic, to which they can subsequently define access controls, routing policy, and traffic treatment. There is a strong correlation between successful deployments of the 128T software and a deep understanding of the services on the target network.</p><p>A service&#x27;s configuration is very flexible, and can represent many different aspects of a network&#x27;s topology. The various data modeling variants of a service are described in the sections that follow.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="fully-qualified-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#fully-qualified-services" title="Direct link to heading">#</a>Fully Qualified Services</h3><p>The most fundamental, and granular definition of a service is one which defines a specific application on your network. The goal of any 128T-powered configuration should be to configure <em>fully qualified</em> services with as much precision as possible. The key elements of a fully qualified service are:</p><ul><li>A narrow range of IP addresses that all serve the application</li><li>Specific transport protocols and ports that the application uses</li></ul><p>Example:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running authority service cloudflare-dns</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service  cloudflare-dns</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  cloudflare-dns</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                 private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address               1.1.1.1/32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address               1.0.0.1/32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         trusted</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source  trusted</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Key to success</h5></div><div class="admonition-content"><p>Define the service as specifically as possible, using transport/port and specific IP addresses as appropriate.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cidr-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#cidr-services" title="Direct link to heading">#</a>CIDR Services</h3><p>Many deployments of the 128T software include a number of <em>CIDR services</em> which – in contrast to fully qualified services – are broad swaths of IP addresses, typically located behind a 128T at a specific location.</p><p>The hallmarks of a CIDR Service are that it seldom has transport protocols defined, and never has ports defined. (Administrators may configure transport protocols without ports to restrict a service to TCP, UDP, and ICMP only, and block other IP protocols such as GRE.)</p><p>Example:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config run auth service burlington-guest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service  burlington-guest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name           burlington-guest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope          private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security       internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address        172.18.32.0/20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  trusted</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      trusted</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            source-nat     network-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="summary-and-spoke-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#summary-and-spoke-services" title="Direct link to heading">#</a>Summary and Spoke Services</h3><p><em>Summary services</em> and <em>spoke services</em> work in conjunction with each another to provide coarse routes from one 128T to another, and specific routes from the receiving 128T router to the destination. It is commonly used in &quot;hub and spoke&quot; topologies, where a less-specific route will direct traffic to a location, and that location&#x27;s router has more specific routes to apply to the traffic.</p><p>For example, in a retail deployment it is common for each branch location to have a specific CIDR block allocated, e.g., 10.20.20.0/24 for &quot;site 2020.&quot; For traffic originating in a data center and destined for the branch, a summary service is configured using the address 10.20.20.0/24. The branch router has more specific spoke services for the individual applications at the branch; e.g., 10.20.20.128/32, 10.20.20.60/32 UDP/5060, etc.</p><p>Conceptually, summary services and spoke services are very similar to CIDR services and application-based services, respectively. However, there is one significant difference between a summary service and a CIDR service: the summary service <em>must include a transport section</em>. This is the &quot;trigger&quot; for the receiving 128T router to apply a more-specific spoke service.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>A second, common attribute of summary services is the inclusion of an <code>applies-to</code> block in the configuration. The purpose of this block is described in more detail in the <em>Router/Router Group-based Services</em> section below. Because summary and spoke services are generally at their most useful in massive deployments to reduce overall configuration overhead, this is a strong case for using Router/Router Group-based services whenever summary services are considered.</p></div></div><p>Example:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service            site2020_summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  site2020_summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to            router-group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type        router-group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                group-name  datacenters</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                group-name  retail-site2020</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             icmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  icmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address               10.20.20.0/24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source  datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy        core2store-retail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="generated-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#generated-services" title="Direct link to heading">#</a>Generated Services</h3><p>Various features within the 128T will cause services to be generated automatically when configured. This includes:</p><ul><li>Conductor Host Services</li><li>BGP over SVR</li><li>DHCP Relay</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>The services generated by the 128T are created as fully qualified services.</p></div></div><p>Each of these service types shares one important attribute: they are created with the <code>generated</code> flag set to <code>true</code>. If you want to make any modifications to the generated services, you must first set <code>generated</code> to <code>false</code>, or else your configuration changes will be stripped upon the next time the configuration is committed. For more information on configuration workflows involving the <code>generated</code> flag, refer to the 128T software documentation.</p><p>Example (BGP over SVR):</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service            _bgp_dc1_loopback1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                     _bgp_dc1_loopback1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description              &quot;Auto generated BGP Service for dc1 at 172.20.0.1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            enabled                  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                    private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security                 internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            tap-multiplexing         false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport                tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  179</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  179</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    179</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address                  172.20.0.1/32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy-generated  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy            _bgp_speaker_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _bgp_speaker_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy           MPLS-DIA-LTE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes     false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            source-nat               network-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type         generic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            generated                true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="routerrouter-group-based-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#routerrouter-group-based-services" title="Direct link to heading">#</a>Router/Router Group-Based Services</h3><p>Router- and router group-based services are not services unto themselves; rather, the term refers to the capability of limiting the scope of services to specific routers or sets of routers. By default, any service configured on a 128T conductor is pushed down to all routers it manages. This may result in unnecessary bloat on routers that will never have a calling for a specific service. E.g., in a typical retail deployment traffic generally goes in one of two directions: originating at a store and heading to a datacenter, or originating at a datacenter and heading to a store. Thus it is important for head end routers to have access to store services, and for a store to have the configuration corresponding to its own local services, but there will be no need for every store to have every other store&#x27;s local services in a full mesh.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>In case a full mesh is a requirement, 128 Technology has the Summary and Spoke Services – which use router-based services to optimize the configuration.</p></div></div><p>Use the <code>applies-to</code> configuration within a <code>service</code> to restrict its scope:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running authority service lo_burlington</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service  lo_burlington</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name           lo_burlington</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to     router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  burlington</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  newton</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description    &quot;burlington loopback&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope          private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security       interfabric</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address        172.31.0.2/32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  trusted</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source  trusted</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy  _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source  _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><p>In this example, the service will only be delivered to two routers: <code>burlington</code> and <code>newton</code>. When using the <code>applies-to router-group</code> configuration, the group name is configured within each router.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service  core2store-default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name            core2store-default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to      router-group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type        router-group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                group-name  DC-routers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                group-name  retail-routers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            enabled         true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope           private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security        internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport       tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport       udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address         10.0.0.0/8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy   datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy  DIA-MPLS-LTE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><p>Here&#x27;s a common sight in large retail deployments: a <code>core2store</code> service for traffic originating in the data center and destined for a retail store. It is applied to two router groups: <code>DC-routers</code> and <code>retail-routers</code>. By applying a <code>group</code> tag on a managed router that matches either (or both) of these two group names, it will receive a copy of this configuration from the conductor.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="application-module-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#application-module-services" title="Direct link to heading">#</a>Application-Module Services</h3><p>Application-module services are dynamic and have two parts: a <code>service</code> configuration that references an <code>application-name</code>, and a script resident on the 128T&#x27;s host operating system with that <code>application-name</code> that generates forwarding rules (FIB entries, in the form of JSON configuration) that are installed onto the 128T. Application-module services give the ultimate flexibility to the 128T administrator: the ability to  define the forwarding logic of the 128T using the programming language of their choice.</p><p>To enable an application-module service, a router must have <code>application-identification</code> with <code>mode</code> set to <code>module</code>, as is shown here:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running auth router burlington application-identification</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router  burlington</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                        burlington</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            application-identification</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                mode  module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><p>A service that references a module name is configured like this:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running auth service custom-service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service  custom-service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  custom-service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description           &quot;Custom service definition using Application Module&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                 private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            application-name      customsvc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><p>Lastly, a file within <code>/etc/128technology/application-modules/</code> to be executed by the 128T software:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[pt@labsystem4 application-modules]$ cd /etc/128technology/application-modules/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[pt@labsystem4 application-modules]$ ls -ltr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total 12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">lrwxrwxrwx  1 root root   21 Sep  1  2018 office365.py -&gt; defaults/office365.py</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x  2 root root 4096 Jan 29 16:46 app_module_utils</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x. 2 root root 4096 Jan 29 16:48 defaults</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rwxr-xr-x  1 root root 1372 Feb 26 06:35 customsvc.py</span></div></code></pre></div><p>Here we can see the python script <code>customsvc.py</code> file, which matches the <code>application-name</code> configured in the <code>service</code> definition above. This is what creates the linkage between the service and the script.</p><p>For more information on creating your own custom <code>application-module</code>, review the documentation and browse the articles on Interchange.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="service-policy"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#service-policy" title="Direct link to heading">#</a>Service Policy</h2><p>Each service can have a <code>service-policy</code> associated with it, to govern its behavior through various configurable attributes. This can influence the service&#x27;s path selection and behavior in the event of path failures or path impairments as <em>administrative priorities</em>.</p><p>Here&#x27;s a representative <code>service-policy</code>, to provide context for discussion:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">service-policy  MPLS-DIA-LTE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name                 MPLS-DIA-LTE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    vector               mpls</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name      mpls</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        priority  5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    vector               broadband</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name      broadband</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        priority  10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    vector               lte</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name      lte</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        priority  15</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    session-resiliency   revertible-failover</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    path-quality-filter  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    max-loss             1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    max-latency          300</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    max-jitter           100</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><p>There are three principal controls within this service-policy:</p><ul><li>Vectors, which are used to indicate the administrative preference for path selection.</li><li>A session-resiliency choice, used to indicate the desired behavior in the event of path failures.</li><li>Path quality metrics, used to indicate the tolerance for loss, latency, and jitter on a path before it is declared ineligible for selection.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="vectors"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#vectors" title="Direct link to heading">#</a>Vectors</h3><p>By configuring vectors and assigning <code>priority</code> to them, an administrator can influence the path selection for egress traffic by a 128T device. Each vector has two components: a <code>name</code> and a <code>priority</code>. The <code>name</code> listed is also applied to an adjacency (though typically configured within a <code>neighborhood</code> and triggering the generation of a peer adjacency) to associate to the preferred egress path.</p><p>By way of example, here is an adjacency on the broadband interface of an example branch location:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router  site2020</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name  site2020</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node  node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name       wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        adjacency  203.0.113.2 dc1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address             203.0.113.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            peer                   dc1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            peer-connectivity      bidirectional</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            generated              true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            inter-router-security  interrouter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            cost                   0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            qp-value               0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            vector                 broadband</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><p>In the configuration fragment, you can see that the broadband interface (named <code>wan1</code>) has an adjacency configured to connect to its data center (named <code>dc1</code>). This adjacency uses the vector <code>broadband</code>.</p><p>Consider the <code>MPLS-DIA-LTE</code> service-policy shown above, which lists five vectors. For services leveraging this service-policy, the adjacency with the <code>broadband</code> vector would be the second priority, behind adjacencies referencing <code>mpls</code> – since that has a lower cost (higher priority).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="session-resiliency"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#session-resiliency" title="Direct link to heading">#</a>Session Resiliency</h3><p>As shown in the <code>MPLS-DIA-LTE</code> service-policy, the session-resiliency is set to <code>revertible-failover</code>. This policy comes into play when traffic needs to move in the event of a failure to a transport circuit (either a path failure or a path quality threshold has been crossed). After a failure to a circuit, traffic using that path will migrate to the next best circuit. When that circuit&#x27;s quality is restored (the path returns to the <code>up</code> state, or the quality thresholds return to satisfactory values), <code>revertible-failover</code> <em>will migrate the traffic back to the preferred circuit</em>. Contrast this to the session-resiliency setting of <code>failover</code>, which will persist the traffic on the migrated circuit and not return it to the preferred circuit.</p><p>In general, 128 Technology recommends using the <code>revertible-failover</code> setting for long-lived session types, such as SIP registrations. By contrast, 128 Technology recommends using the <code>failover</code> setting for transient sessions (such as the audio associated with a telephone call).</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>The vast majority of network sessions are transient, short-lived sessions, but you can validate this during your application discovery exercises.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="path-quality-metrics"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#path-quality-metrics" title="Direct link to heading">#</a>Path Quality Metrics</h3><p>The 128T supports four path quality metrics in its service-policy, all of which establish thresholds for determining a path&#x27;s eligibility for carrying traffic that references that service-policy. The metrics are:</p><ul><li><code>max-loss</code>, which will indicate the maximum percentage of packet loss before a path is ineligible</li><li><code>max-latency</code>, which indicates the maximum latency (half of the round trip time) before a path is unsuitable</li><li><code>max-jitter</code>, which indicates the maximum jitter before a path is unsuitable</li><li><code>min-mos</code> (not part of the example configuration), which indicates the minimum Mean Opinion Score before a path is considered unsuitable</li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>info</h5></div><div class="admonition-content"><p>The MOS value for a given path is a composite metric, computed based on loss, latency and jitter as its factors.</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-03-20T16:28:04.000Z" class="docLastUpdatedAt_1sqk">3/20/2020</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/bcp_lte_peering"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« LTE Peering</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/bcp_tenants"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Tenancy Design »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#intended-audience" class="contents__link">Intended Audience</a></li><li><a href="#overview" class="contents__link">Overview</a></li><li><a href="#service-types" class="contents__link">Service Types</a><ul><li><a href="#fully-qualified-services" class="contents__link">Fully Qualified Services</a></li><li><a href="#cidr-services" class="contents__link">CIDR Services</a></li><li><a href="#summary-and-spoke-services" class="contents__link">Summary and Spoke Services</a></li><li><a href="#generated-services" class="contents__link">Generated Services</a></li><li><a href="#routerrouter-group-based-services" class="contents__link">Router/Router Group-Based Services</a></li><li><a href="#application-module-services" class="contents__link">Application-Module Services</a></li></ul></li><li><a href="#service-policy" class="contents__link">Service Policy</a><ul><li><a href="#vectors" class="contents__link">Vectors</a></li><li><a href="#session-resiliency" class="contents__link">Session Resiliency</a></li><li><a href="#path-quality-metrics" class="contents__link">Path Quality Metrics</a></li></ul></li></ul></div></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright © 2020 128 Technology, Inc.</div></div></div></footer>
</div>

<script src="/styles.43423e3f.js"></script>

<script src="/runtime~main.8f4e7589.js"></script>

<script src="/main.87aa712d.js"></script>

<script src="/1.42dfadb0.js"></script>

<script src="/2.0d532cd3.js"></script>

<script src="/85.a5cb72a5.js"></script>

<script src="/20ac7829.cf1f5304.js"></script>

<script src="/17896441.c363af26.js"></script>

<script src="/0d226310.70e62f8a.js"></script>


</body>
</html>