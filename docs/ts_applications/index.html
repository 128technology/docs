<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Application Troubleshooting | SSN Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/ts_applications"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Application Troubleshooting | SSN Docs"><meta data-react-helmet="true" name="description" content="This guide describes the methodology behind troubleshooting issues on the SSR that apply to a specific application&#x27;s behavior. This technique is useful when the SSR is forwarding traffic, but end users complain about certain applications that are not behaving properly (e.g., performance is slow, certain applications don&#x27;t work)."><meta data-react-helmet="true" property="og:description" content="This guide describes the methodology behind troubleshooting issues on the SSR that apply to a specific application&#x27;s behavior. This technique is useful when the SSR is forwarding traffic, but end users complain about certain applications that are not behaving properly (e.g., performance is slow, certain applications don&#x27;t work)."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/ts_applications"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/ts_applications" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/ts_applications" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.21b25f22.css">
<link rel="preload" href="/assets/js/runtime~main.2c8966b2.js" as="script">
<link rel="preload" href="/assets/js/main.d589b7f3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Session Smart Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation">Installation Process</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_aws">Cloud Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_installer">Supporting Information - Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/config_basics">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_basics">Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_ha">High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/sec_adaptive_encrypt">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/how_to_use_app_summary">How To</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/ts_applications">Troubleshooting</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/ts_applications">Application Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_ap_duplicate_assets">AP: Duplicate Asset ID Error</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_ap_salt_minion">AP: Salt Minion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_cpu_spikes">CPU Spikes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_forwarding_resource_pools">Forwarding Plane Resource Pools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_logs">Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_mac_uniqueness">MAC Address Uniqueness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_packet_capture">Packet Capture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_t1_troubleshooting">T1 Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_troubleshooting_vrf">Troubleshooting VRF</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/bcp_att_avpn_configuration">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/release_notes_128t_5.5">Release Notes</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Application Troubleshooting</h1></header><p>This guide describes the methodology behind troubleshooting issues on the SSR that apply to a specific application&#x27;s behavior. This technique is useful when the SSR is forwarding traffic, but end users complain about certain applications that are not behaving properly (e.g., performance is slow, certain applications don&#x27;t work).</p><p>This document is for network administrators responsible for managing a deployed Session Smart Networking Platform.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="troubleshooting-steps">Troubleshooting Steps<a class="hash-link" href="#troubleshooting-steps" title="Direct link to heading">​</a></h2><p>The basic approach used to troubleshoot applications on the Session Smart Networking Platform follows the set of steps below:</p><ol><li>Identify the applications affected.</li><li>Identify the requesting <em>tenant</em> that is attempting to use the application. </li><li>Identify the <em>service</em> associated with the application. </li><li>Determine the SSR&#x27;s selected route for the application.</li><li>Generate test traffic using the <code>service-ping</code> command.</li><li>Perform end user testing.</li></ol><p>Each of these steps is discussed in more detail in the sections that follow. It is recommended to perform the application troubleshooting steps on both the local router and the remote router (if applicable).</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="identify-the-affected-applications">Identify the Affected Applications<a class="hash-link" href="#identify-the-affected-applications" title="Direct link to heading">​</a></h2><p>The following information can be gathered from the customer:</p><ul><li>Application name and function</li><li>Any application dependencies such as DNS, LDAP/TACACS+, etc.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="identifying-the-requesting-tenant">Identifying the Requesting Tenant<a class="hash-link" href="#identifying-the-requesting-tenant" title="Direct link to heading">​</a></h2><p>Each source of traffic that arrives at an SSR is associated with a tenant; this may be either an administratively assigned tenant, or the default <em>global tenant</em>, which is used when no explicitly configured tenant exists. Tenancy is determined in one of several ways:</p><ol><li>By arriving on a <code>network-interface</code> that has a <code>tenant</code> configured.</li><li>By arriving on a <code>network-interface</code> that has one or more <code>neighborhood</code> elements configured, and those neighborhoods are referenced in <code>tenant &gt; member</code> configuration.</li><li>Via conveyance from an upstream SSR device that has encoded the source tenant information into SSR <em>metadata</em>. This tenancy assignment will not be discussed in this document, as the traffic routing decision is made by the first SSR encountered by a client. The focus of this document will be on items 1 and 2 exclusively.</li></ol><p>The configuration on an SSR – specifically, items 1 and 2 above – constructs the <em>source lookup table</em> used by the SSR to affiliate inbound requests to tenants.</p><p>While it is possible to determine the contents of the source lookup table by checking the ingress <code>network-interface</code> and reviewing the tenant assignment or neighborhoods&#x27; members, the SSR administrative interfaces provide tools to make it simpler.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="determining-the-tenant-from-the-pcli">Determining the Tenant from the PCLI<a class="hash-link" href="#determining-the-tenant-from-the-pcli" title="Direct link to heading">​</a></h3><p>To determine the impacted service and service class, use the command <code>show tenant members</code> to display the <strong>Source Lookup Table</strong> for the specified SSR. </p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.router# show tenant members</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Mon 2019-11-25 17:36:37 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node: SOLMA0128P1A</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============ ========= ============== ================= ================== =================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Device I/F   VLAN ID   Network I/F    Network I/F IP    Source IP Prefix   Tenant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============ ========= ============== ================= ================== =================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          2         0   ha-fabric      169.254.255.0     169.254.255.1/32   &lt;fabric&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          3         0   pos            10.0.0.1          0.0.0.0/0          cust</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          3         2   utility        10.128.0.1        0.0.0.0/0          utility.cust</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          3         3   voice          10.192.0.1        0.0.0.0/0          voice.cust</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          4         0   DIA            128.128.128.129   0.0.0.0/0          &lt;global&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     kni254         0   controlKniIf   169.254.127.126   0.0.0.0/0          _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lte         0   lte            169.254.100.101   0.0.0.0/0          &lt;global&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         t1         0   mpls-backup    169.254.128.128   0.0.0.0/0          &lt;global&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="determining-the-tenant-from-the-gui">Determining the Tenant from the GUI<a class="hash-link" href="#determining-the-tenant-from-the-gui" title="Direct link to heading">​</a></h3><ol><li>Open the Conductor&#x27;s GUI. </li><li>Under Authority, click on <strong>Routers</strong>. In the main information panel, a list of all of the managed routers is displayed. </li><li>Click on a router to display its information page. </li><li>On the right side of the information page, click <strong>Routing Details</strong>. </li><li>From the Routing Details screen, click on the <strong>Source Tenant</strong> tab at the top of the screen. This displays the output of the source lookup table for the router – the same output as the PCLI&#x27;s <code>show tenant members</code> command. </li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="identifying-the-service">Identifying the Service<a class="hash-link" href="#identifying-the-service" title="Direct link to heading">​</a></h2><p>Sometimes, the service a user is attempting to access is self-evident (e.g., in cases where all traffic is forwarded using a &quot;quad zero&quot; service). In other cases it is not so clear. Follow the steps below if you need assistance in determining the <em>service</em> that particular inbound traffic is matching.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>It is worth following these steps if you are not 100% certain of the service that is used for a given source/destination IP pair, since there may be unexpected &quot;better&quot; matches with more specific prefixes, or even &quot;worse&quot; matches if the service you&#x27;re expecting to see doesn&#x27;t match.</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="identifying-the-destination-ip-address-port-and-transport">Identifying the Destination IP Address, Port, and Transport<a class="hash-link" href="#identifying-the-destination-ip-address-port-and-transport" title="Direct link to heading">​</a></h3><p>All service matching is performed based on the destination address of packets received by an SSR, inclusive of port and transport protocol. It is important to understand what address, port, and protocol are being transmitted by the client. </p><p>The best method to identify this information is to use <a href="/docs/ts_packet_capture#selective-packet-capture">Selective Packet Capture</a>. This method applies a trace not only on the ingress node where the capture is defined, but also triggering traces on every subsequent SSR node the session traverses.</p><p>Please refer to the <a href="/docs/ts_packet_capture#selective-packet-capture">Selective Packet Capture section</a> to enable this feature.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="determining-the-service-from-the-pcli">Determining the Service from the PCLI<a class="hash-link" href="#determining-the-service-from-the-pcli" title="Direct link to heading">​</a></h3><p>If you were able to find the session in the output of the session table, it will positively identify the name of the service that is being accessed. Move on to the next step, Determine the Selected Route.</p><p>If you were unable to find the session in the output of the session table, we&#x27;ll need to dig into the IP/port/protocol of the packet to see which service it should match.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="which-services-are-available">Which Services Are Available?<a class="hash-link" href="#which-services-are-available" title="Direct link to heading">​</a></h4><p>From the PCLI, use the following command to identify which services are available to the tenant. For this example we&#x27;ll use the tenant <code>trusted</code>.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">show fib router newton | grep &quot; trusted&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The tenant name within quotes has a preceding space. That will let you isolate services that are specifically allowed by this tenant, and not any of its descendants (children, grandchildren, etc.).</p></div></div><p>This command will output a list of prefixes/transports/ports, sorted by IP address:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show fib router newton | grep &quot; trusted&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Piping output...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 0.0.0.0/8            &lt;any&gt;   &lt;any&gt;   trusted       &lt;ControlMessageService&gt;    &lt;none&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 1.0.0.0/8            &lt;any&gt;   &lt;any&gt;   trusted       internet                   108.26.188.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 1.0.0.1/32           53      udp     trusted       cloudflare-dns             108.26.188.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 1.1.1.1/32           53      udp     trusted       cloudflare-dns             108.26.188.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 2.0.0.0/7            &lt;any&gt;   &lt;any&gt;   trusted       internet                   108.26.188.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 4.0.0.0/6            &lt;any&gt;   &lt;any&gt;   trusted       internet                   108.26.188.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8.0.0.0/7            &lt;any&gt;   &lt;any&gt;   trusted       internet                   108.26.188.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 10.128.200.0/24      &lt;any&gt;   &lt;any&gt;   trusted       becket-servicenet          10.172.170.61</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 11.0.0.0/8           &lt;any&gt;   &lt;any&gt;   trusted       internet                   108.26.188.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 12.0.0.0/6           &lt;any&gt;   &lt;any&gt;   trusted       internet                   108.26.188.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="which-service-did-i-match">Which Service Did I Match?<a class="hash-link" href="#which-service-did-i-match" title="Direct link to heading">​</a></h4><p>Note that the matching algorithm for the SSR will give preference to <em>transport and port</em>. That is, a fully qualified port/protocol match will be considered better than an exact IP address match with no port/protocol specified. By way of example, consider the following two configuration examples:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       service-name    cloudflare-dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       address         1.0.0.1/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       address         1.1.1.1/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                       </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       service-name    all-dns-traffic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       address         0.0.0.0/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       transport       udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               protocol      udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               port-range 53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                       start-port    53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Inbound traffic for <code>1.0.0.1</code> will match the <code>cloudflare-dns</code> service, and traffic for <code>8.8.8.8 UDP/53</code> will match the <code>all-dns-traffic</code> service. But traffic for <code>1.0.0.1 UDP/53</code> will <em>also</em> match the <code>all-dns-traffic</code> service; even though the IP address in the <code>cloudflare-dns</code> service is more specific, because the port and protocol are exact matches, this traffic will match the <code>all-dns-traffic</code> service.</p><p>The lookup algorithm is as follows:</p><ol><li>Perform the lookup with a &quot;fully qualified&quot; protocol and port (e.g., UDP/53).</li><li>If there is no hit, perform a lookup with a fully-qualified protocol and a wildcard port (e.g., UDP/*)</li><li>If there is no hit, perform a lookup using a full wildcard for protocol and port.</li></ol><p>This information is critical when trying to understand which service your inbound traffic matches.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="determine-the-selected-route">Determine the Selected Route<a class="hash-link" href="#determine-the-selected-route" title="Direct link to heading">​</a></h2><p>Once you&#x27;ve positively identified the service that the client is requesting, we&#x27;ll see which route the SSR will use for that traffic.</p><p>For service-routed traffic (i.e., when there&#x27;s either an explicitly configured or a generated <code>service-route</code> for that <code>service</code> on the ingress router), you can use the <code>show load-balancer</code> tool within the PCLI to determine how the SSR will route the traffic. For natively-routed traffic, we&#x27;ll use the RIB to show us where to expect the traffic to be sent.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="service-routed-traffic">Service-Routed Traffic<a class="hash-link" href="#service-routed-traffic" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show load-balancer router newton service cloudflare-dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tue 2019-12-03 16:49:04 EST</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===============================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Service:  cloudflare-dns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Strategy: hunt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+--------------------+-------------+------------+----------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|       Agent        | Destination |    Node    |    Service     |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+--------------------+-------------+------------+----------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| rte_cloudflare-dns |   &lt;empty&gt;   | labsystem2 | cloudflare-dns |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+--------------------+-------------+------------+----------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Capacity:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">====== =========== ====== ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Used         Max   Util   Rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">====== =========== ====== ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1   unlimited           0/s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Paths (count 1):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">wan.0 gateway 128.128.128.128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======= ========= ====== ======= ====== ========= ========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type   Quality   Cost   State   Loss   Latency   Jitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======= ========= ====== ======= ====== ========= ========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> local         0    N/A      up     0%       0ms      0ms</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This <code>cloudflare-dns</code> service is a non-SVR service (the next-hop type is <code>local</code>). This traffic is using the <code>wan.0</code> egress interface and will be sent to the gateway router <code>128.128.128.128</code>.</p><p>Now we&#x27;ll look at an SVR service to see what the <code>load-balancer</code> output looks like:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show load-balancer router becket service newton-https</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tue 2019-12-03 16:50:56 EST</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===============================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Service:  newton-https</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Strategy: hunt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+----------------------+-------------+------------+--------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">|        Agent         | Destination |    Node    |   Service    |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+----------------------+-------------+------------+--------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| newton-https__newton |    newton   | labsystem4 | newton-https |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+----------------------+-------------+------------+--------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Capacity:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">====== =========== ====== ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Used         Max   Util   Rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">====== =========== ====== ======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    0   unlimited           0/s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Paths (count 2):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lte.0 gateway 128.128.128.129</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======== ========= ====== ======= ====== ========= ========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Type   Quality   Cost   State   Loss   Latency   Jitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======== ========= ====== ======= ====== ========= ========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> router         0    N/A      up     0%     156ms      3ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">wan0.0 gateway 192.168.2.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======== ========= ====== ======= ====== ========= ========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Type   Quality   Cost   State   Loss   Latency   Jitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======== ========= ====== ======= ====== ========= ========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> router         0    N/A    down     0%       0ms      0ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">++ Warning: Path link is down</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this case, we can tell that it is an SVR route because the <code>Destination</code> is another router. Each of the paths (of which there are two) is of type <code>router</code>. The peer path over <code>wan0.0</code> is down, and thus we should expect the traffic to egress over the <code>lte.0</code> interface. You can also see the path statistics here (loss/latency/jitter) which can influence route selection in the event that a <code>service-policy</code> is applied to a service and requires specific ceilings for those values.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="check-the-selected-routes-health">Check the Selected Route&#x27;s Health<a class="hash-link" href="#check-the-selected-routes-health" title="Direct link to heading">​</a></h2><p>Now that we&#x27;ve identified the tenant, the service, and the path that traffic will take, we&#x27;ll investigate the health of that path. The process for doing this varies slightly based on whether it is an SVR path or a non-SVR path.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="svr-traffic">SVR Traffic<a class="hash-link" href="#svr-traffic" title="Direct link to heading">​</a></h3><p>When traffic is sent from one SSR to another SSR <em>peer</em>, it is called Secure Vector Routing, or &quot;SVR.&quot;</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>SSRs can also send traffic to other SSRs as &quot;native&quot; traffic – i.e., non-SVR. This is fairly uncommon, however.</p></div></div><p>The first thing to check when verifying a route&#x27;s health is to look at the output of <code>show peers</code>. Here&#x27;s an example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show peers router becket</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tue 2019-12-03 18:12:03 EST</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">================== ============ =========== ================= ======== ================ </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Peer               Node         Interface   Destination       Status   Hostname             </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">================== ============ =========== ================= ======== ================ </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> becket -&gt; newton   labsystem4   wan0        128.128.128.129   down     lab.128t.com   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> becket -&gt; newton   labsystem4   lte         128.128.128.129   up       lab.128t.com </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As we saw in the output from <code>show load-balancer</code>, one of the peers between these two routers is down (over the <code>wan0</code> interface). The LTE peer path is up, however, so this is the one which will be used.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If all peer paths between a source and a destination are down, and there are no other routes, the SSR has a &quot;best effort&quot; route it will use if configured to do so.</p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="service-ping">Service Ping<a class="hash-link" href="#service-ping" title="Direct link to heading">​</a></h4><p>Once you have identified the tenant, service, and path, you can exercise that path using the PCLI&#x27;s built-in <code>service-ping</code> capability. While the syntax is a bit complex, it will use the exact same forwarding logic that the SSR control plane uses for making traffic forwarding decisions.</p><p>Here is an example of the <code>service-ping</code> at work:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# service-ping router becket node labsystem4 service-name newton-https tenant trusted 128.128.128.129</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PING 128.128.128.129 56 bytes of data.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ping from 128.128.128.129 (128.128.128.129): icmp_seq=0 ttl=48 time=136.176ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ping from 128.128.128.129 (128.128.128.129): icmp_seq=1 ttl=48 time=112.438ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ping from 128.128.128.129 (128.128.128.129): icmp_seq=2 ttl=48 time=119.685ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ping from 128.128.128.129 (128.128.128.129): icmp_seq=3 ttl=48 time=100.758ms</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can pass the router, node, service, tenant, and destination IP addresses to the <code>service-ping</code> command. You cannot pass transport and port, however; as the <code>service-ping</code> command will exclusively generate ICMP packets.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The <code>service-ping</code> command will exercise the entire data path, including creating a session. You can see the effects of the <code>service-ping</code> in the output of <code>show sessions</code> – but you have to act fast (or have a second screen), since the session will expire five seconds after the last ping is sent.</p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="checking-sessions">Checking Sessions<a class="hash-link" href="#checking-sessions" title="Direct link to heading">​</a></h4><p>Each bidirectional flow of traffic processed by an SSR will have a unique <em>session ID</em> that persists for the duration of the session. (This is the leftmost column in the output of <code>show sessions</code>). When an SSR sends SVR traffic to another SSR, <strong>the session ID persists between the two devices</strong>. This greatly assists in troubleshooting, since you can identify the traffic of interest on the ingress device and see if the session arrives successfully at the next hop SSR.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="non-svr-traffic">Non-SVR Traffic<a class="hash-link" href="#non-svr-traffic" title="Direct link to heading">​</a></h3><p>For non-SVR traffic, we can use the &quot;classic&quot; <code>ping</code> function to make sure the SSR can reach the outside world. If the SSR can reach its next hop gateway, but pings to the far end destination fail, then the issue should be taken up with the ISP providing the circuit.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# ping router becket node labsystem4 egress-interface wan0 1.0.0.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PING 1.0.0.1 56 bytes of data.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ping from 1.0.0.1 (1.0.0.1): icmp_seq=0 ttl=57 time=114.491ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ping from 1.0.0.1 (1.0.0.1): icmp_seq=1 ttl=57 time=138.771ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ping from 1.0.0.1 (1.0.0.1): icmp_seq=2 ttl=57 time=138.339ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ping from 1.0.0.1 (1.0.0.1): icmp_seq=3 ttl=57 time=138.002ms</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="wan-link-status">WAN Link Status<a class="hash-link" href="#wan-link-status" title="Direct link to heading">​</a></h3><p>Verfiy whether the WAN links are up by checking the peer path information with the commands below.</p><ul><li><p>Use <a href="/docs/cli_reference#show-device-interface"><code>show device-interface router &lt;routerName&gt; summary</code></a> to confirm that the target device-interface is up/up/up.</p></li><li><p>Use <a href="/docs/cli_reference#show-network-interface"><code>show network-interface router &lt;routerName&gt;</code></a> to confirm that the target network-interface is up.</p></li><li><p>From the Router PCLI, check the up/down transition of the peer-paths using <a href="/docs/cli_reference#show-peers"><code>show peers name router &lt;routerName&gt; detail</code></a>.</p></li><li><p>From the Conductor PCLI, confirm peer status is up: <a href="/docs/cli_reference#show-peers"><code>show peers name router &lt;routerName&gt; detail</code></a>.
</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="wan-side-application-latency">WAN Side Application Latency<a class="hash-link" href="#wan-side-application-latency" title="Direct link to heading">​</a></h3><ul><li><p>Check link latency via BFD based information
<a href="/docs/cli_stats_reference#show-stats-bfd-by-peer-path"><code>show stats bfd by-peer-path router &lt;routerName&gt;</code></a></p><ul><li>Check <a href="/docs/cli_stats_reference#show-stats-bfd-by-peer-path-async-received-miss"><code>show stats bfd by-peer-path router &lt;routerName&gt; async received miss</code></a> for BFD async packets not received in time on the peer path.</li><li>Check jitter using <a href="/docs/cli_stats_reference#show-stats-bfd-by-peer-path-jitter"><code>show stats bfd by-peer-path router &lt;routerName&gt; jitter</code></a>.</li><li>Check latency using <a href="/docs/cli_stats_reference#show-stats-bfd-by-peer-path-latency"><code>show stats bfd by-peer-path router &lt;routerName&gt; latency</code></a>.</li></ul></li><li><p>Identify the impacted service and service class</p><ul><li>Use <a href="/docs/cli_reference#show-fib"><code>show-fib router &lt;router&gt; tenant &lt;tenant&gt;</code></a> to gather information about FIB entries at the router.</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="reviewing-traffic-engineering-priorities">Reviewing Traffic Engineering Priorities<a class="hash-link" href="#reviewing-traffic-engineering-priorities" title="Direct link to heading">​</a></h4><p>Look closely at the traffic engineering priorities. An oversubscribed traffic class may cause the application performance to suffer. If an oversubscribed traffic class is identified, consider reclassifying the traffic in the identified class, or increasing the allocation for that class. Use the following <code>show</code> commands to dig into the application processing details.</p><p>Use the <a href="/docs/cli_stats_reference#show-stats-traffic-eng-device-interface-per-traffic-class"><code>show stats traffic-eng device-interface per-traffic-class traffic-class &lt;traffic class&gt;</code></a> to display the available success and failure statistics associated with traffic engineering. When experiencing a degradation in user experience for a particular application, checking the associated error statistics for traffic engineering may show an overwhelmed traffic-class. </p><p>Statistics such as <a href="/docs/cli_stats_reference#show-stats-traffic-eng-internal-application-per-traffic-class-buffer-capacity-exceeded-packets"><code>buffer-capacity-exceeded-packets</code></a>, and <a href="/docs/cli_stats_reference#show-stats-traffic-eng-internal-application-per-traffic-class-schedule-failure-packets"><code>schedule-failure-packets</code></a> show issues where an incoming burst or sustained rate has exceeded a particular queue (or multiple queues) within traffic engineering, causing the loss of those packets. </p><p>Statistics such as <a href="/docs/cli_stats_reference#show-stats-traffic-eng-internal-application-per-traffic-class-dequeue-aqm-drop-packets"><code>dequeue-aqm-drop-packets</code></a> and <a href="/docs/cli_stats_reference#show-stats-traffic-eng-internal-application-per-traffic-class-dequeue-max-latency-drop-packets"><code>dequeue-max-latency-drop-packets</code></a> show that packets have buffered for an excessive amount of time and are being dropped to clear up buffer space within the scheduler for more recent packets. This type of packet loss is indicative of excessive bandwidth which has overwhelmed the transmit-cap of the device-interface for a prolonged period of time. </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="fragmentation">Fragmentation<a class="hash-link" href="#fragmentation" title="Direct link to heading">​</a></h4><p>To check for fragmentation, run the <a href="/docs/cli_stats_reference#show-stats-packet-processing-fragmentation"><code>show stats packet-processing fragmentation router &lt;routerName&gt;</code></a> command multiple times and look for incrementing stats. If Path MTU Discovery <!-- -->[PMTUD]<!-- --> is currently disabled, we recommend it be enabled. </p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The Automatic MSS adjustment feature was added in version 5.2.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="perform-end-user-testing">Perform End User Testing<a class="hash-link" href="#perform-end-user-testing" title="Direct link to heading">​</a></h2><p>Now that you have a sense of the type of application traffic you&#x27;re interested in troubleshooting, we&#x27;ll follow basic troubleshooting methodology:</p><ol><li><p>Coordinate a time with the end user reporting a problem to attempt to reproduce the issue.</p></li><li><p>Prior to testing, enable session captures on the LAN interface of the egress router using the service identified in previous steps.</p></li><li><p>Use the command <code>write log message BEGINNING TEST 1</code> to cause the SSR to put an identifier into each log on the system.</p></li><li><p>Ask your user to run tests that demonstrate the failure.</p></li><li><p>Use the command <code>write log message ENDING TEST 1</code></p></li><li><p>Repeat steps 4-6 several times, incrementing the TEST numbers in your log message.</p></li><li><p>Disable session captures on all devices.</p></li><li><p>Retrieve the logs and captures from ingress and egress SSR systems.</p></li><li><p>Analyze the captures to follow the packet flow from ingress to egress SSR. Ensure that all messages received on the ingress router arrive and are forwarded by the egress router, and that the return path follows suit in the reverse direction.</p></li></ol><p>If the SSR devices are confirmed to be forwarding traffic in both directions but the application is not working, then consult with the application provider to get their consultation. If the SSR devices are not forwarding traffic, continue troubleshooting.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="traffic-doesnt-leave-the-ingress-router">Traffic Doesn&#x27;t Leave the Ingress Router<a class="hash-link" href="#traffic-doesnt-leave-the-ingress-router" title="Direct link to heading">​</a></h3><p>This is generally due to a configuration problem or a transient network issue (e.g., an interface failure). Look for the <code>BEGINNING TEST</code> messages in the logs and correlate them to the session captures you took. Look for evidence of failure. For configurations that had been working previously but stopped (with no configuration changes), correlate the time at which traffic stopped working to any notable items in the router&#x27;s event history – viewable with the command <code>show events alarm</code>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="traffic-doesnt-reach-the-egress-router">Traffic Doesn&#x27;t Reach the Egress Router<a class="hash-link" href="#traffic-doesnt-reach-the-egress-router" title="Direct link to heading">​</a></h3><p>If traffic is processed by the ingress router and you believe it is forwarded out to the egress router but doesn&#x27;t arrive, perform additional testing as follows:</p><ol><li><p>Run the tests as was done previously. Investigate the <code>highway</code> and <code>serviceArea</code> logs, or the output of the <code>show sessions</code> table while the traffic is in progress to see what waypoint allocations were assigned to that traffic flow. On the ingress router this will be indicated by the <code>rev</code> flow for the session.</p></li><li><p>Look for these ports in the 128T<em>service</em>.pcap on both the ingress and egress routers. If you see them leaving the ingress router and not arriving at the egress router, then this should be taken to your ISP for assistance in troubleshooting.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="traffic-doesnt-leave-the-egress-router">Traffic Doesn&#x27;t Leave the Egress Router<a class="hash-link" href="#traffic-doesnt-leave-the-egress-router" title="Direct link to heading">​</a></h3><p>As with issues with the ingress router, this is generally due to a configuration problem or a transient network issue (e.g., an interface failure). Look for the <code>BEGINNING TEST</code> messages in the logs and correlate them to the session captures you took. Look for evidence of failure. For configurations that had been working previously but stopped (with no configuration changes), correlate the time at which traffic stopped working to any notable items in the router&#x27;s event history – viewable with the command <code>show events alarm</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="support-services">Support Services<a class="hash-link" href="#support-services" title="Direct link to heading">​</a></h2><p>Juniper offers several options for support services to assist with troubleshooting. Users with a valid End User License Agreement can escalate support issues using our support system (telephone, email, web portal) as governed by our Service and Support Plan. We also host a peer-to-peer community portal, Interchange, for discussing issues that are less time sensitive or urgent. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="support-logs">Support Logs<a class="hash-link" href="#support-logs" title="Direct link to heading">​</a></h3><p>In cases where the above troubleshooting steps have not resolved the issue, please gather the following information before opening a support ticket.</p><ul><li>Application name</li><li>Name of the router/node</li><li>Source ip/port</li><li>Destination ip/port</li><li>Tenant/service/service class <!-- -->[TE]</li><li>Exact date/time of issue</li></ul><p>Perform/gather the following:</p><ul><li><p><strong>Before</strong> collecting the TSI, run <code>save runtime-stats filename &lt;filename&gt;</code> </p><ul><li><p>Run the command <code>save runtime-stats filename &lt;filename&gt;</code> on each node.</p></li><li><p>Wait 30 seconds.</p></li><li><p>Run the command again.</p><p>Example: </p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labconductor.lab# save runtime-stats filename runtime-stats-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Retrieving Runtime Stats...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Runtime stats saved to /var/log/128technology/filename</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labconductor.lab# save runtime-stats filename runtime-stats-2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">etrieving Runtime Stats...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Runtime stats saved to /var/log/128technology/filename</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul></li><li><p>Session captures along path.</p><p>  A session capture should auto-create pcaps from end to end and should be generated BEFORE collecting the TSI</p></li><li><p>Full TSI/logs including journal from each router/node</p><p>  Example Journal:
<code>journalctl --since &quot;yyyy-mm-dd hh:mm:ss” --until “yyyy-mm-dd hh:mm:ss&quot; &gt; /tmp/journal.txt</code></p></li><li><p>If the issue is related to salt, include conductor logs.</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-04-07T23:47:17.000Z">4/7/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/howto_tune_bfd"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tuning BFD</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/ts_ap_duplicate_assets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AP: Duplicate Asset ID Error</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#troubleshooting-steps" class="table-of-contents__link toc-highlight">Troubleshooting Steps</a></li><li><a href="#identify-the-affected-applications" class="table-of-contents__link toc-highlight">Identify the Affected Applications</a></li><li><a href="#identifying-the-requesting-tenant" class="table-of-contents__link toc-highlight">Identifying the Requesting Tenant</a><ul><li><a href="#determining-the-tenant-from-the-pcli" class="table-of-contents__link toc-highlight">Determining the Tenant from the PCLI</a></li><li><a href="#determining-the-tenant-from-the-gui" class="table-of-contents__link toc-highlight">Determining the Tenant from the GUI</a></li></ul></li><li><a href="#identifying-the-service" class="table-of-contents__link toc-highlight">Identifying the Service</a><ul><li><a href="#identifying-the-destination-ip-address-port-and-transport" class="table-of-contents__link toc-highlight">Identifying the Destination IP Address, Port, and Transport</a></li><li><a href="#determining-the-service-from-the-pcli" class="table-of-contents__link toc-highlight">Determining the Service from the PCLI</a></li></ul></li><li><a href="#determine-the-selected-route" class="table-of-contents__link toc-highlight">Determine the Selected Route</a><ul><li><a href="#service-routed-traffic" class="table-of-contents__link toc-highlight">Service-Routed Traffic</a></li></ul></li><li><a href="#check-the-selected-routes-health" class="table-of-contents__link toc-highlight">Check the Selected Route&#39;s Health</a><ul><li><a href="#svr-traffic" class="table-of-contents__link toc-highlight">SVR Traffic</a></li><li><a href="#non-svr-traffic" class="table-of-contents__link toc-highlight">Non-SVR Traffic</a></li><li><a href="#wan-link-status" class="table-of-contents__link toc-highlight">WAN Link Status</a></li><li><a href="#wan-side-application-latency" class="table-of-contents__link toc-highlight">WAN Side Application Latency</a></li></ul></li><li><a href="#perform-end-user-testing" class="table-of-contents__link toc-highlight">Perform End User Testing</a><ul><li><a href="#traffic-doesnt-leave-the-ingress-router" class="table-of-contents__link toc-highlight">Traffic Doesn&#39;t Leave the Ingress Router</a></li><li><a href="#traffic-doesnt-reach-the-egress-router" class="table-of-contents__link toc-highlight">Traffic Doesn&#39;t Reach the Egress Router</a></li><li><a href="#traffic-doesnt-leave-the-egress-router" class="table-of-contents__link toc-highlight">Traffic Doesn&#39;t Leave the Egress Router</a></li></ul></li><li><a href="#support-services" class="table-of-contents__link toc-highlight">Support Services</a><ul><li><a href="#support-logs" class="table-of-contents__link toc-highlight">Support Logs</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2c8966b2.js"></script>
<script src="/assets/js/main.d589b7f3.js"></script>
</body>
</html>