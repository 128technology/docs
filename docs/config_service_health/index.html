<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Service Health Learning and Fault Avoidance | SSN Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/config_service_health"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Service Health Learning and Fault Avoidance | SSN Docs"><meta data-react-helmet="true" name="description" content="When an interface is operationally down, or ARP requests to the next-hop gateway are not consistently returned, the path in question will be removed from routing decisions. In concert with dynamic routing protocols such as BGP, network software is able to determine the best path to the destination. However in some deployments, routers can be pre-configured with all potentially available transports, or lacking in dynamic routing protocols to determine if the path to the final destination is available on a given route. As a result, the path selected by the router might effectively black-hole traffic."><meta data-react-helmet="true" property="og:description" content="When an interface is operationally down, or ARP requests to the next-hop gateway are not consistently returned, the path in question will be removed from routing decisions. In concert with dynamic routing protocols such as BGP, network software is able to determine the best path to the destination. However in some deployments, routers can be pre-configured with all potentially available transports, or lacking in dynamic routing protocols to determine if the path to the final destination is available on a given route. As a result, the path selected by the router might effectively black-hole traffic."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/config_service_health"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_service_health" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_service_health" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.21b25f22.css">
<link rel="preload" href="/assets/js/runtime~main.4b0b2d4d.js" as="script">
<link rel="preload" href="/assets/js/main.0b437b3a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Session Smart Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation">Installation Process</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_image">Image-Based Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_quickstart_aws">Cloud Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_upgrade_considerations">Upgrades and Rollback</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_installer">Supporting Install Information - Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_wa_quickstart_1_networks">WAN Assurance Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/wan_overview">WAN Assurance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/config_basics">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/config_basics">Configuration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_basics">Configuration Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_templates">Configuration Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_asset_connection_resiliency">Asset Connection Resiliency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dscp_steering">Configuring DSCP Steering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dscp_preservation">DSCP Preservation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_vrf_learning">VRF Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_audit_event">Audit Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dhcp">DHCP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_forward_error_correction">Configuring Forward Error Correction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_management_over_forwarding">Management over Forwarding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_domain-based_web_filter">Web Filtering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_app_ident">Application Identification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_EthoSVR">Configuring Ethernet Over Secure Vector Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_EthoSVR_activestandby">Configuring Ethernet Over SVR for Active/Standby</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_flow_perf_mon">Inline Flow Performance Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_gre_tunnel">Native GRE Tunnels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_in-memory_metrics">In-Memory Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_nat">NAT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_rate_limiting">Rate Limiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_RBAC">Configuring Role-Based Access Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/config_service_health">Service Health Learning and Fault Avoidance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp">SNMP - Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/howto_config_snmp">SNMP - Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_static_hostname_mapping">Static Hostname Mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_tenants">Tenants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_transport_encryption">Transport Based Encryption</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/howto_tune_bfd">Optimizing Routing Protocols</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_ha">High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_access_mgmt">Access Management and Authentication</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_ntp_auth">NTP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/sec_adaptive_encrypt">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/concepts_ssr_idp">Intrusion Detection and Prevention</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_STEP">Service and Topology Exchange Protocol (STEP)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/how_to_use_app_summary">How To</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/ts_applications">Troubleshooting</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/bcp_att_avpn_configuration">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/release_notes_128t_6.0">Release Notes</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Service Health Learning and Fault Avoidance</h1></header><p>When an interface is operationally down, or ARP requests to the next-hop gateway are not consistently returned, the path in question will be removed from routing decisions. In concert with dynamic routing protocols such as BGP, network software is able to determine the best path to the destination. However in some deployments, routers can be pre-configured with all potentially available transports, or lacking in dynamic routing protocols to determine if the path to the final destination is available on a given route. As a result, the path selected by the router might effectively black-hole traffic.</p><p>A unique advantage of Session Smart Routing is that it can understand patterns and characteristics of the underlying traffic passing through the system. These heuristics can then be leveraged on a number of different parameters in order to make more intelligent routing and load balancing decisions.</p><ul><li>Per Service</li><li>Per Path</li><li>Per transport and application such as TCP, UDP, TLS etc</li><li>Per destination (/32 address only)</li><li>Per traffic-class (high, medium, low, best-effort)</li></ul><p>The Session Smart Router (SSR) collects key performance metrics to assist in making load balancing decisions, such as:</p><ul><li>Number of TCP connection errors</li><li>Number of UDP failures due to ICMP unreachable</li><li>Time to first data packet for TCP and TLS</li></ul><p>Service Health Learning can operate in a detection mode to gather the metrics listed above, and then enforce path selection based on the experienced values.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="detection-mode">Detection Mode<a class="hash-link" href="#detection-mode" title="Direct link to heading">​</a></h2><p>Detection Mode is configured on the service-route, and allows you to gather statistics based on the traffic profiles as described in <a href="/docs/concepts_metrics#session-establishment-metrics">Session Establishment Metrics</a>. This mode defines the criteria the 128T router uses to apply load balancing decisions. Detection mode allows you to visualize the current network and understand the necessary configuration for enforcement.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configure-detection-mode">Configure Detection Mode<a class="hash-link" href="#configure-detection-mode" title="Direct link to heading">​</a></h3><p>Detection Mode is configured per service-route, and gathers statistics using <a href="/docs/concepts_metrics#session-establishment-metrics">Session Establishment Metrics</a>.</p><p>To enable Detection Mode:</p><ol><li>Under Authority, select a router.</li><li>Scroll down to Service Routes.</li><li>Click ADD.</li><li>Enter a Name for the new Service Route, and click SAVE.</li><li>Choose the Service Name.</li><li>Choose the Service Route Type and the Peer (if necessary).</li></ol><p>The following is an example configuration from the PCLI.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router  Fabric128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name           Fabric128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service-route  test-1_intf13_route-0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                    test-1_intf13_route-0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-name            east-0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            next-hop                test-1 intf13</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                node-name   test-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                interface   intf13</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                gateway-ip  172.16.4.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            reachability-detection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                enabled           true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                enforcement       false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Reachability Detection is now enabled and will gather service route information. Configure as many detection settings as necessary to gather information about the network connectivity.
The next step is to set Enforcement Mode parameters for load balancing.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="enforcement-mode">Enforcement Mode<a class="hash-link" href="#enforcement-mode" title="Direct link to heading">​</a></h2><p>In Enforcement Mode, you define a traffic profile using the parameters from Detection Mode to apply criteria that determines the health of a path and subsequent selection by the load balancer.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configure-enforcement-mode">Configure Enforcement Mode<a class="hash-link" href="#configure-enforcement-mode" title="Direct link to heading">​</a></h3><p>It is easiest to use the Service Routes configured in Detection Mode and simply enable Reachability Detection Enforcement.</p><ol><li>Under Authority, select a Router.</li><li>Scroll down to Service Routes.</li><li>Select the Service Route.</li><li>Under Reachability Detection Settings, enable Reachability Detection Enforcement.</li><li>Define the Enforcement Detection Window (time). The <code>detection-window</code> (default 5s) determines how often the stats will be aggregated in terms of min, max, and median.</li><li>Define an Enforcement Hold-Down time. This determines how long the path stays down upon determining it is unusable.</li><li>To use a probe to determine service health, configure the <code>probe-type</code> as <code>always</code>. To use only organic traffic to determine service health, set the <code>probe-type</code> to <code>disabled</code>.</li><li>If you have previously configured a Reachability Profile, select the appropriate profile. If there is no existing Reachability Detection Profile, use the procedure below.</li><li>Scroll to Reachability Detection Enforcement Probes and click ADD.</li><li>Enter a name for the probe and click SAVE.</li><li>In the Probe Type window, select a probe type from the drop-down. The default probe type is an ICMP probe.</li><li>Click Validate, and then Commit.</li></ol><p>The following is an example Enforcement configuration with a Reachability Profile entered from the PCLI.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router  Fabric128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name                  Fabric128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        reachability-profile  profile-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name      profile-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol  tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol-type  tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                traffic-class  high</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    traffic-class-id            high</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled                     true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    acceptable-error-threshold  50</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    time-to-establishment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        enabled  true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        max      500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        mean     250</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol  udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol-type  udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                traffic-class  high</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    traffic-class-id            high</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled                     true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    acceptable-error-threshold  50</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    time-to-establishment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        enabled  true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        max      500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        mean     250</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service-route  test-1_intf13_route-0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name                    test-1_intf13_route-0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-name            east-0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            next-hop                test-1 intf13</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                node-name   test-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                interface   intf13</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                gateway-ip  172.16.4.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            reachability-detection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                enabled               true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                enforcement           true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                detection-window      10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                hold-down             60</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                reachability-profile  profile-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                probe-type            always</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                probe                 foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name                foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled             true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    icmp-probe-profile  icmp-profile-0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="creating-a-reachability-detection-profile">Creating a Reachability Detection Profile<a class="hash-link" href="#creating-a-reachability-detection-profile" title="Direct link to heading">​</a></h3><p>Defining a reachability detection profile (<code>reachability-detection-profile</code>) allows you to define the criteria around determining the health of a path. </p><ol><li>Go to the Router level (up one level).</li><li>Scroll down to Reachability Profile, and click ADD.</li><li>Under Protocol, click ADD.</li><li>Select the Protocol type from the drop-down (tcp, tls, udp) and click SAVE.</li><li>Under the protocol class label, click ADD.</li><li>Select a traffic class ID and click SAVE. The traffic-class configuration allows you to configure different treatments for different classes of traffic for the same service.</li><li>In the Acceptable Error Threshold field, set the threshold.</li><li>In the <code>time-to-establishment.label</code> field, set Enabled to true. Define the max and mean times as necessary. This configures the time allowed to establish a session for the protocol.</li><li>Return to the Router level.</li><li>Select the Service Route where the Enforcement settings will be in affect.</li><li>Scroll down to Reachability Detection settings. In the Reachability Detection Enforcement Profile select the Reachability Profile you just created.</li><li>Click Validate, and then Commit.</li></ol><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        reachability-detection-profile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name    profile1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                traffic-class high</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    acceptable-error-threshold    5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    time-to-establishment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        max       100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        mean          50</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                traffic-class best-effort</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    acceptable-error-threshold    10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    time-to-establishment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        max       500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        mean          250</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                acceptable-error-threshold    20</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                time-to-establishment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled    false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>reachability-detection-profile</code> allows the user to configure enforcement parameters for tcp, udp and tls.</li><li><code>traffic-class</code> allows the user to configure different treatments for different classes of traffic for the same service. The same default values (as described below) apply to all the classes.</li><li><code>acceptable-error-threshold</code> (expressed in percentage) is the amount of errors acceptable on the path before taking it offline. For TCP, this includes the session closed before establishment, any ICMP error that constitutes destination unreachable, and session timeout before establishment. For UDP, this includes the destination unreachable class of ICMP errors.</li><li><code>time-to-establishment</code> allows the user to configure a max and a mean time for a session to be established as defined for the protocol within the configured detection-window. The following table describes the default values.</li></ul><table><thead><tr><th>Config</th><th>Type</th><th>Default Value</th><th>How to disable?</th></tr></thead><tbody><tr><td>acceptable-error-threshold</td><td>percentage</td><td>25%</td><td>0%</td></tr><tr><td>traffic-class</td><td></td><td></td><td></td></tr><tr><td>enabled</td><td>boolean</td><td>true</td><td>false</td></tr><tr><td>time-to-establishment</td><td></td><td></td><td></td></tr><tr><td>- enabled</td><td>boolean</td><td>true</td><td>false</td></tr><tr><td>- max</td><td>milliseconds</td><td>500 ms</td><td>0 ms</td></tr><tr><td>- mean</td><td>milliseconds</td><td>250 ms</td><td>0 ms</td></tr></tbody></table><p>If a profile is configured with no values specified, the defaults listed above are enforced. To turn off the specific enforcement, use the disable value shown above.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="health-probes">Health Probes<a class="hash-link" href="#health-probes" title="Direct link to heading">​</a></h3><p>An ICMP probe, as described below is built into the system, providing the health probe method. Other application specific probes (<a href="/docs/plugin_http_probe">HTTP, TLS</a>, SIP, etc.) are made possible with external plugins utilizing the REST API added for this feature. The two main aspects are:</p><ul><li>Load-balancer API to declare select paths as down</li><li>Mechanism to report activity or inactivity over a path to an external application</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="health-probes-rest-api">Health Probes REST API<a class="hash-link" href="#health-probes-rest-api" title="Direct link to heading">​</a></h4><p>The reachability manager provides a REST API for setting, getting, and deleting probe state. Note that the state is cleared when the probe-type becomes disabled.</p><p>If any probe sets state to down for the service-path, the path is marked as down. The path may still periodically become up to allow organic traffic for one interval as it exits the hold-down period. This can be seen through the <code>show service-path</code> command.</p><p>For the REST API, either (service-route + service) or (network-interface) must be given. Network-interface may map to more than one service-route. One service-route may map to multiple service-paths.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="icmp-probe">ICMP Probe<a class="hash-link" href="#icmp-probe" title="Direct link to heading">​</a></h3><p>The default probe is an ICMP based health probe to detect the liveliness of the remote endpoint. Below is a sample config:</p><p>The probe-name for the REST API is <code>128T-icmp-probe</code>.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">icmp-probe-profile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name                     icmp-profile1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    probe-interval      10s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    number-of-attempts      5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    probe-duration      1s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    probe-address             8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    probe-address             9.9.9.9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sla-metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        max-loss    10%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        latency</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            max 200ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            mean    50ms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The following table describes the configuration values above:</p><table><thead><tr><th>Config</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>router &gt; icmp-probe-profile</td><td></td><td></td><td></td></tr><tr><td>name</td><td>string</td><td>key</td><td>Unique name to identify an ICMP probe profile</td></tr><tr><td>probe-interval</td><td>uint32 (seconds) range: 1-3600</td><td>default: 10</td><td>Duration (in seconds) of how often to perform a link test to the destination.</td></tr><tr><td>number-of-attempts</td><td>uint8 range: 1-20</td><td>default: 4</td><td>Number of consecutive ICMP ping requests to be sent within the probe-duration before deciding that destination is unreachable.</td></tr><tr><td>probe-duration</td><td>uint8 (seconds) range: 1-10</td><td>default: 1</td><td>Duration (in seconds) within which to reach the destination. Each attempt will be made in probe-duration / number-of-attempts interval.</td></tr><tr><td>sla-metrics</td><td></td><td></td><td></td></tr><tr><td>max-loss</td><td>uint8 (percent)</td><td>default: 10%</td><td>The amount of acceptable loss on the link. The loss will be determined by sending number-of-attempts ICMP requests and waiting the probe-duration to get the replies back.</td></tr><tr><td>latency &gt; max</td><td>milliseconds</td><td>default: 250</td><td>Maximum acceptable latency based on the ping test.</td></tr><tr><td>latency &gt; mean</td><td>milliseconds</td><td>default: 100</td><td>The average latency on a path based on the ping test.</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_y2LR" id="troubleshooting-the-icmp-probe-profile">Troubleshooting the ICMP Probe Profile<a class="hash-link" href="#troubleshooting-the-icmp-probe-profile" title="Direct link to heading">​</a></h4><p>If any of the addresses listed in the profile do not meet the SLA requirements, all service-routes referencing this profile are marked as down.</p><p>Stats are available for number of failed-to-send, response-timeout, and ping success in total, and for ping exceeded-by-max-loss, exceeded-by-max-latency, and exceeded-by-mean-latency.</p><p>Ping state will be detected for each unique combination of probe-profile, service-name, and tenant.</p><p>If an ICMP probe fails to send requests, the PCLI ping command and highway logs can be used to debug. If <code>ping node &lt;node-name&gt; egress-interface &lt;intf-name&gt; gateway &lt;gateway-ip&gt; &lt;address&gt;</code> succeeds where the node and egress-interface match the service-route next-hop and the gateway is from the routing FIB or the interface gateway, then the ICMP probe will be able to send a ping.</p><p>Probe-interval and probe-duration should be tuned so that probe-interval + probe-duration is less than the detection-window, allowing the ping to run to completion within the detection window. If the ping interval is longer, when the path is declared down, is held-down, and is brought up for one window, the probe may say the path is down and the service-path will be brought down again, bouncing the path repeatedly.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="custom-health-probe-plugins">Custom Health Probe Plugins<a class="hash-link" href="#custom-health-probe-plugins" title="Direct link to heading">​</a></h3><p>The extensibility APIs described above enable plugins to be developed for performing additional probes using TCP, <a href="/docs/plugin_http_probe">TLS, HTTP</a>, SIP etc. The plugin workflow for these types of probes would be as follows:</p><ul><li>Augment the service-route &gt; reachability-detection &gt; probe choice statement to plugin specific probe configuration. In general, there is no restriction enforced on what and how many plugins run a reachability check in parallel.</li><li>The probe plugin operates independently to determine if the path is up or down. Based on the specific business logic, the plugin triggers the path down using the load balancer APIs.</li><li>The probe plugin uses the probe-status REST API to set service-paths up or down.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="tracking-behavior">Tracking Behavior<a class="hash-link" href="#tracking-behavior" title="Direct link to heading">​</a></h3><p>The algorithm for tracking errors, establishment times, etc. is run on a per-service, per-path and per-traffic-class basis. In addition, the following destination address are also tracked:</p><ul><li>Any fully qualified address (/32 for IPv4 and /128 for IPv6) configured in service &gt; address is tracked for the above metrics.</li><li>When there is a service-route &gt; nat-target or service-route &gt; next-hop &gt; target-address configured, they are tracked for the metrics above.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="load-balancer-behavior">Load Balancer Behavior<a class="hash-link" href="#load-balancer-behavior" title="Direct link to heading">​</a></h3><p>An algorithm is used to flag and recover path failures.</p><ul><li>The enforcement algorithm calculates the health of each path based on the profile at the configured detection interval.</li><li>When any of the configured thresholds are exceeded, the path is flagged as unusable. The first test to fail causes the path to be taken out of consideration from the load balancer.</li><li>Once the path is deemed to be not healthy: The subsequent sessions are used for routing. In the event that none of the paths are healthy, the best-effort algorithm picks one of the paths for routing sessions. This can be disabled by turning off best-effort configuration in the service-policy.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>When a path becomes unavailable, all the existing sessions continue to be routed over this path. Since this is non-SVR, changing a destination or path might have unintended consequences.</p></div></div><p>The path is kept down for the configured hold-down time before being put back in service. At that time, the tracking and enforcement algorithm restarts.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h2><p>If the value of the threshold or window is too small, the link will go in and out of service. If this is the case, adjust the threshold value in the configuration.</p><p>Alarms and events:</p><ul><li>During enforcement mode, if a path is taken out of service for a given service, protocol, or traffic class, an alarm is generated to indicate the event. The alarm is cleared when the path is put back in service.</li></ul><p>Show commands:</p><ul><li><code>show stats</code> command can be used for capturing the “current” snapshot of the relevant stats.<ul><li>For the icmp-probe use <code>show stats icmp reachability-probe</code></li></ul></li><li>The Meets-SLA field has been added to the <code>show load-balancer</code> command to indicate the result of the reachability detection.</li></ul><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">======== ========= ====== ======= ====== ========= ======== ===== ===========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Type   Quality   Cost   State   Loss   Latency   Jitter   Mos   Meets-SLA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======== ========= ====== ======= ====== ========= ======== ===== ===========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> router         0    N/A      up   0.7%     250ms    100ms   2.0         Yes</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>The <code>show service-path detail</code> output indicates when a non-SVR path is no longer in-service and why.
Two fields have been added to the show command: Meets-SLA and Reachability-Probes. Meets-SLA indicates if a service agent meets or satisfies SLA as a result of reachability detection. Reachability-Probes shows the probes status from reachability detection.</li></ul><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">show service-path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==============</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Service: web</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==============</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Service-Route:    web-route1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type:                    service-agent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Destination:         4.4.4.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Next-Hop:            1.1.1.3, Lan(Down)[Gateway Arp unresolved)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Peer:                    unavailable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Path-Metrics:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     High</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         TCP:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         TLS:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         UDP:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         ICMP: latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Medium</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         TCP:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         TLS:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         UDP:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         ICMP: latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Low</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         TCP:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         TLS:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         UDP:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         ICMP: latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Best-Effort</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         TCP:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         TLS:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         UDP:  latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         ICMP: latency [0ms] loss [0] jitter [0ms]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Vector:                   Red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Cost:                      10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Rate:                      1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Capacity:               200/3000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Index:                    18</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Meets-SLA:           Yes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Reachability-Probes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               TestProbe1: Up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               TestProbe2: Down</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-09-20T14:35:30.000Z">9/20/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/config_RBAC"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configuring Role-Based Access Control</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/config_snmp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SNMP - Overview</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#detection-mode" class="table-of-contents__link toc-highlight">Detection Mode</a><ul><li><a href="#configure-detection-mode" class="table-of-contents__link toc-highlight">Configure Detection Mode</a></li></ul></li><li><a href="#enforcement-mode" class="table-of-contents__link toc-highlight">Enforcement Mode</a><ul><li><a href="#configure-enforcement-mode" class="table-of-contents__link toc-highlight">Configure Enforcement Mode</a></li><li><a href="#creating-a-reachability-detection-profile" class="table-of-contents__link toc-highlight">Creating a Reachability Detection Profile</a></li><li><a href="#health-probes" class="table-of-contents__link toc-highlight">Health Probes</a></li><li><a href="#icmp-probe" class="table-of-contents__link toc-highlight">ICMP Probe</a></li><li><a href="#custom-health-probe-plugins" class="table-of-contents__link toc-highlight">Custom Health Probe Plugins</a></li><li><a href="#tracking-behavior" class="table-of-contents__link toc-highlight">Tracking Behavior</a></li><li><a href="#load-balancer-behavior" class="table-of-contents__link toc-highlight">Load Balancer Behavior</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4b0b2d4d.js"></script>
<script src="/assets/js/main.0b437b3a.js"></script>
</body>
</html>