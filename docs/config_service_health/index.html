<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="128T Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="128T Docs Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-167298415-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="128T Docs" href="/opensearch.xml"><title data-react-helmet="true">Service Health Learning and Fault Avoidance | 128T Docs</title><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/config_service_health"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Service Health Learning and Fault Avoidance | 128T Docs"><meta data-react-helmet="true" name="description" content="When an interface is operationally down, or ARP requests to the next-hop gateway are not consistently returned, the path in question will be removed from routing decisions. In concert with dynamic routing protocols such as BGP, network software is able to determine the best path to the destination. However in some deployments, routers can be pre-configured with all potentially available transports, or lacking in dynamic routing protocols to determine if the path to the final destination is available on a given route. As a result, the path selected by the router might effectively black-hole traffic."><meta data-react-helmet="true" property="og:description" content="When an interface is operationally down, or ARP requests to the next-hop gateway are not consistently returned, the path in question will be removed from routing decisions. In concert with dynamic routing protocols such as BGP, network software is able to determine the best path to the destination. However in some deployments, routers can be pre-configured with all potentially available transports, or lacking in dynamic routing protocols to determine if the path to the final destination is available on a given route. As a result, the path selected by the router might effectively black-hole traffic."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/config_service_health"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_service_health" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_service_health" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b920482b.css">
<link rel="preload" href="/assets/js/runtime~main.1227ff50.js" as="script">
<link rel="preload" href="/assets/js/main.6fb9b052.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Session Smart</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Interchange</a><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Session Smart</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Docs</a></li><li class="menu__list-item"><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="menu__link">Interchange</a></li><li class="menu__list-item"><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="menu__link">Company</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_128t">128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_svr_savings">Secure Vector Routing Savings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_releases">SSR Releases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_support_policy">Software Support Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_supported_platforms">Platform Support Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_supported_drivers">Supported NICs and Drivers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_certified_platforms">Certified Plus Platforms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_security_policy">Security Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_services_description">Services Description</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/CONTRIBUTING">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_getting_started">Getting Started with the 128T Networking Platform</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Considerations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_system_reqs">System Requirements</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installation Process</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation">Installation Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_downloading_iso">Downloading ISOs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_creating_bootable_usb">Creating Bootable USB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_bootable_media">Conductor Interactive Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_basic_conductor_config">Configure the Conductor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_basic_router_config">Basic Router Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_otp_iso_install">Router Installation Using OTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_install_quickstart_otpiso">QuickStart from the OTP ISO</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Cloud Installations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_aws">Installing from the AWS Marketplace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_quickstart_aws">QuickStart Installation in AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_azure">Installing in Azure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_initialize_HA_conductor">Conductor High Availability for Cloud Deployments</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Supporting Information - Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_installer">Manually Installing the 128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/legacy_OTP_install">Installing Using the Pre-5.0 Interactive ISO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_upgrade_considerations">Upgrade Considerations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_upgrading">Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_rollback">Rollback</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_application_discovery">Application Discovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_appid">Application Identification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_EthOverSVR">Ethernet Over Secure Vector Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_ha_theoryofoperation">HA - Theory of Operation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_interface_types">Interface Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_kni">Kernel Network Interfaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_linux_host_networking">Linux Host Networking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_learning_VRF_routes">Learning VRF Routes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_network_planes">Forwarding Planes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_metadata">128T Metadata</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_machine_communication">Machine Communication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_pcli">PCLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_session_timer">Session Timers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_STEP">Service and Topology Exchange Protocol (STEP)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_waypoint_ports">Waypoints</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_glossary">Data Model</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_basics">Configuration Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_access_mgmt">Access Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_asset_connection_resiliency">Asset Connection Resiliency</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_bgp">Configuring BGP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ospf">OSPF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dscp_steering">Configuring DSCP Steering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_vrf_learning">VRF Learning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_reference_guide">Element Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_audit_event">Audit Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dhcp">DHCP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ldap">LDAP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_management_over_forwarding">Management over Forwarding</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_domain-based_web_filter">Configuring Domain-based Web Filtering/Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_EthoSVR">Configuring Ethernet Over Secure Vector Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_flow_perf_mon">Inline Flow Performance Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_gre_tunnel">Native GRE Tunnels</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_in-memory_metrics">In-Memory Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_nat">NAT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_rate_limiting">Rate Limiting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_RBAC">Configuring Role-Based Access Control</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/config_service_health">Service Health Learning and Fault Avoidance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp">SNMP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_static_hostname_mapping">Static Hostname Mappings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_STEP">Configuring Service and Topology Exchange Protocol (STEP)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_tenants">Tenants</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_templates">Configuration Templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_transport_encryption">Transport Based Encryption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_wan_assurance">Configuring WAN Assurance</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">High Availability</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_ha">Dual Node High Availability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_dual_router_ha">Dual Router High Availability using iBGP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_ha_vrrp">Dual Router High Availability and VRRP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_non_forwarding_ha_interfaces">Non-forwarding HA Interfaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_adding_interfaces_to_ha_team">Adding Interfaces to HA Team Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_transition_standalone_to_ha">Transitioning a Conductor from Standalone to HA</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sec_adaptive_encrypt">Adaptive Encryption</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">How To</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_conductor_migration">Conductor Migration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_extend_gui_nav">Extending GUI Nav</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_lte">LTE and Dual LTE Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_config_PPPoE">Configuring Dual PPPoE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_maintenance_mode">Maintenance Mode</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_ms365">Microsoft 365</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_trusted_ca_certificate">Adding a Trusted Certificate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_tune_bfd">Tuning BFD</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_applications">Application Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_ap_duplicate_assets">AP: Duplicate Asset ID Error</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_ap_salt_minion">AP: Salt Minion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_cpu_spikes">CPU Spikes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_forwarding_resource_pools">Forwarding Plane Resource Pools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_logs">Logs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_mac_uniqueness">MAC Address Uniqueness</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_packet_capture">Packet Capture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_t1_troubleshooting">T1 Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_troubleshooting_vrf">Troubleshooting VRF</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_overview">Alarm and Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_alarms">Alarms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_events">Events</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_att_avpn_configuration">AT&amp;T AVPN Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_using_128T_as_ntp_server">Branch NTP Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_conductor_deployment">Conductor Deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_per-adjacency_traffic_engineering">Per Adjacency Traffic Engineering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_qos_msft_expressroute">ExpressRoute QoS Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_lte_peering">LTE Peering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_monitoring_headends">Monitoring Head End Routers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_salt_pillars">Saltstack at Scale With 128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_sdwan_design_guide">SD-WAN Design Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_service_and_service_policy_design">Service and Service Policy Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_service-policy_defaults">Service Policy Baseline Defaults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_tenants">Tenancy Design</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLI Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli_reference">Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli_stats_reference">Show Stats Reference</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installer/Initializer Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installer_cli_reference">Installer Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installer_preferences">Installer Preferences File Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/initializer_cli_reference">Initializer Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/initializer_preferences">Initializer Preferences File Reference</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_aws_tgw_connect">AWS Transit Gateway Connect</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_bgp_community_services">BGP Community Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_cloud_ha">Cloud HA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_dns_app_id">DNS App Id</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_dns_cache">DNS Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_gre">GRE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_ha_sync_redundancy">HA Sync Redundancy Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_http_probe">HTTP Probe Reachability Detection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_icmp_reachability_detection">ICMP Reachability Detection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_ipsec_client">IPsec Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_loopback_static_routes">Loopback Static Routes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_m800_watchdog">M800 Watchdog</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_monitoring_agent">Monitoring Agent</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_mosh">Mosh</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_set_hostname">Set Hostname</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_sip_alg">SIP ALG</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_wireguard">Wireguard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_kni_namespace_scripts">KNI Namespace Scripts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">REST APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api_rest_4.2.0">128T-4.2.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">SSR</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.4">5.4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.3">5.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.2">5.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.1">5.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.0">5.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.5">4.5</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.4">4.4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.3">4.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.2">4.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.1">4.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.0">4.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">SSR Installer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_3.1">3.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_3.0">3.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.7">2.7</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.6">2.6</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.5">2.5</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.4">2.4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.3">2.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.2">2.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.1">2.1</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Service Health Learning and Fault Avoidance</h1></header><div class="markdown"><p>When an interface is operationally down, or ARP requests to the next-hop gateway are not consistently returned, the path in question will be removed from routing decisions. In concert with dynamic routing protocols such as BGP, network software is able to determine the best path to the destination. However in some deployments, routers can be pre-configured with all potentially available transports, or lacking in dynamic routing protocols to determine if the path to the final destination is available on a given route. As a result, the path selected by the router might effectively black-hole traffic.</p><p>A unique advantage of Session Smart Routing is that it can understand patterns and characteristics of the underlying traffic passing through the system. These heuristics can then be leveraged on a number of different parameters in order to make more intelligent routing and load balancing decisions.</p><ul><li>Per Service</li><li>Per Path</li><li>Per transport and application such as TCP, UDP, TLS etc</li><li>Per destination (/32 address only)</li><li>Per traffic-class (high, medium, low, best-effort)</li></ul><p>The Session Smart Router (SSR) collects key performance metrics to assist in making load balancing decisions, such as:</p><ul><li>Number of TCP connection errors</li><li>Number of UDP failures due to ICMP unreachable</li><li>Time to first data packet for TCP and TLS</li></ul><p>Service Health Learning can operate in a detection mode to gather the metrics listed above, and then enforce path selection based on the experienced values.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="detection-mode"></a>Detection Mode<a class="hash-link" href="#detection-mode" title="Direct link to heading">#</a></h2><p>Detection Mode is configured on the service-route, and allows you to gather statistics based on the traffic profiles as described in <a href="/docs/concepts_metrics#session-establishment-metrics">Session Establishment Metrics</a>. This mode defines the criteria the 128T router uses to apply load balancing decisions. Detection mode allows you to visualize the current network and understand the necessary configuration for enforcement.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="configure-detection-mode"></a>Configure Detection Mode<a class="hash-link" href="#configure-detection-mode" title="Direct link to heading">#</a></h3><p>Detection Mode is configured per service-route, and gathers statistics using <a href="/docs/concepts_metrics#session-establishment-metrics">Session Establishment Metrics</a>.</p><p>To enable Detection Mode:</p><ol><li>Under Authority, select a router.</li><li>Scroll down to Service Routes.</li><li>Click ADD.</li><li>Enter a Name for the new Service Route, and click SAVE.</li><li>Choose the Service Name.</li><li>Choose the Service Route Type and the Peer (if necessary).</li></ol><p>The following is an example configuration from the PCLI.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><div tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    router  Fabric128</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name           Fabric128</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-route  test-1_intf13_route-0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                    test-1_intf13_route-0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-name            east-0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            next-hop                test-1 intf13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                node-name   test-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                interface   intf13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                gateway-ip  172.16.4.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            reachability-detection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                enabled           true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                enforcement       false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Reachability Detection is now enabled and will gather service route information. Configure as many detection settings as necessary to gather information about the network connectivity.
The next step is to set Enforcement Mode parameters for load balancing.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="enforcement-mode"></a>Enforcement Mode<a class="hash-link" href="#enforcement-mode" title="Direct link to heading">#</a></h2><p>In Enforcement Mode, you define a traffic profile using the parameters from Detection Mode to apply criteria that determines the health of a path and subsequent selection by the load balancer.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="configure-enforcement-mode"></a>Configure Enforcement Mode<a class="hash-link" href="#configure-enforcement-mode" title="Direct link to heading">#</a></h3><p>It is easiest to use the Service Routes configured in Detection Mode and simply enable Reachability Detection Enforcement.</p><ol><li>Under Authority, select a Router.</li><li>Scroll down to Service Routes.</li><li>Select the Service Route.</li><li>Under Reachability Detection Settings, enable Reachability Detection Enforcement.</li><li>Define the Enforcement Detection Window (time). The <code>detection-window</code> (default 5s) determines how often the stats will be aggregated in terms of min, max, and median.</li><li>Define an Enforcement Hold-Down time. This determines how long the path stays down upon determining it is unusable.</li><li>If you have previously configured a Reachability Profile, select the appropriate profile. If there is no existing Reachability Detection Profile, use the procedure below.</li><li>Scroll to Reachability Detection Enforcement Probes and click ADD.</li><li>Enter a name for the probe and click SAVE.</li><li>In the Probe Type window, select a probe type from the drop-down. The default probe type is an ICMP probe.</li><li>Click Validate, and then Commit.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="creating-a-reachability-detection-profile"></a>Creating a Reachability Detection Profile<a class="hash-link" href="#creating-a-reachability-detection-profile" title="Direct link to heading">#</a></h4><ol><li>Go to the Router level (up one level).</li><li>Scroll down to Reachability Profile, and click ADD.</li><li>Under Protocol, click ADD.</li><li>Select the Protocol type from the drop-down (tcp, tls, udp) and click SAVE.</li><li>Under the protocol class label, click ADD.</li><li>Select a traffic class ID and click SAVE. The traffic-class configuration allows you to configure different treatments for different classes of traffic for the same service.</li><li>In the Acceptable Error Threshold field, set the threshold.</li><li>In the <code>time-to-establishment.label</code> field, set Enabled to true. Define the max and mean times as necessary. This configures the time allowed to establish a session for the protocol.</li><li>Return to the Router level.</li><li>Select the Service Route where the Enforcement settings will be in affect.</li><li>Scroll down to Reachability Detection settings. In the Reachability Detection Enforcement Profile select the Reachability Profile you just created.</li><li>Click Validate, and then Commit.</li></ol><p>The following is an example Enforcement configuration with a Reachability Profile entered from the PCLI.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><div tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    router  Fabric128</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name                  Fabric128</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        reachability-profile  profile-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name      profile-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol  tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol-type  tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                traffic-class  high</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    traffic-class-id            high</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled                     true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    acceptable-error-threshold  50</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    time-to-establishment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        enabled  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        max      500</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        mean     250</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol  udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol-type  udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                traffic-class  high</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    traffic-class-id            high</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled                     true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    acceptable-error-threshold  50</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    time-to-establishment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        enabled  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        max      500</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        mean     250</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-route  test-1_intf13_route-0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                    test-1_intf13_route-0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-name            east-0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            next-hop                test-1 intf13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                node-name   test-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                interface   intf13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                gateway-ip  172.16.4.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            reachability-detection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                enabled               true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                enforcement           true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                detection-window      10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                hold-down             60</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                reachability-profile  profile-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                probe-type            always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    probe               foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name                foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        enabled             true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        icmp-probe-profile  icmp-profile-0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="traffic-profile"></a>Traffic Profile<a class="hash-link" href="#traffic-profile" title="Direct link to heading">#</a></h3><p>When a traffic profile is configured, it allows for the enforcement of path characteristics.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><div tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">router &gt; traffic-profile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name    profile1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    protocol tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          protocol tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          traffic-class high</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              traffic-class high</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              enabled true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              acceptable-error-threshold    5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              time-to-establishment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                max       100</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                mean          50</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          traffic-class best-effort</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              traffic-class best-effort</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              enabled true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              acceptable-error-threshold    10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              time-to-establishment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    enabled true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                max       500</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                mean          250</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    protocol udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          protocol udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          acceptable-error-threshold    20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          time-to-establishment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         enabled    false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><ul><li><code>traffic-profile</code> allows the user to configure enforcement parameters for tcp, udp and tls.</li><li><code>traffic-class</code> allows the user to configure different treatments for different classes of traffic for the same service. The same default values (as described below) apply to all the classes.</li><li><code>acceptable-error-threshold</code> (expressed in percentage) is the amount of errors acceptable on the path before taking it offline. For TCP, this includes the session closed before establishment, any ICMP error that constitutes destination unreachable, and session timeout before establishment. For UDP, this includes the destination unreachable class of ICMP errors.</li><li><code>time-to-establishment</code> allows the user to configure a max and a mean time for a session to be established as defined for the protocol within the configured detection-window. The following table describes the default values.</li></ul><table><thead><tr><th>Config</th><th>Type</th><th>Default Value</th><th>How to disable?</th></tr></thead><tbody><tr><td>acceptable-error-threshold</td><td>percentage</td><td>25%</td><td>0%</td></tr><tr><td>traffic-class</td><td></td><td></td><td></td></tr><tr><td>enabled</td><td>boolean</td><td>true</td><td>false</td></tr><tr><td>time-to-establishment</td><td></td><td></td><td></td></tr><tr><td>- enabled</td><td>boolean</td><td>true</td><td>false</td></tr><tr><td>- max</td><td>milliseconds</td><td>500 ms</td><td>0 ms</td></tr><tr><td>- mean</td><td>milliseconds</td><td>250 ms</td><td>0 ms</td></tr></tbody></table><p>Once a profile is configured, the above defaults are enforced. To turn off the specific enforcement, configure an appropriate value as listed above.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="health-probes"></a>Health Probes<a class="hash-link" href="#health-probes" title="Direct link to heading">#</a></h3><p>An ICMP probe, as described below is built into the system, providing the health probe method. Other application specific probes (<a href="/docs/plugin_http_probe">HTTP, TLS</a>, SIP, etc.) are made possible with external plugins utilizing the REST API added for this feature. The two main aspects are:</p><ul><li>Load-balancer API to declare select paths as down</li><li>Mechanism to report activity or inactivity over a path to an external application</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="health-probes-rest-api"></a>Health Probes REST API<a class="hash-link" href="#health-probes-rest-api" title="Direct link to heading">#</a></h4><p>The reachability manager provides a REST API for setting, getting, and deleting probe state. Note that the state is cleared when the probe-type becomes disabled.</p><p>If any probe sets state to down for the service-path, the path is marked as down. The path may still periodically become up to allow organic traffic for one interval as it exits the hold-down period. This can be seen through the <code>show service-path</code> command.</p><p>For the REST API, either (service-route + service) or (network-interface) must be given. Network-interface may map to more than one service-route. One service-route may map to multiple service-paths.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="icmp-probe"></a>ICMP Probe<a class="hash-link" href="#icmp-probe" title="Direct link to heading">#</a></h3><p>The default probe is an ICMP based health probe to detect the liveliness of the remote endpoint. Below is a sample config:</p><p>The probe-name for the REST API is <code>128T-icmp-probe</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><div tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">icmp-probe-profile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name                     icmp-profile1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    probe-interval      10s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    number-of-attempts      5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    probe-duration      1s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    probe-address             8.8.8.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    probe-address             9.9.9.9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sla-metrics</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        max-loss    10%</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        latency</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max 200ms</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            mean    50ms</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The following table describes the configuration values above:</p><table><thead><tr><th>Config</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>router &gt; icmp-probe-profile</td><td></td><td></td><td></td></tr><tr><td>name</td><td>string</td><td>key</td><td>Unique name to identify an ICMP probe profile</td></tr><tr><td>probe-interval</td><td>uint32 (seconds) range: 1-3600</td><td>default: 10</td><td>Duration (in seconds) of how often to perform a link test to the destination.</td></tr><tr><td>number-of-attempts</td><td>uint8 range: 1-20</td><td>default: 4</td><td>Number of consecutive ICMP ping requests to be sent within the probe-duration before deciding that destination is unreachable.</td></tr><tr><td>probe-duration</td><td>uint8 (seconds) range: 1-10</td><td>default: 1</td><td>Duration (in seconds) within which to reach the destination. Each attempt will be made in probe-duration / number-of-attempts interval.</td></tr><tr><td>sla-metrics</td><td></td><td></td><td></td></tr><tr><td>max-loss</td><td>uint8 (percent)</td><td>default: 10%</td><td>The amount of acceptable loss on the link. The loss will be determined by sending number-of-attempts ICMP requests and waiting the probe-duration to get the replies back.</td></tr><tr><td>latency &gt; max</td><td>milliseconds</td><td>default: 250</td><td>Maximum acceptable latency based on the ping test.</td></tr><tr><td>latency &gt; mean</td><td>milliseconds</td><td>default: 100</td><td>The average latency on a path based on the ping test.</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="troubleshooting-the-icmp-probe-profile"></a>Troubleshooting the ICMP Probe Profile<a class="hash-link" href="#troubleshooting-the-icmp-probe-profile" title="Direct link to heading">#</a></h4><p>If any of the addresses listed in the profile do not meet the SLA requirements, all service-routes referencing this profile are marked as down.</p><p>Stats are available for number of failed-to-send, response-timeout, and ping success in total, and for ping exceeded-by-max-loss, exceeded-by-max-latency, and exceeded-by-mean-latency.</p><p>Ping state will be detected for each unique combination of probe-profile, service-name, and tenant.</p><p>If an ICMP probe fails to send requests, the PCLI ping command and highway logs can be used to debug. If <code>ping node &lt;node-name&gt; egress-interface &lt;intf-name&gt; gateway &lt;gateway-ip&gt; &lt;address&gt;</code> succeeds where the node and egress-interface match the service-route next-hop and the gateway is from the routing FIB or the interface gateway, then the ICMP probe will be able to send a ping.</p><p>Probe-interval and probe-duration should be tuned so that probe-interval + probe-duration is less than the detection-window, allowing the ping to run to completion within the detection window. If the ping interval is longer, when the path is declared down, is held-down, and is brought up for one window, the probe may say the path is down and the service-path will be brought down again, bouncing the path repeatedly.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="custom-health-probe-plugins"></a>Custom Health Probe Plugins<a class="hash-link" href="#custom-health-probe-plugins" title="Direct link to heading">#</a></h3><p>The extensibility APIs described above enable plugins to be developed for performing additional probes using TCP, <a href="/docs/plugin_http_probe">TLS, HTTP</a>, SIP etc. The plugin workflow for these types of probes would be as follows:</p><ul><li>Augment the service-route &gt; reachability-detection &gt; probe choice statement to plugin specific probe configuration. In general, there is no restriction enforced on what and how many plugins run a reachability check in parallel.</li><li>The probe plugin operates independently to determine if the path is up or down. Based on the specific business logic, the plugin triggers the path down using the load balancer APIs.</li><li>The probe plugin uses the probe-status REST API to set service-paths up or down.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="tracking-behavior"></a>Tracking Behavior<a class="hash-link" href="#tracking-behavior" title="Direct link to heading">#</a></h3><p>The algorithm for tracking errors, establishment times, etc. is run on a per-service, per-path and per-traffic-class basis. In addition, the following destination address are also tracked:</p><ul><li>Any fully qualified address (/32 for IPv4 and /128 for IPv6) configured in service &gt; address is tracked for the above metrics.</li><li>When there is a service-route &gt; nat-target or service-route &gt; next-hop &gt; target-address configured, they are tracked for the metrics above.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="load-balancer-behavior"></a>Load Balancer Behavior<a class="hash-link" href="#load-balancer-behavior" title="Direct link to heading">#</a></h3><p>An algorithm is used to flag and recover path failures.</p><ul><li>The enforcement algorithm calculates the health of each path based on the profile at the configured detection interval.</li><li>When any of the configured thresholds are exceeded, the path is flagged as unusable. The first test to fail causes the path to be taken out of consideration from the load balancer.</li><li>Once the path is deemed to be not healthy: The subsequent sessions are used for routing. In the event that none of the paths are healthy, the best-effort algorithm picks one of the paths for routing sessions. This can be disabled by turning off best-effort configuration in the service-policy.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>When a path becomes unavailable, all the existing sessions continue to be routed over this path. Since this is non-SVR, changing a destination or path might have unintended consequences.</p></div></div><p>The path is kept down for the configured hold-down time before being put back in service. At that time, the tracking and enforcement algorithm restarts.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="troubleshooting"></a>Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">#</a></h2><p>If the value of the threshold or window is too small, the link will go in and out of service. If this is the case, adjust the threshold value in the configuration.</p><p>Alarms and events:</p><ul><li>During enforcement mode, if a path is taken out of service for a given service, protocol, or traffic class, an alarm is generated to indicate the event. The alarm is cleared when the path is put back in service.</li></ul><p>Show commands:</p><ul><li><code>show stats</code> command can be used for capturing the current snapshot of the relevant stats.<ul><li>For the icmp-probe use <code>show stats icmp reachability-probe</code></li></ul></li><li>The Meets-SLA field has been added to the <code>show load-balancer</code> command to indicate the result of the reachability detection.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><div tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">======== ========= ====== ======= ====== ========= ======== ===== ===========</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Type   Quality   Cost   State   Loss   Latency   Jitter   Mos   Meets-SLA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">======== ========= ====== ======= ====== ========= ======== ===== ===========</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> router         0    N/A      up   0.7%     250ms    100ms   2.0         Yes</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><ul><li>The <code>show service-path detail</code> output indicates when a non-SVR path is no longer in-service and why.
Two fields have been added to the show command: Meets-SLA and Reachability-Probes. Meets-SLA indicates if a service agent meets or satisfies SLA as a result of reachability detection. Reachability-Probes shows the probes status from reachability detection.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><div tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">show service-path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==============</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Service: web</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">==============</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Service-Route:    web-route1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Type:                    service-agent</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Destination:         4.4.4.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Next-Hop:            1.1.1.3, Lan(Down)[Gateway Arp unresolved)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Peer:                    unavailable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Path-Metrics:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     High</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         TCP:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         TLS:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         UDP:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         ICMP: latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Medium</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         TCP:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         TLS:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         UDP:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         ICMP: latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Low</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         TCP:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         TLS:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         UDP:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         ICMP: latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Best-Effort</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         TCP:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         TLS:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         UDP:  latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         ICMP: latency [0ms] loss [0] jitter [0ms]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Vector:                   Red</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Cost:                      10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Rate:                      1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Capacity:               200/3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Index:                    18</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Meets-SLA:           Yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Reachability-Probes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               TestProbe1: Up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               TestProbe2: Down</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2022-01-18T17:27:38.000Z" class="lastUpdatedDate_nN9m">1/18/2022</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/config_RBAC"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label"> Configuring Role-Based Access Control</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/config_snmp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Simple Network Management Protocol (SNMP) </div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#detection-mode" class="table-of-contents__link">Detection Mode</a><ul><li><a href="#configure-detection-mode" class="table-of-contents__link">Configure Detection Mode</a></li></ul></li><li><a href="#enforcement-mode" class="table-of-contents__link">Enforcement Mode</a><ul><li><a href="#configure-enforcement-mode" class="table-of-contents__link">Configure Enforcement Mode</a></li><li><a href="#traffic-profile" class="table-of-contents__link">Traffic Profile</a></li><li><a href="#health-probes" class="table-of-contents__link">Health Probes</a></li><li><a href="#icmp-probe" class="table-of-contents__link">ICMP Probe</a></li><li><a href="#custom-health-probe-plugins" class="table-of-contents__link">Custom Health Probe Plugins</a></li><li><a href="#tracking-behavior" class="table-of-contents__link">Tracking Behavior</a></li><li><a href="#load-balancer-behavior" class="table-of-contents__link">Load Balancer Behavior</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link">Troubleshooting</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright  2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1227ff50.js"></script>
<script src="/assets/js/main.6fb9b052.js"></script>
</body>
</html>