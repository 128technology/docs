<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-167298415-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="128T Docs" href="/opensearch.xml"><title data-react-helmet="true">Configuring Dual Router High Availability | 128T Docs</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Configuring Dual Router High Availability | 128T Docs"><meta data-react-helmet="true" name="description" content="There are several different high availability models possible with the 128T routing software. This document covers dual router high availability, which is when two instances of the 128T software are each configured as separate routers (rather than as two nodes within a single router). This is characterized by:"><meta data-react-helmet="true" property="og:description" content="There are several different high availability models possible with the 128T routing software. This document covers dual router high availability, which is when two instances of the 128T software are each configured as separate routers (rather than as two nodes within a single router). This is characterized by:"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/config_dual_router_ha"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/config_dual_router_ha"><link rel="stylesheet" href="/styles.b64930b1.css">
<link rel="preload" href="/styles.274b9cd0.js" as="script">
<link rel="preload" href="/runtime~main.d46e691e.js" as="script">
<link rel="preload" href="/main.9d6be68d.js" as="script">
<link rel="preload" href="/1.28820cf6.js" as="script">
<link rel="preload" href="/2.f0755fb5.js" as="script">
<link rel="preload" href="/158.70c8d9c4.js" as="script">
<link rel="preload" href="/161.1d1b3184.js" as="script">
<link rel="preload" href="/935f2afb.ece3b60e.js" as="script">
<link rel="preload" href="/17896441.8ac8b297.js" as="script">
<link rel="preload" href="/b1274c58.f9e885a8.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Juniper Logo"><strong class="navbar__title">Session Smart</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Interchange</a><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Juniper Logo"><strong class="navbar__title">Session Smart</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Docs</a></li><li class="menu__list-item"><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="menu__link">Interchange</a></li><li class="menu__list-item"><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="menu__link">Company</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_128t">128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_svr_savings">Secure Vector Routing Savings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_releases">128T Releases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_support_policy">Software Support Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_supported_platforms">Platform Support Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_certified_platforms">Certified Platforms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_security_policy">Security Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_services_description">Services Description</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/CONTRIBUTING">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_getting_started">Getting Started with the 128T Networking Platform</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Considerations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_system_reqs">System Requirements</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installation Process</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation">Installation Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_downloading_iso">Downloading ISOs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_creating_bootable_usb">Creating Bootable USB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_bootable_media">Conductor Interactive Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_basic_conductor_config">Configure the Conductor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_basic_router_config">Basic Router Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_otp_iso_install">Router Installation Using OTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_install_quickstart_otpiso">QuickStart from the OTP ISO</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Cloud Installations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_aws">Installing from the AWS Marketplace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_quickstart_aws">QuickStart Installation in AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_azure">Installing in Azure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_initialize_HA_conductor">Conductor High Availability for Cloud Deployments</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Supporting Information - Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_installer">Manually Installing the 128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/legacy_OTP_install">Installing Using the Pre-5.0 Interactive ISO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_upgrading">Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_rollback">Rollback</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_application_discovery">Application Discovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_appid">Application Identification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_EthOverSVR">Ethernet Over Secure Vector Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_ha_theoryofoperation">HA - Theory of Operation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_interface_types">Interface Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_kni">Kernel Network Interfaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_linux_host_networking">Linux Host Networking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_learning_VRF_routes">Learning VRF Routes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_network_planes">Forwarding Planes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_metadata">128T Metadata</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_machine_communication">Machine Communication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_pcli">PCLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_session_timer">Session Timers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_STEP">Service and Topology Exchange Protocol (STEP)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_waypoint_ports">Waypoints</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_glossary">Glossary</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_basics">Configuration Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_access_mgmt">Access Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_asset_connection_resiliency">Asset Connection Resiliency</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_bgp">BGP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_vrf_learning">VRF Learning via BGP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_reference_guide">Element Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_audit_event">Audit Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dhcp">DHCP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ldap">LDAP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_management_over_forwarding">Management over Forwarding</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_EthoSVR">Configuring Ethernet Over Secure Vector Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ha">High Availability</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/config_dual_router_ha">High Availability (Dual Router)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_non_forwarding_ha_interfaces">Non-forwarding HA Interfaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_adding_interfaces_to_ha_team">Adding Interfaces to HA Team Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_transition_standalone_to_ha">Transitioning a Conductor from Standalone to HA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_nat">NAT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ospf">OSPF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_rate_limiting">Rate Limiting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_RBAC">Configuring Role-Based Access Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp">SNMP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_static_hostname_mapping">Static Hostname Mappings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_STEP">Configuring Service and Topology Exchange Protocol (STEP)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_tenants">Tenants</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_templates">Configuration Templates</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sec_adaptive_encrypt">Adaptive Encryption</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">How To</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_conductor_migration">Conductor Migration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_extend_gui_nav">Extending GUI Nav</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_lte">LTE and Dual LTE Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_config_PPPoE">Configuring Dual PPPoE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_maintenance_mode">Maintenance Mode</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_ms365">Microsoft 365</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_trusted_ca_certificate">Adding a Trusted Certificate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_tune_bfd">Tuning BFD</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_applications">Application Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_ap_duplicate_assets">AP: Duplicate Asset ID Error</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_ap_salt_minion">AP: Salt Minion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_cpu_spikes">CPU Spikes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_forwarding_resource_pools">Forwarding Plane Resource Pools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_logs">Logs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_mac_uniqueness">MAC Address Uniqueness</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_packet_capture">PCLI Packet Capture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_t1_troubleshooting">T1 Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_troubleshooting_vrf">Troubleshooting VRF</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_overview">Alarm and Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_alarms">Alarms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_events">Events</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_att_avpn_configuration">AT&amp;T AVPN Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_using_128T_as_ntp_server">Branch NTP Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_conductor_deployment">Conductor Deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_qos_msft_expressroute">ExpressRoute QoS Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_lte_peering">LTE Peering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_monitoring_headends">Monitoring Head End Routers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_salt_pillars">Saltstack at Scale With 128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_sdwan_design_guide">SD-WAN Design Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_service_and_service_policy_design">Service and Service Policy Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_service-policy_defaults">Service Policy Baseline Defaults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_tenants">Tenancy Design</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLI Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli_reference">Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli_stats_reference">Show Stats Reference</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installer/Initializer Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installer_cli_reference">Installer Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installer_preferences">Installer Preferences File Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/initializer_cli_reference">Initializer Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/initializer_preferences">Initializer Preferences File Reference</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_bgp_community_services">BGP Community Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_cloud_ha">Cloud HA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_dns_app_id">DNS App Id</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_dns_cache">DNS Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_gre">GRE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_icmp_reachability_detection">ICMP Reachability Detection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_ipsec_client">IPsec Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_loopback_static_routes">Loopback Static Routes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_m800_watchdog">M800 Watchdog</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_monitoring_agent">Monitoring Agent</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_mosh">Mosh</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_set_hostname">Set Hostname</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_sip_alg">SIP ALG</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_wireguard">Wireguard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/plugin_kni_namespace_scripts">KNI Namespace Scripts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">REST APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api_rest_4.2.0">128T-4.2.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">128T</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.1">5.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.0">5.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.5">4.5</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.4">4.4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.3">4.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.2">4.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.1">4.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.0">4.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">128T Installer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_3.0">3.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.7">2.7</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.6">2.6</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.5">2.5</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.4">2.4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.3">2.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.2">2.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.1">2.1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">128T SIP ALG</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_sip_alg_2.1">2.1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">128T ZScaler</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_zscaler_1.1">1.1</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Configuring Dual Router High Availability</h1></header><div class="markdown"><p>There are several different high availability models possible with the 128T routing software. This document covers <em>dual router high availability</em>, which is when two instances of the 128T software are each configured as separate routers (rather than as two nodes within a single router). This is characterized by:</p><ul><li>An iBGP interface shared between the two devices in lieu of a &quot;fabric&quot; interface in the dual node deployment.</li><li>No <code>shared-phys-address</code> (and hence no shared interfaces) between the two devices. Interface protection in a dual router HA deployment is accomplished using traditional routing protocols (Layer 3) rather than IP/MAC takeover (Layer 2).</li><li>No state synchronization between the two devices (and hence no &quot;HA link&quot;). While this improves overall performance for the routers (since there is no overhead incurred due to state synchronization), the implication is that there are some capabilities not supported in this design. See <a href="#Unsupported-Features">Unsupported Features</a>, below.</li></ul><p>Dual router high availability is recommended for data center designs where there will be a large volume of traffic; the elimination of shared state synchronization yields a simpler design, benefitting critical infrastructure.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="unsupported-features"></a>Unsupported Features<a aria-hidden="true" tabindex="-1" class="hash-link" href="#unsupported-features" title="Direct link to heading">#</a></h2><p>When deploying two nodes in a dual router high availability deployment, several features that rely on synchronized state between nodes are no longer available.</p><ul><li>Source NAT. When source NAT is enabled, a system will allocate ephemeral ports on its egress interface as sessions leave the 128T router. Because there is no state synchronization between the two nodes in this deployment model, these ephemeral ports are not shared. Thus, if the active node fails and traffic starts transiting its counterpart, the source NAT allocation on the newly active system will be different. This will impact application flows.</li><li>Shared interfaces. A router node cannot perform gratuitous ARP takeover of an interface from another, distinct router node.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="design-constraints"></a>Design Constraints<a aria-hidden="true" tabindex="-1" class="hash-link" href="#design-constraints" title="Direct link to heading">#</a></h2><p>Due to the way that dual router high availability operates without state synchronization, in the event of a failure to one router in a pair, all traffic will be sent to the counterpart router (once routing converges). The now-active router does not have a shared database to reconstruct session state; it will receive mid-session packets (from the client&#x27;s and server&#x27;s perspectives) and need to construct its own state from these packets.</p><p>For this reason, services that leverage a dual router HA pair must reference a <code>service-policy</code> that has <code>transport-state-enforcement allow</code> configured. Otherwise, mid-session TCP packets cause the 128T device to send a TCP RST to the sender.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="design-overview"></a>Design Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#design-overview" title="Direct link to heading">#</a></h2><p>Unlike a <a href="/docs/config_ha">&quot;traditional&quot; dual node high availability design</a>, in which two nodes compose a single router and use an out-of-band interface (the &quot;sync interface&quot;) to synchronize state and a fabric interface to forward packets from one node to the other, the dual router trades these in for an inter-router iBGP connection for forwarding packets.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>It is possible to configure multiple inter-router connections for added resiliency if there are spare physical connections available between the two routers.</p></div></div><p>The sample high level topology we will discuss in this document is as follows:</p><p><img alt="dual-router-ha-diagrams" src="/assets/images/config_dual-router-ha-diagrams-8b816bb02a206e9267ee6d9b6da3d748.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="notes-about-the-topology"></a>Notes about the Topology<a aria-hidden="true" tabindex="-1" class="hash-link" href="#notes-about-the-topology" title="Direct link to heading">#</a></h3><p>In this sample exercise, each of the two routers (<code>routerA</code> and <code>routerB</code>) have two WAN interfaces and one LAN interface. Between them is an interconnect cable; for collocated routers, this can be a simple &quot;crossover&quot; cable between the two systems.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="routing-overview"></a>Routing Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#routing-overview" title="Direct link to heading">#</a></h3><p>Unlike the dual node redundancy model, where the two devices collectively harbor a single instance of the <code>routingManager</code> process, routing within the dual router redundancy model must be accomplished &quot;by hand;&quot; i.e., discretely on each individual system. This consists of two components:</p><ol><li>Each router uses BGPoSVR to exchange routes with the other.</li><li>For services that use <code>peer</code>-type service-routes to reach another 128T instance, these service-routes will need to include the complementary router as an additional <code>next-peer</code>. I.e., each router in the HA pair will point to the <code>next-peer</code> 128T as well as a <code>next-peer</code> for one another.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sample-configuration"></a>Sample Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sample-configuration" title="Direct link to heading">#</a></h2><p>Each of the two routers that comprise the highly available pair will be configured similarly. Here is our <code>routerA</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.bernstein# show config runn auth router routerA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router  routerA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                 routerA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            router-group         headend-datacenter1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            inter-node-security  internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node                 node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name                  node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                asset-id              797b06cb-2187-406a-a933-4e93fc991fb0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                description           &quot;routerA standalone node&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                role                  combo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                forwarding-core-mode  automatic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface      eno1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               eno1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:00:01.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  interrouter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name                   interrouter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id              10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        neighborhood           dc1-interrouter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            name               dc1-interrouter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            peer-connectivity  bidirectional</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            topology           mesh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        inter-router-security  unencrypted</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address                169.254.1.28</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     169.254.1.28</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  31</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface      eno2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               eno2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    description        &quot;LAN interface&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:00:02.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  lan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name         lan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id    11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        description  &quot;Data center LAN&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        vlan         0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address      10.0.128.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     10.0.128.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface      eno3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               eno3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    description        &quot;WAN interface 1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:00:03.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name         wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id    12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        description  &quot;WAN 1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        vlan         0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address      198.51.100.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     198.51.100.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface      eno4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               eno4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    description        &quot;WAN interface 2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:00:04.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name         wan2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id    13</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        description  &quot;WAN 2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        vlan         0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address      203.0.113.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     203.0.113.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            routing              default-instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type              default-instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                interface         lo1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name        lo1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    ip-address  169.254.2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                routing-protocol  bgp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    description   &quot;Dual router HA iBGP&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type       bgp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    local-as   64512</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    router-id  169.254.2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    neighbor   169.254.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        neighbor-address  169.254.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        neighbor-as       64512</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        shutdown          false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        timers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            connect-retry                   30</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            minimum-advertisement-interval  30</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        transport</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            passive-mode   false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            local-address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                routing-interface  lo1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address-family    ipv4-unicast</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            afi-safi       ipv4-unicast</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            next-hop-self  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="routing-configuration"></a>Routing Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#routing-configuration" title="Direct link to heading">#</a></h3><p>Unlike the <em>dual node high availability</em> design, the dual router high availability design does not synchronize state between routers. Instead, the two devices exchange reachability information using iBGP; this is implemented on the 128T using <a href="/docs/config_bgp#bgp-over-svr-bgposvr">BGP over SVR</a> (BGPoSVR), as seen in the sample configuration.</p><p>In our sample configuration we use <code>device-interface eno1</code> as our iBGP link. The sample here uses <a href="https://en.wikipedia.org/wiki/Link-local_address" target="_blank" rel="noopener noreferrer">link-local IP addresses</a>, presuming that the two nodes are situated next to one another in the same data center. The <code>neighborhood dc1-interrouter</code> configuration, also provisioned on <code>routerB</code>, indicates to conductor that the two devices are mutually reachable. This hint (combined with the loopback interfaces) is what creates the peering relationship, the services, and the service-routes in support of BGPoSVR.</p><p>This iBGP will also interact with other routing protocols to exchange reachability information with one another. For example, you may <code>redistribute ospf</code> into this iBGP, so that each device is aware of the other&#x27;s reachability, as shown here:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">                routing-protocol  bgp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    description   &quot;Dual router HA iBGP&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type          bgp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    local-as      64512</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    router-id     169.254.2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    neighbor      169.254.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        neighbor-address  169.254.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        neighbor-as       64512</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        shutdown          false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        timers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            connect-retry                   30</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            minimum-advertisement-interval  30</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        transport</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            passive-mode   false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            local-address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                routing-interface  lo1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address-family    ipv4-unicast</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            afi-safi       ipv4-unicast</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            next-hop-self  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    redistribute  ospf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        protocol  ospf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="service-policy-configuration"></a>Service Policy Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#service-policy-configuration" title="Direct link to heading">#</a></h3><p>As mentioned in the <a href="#design-constraints">design constraints</a> section, due to the fact that there is no shared state between the routers in a dual router HA deployment, when a router fails its counterpart will pick up all traffic for active sessions as soon as routing converges. This will result in mid-flow TCP packets arriving at the new router, and the default behavior for the 128T router is to reject all mid-flow TCP packets by sending a TCP RST back to the sender.</p><p>This behavior is governed by the <code>transport-state-enforcement</code> field in the <code>service-policy</code>. Any service traffic that is conveyed to or from a system that is configured as a dual router HA deployment must have <code>transport-state-enforcement</code> set to <code>allow</code>, or else all TCP-based traffic will need to be restarted post-switchover. Below is an example <code>service-policy</code> showing the <code>transport-state-enforcement</code> set to <code>allow</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@labsystem1.fiedler# show config running authority service-policy data-mission-critical</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-policy  data-mission-critical</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                         data-mission-critical</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description                  &quot;Mission-critical data&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-class                MultimediaStreaming</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            path-quality-filter          true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            best-effort                  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-latency                  250</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport-state-enforcement  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><p>For more information on this setting, refer to the section on <code>transport-state-enforcement</code> in our <a href="/docs/config_reference_guide#service-policy">online documentation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="service-route-configuration"></a>Service Route Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#service-route-configuration" title="Direct link to heading">#</a></h3><p>There are two considerations when constructing <code>service-route</code> configuration in a dual router HA environment:</p><ul><li>Routing traffic from a router to a remote set of routers configured for dual router HA</li><li>Routing traffic from the dual router HA to other peers</li></ul><p>In both of these cases, the <code>service-route</code> will use the <code>next-peer</code> method.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="routing-to-a-dual-router-ha"></a>Routing to a Dual Router HA<a aria-hidden="true" tabindex="-1" class="hash-link" href="#routing-to-a-dual-router-ha" title="Direct link to heading">#</a></h4><p>Below is an example <code>service-route</code> that would typify a branch router&#x27;s path to a data center dual router HA pair:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route         rte-datacenter-service-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          rte-datacenter-service-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  service-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-peer     routerA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-peer     routerB</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div></div></div></div></div><p>In this example, the branch router&#x27;s traffic matching <code>service-1</code> will have two possible peers it can leverage, <code>routerA</code> and <code>routerB</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>While it is possible to manually configure these yourself, the conductor will typically autogenerate these types of <code>service-route</code> elements on your behalf.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="routing-from-a-dual-router-ha"></a>Routing from a Dual Router HA<a aria-hidden="true" tabindex="-1" class="hash-link" href="#routing-from-a-dual-router-ha" title="Direct link to heading">#</a></h4><p>Below is an example <code>service-route</code> that typifies a dual router HA system sending traffic to a branch site (using a <a href="/docs/bcp_service_and_service_policy_design#summary-and-spoke-services">summary service</a>):</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route         rte-branch1-summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          rte-branch1-summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  branch1-summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-peer     branch1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-peer     routerB</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div></div></div></div></div><p>This example would be found on <code>routerA</code>; note that while we still use <code>next-peer</code>, the hops are different. First is <code>branch1</code>, the target of our summary service. Second, however, is <code>routerB</code>. This is effectively a manually-created dual router HA version of a dual node HA&#x27;s &quot;fabric&quot; path: <code>routerA</code> has a path to reach <code>branch1</code> via <code>routerB</code>.</p><p>There will also be a corresponding <code>service-route</code> on <code>routerB</code> that looks slightly different:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route         rte-branch1-summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          rte-branch1-summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  branch1-summary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-peer     branch1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-peer     routerA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div></div></div></div></div><p>Here we see that <code>routerB</code> will &quot;hop through&quot; <code>routerA</code> to get to <code>branch1</code>, if its direct path to <code>branch1</code> is down. (I.e., all peer paths are unavailable.)</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>These <code>service-route</code> configuration elements will not be built for you by conductor, and must be manually created. (They are typically part of provisioning templates, such that as new routers are deployed the configuration templates will include these <code>service-route</code> elements for the new peers.)</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-28T12:59:25.000Z" class="docLastUpdatedAt_217_">4/28/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/config_ha"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Configuring High Availability (128T Router)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/config_non_forwarding_ha_interfaces"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Non-forwarding HA Interfaces Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#unsupported-features" class="table-of-contents__link">Unsupported Features</a></li><li><a href="#design-constraints" class="table-of-contents__link">Design Constraints</a></li><li><a href="#design-overview" class="table-of-contents__link">Design Overview</a><ul><li><a href="#notes-about-the-topology" class="table-of-contents__link">Notes about the Topology</a></li><li><a href="#routing-overview" class="table-of-contents__link">Routing Overview</a></li></ul></li><li><a href="#sample-configuration" class="table-of-contents__link">Sample Configuration</a><ul><li><a href="#routing-configuration" class="table-of-contents__link">Routing Configuration</a></li><li><a href="#service-policy-configuration" class="table-of-contents__link">Service Policy Configuration</a></li><li><a href="#service-route-configuration" class="table-of-contents__link">Service Route Configuration</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright Â© 2021 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/styles.274b9cd0.js"></script>
<script src="/runtime~main.d46e691e.js"></script>
<script src="/main.9d6be68d.js"></script>
<script src="/1.28820cf6.js"></script>
<script src="/2.f0755fb5.js"></script>
<script src="/158.70c8d9c4.js"></script>
<script src="/161.1d1b3184.js"></script>
<script src="/935f2afb.ece3b60e.js"></script>
<script src="/17896441.8ac8b297.js"></script>
<script src="/b1274c58.f9e885a8.js"></script>
</body>
</html>