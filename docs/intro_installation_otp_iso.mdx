---
title: Installing From OTP ISO
---

import Flowchart from '../src/components/Flowchart';

## One Touch Provisioning (OTP)

The OTP installation process produces a system installed with 128T software set to its factory defaults. Upon completion of the OTP installation process, the default behavior is to provision the device to be configured with a DHCP client on the first ethernet port and DHCP server listening on all other ports. A user would then connect to the 128T via ethernet cable and use the [Quickstart](intro_ztp.md) file generated by the Conductor to finalize the 128T configuration. After performing the QuickStart operation, the 128T will have connectivity to its Conductor and can download the latest configuration (if necessary) and begin operation. These defaults [can be changed](#quickstart-location) to suit your needs.

## Installing 128T with the ISO

### Bootable USB

For smaller deployments or proof of concepts each image can be loaded on to a bootable USB for installing the operating system and 128T software. Follow the [instructions](intro_installation_bootable_media.md) for installing from bootable media. After installation, the platform will power off.

#### Disk Cloning

Disk cloning will allow large distributors to take an ISO image, install it on to a platform, and create a master disk copy of the platform.
:::note
When using cloned images, the same exact hardware platform must be used.  Create a new master disk image for each hardware variation.
:::
This disk copy can then be used to quickly install platforms by copying the filesystem and 128T software from one platform to another. After the initial installation the platform will be powered off. At this point in time the platform is generic and not unique -- which is the proper time to create a disk clone of the hard drive.

The following procedure must be followed:
1. Platform is installed using ISO image which powers down on success
2. Use Clonezilla or other Live USB to take a disk copy of the platform
3. Distribute disk clone using USB, multicast, or other technique
4. Start each platform after installation
5. Allow platform to bootstrap and then reboot
6. Verify platform validation report

## Bootstrapping

As mentioned above, the platform is generic after the initial installation and poweroff. However, once the platform is started again there is an automated script that does bootstrapping of the platform. This script is a one-shot service unit that only executes **once** during the first bootup. It will perform the following steps:
1. Configure Hostname and Salt Minion Identifier
2. Configure 128T and network interfaces
3. Enable 128T and salt-minion service
4. Write a Result Report
5. Reboot
After rebooting the 128T service will be running with configuration.

:::info
It is worth noting that after the OS installation -- dhclient is configured across all network interfaces until the platform has completed Bootstrapping.
:::

### Hostname and Salt Minion Identifier

The hostname and salt minion identifier are set to the same value during the bootstrapping process.
1. If the system serial number provisioned (which can be seen by `dmidecode --string system-serial-number`) this value will be used.
2. Otherwise use the first MAC address found in the format of: `mac-<address>`

### Quickstart Location

The Bootstrapper will set 128T configuration via a Quickstart file that can be present in a number of locations:

1. The Quickstart file can be placed in the root of an attached USB drive. i.e. `/bootstrap.quickstart`<br/>The USB drive MUST be named "BOOTSTRAP" in all caps.

2. If an attached USB drive is not found with the file in root, then the one-shot process will look for the Quickstart file `/etc/128technology/bootstrap.quickstart`.
3. If no file source is present, the Bootstrapper will execute HTTP GET requests to the following endpoints in an attempt to download the Quickstart File from a server. The REST response is explained in [REST details](#quickstart-file-via-rest).
    1. `http://quickstart.128t-bootstrap/quickstart/<identifier>`
    2. `http://192.168.128.128/quickstart/<identifier>`
    > Where `<identifier>` will be the minion-id as determined by the algorithm discussed in the [above](#hostname-and-salt-minion-identifier) section. It will most likely be the system serial number.
4. Else use OTP defaults, which sets up DHCP client on the first ethernet port and a DHCP server listening on all other ports.

### Image Validation
Once the platform has been rebooted after bootstrapping has completed, there will be a bootstrap validation report that is located at the root filesystem (`/root/128T-bootstrap.txt`) that contains details about the steps taken. There is also the file `/root/128T-bootstrap.json` that contains the same information in JSON format. The report will contain a message that includes additional details for each step.

Shown below is the location of the bootstrap report as well as an example of the contents
![Bootstrap Report](/img/intro_installation_otp_iso_results.png)

### Scriptlets
In addition to the above steps, the Bootstrap utility supports executing pre and post scriptlets on a USB drive for further customisation of the platform.  The scriptlets will be executed as the first step in the bootstrap process and as the last step.

The locations for the scriptlets are:
* If scriptlet exists at the root of USB drive and is called “/pre-bootstrap”
    * Otherwise, try to use /etc/128technology/pre-bootstrap
* If scriptlet exists at the root of USB drive and is called “/post-bootstrap”
    * Otherwise, try to use /etc/128technology/post-bootstrap
:::important
The scriptlets must have executable permissions to be executed properly.
:::
Any stdout/stderr output generated from the scriptlets will be logged for you in `/var/log/128T-bootstrap/<scriptlet-name>-scriptlet.log`.

### Bootstrapping Flow Chart
Below is a diagram of the procedure followed by the Bootstrapper software during first bootup of the platform. This occurs after the ISO installation when powered on for the first time.

<Flowchart
  chartCode={`
    st=>start: Start
      bs=>operation: Pre-Bootstrap Scriptlet
      usb1=>condition: On USB?
      def1=>condition: Default?
      es=>inputoutput: Execute Scriptlet
      smh=>operation: Set Minion ID\nSet Hostname\nSynchronize Clock
      sfd=>operation: Set 128T Factory Defaults
      usb2=>condition: On USB?
      def2=>condition: Default?
      rest=>condition: REST get?
      aq=>inputoutput: Apply quickstart.txt
      aotpd=>inputoutput: Apply OTP Defaults
      ist=>operation: Setup IFCFG\nEnable salt-minion\nEnable 128T
      pbs=>operation: Post-Bootstrap Scriptlet
      usb3=>condition: On USB?
      def3=>condition: Default?
      es2=>inputoutput: Execute Scriptlet
      fin=>operation: Finalize
      wbr=>subroutine: Write Bootstrap Report
      reb=>operation: Reboot
      e=>end: End
    st->bs->usb1
    usb1(no)->def1
    usb1(yes)->es
    def1(yes)->es
    def1(no)->smh
    es->smh
    smh->sfd->usb2
    usb2(no, right)->def2
    usb2(yes, right)->aq
    def2(yes)->aq
    def2(no)->rest
    rest(no)->aotpd
    rest(yes)->aq->ist
    aotpd->ist->pbs->usb3
    usb3(yes)->es2
    usb3(no)->def3
    def3(yes)->es2->fin
    def3(no)->fin
    fin->wbr->reb->e
  `}
/>

## Quickstart file via REST

If no bootstrap file is present on USB device or disk, the Bootstrapper will execute HTTP GET requests in an attempt to download the Quickstart file from a server.

The server must respond to the HTTP GET request with valid JSON data that is of format:
```
{
  “quickstart”: “<quickstart-file-contents>”,
  “password”: “this-is-my-password”
}
```

The password data within the JSON is required if the Quickstart file was encrypted when exported from the 128T Conductor.

### Testing
The bootstrap utility provides an entrypoint to test your own Quickstart Server. By executing the below command, the client will make requests to URLs and attempt to download and decode the quickstart file. It will NOT apply the quickstart to the platform -- only test the process.
```
$ bootstrap128t rest-test -i <test-identifier>
```
OR if you want to test a specific url.
```
$ bootstrap128t rest-test -i <test-identifier> --url <a-fully-qualified-url>
```
