<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ts_session_processing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Troubleshooting Session Processing | SSN Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.128technology.com/docs/ts_session_processing"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Troubleshooting Session Processing | SSN Docs"><meta data-rh="true" name="description" content="Session Smart Routers behave as both a firewall and a router. It is in its name – to be session smart – where the platform can apply a surgical amount of policy, treatment, and offer a rich amount of application data for use in understanding network performance."><meta data-rh="true" property="og:description" content="Session Smart Routers behave as both a firewall and a router. It is in its name – to be session smart – where the platform can apply a surgical amount of policy, treatment, and offer a rich amount of application data for use in understanding network performance."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.128technology.com/docs/ts_session_processing"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/ts_session_processing" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/ts_session_processing" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/kb/rss.xml" title="SSR Knowledge Base Articles RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/kb/atom.xml" title="SSR Knowledge Base Articles Atom Feed">
<link rel="alternate" type="application/json" href="/kb/feed.json" title="SSR Knowledge Base Articles JSON Feed"><link rel="stylesheet" href="/assets/css/styles.df1c9d6e.css">
<script src="/assets/js/runtime~main.02dfa6ea.js" defer="defer"></script>
<script src="/assets/js/main.065ea9f0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a class="navbar__item navbar__link" href="/kb">Knowledge Base</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_getting_started">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/release_notes_128t_6.3">Release Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/supported-devices-overview">Supported Hardware Platforms</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concepts-overview">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation">Installing Software Version 6.3.0 and Later</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/supported_cloud_platforms">Cloud / Hypervisor Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation_legacy">Installing Software Versions Earlier than 6.3.0</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_upgrade_considerations">Upgrading the SSR</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/bcp_sdwan_design_guide">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/config_basics">Administration Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/security-overview">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/config_ha">High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/wan_overview">WAN Assurance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/ts_applications">Troubleshooting</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_applications">Application Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_ap_duplicate_assets">AP: Duplicate Asset ID Error</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_ap_salt_minion">AP: Salt Minion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_cpu_spikes">CPU Spikes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_forwarding_resource_pools">Forwarding Plane Resource Pools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_logs">Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_mac_uniqueness">MAC Address Uniqueness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_packet_capture">Packet Capture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_serial_console_tsing">Serial Console Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/ts_session_processing">Session Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_t1_troubleshooting">T1 Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_traceroute">Traceroute</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ts_troubleshooting_vrf">Troubleshooting VRF</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Troubleshooting</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Session Processing</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Troubleshooting Session Processing</h1></header><p>Session Smart Routers behave as both a firewall and a router. It is in its name – to be session smart – where the platform can apply a surgical amount of policy, treatment, and offer a rich amount of application data for use in understanding network performance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="session-processing-on-the-session-smart-router">Session Processing on the Session Smart Router<a href="#session-processing-on-the-session-smart-router" class="hash-link" aria-label="Direct link to Session Processing on the Session Smart Router" title="Direct link to Session Processing on the Session Smart Router">​</a></h2>
<p>When it comes to determining proper performance and utilization of an SSR, you must look at three characteristics:</p>
<ul>
<li>Throughput</li>
<li>Session Capacity</li>
<li>Connections per second (CPS)</li>
</ul>
<p>This document focuses on the last of these three factors, CPS, and understanding its utilization related to the SSR&#x27;s ability to process sessions.</p>
<p>Connections per second influence how quickly the SSR can create, modify, and store a new session. Every system has a maximum session processing rate that is governed by the platform on which it runs. In SSR software versions prior to 6.1, session processing is single-threaded and is rate-limited by CPU clock speed and overall CPU busy-ness (as the OS scheduler delegates compute cycles to this task). In software versions 6.1 and beyond, session processing is multi-threaded and can take advantage of additional host cores. The SSR uses an RSS hashing mechanism to distribute traffic into the session processing threads based on the five tuples of packet (source IP, source port, destination IP, destination port, protocol).</p>
<p>The session processing thread is responsible for session setup and modify operations. Modify operations are performed for a flow move (peer path failure or SLA violation) or with the use of application identification which updates the session after DPI. The session processing thread has a buffer queue for handling bursts of traffic or when the thread is “backed up”. As the queue fills up, latency increases for all packets in the queue. This will translate into end-to-end latency within the network. Always scale the system with ample headroom to handle peak session processing load.</p>
<p>The SSR should be operating at no more than 80% utilization of its session processing threads, allowing it to handle bursty conditions that are triggered as a result of path migrations. When a path failure occurs, or a service is no longer within SLA, the SSR modifies existing sessions to ensure they are traversing the optimal pathway. For systems carrying considerable load, this could be many thousands of sessions that need to be updated.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-multi-threading">Enabling Multi-Threading<a href="#enabling-multi-threading" class="hash-link" aria-label="Direct link to Enabling Multi-Threading" title="Direct link to Enabling Multi-Threading">​</a></h3>
<p>While SSR software versions 6.1.x support multi-threading for session processing, it is not enabled by default. Reference the <a href="/docs/config_reference_guide#session-setup-scaling">Configuration Element Reference guide</a> for details on the configuration parameters. Note that this feature must be enabled on both nodes if operating in a HA cluster.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>It is not recommended to set <code>session-processor-mode</code> to <code>manual</code> unless instructed by a member of Juniper support or the engineering team to ensure that this value is right-sized for the environment.</p></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config authority router &lt;router-name&gt; node &lt;node-name&gt; session-setup-scaling   true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config authority router &lt;router-name&gt; node &lt;node-name&gt; session-processor-mode  automatic</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once the configuration changes have been made and committed, a restart of the SSR service is required for the changes to take effect.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="examining-utilization-of-session-processing-threads">Examining Utilization of Session Processing Threads<a href="#examining-utilization-of-session-processing-threads" class="hash-link" aria-label="Direct link to Examining Utilization of Session Processing Threads" title="Direct link to Examining Utilization of Session Processing Threads">​</a></h3>
<p>To view and understand host CPU usage, you must look at the individual session processing threads <em>as well as</em> the other threads in the system. This is due to how the OS scheduler works, distributing compute cycles to available CPUs.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ssr-versions--61">SSR Versions &lt; 6.1<a href="#ssr-versions--61" class="hash-link" aria-label="Direct link to SSR Versions &lt; 6.1" title="Direct link to SSR Versions &lt; 6.1">​</a></h4>
<p>In software versions prior to 6.1, examine the utilization of the <strong>PacketProcessing</strong> thread by viewing the output of the command <code>top -H d 1.0 | grep PacketProcess</code> from the OS shell, as seen below.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[centos@SOL-DL360-DUT1 ~]$ top -H d 1.0 | grep PacketProcess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 S 41.2  2.9 177:25.82 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 S 39.8  2.9 177:26.23 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 R 42.2  2.9 177:26.66 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 S 42.7  2.9 177:27.10 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 R 41.2  2.9 177:27.52 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 R 37.3  2.9 177:27.90 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 R 46.6  2.9 177:28.38 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 R 52.0  2.9 177:28.91 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 S 56.3  2.9 177:29.49 PacketProcessin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 8590 root      20   0  265.2g   7.2g 113312 R 61.8  2.9 177:30.12 PacketProcessin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ssr-versions--61-1">SSR Versions &gt;= 6.1<a href="#ssr-versions--61-1" class="hash-link" aria-label="Direct link to SSR Versions &gt;= 6.1" title="Direct link to SSR Versions &gt;= 6.1">​</a></h4>
<p>In software versions 6.1 and greater, the session processing thread(s) are named <code>Session-Proc-XX</code> where <code>XX</code> is a zero-based index of the number of threads allocated to session processing. An easy way to view the number of threads allocated to session processing as well as seeing current utilization is to run the command <code>show stats process thread process-name highway | grep SessionProc | grep &quot;cpu usage&quot;</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@test1.combo1# show stats process thread process-name highway | grep SessionProc | grep &quot;cpu usage&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Piping output...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu usage             test1   highway        SessionProc-00         61.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu usage             test1   highway        SessionProc-01           55</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu usage             test1   highway        SessionProc-02           48</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu usage             test1   highway        SessionProc-03         40.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu usage             test1   highway        SessionProc-04         30.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu usage             test1   highway        SessionProc-05           20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>Top</code> can be used to follow the session processing threads:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[centos@SOL-DL360-DUT1 ~]$ top -H d 1.0 | grep SessionProc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7532 root      20   0  266.9g   8.8g 120940 S 60.0  3.5  39:48.64 SessionProc-00                                                                 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7533 root      20   0  266.9g   8.8g 120940 R 55.0  3.5  37:18.75 SessionProc-01                                                     </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7534 root      20   0  266.9g   8.8g 120940 S 55.0  3.5  34:42.19 SessionProc-02                                                       </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7535 root      20   0  266.9g   8.8g 120940 S 45.0  3.5  31:33.67 SessionProc-03                                                          </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7536 root      20   0  266.9g   8.8g 120940 S 35.0  3.5  27:27.56 SessionProc-04                                                          </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 7537 root      20   0  266.9g   8.8g 120940 S 20.0  3.5  22:51.79 SessionProc-05</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-cli-output">Understanding CLI Output<a href="#understanding-cli-output" class="hash-link" aria-label="Direct link to Understanding CLI Output" title="Direct link to Understanding CLI Output">​</a></h3>
<p>The <strong>Service Area</strong> is the informal name given to the business logic responsible for session processing. The set of stats related to <code>internal-application</code> of Service Area processing are valuable to understand system behavior. These stats are monotonically increasing scalar values; you will need to compare deltas over two periods of time to get an accurate view of rate. In particular, <code>schedule-failure</code> and <code>sent-timeout</code> are signs that the session processing is unable to keep up with load or unable to handle bursty traffic patterns.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@test1.combo1# show stats traffic-eng internal-application internal-application &quot;Service Area&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wed 2023-10-18 17:03:48 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Retrieving statistics...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Internal Application Traffic Engineering Stats</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">----------------------------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==================================================== ======= ====================== =============</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Metric                                               Node    Internal-application         Value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==================================================== ======= ====================== =============</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> per-traffic-class buffer-capacity-exceeded-packets   test1   Service Area                     0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> per-traffic-class dequeue-aqm-drop-packets           test1   Service Area                     0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> per-traffic-class dequeue-max-latency-drop-packets   test1   Service Area                     0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> per-traffic-class dequeue-success-packets            test1   Service Area              24113256</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> per-traffic-class schedule-failure-packets           test1   Service Area                     0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> per-traffic-class schedule-success-packets           test1   Service Area              24113256</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> schedule-failure                                     test1   Service Area                     0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> schedule-success                                     test1   Service Area              24114030</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> scheduler-reset                                      test1   Service Area                     0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sent-retry                                           test1   Service Area           32121873138</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sent-success                                         test1   Service Area              24113708</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sent-timeout                                         test1   Service Area                     0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.03 seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>SSR software version 6.1 introduces the thread-specific metrics <code>show stats process thread process-name highway thread-name</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@test1.combo1# show stats process thread process-name highway thread-name SessionProc-00</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wed 2023-10-18 17:01:07 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Retrieving statistics...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Process Thread Metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">----------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===================== ======= ============== ================ =========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Metric                Node    Process-name   Thread-name        Value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===================== ======= ============== ================ =========</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu iowait            test1   highway        SessionProc-00         0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu system-usage      test1   highway        SessionProc-00       9.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu usage             test1   highway        SessionProc-00        63</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> cpu user-usage        test1   highway        SessionProc-00      53.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> queue delay           test1   highway        SessionProc-00        59</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> queue depth           test1   highway        SessionProc-00         0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> queue total           test1   highway        SessionProc-00   8355742</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> task errors           test1   highway        SessionProc-00         0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> task execution-time   test1   highway        SessionProc-00       389</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> task total            test1   highway        SessionProc-00   8363312</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.02 seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The units for <code>queue delay</code> and <code>task execution-time</code> are in microseconds.
All values are rolling averages, except for <code>queue total</code> and <code>task total</code> which are counters.</p>
<p>The values <code>cpu system-usage</code>, <code>cpu usage</code>, and <code>cpu user-usage</code> are percentages and indicate utilization of the service area thread performing session setup.</p>
<p>High values for queue depth and queue delay, coupled with high CPU usage values, are indicative of the service area threads not keeping up.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-retention">Metrics Retention<a href="#metrics-retention" class="hash-link" aria-label="Direct link to Metrics Retention" title="Direct link to Metrics Retention">​</a></h3>
<p>To view metrics over a longer period of time than the defaults, you can adjust the retention for key metrics relating to session processing. The current metrics retention defaults are as follows:</p>
<table><thead><tr><th>Retention</th><th>State</th><th>Interval</th><th>Duration</th></tr></thead><tbody><tr><td>short</td><td>Enabled: true</td><td>5 seconds</td><td>1 hour</td></tr><tr><td>intermediate</td><td>Enabled: true</td><td>5 minutes</td><td>1 day</td></tr><tr><td>long</td><td>Enabled: true</td><td>1 hour</td><td>180 days</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Increasing the retention duration and/or decreasing the interval from the defaults has the potential to impact system overhead and should be carefully considered.</p></div></div>
<p>For additional details about metrics retention profiles, see <a href="/docs/config_in-memory_metrics">Configuring In-Memory Metrics</a>.</p>
<p>Use the following processes and examples to adjust the retention time for session processing metrics. Procedures for both the CLI and GUI are provided.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cli">CLI<a href="#cli" class="hash-link" aria-label="Direct link to CLI" title="Direct link to CLI">​</a></h4>
<ol>
<li>Create a new metrics-profile referencing the key session processing metrics. Example:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        metrics-profile  session-processing-metrics-profile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name    session-processing-metrics-profile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            metric  /stat/traffic-eng/internal-application/sent-timeout</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                id           /traffic-eng/internal-application/sent-timeout</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                description  &quot;Internal application sent-timeout&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            metric  /stat/aggregate-session/node/session-arrival-rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                id           /aggregate-session/node/session-arrival-rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                description  &quot;Session arrival rate&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            metric  /stat/process/thread/queue/delay</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                id           /process/thread/queue/delay</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                description  &quot;Packet processing thread queue delay&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            metric  /stat/process/thread/cpu/usage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                id           /process/thread/cpu/usage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                description  &quot;CPU thread usage&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            metric  /stat/process/thread/queue/depth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                id           /process/thread/queue/depth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                description  &quot;Packet processing thread queue depth&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>For each router, reference the metrics profile in the <code>system</code> -&gt; <code>metrics</code> settings, and set the retention to <code>long</code>. Example:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router           my-router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    profile  session-processing-metrics-profile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name       session-processing-metrics-profile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        retention  long</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="gui">GUI<a href="#gui" class="hash-link" aria-label="Direct link to GUI" title="Direct link to GUI">​</a></h4>
<p>Use the process below to create a new Metrics Profile referencing the key session processing metrics.</p>
<ol>
<li>On the Conductor GUI, navigate to <code>CONFIGURATION</code> then <code>Authority</code>.
<img decoding="async" loading="lazy" alt="Authority config" src="/assets/images/ts_sp_session_processing_metrics_config_1-50991f0a0c51b320783b5c05694792db.png" width="1326" height="986" class="img_ev3q"></li>
<li>Create a new Metrics Profile.
<img decoding="async" loading="lazy" alt="New metrics profile" src="/assets/images/ts_sp_session_processing_metrics_config_2-85833d218b0fe804d40b546941354704.png" width="1596" height="240" class="img_ev3q"></li>
<li>Name the new Metrics Profile (example: <code>session-processing-metrics-profile</code>)
<img decoding="async" loading="lazy" alt="Name new metrics profile" src="/assets/images/ts_sp_session_processing_metrics_config_3-881f5e34970aa5116ca189a32a5fc426.png" width="1268" height="512" class="img_ev3q"></li>
<li>Add each of the following session processing metrics to the profile:</li>
</ol>
<ul>
<li><code>/stat/traffic-eng/internal-application/sent-timeout</code></li>
<li><code>/stat/aggregate-session/node/session-arrival-rate</code></li>
<li><code>/stat/process/thread/queue/delay</code></li>
<li><code>/stat/process/thread/cpu/usage</code></li>
<li><code>/stat/process/thread/cpu/depth</code></li>
</ul>
<p><img decoding="async" loading="lazy" alt="Session processing metrics profile" src="/assets/images/ts_sp_session_processing_metrics_config_4-eeddd7d6e7fbd5882823acc02cc8c9e6.png" width="2070" height="794" class="img_ev3q"></p>
<p>For each router, reference the metrics profile in the <code>System</code> -&gt; <code>Metrics</code> settings, and set the retention to <code>long</code>. Example:</p>
<ol>
<li>On the Conductor GUI, navigate to the router you wish to set up longer retention of session processing metrics.</li>
<li>Navigate to the <code>System</code> then <code>Metrics</code> settings for the router.
<img decoding="async" loading="lazy" alt="Router config" src="/assets/images/ts_sp_session_processing_metrics_config_5-0fdda3bade48746ea4eda12289e1af48.png" width="1070" height="376" class="img_ev3q">
<img decoding="async" loading="lazy" alt="Metrics config" src="/assets/images/ts_sp_session_processing_metrics_config_6-c6484cd05d420dfdeeeb52668af6e593.png" width="402" height="346" class="img_ev3q"></li>
<li>Add a new <code>Metrics Profile</code>.
<img decoding="async" loading="lazy" alt="Metrics profile config" src="/assets/images/ts_sp_session_processing_metrics_config_7-1efc72550ab2a1a50c6a3832ec07ed02.png" width="1776" height="244" class="img_ev3q"></li>
<li>Select your session processing metrics profile from the dropdown, and save.
<img decoding="async" loading="lazy" alt="Metrics profile name" src="/assets/images/ts_sp_session_processing_metrics_config_8-457903946b7383d315aad556c9a51442.png" width="1296" height="492" class="img_ev3q"></li>
<li>Set the retention to <code>long</code>.
<img decoding="async" loading="lazy" alt="Metrics profile retention long" src="/assets/images/ts_sp_session_processing_metrics_config_9-7095188860481bab8585aca3df5ddf75.png" width="1790" height="538" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-dashboard-for-active-monitoring">Creating a Dashboard for Active Monitoring<a href="#creating-a-dashboard-for-active-monitoring" class="hash-link" aria-label="Direct link to Creating a Dashboard for Active Monitoring" title="Direct link to Creating a Dashboard for Active Monitoring">​</a></h3>
<p>Creating a <code>Custom Report</code> on the Conductor is strongly recommended for each head-end router in an authority. Head-ends are central aggregation points for traffic and typically have the highest utilization and blast radius.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dashboard-setup">Dashboard Setup<a href="#dashboard-setup" class="hash-link" aria-label="Direct link to Dashboard Setup" title="Direct link to Dashboard Setup">​</a></h4>
<p>To create a custom report, use the following procedure:</p>
<ol>
<li>On the Conductor GUI, navigate to <code>CUSTOM REPORTS</code>.</li>
<li>Click on <code>NEW</code> in the top-right corner.</li>
<li>Select <code>New Empty Report</code>.</li>
<li>Name the report. For example: <code>Session Processing Utilization - &lt;Router Name&gt;</code> (where <code>&lt;Router Name&gt;</code> is the name of the router on which these reports will be customized).</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Time series graphs of per-thread utilization are only available on SSR software starting with 6.1.</p></div></div>
<p>The graph shows time series thread utilization of session processing threads. This graph can be customized per router, per node, per process, and each SessionProc thread.
When building this graph, make sure to include each of the running <code>SessionProc</code> threads.
<img decoding="async" loading="lazy" alt="Session Processing Thread Utilization" src="/assets/images/ts_sp_session_processing_thread_utilization-95b4282ece540089c6debcbc2d212dda.png" width="2301" height="1022" class="img_ev3q">
<strong>Metric:</strong> <code>process/thread/cpu/usage</code> <br>
<strong>Series:</strong> <code>Router &lt;router-name&gt; Node &lt;node-name&gt; Process Name &#x27;highway&#x27; Thread Name &#x27;SessionProc-XX&#x27;</code></p>
<p>To ensure a holistic view of session processing along with the stated above, looking that the utilization of all the other threads is important. It is valuable to determine if other processes are starving out the session processing threads.
<img decoding="async" loading="lazy" alt="Host CPU Utilization - All Threads" src="/assets/images/ts_sp_host_cpu_thread_utilization-198c467d595d16aabcf0dfbb5b3f532b.png" width="2294" height="654" class="img_ev3q">
<strong>Metric:</strong> <code>process/thread/cpu/usage</code> <br>
<strong>Series:</strong> <code>All for Selected Router</code></p>
<p>On a production system there will be a non-zero value of packets waiting in a queue to be processed by the session processing threads. When this value increases steadily and remains at a steady state, this indicates that the system is unable to keep up with load. The following graph shows the queue depth for all packets destined for session processing. Note that this graph requires a custom series with the router, node, process and thread name specified according to the image below.
<img decoding="async" loading="lazy" alt="Session Processing Queue Depth" src="/assets/images/ts_sp_session_processing_queue_depth-fde7a3e6413be09cda525f33fd86fa94.png" width="2296" height="696" class="img_ev3q">
<strong>Metric:</strong> <code>process/thread/queue/depth</code> <br>
<strong>Series:</strong> <code>Router &lt;router-name&gt; Node &lt;node-name&gt; Process Name &#x27;highway&#x27; Thread Name &#x27;SessionPipeline&#x27;</code></p>
<p>Queue delay represents the average amount of time (in microseconds) packets are waiting to be processed. When this value is steadily increasing, this indicates that the system is unable to keep up with load. The following graph shows the average time packets are waiting to be processed. Note that this graph requires a custom series with the router, node, process and thread name specified according to the image below.
<img decoding="async" loading="lazy" alt="Session Processing Queue Delay" src="/assets/images/ts_sp_session_processing_queue_delay-f8fe24a3be66839f660ac13448d37b9f.png" width="2295" height="702" class="img_ev3q">
<strong>Metric:</strong> <code>process/thread/queue/delay</code> <br>
<strong>Series:</strong> <code>Router &lt;router-name&gt; Node &lt;node-name&gt; Process Name &#x27;highway&#x27; Thread Name &#x27;SessionPipeline&#x27;</code></p>
<p>The Session Processing threads operate on packets that either create or modify a session. In a steady-state environment, the majority of packets arriving to the <strong>Service Area</strong> are <em>first packets</em> that create a session. A KPI valuable for determining (at least partial) load of the session processing threads is <code>session-arrival-rate</code>, or the rate at which new sessions are being setup.
<img decoding="async" loading="lazy" alt="Session Arrival Rate" src="/assets/images/ts_sp_session_arrival_rate-5531c1d6111b29c07bfe01bc6d2d8edc.png" width="2302" height="671" class="img_ev3q">
<strong>Metric:</strong> <code>aggregate-session/node/session-arrival-rate</code> <br>
<strong>Series:</strong> <code>All for Selected Router</code></p>
<p>When the session processing queue overflows or packets exceed their maximum time waiting in the queue, they are dropped so that clients can re-transmit the packet. Timeouts on their own do not indicate an overloaded SSR as bursts always happen in a network during network churn. However, if this value is steadily increasing it can mean that the SSR is unable to keep up with session processing load.
<img decoding="async" loading="lazy" alt="Service Area Scheduling Timeouts" src="/assets/images/ts_sp_service_area_schedule_timeouts-96c402566fa9674953ff3a3612bfc67b.png" width="2297" height="666" class="img_ev3q">
<strong>Metric:</strong> <code>traffic-eng/internal-application/sent-timeout</code> <br>
<strong>Series:</strong> <code>All for Selected Router</code></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/ts_serial_console_tsing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Serial Console Troubleshooting</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/ts_t1_troubleshooting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">T1 Troubleshooting</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#session-processing-on-the-session-smart-router" class="table-of-contents__link toc-highlight">Session Processing on the Session Smart Router</a><ul><li><a href="#enabling-multi-threading" class="table-of-contents__link toc-highlight">Enabling Multi-Threading</a></li><li><a href="#examining-utilization-of-session-processing-threads" class="table-of-contents__link toc-highlight">Examining Utilization of Session Processing Threads</a></li><li><a href="#understanding-cli-output" class="table-of-contents__link toc-highlight">Understanding CLI Output</a></li><li><a href="#metrics-retention" class="table-of-contents__link toc-highlight">Metrics Retention</a></li><li><a href="#creating-a-dashboard-for-active-monitoring" class="table-of-contents__link toc-highlight">Creating a Dashboard for Active Monitoring</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Juniper Networks, Inc.</div></div></div></footer></div>
</body>
</html>