<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Configuring BGP | SSN Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/config_bgp"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuring BGP | SSN Docs"><meta data-react-helmet="true" name="description" content="The Border Gateway Protocol (BGP) is a standard exterior gateway protocol developed for exchanging routing and reachability information between Autonomous Systems, a collection of IP routing prefixes managed by a single administrative entity. BGP makes routing decisions based on paths and network policies; although historically mainly seen in service provider networks, it is now gaining acceptance in large enterprise networks. BGP can also be used for routing within an autonomous system as an interior gateway protocol; when doing so it is referred to as iBGP."><meta data-react-helmet="true" property="og:description" content="The Border Gateway Protocol (BGP) is a standard exterior gateway protocol developed for exchanging routing and reachability information between Autonomous Systems, a collection of IP routing prefixes managed by a single administrative entity. BGP makes routing decisions based on paths and network policies; although historically mainly seen in service provider networks, it is now gaining acceptance in large enterprise networks. BGP can also be used for routing within an autonomous system as an interior gateway protocol; when doing so it is referred to as iBGP."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/config_bgp"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_bgp" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_bgp" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.21b25f22.css">
<link rel="preload" href="/assets/js/runtime~main.e802e1cc.js" as="script">
<link rel="preload" href="/assets/js/main.175dedfe.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Interchange<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation">Installation Process</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_aws">Cloud Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_installer">Supporting Information - Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/config_basics">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/config_basics">Configuration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_basics">Configuration Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_access_mgmt">Access Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_asset_connection_resiliency">Asset Connection Resiliency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/config_bgp">Configuring BGP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ospf">OSPF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dscp_steering">Configuring DSCP Steering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_vrf_learning">VRF Learning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_audit_event">Audit Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dhcp">DHCP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_forward_error_correction">Configuring Forward Error Correction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_management_over_forwarding">Management over Forwarding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_domain-based_web_filter">Web Filtering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_app_ident">Application Identification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_EthoSVR">Configuring Ethernet Over Secure Vector Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_flow_perf_mon">Inline Flow Performance Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_gre_tunnel">Native GRE Tunnels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_in-memory_metrics">In-Memory Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_nat">NAT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_rate_limiting">Rate Limiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_RBAC">Configuring Role-Based Access Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_service_health">Service Health Learning and Fault Avoidance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp">SNMP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_static_hostname_mapping">Static Hostname Mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_STEP">Configuring Service and Topology Exchange Protocol (STEP)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_tenants">Tenants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_templates">Configuration Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_transport_encryption">Transport Based Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_wan_assurance">Configuring WAN Assurance</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_ha">High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/sec_adaptive_encrypt">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/how_to_use_app_summary">How To</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/ts_applications">Troubleshooting</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/bcp_att_avpn_configuration">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/api_rest_4.2.0">REST APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/release_notes_128t_5.5">Release Notes</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuring BGP</h1></header><p>The Border Gateway Protocol (BGP) is a standard exterior gateway protocol developed for exchanging routing and reachability information between Autonomous Systems, a collection of IP routing prefixes managed by a single administrative entity. BGP makes routing decisions based on paths and network policies; although historically mainly seen in service provider networks, it is now gaining acceptance in large enterprise networks. BGP can also be used for routing within an autonomous system as an interior gateway protocol; when doing so it is referred to as iBGP.</p><p>Learning routes from BGP simplifies enterprise configuration and integration with Secure Vector Routing. In this configuration guide we will also discuss a 128T-specific feature referred to as &quot;BGP over SVR&quot; (or BGPoSVR), which combines the power of Secure Vector Routing with the rich feature set of the BGP protocol.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h3><p>This section presumes that the reader has a running 128T system and wants to add configuration to support BGP. The running 128T system should already include configuration for basic platform functionality (e.g., <code>router</code>, <code>node</code>, <code>device-interface</code>, <code>network-interface</code>) and basic 128T modeling configuration (e.g., tenants, services, etc.). Refer to the <a href="/docs/config_reference_guide">Element Reference</a> section of our documentation for a better understanding about basics of the 128T data model.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="peering-with-non-128t-routers">Peering with non-128T Routers<a class="hash-link" href="#peering-with-non-128t-routers" title="Direct link to heading">​</a></h3><p>The BGP configuration exists in the <a href="/docs/config_reference_guide#routing"><code>routing</code></a> configuration container within the 128T data model. For any routing configuration, static or dynamic, a default routing instance called <code>default-instance</code> must be defined in the 128T configuration.</p><p>In this example we will assume that BGP is configured on the peering router with IP address 1.1.1.1, as autonomous system number (ASN) 6000. </p><ol><li>To peer the 128T router with this router, configure BGP on our 128T using the following commands:</li></ol><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1# config auth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (authority)# router seattlesite1 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (router[name=seattlesite1])# routing default-instance</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Every 128T router (in this case, the router named <code>seattlesite1</code>), contains all of its legacy routing protocol information within the <code>default-instance</code> routing container.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing[type=default-instance])# routing-protocol bgp</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="2"><li>Enter into the BGP portion of the routing configuration model; set the local autonomous system number to 100, and set the router ID to 1.1.1.128.</li></ol><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# local-as 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# router-id 1.1.1.128</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="3"><li>Configure the <code>address-family</code> using <code>ipv4-unicast</code>. At least one <code>address-family</code>must be configured, and typically is set as <code>ipv4-unicast</code>. If your deployment uses other address families (e.g., IPv6) or routes multicast, you may also need to configure support for other address families.</li></ol><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# address-family ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])# exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Address families are also sometimes referred to as &quot;AFI-SAFI&quot; (pronounced &quot;affy-saffy&quot;), which is an Address Family Indicator plus Sub-Address Family Indicator. </p><ol start="4"><li>Configure the <code>neighbor</code>. In the example here, we&#x27;ve identified its IP address as <code>1.1.1.1</code> and its ASN as 6000. (Because this neighbor has a different ASN than the 128T, the 128T will recognize it as an eBGP peer rather than an iBGP peer.) An <code>address-family</code> of <code>ipv4-unicast</code>, lets the 128T know to exchange IPv4 unicast routes with the peer.</li></ol><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# neighbor 1.1.1.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=1.1.1.1])# neighbor-as 6000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=1.1.1.1])# address-family ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])# next-hop-self true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])#exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=1.1.1.1])# exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="5"><li>Set <code>next-hop-self</code> to <code>true.</code> During advertisement, non-directly connected routers need to learn how to reach an advertised route. To provide this information to the non-directly connected (as well as iBGP peers), next-hop-self command is used. This will cause the 128T to rewrite the <code>next-hop</code> information in the routes it advertises to this peer to be its own address.</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In the example above, we&#x27;ve set our router&#x27;s AS to 100. This will apply to all neighbors as the &quot;default&quot; AS it will advertise. You can override this on a per-neighbor basis by setting <code>local-as</code> within the <code>neighbor</code> configuration to a different value. However, <em>you must not configure the same value within the neighbor as you&#x27;ve already set in your global configuration</em>. This may cause issues when attempting to establish a peering relationship.</p></div></div><ol start="6"><li>Use the <code>exit</code> command several times to return to the <code>routing-protocol</code> level of the configuration hierarchy, and issue the <code>show</code> command. Your configuration should look something like this:</li></ol><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# show</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">local-as 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">router-id 1.1.1.128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">address-family  ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    afi-safi  ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">neighbor        1.1.1.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    neighbor-address  1.1.1.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    neighbor-as       6000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    shutdown          false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address-family    ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        afi-safi      ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        next-hop-self true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="advertising-routes">Advertising Routes<a class="hash-link" href="#advertising-routes" title="Direct link to heading">​</a></h3><p>There are two ways to advertise routes into BGP:</p><ul><li>Using <code>network</code> statements to identify the prefixes you want to advertise</li><li>Redistributing routes learned through other IGP or from configuration</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="using-the-network-statement">Using the <code>network</code> Statement<a class="hash-link" href="#using-the-network-statement" title="Direct link to heading">​</a></h4><p>To advertise routes to BGP, configure the network to be advertised under the address-family of the router. You may also apply a policy to the advertised route using  					 					 					command.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You can apply policies to these routes (i.e., policy and filters) individually. Policies are configured within the authority-level <code>routing</code> configuration at <code>config &gt; authority &gt; routing &gt; filter</code> and <code>config &gt; authority &gt; routing &gt; policy</code>. For more information, refer to the section in our documentation on Filters and Policies.</p></div></div><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">**admin@branchoffice1.seattlesite1# config auth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> admin@branchoffice1.seattlesite1 (authority)# router seattlesite1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> admin@branchoffice1.seattlesite1 (router[name=seattlesite1])# routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> admin@branchoffice1.seattlesite1 (routing[type=default-instance])# routing-protocol bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# address- family ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])# network 172.16.255.0/30</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> admin@branchoffice1.seattlesite1 (network[network- address=172.16.255.0/30])# policy allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> admin@branchoffice1.seattlesite1 (network[network- address=172.16.255.0/30])# exit**</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this example we&#x27;re advertising the CIDR <code>172.16.255.0/30</code>, and it will use the global route policy named <code>allow</code> (not shown).</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="redistributing-routes">Redistributing Routes<a class="hash-link" href="#redistributing-routes" title="Direct link to heading">​</a></h4><p>To redistribute connected, static, service routes and/or routes learned through OSPF, you can use the <code>redistribute</code> configuration.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1# config auth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (authority)# router seattlesite1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (router[name=seattlesite1])# routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing[type=default-instance])# routing-protocol bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# redistribute connected</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="bgp-over-svr-bgposvr">BGP over SVR (BGPoSVR)<a class="hash-link" href="#bgp-over-svr-bgposvr" title="Direct link to heading">​</a></h2><p>Use BGP over SVR when peering with a 128T to gain the benefit of Secure Vector Routing for all BGP traffic flowing to-and-from the 128T peers. </p><p>This procedure assumes that the 128T system is configured for basic platform functionality. Refer to the configuration example below for context.</p><p>To configure BGP over SVR:</p><ol><li>Configure a <em>routing interface</em>. This is similar to a loopback interface on traditional routers.
Unlike normal loopback BGP peering, this IP address does not need to be routable on the transport network because it will never see the wire. BGP peering is created on this interface. The conductor triggers on this and autogenerates the following components to activate BGP over SVR:</li></ol><ul><li><em>bgp_speaker</em> tenant</li><li>Auto-generated BGP services and service routes</li><li>Router Peers</li></ul><p>These BGP connections are protected by SVR, and able to migrate between SVR paths.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You must use a conductor to configure BGP over SVR; manually configuring the various pieces between two routers is not supported.</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If the interface facing the BGPoSVR peer is already part of a neighborhood, then ensure that the two routers&#x27; interface topology types (<code>network-interface &gt;neighborhood &gt; topology</code>) are configured allowing the routers to form peering relationships for the auto-generated peer service routes; e.g., mesh-mesh, mesh-hub, mesh-spoke or hub-spoke.</p></div></div><ol start="2"><li><p>Configure a BGP instance with the router’s local AS and a router-id that matches the routing interface&#x27;s IP. For each BGP over SVR peer, use a neighbor address of the neighbor&#x27;s routing interface IP address. </p></li><li><p>Configure the BGP peer configuration options such as the timers and address families. In address-family IPv4-unicast, <code>next-hop-self</code> must be set to <code>true</code>.</p></li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>When configuring BGPoSVR with an eBGP peer, you must set <code>multihop ttl</code> to at least <code>2</code>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="configuration-example">Configuration Example:<a class="hash-link" href="#configuration-example" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router myRouter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            type default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            interface rtg-int</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name rtg-int</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ip-address &lt;myAddress&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            routing-protocol bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                type bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                local-as 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-id &lt;myAddress&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                neighbor &lt;theirAddress&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                neighbor-as 200</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                timers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    hold-time 9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    keepalive-interval 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                address-family ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    afi-safi ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    next-hop-self true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                transport</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    local-address</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        routing-interface rtg-int</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                multihop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    ttl 255</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="sample-configuration">Sample Configuration:<a class="hash-link" href="#sample-configuration" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1# config auth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (authority)# router seattlesite1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (router[name=seattlesite1])# routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing[type=default-instance])# interface bgp-int-seattle</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (interface[name=bgp-int-seattle])# ip- address 10.128.128.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (interface[name=bgp-int-seattle])# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing[type=default-instance])# routing- protocol bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# local-as 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# router-id 10.128.128.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# address- family ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# neighbor 10.128.128.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=10.128.128.1])# neighbor-as 300</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=10.128.128.1])# address-family ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])# next-hop-self true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=10.128.128.1])# transport</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (transport)# local-address</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (local-address)# routing-interface bgp-int-seattle</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (local-address)# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (transport)# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=10.128.128.1])# multihop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (multihop)# ttl 255</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (multihop)# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=10.128.128.1])# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing[type=default-instance])# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (router[name=seattlesite1])# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (authority)# exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="verifying-the-bgp-configuration">Verifying the BGP Configuration<a class="hash-link" href="#verifying-the-bgp-configuration" title="Direct link to heading">​</a></h3><p>Use <code>show bgp</code> to see the overview of the BGP routing process on the 128T:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1# show bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wed 2019-02-20 23:14:58 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BGP table version is 12, local router ID is 10.128.128.2, vrf id 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Status codes:  s suppressed, d damped, h history, * valid, &gt; best, = multipath,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               i internal, r RIB-failure, S Stale, R Removed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Nexthop codes: @NNN nexthop&#x27;s vrf id, &lt; announce-nh-self</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Origin codes:  i - IGP, e - EGP, ? - incomplete</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Network          Next Hop            Metric LocPrf Weight Path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   10.128.128.2/32  10.128.128.3                           0 200 300 ?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   10.128.128.3/32  10.128.128.3                           0 200 300 ?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   128.128.128.1/32 10.128.128.3                           0 200 300 ?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   128.128.128.128/32</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    10.128.128.3                           0 200 300 ?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   172.16.128.2/32  10.128.128.3                           0 200 300 ?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   172.16.255.0/30  0.0.0.0                  0         32768 i</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   172.26.128.0/30  10.128.128.3                           0 200 300 i</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Displayed  7 routes and 7 total paths</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In addition to the output from <code>show bgp</code>, the contributions to the RIB from BGP are visible in the output of <code>show rib</code>.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1# show rib</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wed 2019-02-20 23:04:20 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Codes: K - kernel route, C - connected, S - static, R - RIP,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       O - OSPF, I - IS-IS, B - BGP, P - PIM, T - Table, v - VNC,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       V - VNC-Direct,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &gt; - selected route, * - FIB route</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B   1.1.1.0/24 [20/0] via 1.1.1.1 inactive, 22:28:18</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">C&gt;* 1.1.1.0/24 is directly connected, g4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B&gt;* 2.2.2.0/24 [20/0] via 1.1.1.1, g4, 22:28:18</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B&gt;* 3.3.3.0/24 [20/0] via 1.1.1.1, g4, 22:28:18</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">C&gt;* 10.0.128.0/31 is directly connected, g1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">K&gt;* 128.128.128.1/32 is directly connected, Null0, bh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">K&gt;* 128.128.128.128/32 is directly connected, Null0, bh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">C&gt;* 169.254.127.126/31 is directly connected, g4294967294</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">S&gt;* 172.16.128.2/32 [1/0] via 10.0.128.1, g1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">K   172.16.128.2/32 is directly connected, Null0, bh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">K&gt;* 172.26.128.2/32 is directly connected, Null0, bh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">C&gt;* 192.168.64.0/24 is directly connected, g2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.09 seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>As shown in the header, the routes that start with <strong>B</strong> are contributed by BGP.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="vrf-bgp-over-svr">VRF BGP Over SVR<a class="hash-link" href="#vrf-bgp-over-svr" title="Direct link to heading">​</a></h2><p>The establishment of a BGP session over SVR is achieved by the conductor auto-generating the necessary services and service-routes. The introduction of the VRF feature allows for configuring BGP instances within a VRF, and establishing BGP sessions with neighbors within the same VRF. </p><p>When configuring VRFs, there can be multiple BGP instances configured on one router, each one expecting to communicate via a separate VRF routing table. The result is that the generated routing-stack service-route needs to indicate which VRF table to direct the BGP session to.</p><p>By explicitly disabling the auto-generation of BGP services and service-routes for any configured BGP neighbor, it is possible to establish BGP sessions that use routing interfaces (aka “loopback” interfaces) for communication without also using SVR.</p><p>Other supported use cases include the ability to establish BGP over SVR sessions with each side residing in a different VRF. The typical scenario is a VPN architecture where one router is a CPE device on a customer site without any explicit VRF configuration. It connects to another router at the VPN provider which has a VRF configured for this customer and a BGP instance inside that VRF: </p><p><img alt="BGP Instance inside VRF" src="/assets/images/config_BGPoSVRinVRF-b1f0b14a118e12dfc45016eef75713d8.png"></p><p>In this example, the BGP instance configured in the default VRF on a CPE router needs to establish a session with a VRF BGP instance in the VPN provider’s router. To enable the generation of appropriate BGP service and service-route configuration objects, and in cases where the VRF&#x27;s have overlapping address space, some additional BGP neighbor configuration is required.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configuration-example-1">Configuration Example<a class="hash-link" href="#configuration-example-1" title="Direct link to heading">​</a></h3><p>The following example is based on the VPN provider scenario illustrated above: <strong>router A</strong> (the VPN Provider) represents a core router with a BGP instance inside a VRF peered with <strong>router B’s</strong> (Customer Y) BGP instance inside the default VRF.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router A</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            vrf vrfA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                interface loopback-vrfA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    ip-address 10.0.0.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                routing-protocol bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    local-as 500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    router-id 10.0.0.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    neighbor 10.0.0.11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        neighbor-as 500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        transport</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            bgp-service-generation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                neighbor-vrf default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            local-address</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                routing-interface loopback-vrfA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router B</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            interface loopback</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 ip-address 10.0.0.11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            routing-protocol bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                local-as 500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                router-id 10.0.0.11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                neighbor 10.0.0.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    neighbor-as 500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    transport</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        bgp-service-generation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            neighbor-vrf vrfA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        local-address</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            routing-interface loopback</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="bgp-service-generation">BGP Service Generation<a class="hash-link" href="#bgp-service-generation" title="Direct link to heading">​</a></h4><p>The <code>bgp-service-generation</code> configuration object is available in a BGP neighbor’s <code>transport</code> settings. For neighbors specified in the default routing instance or specified inside a VRF, the following choices are available:</p><ul><li><code>disabled </code>: Do not generate BGP service or service-routes.</li><li><code>neighbor-vrf (&lt;vrf-name&gt;|default) </code>: Name of the neighbor’s VRF in which the peer BGP instance resides. Can be “default” to specify the default VRF.</li><li><code>same-neighbor-vrf </code>: (Default) Generate the BGP service if there is a matching peer with a BGP instance within the same VRF. Explicitly specifying this is equivalent to not configuring any <code>bgp-service-generation</code> statement.</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="routing-stack-service-route">Routing-Stack Service-Route<a class="hash-link" href="#routing-stack-service-route" title="Direct link to heading">​</a></h4><p>A service-route of type <code>routing-stack</code> can be directed to a specific VRF:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service-route &lt;service-route-name&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-name &lt;service-name&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            routing-stack</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            routing-stack-vrf &lt;vrf-name&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The existing <code>routing-stack</code> statement directs the session into the <code>routingEngine</code> network namespace used by the routing engine. The optional <code>routing-stack-vrf &lt;vrf-name&gt;</code> statement specifies the desired VRF within the <code>routingEngine</code> namespace. The <code>vrf-name</code> parameter is a reference to an existing VRF in the same router. If no <code>routing-stack-vrf</code> is specified, the target of the service-route is the default VRF.</p><p>Service-routes of type <code>routing-stack</code> are automatically generated by the conductor for use with an auto-generated BGP service. Manually creating this type of service-route is not supported.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="generated-services-and-tenants">Generated Services and Tenants<a class="hash-link" href="#generated-services-and-tenants" title="Direct link to heading">​</a></h4><p>More than one access-policy can be specified in a service; a service is generated for each unique routing-interface and VRF tuple for a given router. Because multiple peering relationships may exist using that service, the access-policy lists all tenants associated with the BGP neighbors using that service for peering. All tenants used in these access-policy statements appear as generated tenants in the configuration, one for each VRF in use.</p><p>For a BGP neighbor residing in the default VRF, the generated BGP service  is named <code>_bgp_&lt;router-name&gt;_&lt;routing-interface-name&gt;</code>, and the tenant associated with this BGP neighbor in the default VRF is named <code>_bgp_speaker_</code>.</p><p>For a BGP neighbor residing in a non-default VRF, the generated BGP service is named <code>_bgp_&lt;router-name&gt;_&lt;vrf-name&gt;_&lt;vrf-routing-interface-name&gt;</code>. The associated tenant is named <code>_&lt;vrf-name&gt;._vrf_bgp_speaker_</code>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h3><p>If expected BGP services or service-routes are not auto-generated, use the log messages on the conductor to troubleshoot. Each BGP service and service-route that is generated or skipped for config generation results in a debug level log message. These messages are written to <code>persistentDataManager.log</code> with category RTG and sub-category CFG.</p><p>If all expected configuration has been generated, but a BGP over SVR session does not come up, then all available tools for debugging traffic problems also apply to BGP sessions:</p><ul><li>show fib</li><li>show service-path</li><li>show sessions</li></ul><p>Additionally, use the <code>show rib {vrf &lt;vrf-name&gt;}</code> command to verify the BGP neighbor is reachable and its kernel route entry is not superseded by another, higher priority entry in the RIB. </p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="bgp-graceful-restart">BGP Graceful Restart<a class="hash-link" href="#bgp-graceful-restart" title="Direct link to heading">​</a></h2><p>Users can now configure <code>graceful-restart</code> as disabled, rather than helper mode or full graceful restart. Additionally, the graceful restart mode on BGP neighbors can be configured differently than on the BGP instance. Historically there was no separate neighbor configuration. The graceful restart mode must be explicitly enabled, otherwise the default mode is <strong>helper</strong>. </p><p>Example New Data Model Objects</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">routing-protocol     bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    local-as         65    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    graceful-restart        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        mode             enable       </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        restart-time     150       </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stale-routes-time    150        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    …        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    neighbor     172.16.0.1            </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        neighbor-as    66           </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        graceful-restart               </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            mode         disable</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="show-command-and-troubleshooting">Show Command and Troubleshooting<a class="hash-link" href="#show-command-and-troubleshooting" title="Direct link to heading">​</a></h3><p>Use the <code>show bgp neighbors</code> command to verify graceful restart is configured as expected. Graceful restart is part of BGP capabilities negotiation.  When the BGP peering session is established, the command output includes the negotiated graceful restart:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Graceful Restart Capability: advertised</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Graceful restart information:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Local GR Mode: Helper*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Remote GR Mode: Disable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    R bit: False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Timers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Configured Restart Time(sec): 120</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Received Restart Time(sec): 0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If the BGP peering session does not form, use packet capture to view the local BGP protocol traffic from the linux shell:
<code>ip netns exec routingEngine tcpdump -i any -v &quot;tcp port 179”</code></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="routing-features">Routing Features<a class="hash-link" href="#routing-features" title="Direct link to heading">​</a></h2><p>This section contains various features supported by the 128T&#x27;s BGP implementation.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-128t-as-a-route-reflector">Configuring 128T as a Route Reflector<a class="hash-link" href="#configuring-128t-as-a-route-reflector" title="Direct link to heading">​</a></h3><p>While configuring iBGP, you may need to enable the <strong>Route Reflector</strong> capability to facilitate easy learning of routes. Your 128T can be configured as a route reflector for a particular neighbor or more realistically a set of neighbors, also known as a route reflector client(s). This can be configured in the route reflector router&#x27;s BGP config, under the respective neighbor object.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1# config auth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (authority)# router seattlesite1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (router[name=seattlesite1])# routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing[type=default-instance])# routing- protocol bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# neighbor 1.1.1.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In our example, the route reflector in our network is <code>branchoffice1</code> router, and our route reflector client is its neighbor <code>1.1.1.1</code>.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (neighbor[neighbor-address=1.1.1.1])# address-family ipv4-unicast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])# route-reflector client true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (address-family[afi-safi=ipv4-unicast])# exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>By setting <code>route-reflector client true</code>, we instruct the <code>branchoffice1</code> router to treat the neighbor as a route reflector client.</p><p>There is one additional field which needs to be set in route reflector&#x27;s BGP config, and that is <code>Client-ID</code>, which has the format of an IP address. This can be set to anything unique in the AS, and can be the same as the <code>Router ID</code> field.</p><p>When the route reflector sends routes to the clients, by default it doesn&#x27;t modify the next-hop. An outbound policy can be used to change the next-hop in these routes to that of the route reflector, if desired. In such instances, another option, which is turned off by default, needs to be set in the route reflector&#x27;s BGP config: <code>Route Reflector Allow Outbound Policy = TRUE</code>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="bgp-confederations">BGP Confederations<a class="hash-link" href="#bgp-confederations" title="Direct link to heading">​</a></h3><p>When configuring iBGP, the <strong>Confederation</strong> feature may be helpful when dealing with an enormous autonomous system. This feature allows you to break up the AS into smaller sub-autonomous systems. Confederation can be directly configured under the routing protocol element. Here, 65535 is the <strong>confederation identifier AS number</strong> and, 1100 and 2200 are the <strong>member AS</strong> numbers of that confederation AS.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1# config auth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (authority)# router seattlesite1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (router[name=seattlesite1])# routing default-instance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing[type=default-instance])# routing- protocol bgp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# confederation identifier 65535</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# confederation member-as 1100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# confederation member-as 2200</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@branchoffice1.seattlesite1 (routing-protocol[type=bgp])# exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-03-16T12:51:51.000Z">3/16/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/config_asset_connection_resiliency"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Asset Connection Resiliency</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/config_ospf"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">OSPF</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#peering-with-non-128t-routers" class="table-of-contents__link toc-highlight">Peering with non-128T Routers</a></li><li><a href="#advertising-routes" class="table-of-contents__link toc-highlight">Advertising Routes</a></li><li><a href="#bgp-over-svr-bgposvr" class="table-of-contents__link toc-highlight">BGP over SVR (BGPoSVR)</a><ul><li><a href="#verifying-the-bgp-configuration" class="table-of-contents__link toc-highlight">Verifying the BGP Configuration</a></li></ul></li><li><a href="#vrf-bgp-over-svr" class="table-of-contents__link toc-highlight">VRF BGP Over SVR</a><ul><li><a href="#configuration-example-1" class="table-of-contents__link toc-highlight">Configuration Example</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li><li><a href="#bgp-graceful-restart" class="table-of-contents__link toc-highlight">BGP Graceful Restart</a><ul><li><a href="#show-command-and-troubleshooting" class="table-of-contents__link toc-highlight">Show Command and Troubleshooting</a></li></ul></li><li><a href="#routing-features" class="table-of-contents__link toc-highlight">Routing Features</a><ul><li><a href="#configuring-128t-as-a-route-reflector" class="table-of-contents__link toc-highlight">Configuring 128T as a Route Reflector</a></li><li><a href="#bgp-confederations" class="table-of-contents__link toc-highlight">BGP Confederations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e802e1cc.js"></script>
<script src="/assets/js/main.175dedfe.js"></script>
</body>
</html>