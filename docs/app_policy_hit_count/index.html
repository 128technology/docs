<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-app_policy_hit_count" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Application Policy Hit Count | SSN Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.128technology.com/docs/app_policy_hit_count"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Application Policy Hit Count | SSN Docs"><meta data-rh="true" name="description" content="Application Policy Hit Count (APHC) provides insight into the routing policies being used to direct traffic in your network operations; it reports which policies are seeing active traffic (&quot;hit&quot;) and how. These values are presented as metrics tracked per service, per tenant; where each tenant service combination could be &quot;hit&quot; in one of the following ways."><meta data-rh="true" property="og:description" content="Application Policy Hit Count (APHC) provides insight into the routing policies being used to direct traffic in your network operations; it reports which policies are seeing active traffic (&quot;hit&quot;) and how. These values are presented as metrics tracked per service, per tenant; where each tenant service combination could be &quot;hit&quot; in one of the following ways."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.128technology.com/docs/app_policy_hit_count"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/app_policy_hit_count" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/app_policy_hit_count" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/kb/rss.xml" title="SSR Knowledge Base Articles RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/kb/atom.xml" title="SSR Knowledge Base Articles Atom Feed">
<link rel="alternate" type="application/json" href="/kb/feed.json" title="SSR Knowledge Base Articles JSON Feed"><link rel="stylesheet" href="/assets/css/styles.df1c9d6e.css">
<script src="/assets/js/runtime~main.2ced7467.js" defer="defer"></script>
<script src="/assets/js/main.520036c5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a class="navbar__item navbar__link" href="/kb">Knowledge Base</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_getting_started">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/release_notes_128t_7.0">Release Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/supported-devices-overview">Supported Hardware Platforms</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concepts-overview">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation">Installing Software Version 6.3.0 and Later</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/supported_cloud_platforms">Cloud / Hypervisor Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_installation_legacy">Installing Software Versions Earlier than 6.3.0</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/intro_upgrade_considerations">Upgrading the SSR</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/bcp_sdwan_design_guide">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/config_basics">Administration Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/config_basics">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/concepts_appid">Application Identification</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts_appid">Application Identification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_app_ident">Application Learning Mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how_to_use_app_summary">Using Application Summary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/app_policy_hit_count">Application Policy Hit Count</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/events_overview">Events and Alarms</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/config_source-dest_nat">Network Address Translation (NAT)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/config_dhcp">Network Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/config_dscp_steering">Routing and Network Protocols</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/config_snmp">SNMP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/config_tenants">Tenants</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/concepts_traf_eng">Traffic Engineering</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/security-overview">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/config_ha">High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/wan_overview">WAN Assurance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/ts_applications">Troubleshooting</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Administration Guide</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Application Identification</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Application Policy Hit Count</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Application Policy Hit Count</h1></header><p>Application Policy Hit Count (APHC) provides insight into the routing policies being used to direct traffic in your network operations; it reports which policies are seeing active traffic (&quot;hit&quot;) and how. These values are presented as metrics tracked per service, per tenant; where each tenant service combination could be &quot;hit&quot; in one of the following ways.</p>
<table><thead><tr><th>Count</th><th>Description</th></tr></thead><tbody><tr><td>Allowed</td><td>The session was allowed and created successfully.</td></tr><tr><td>Failed</td><td>The session could not be created.</td></tr><tr><td>Denied due to Access Policy</td><td>The packet was denied because an access policy explicitly disallows access.</td></tr><tr><td>Denied due to URL Filtering</td><td>The session was created but was blocked once app classification was completed.</td></tr><tr><td>Denied due to Local Service Definition</td><td>The session was allowed on another ingress router, but is denied here based on the policy on this router (commonly related to hierarchical services).</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-it-work">How Does It Work?<a href="#how-does-it-work" class="hash-link" aria-label="Direct link to How Does It Work?" title="Direct link to How Does It Work?">​</a></h2>
<p>Application Policy Hit Count is enabled by default, tracking counts for all observed service and tenant combinations, including the <code>access policy denied</code> counters.</p>
<p>The system maintains the current value in memory and will not provide a historical time series of the data unless configured to do so. To prevent excessive consumption of memory resources, the device periodically removes combinations that are no longer being observed. Inactive tenant service combinations remain in the system for 30 to 60 minutes before being removed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2>
<p>Counter configuration is flexible and can be enabled or disabled on individual routers, or across the whole authority. Counters can be configured to persist the policy hit count metrics, allowing them to be viewed as a time-series graph. The following configuration snippets show how each configure each option.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disable-aphc-for-the-authority">Disable APHC for the Authority<a href="#disable-aphc-for-the-authority" class="hash-link" aria-label="Direct link to Disable APHC for the Authority" title="Direct link to Disable APHC for the Authority">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">configure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      application-policy-hit-count-tracking</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        enabled false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disable-aphc-for-the-router">Disable APHC for the Router<a href="#disable-aphc-for-the-router" class="hash-link" aria-label="Direct link to Disable APHC for the Router" title="Direct link to Disable APHC for the Router">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">configure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router &lt;router&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          application-policy-hit-count-tracking disabled</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disable-aphc-for-the-authority-but-enable-for-a-specific-router">Disable APHC for the Authority but Enable for a Specific Router<a href="#disable-aphc-for-the-authority-but-enable-for-a-specific-router" class="hash-link" aria-label="Direct link to Disable APHC for the Authority but Enable for a Specific Router" title="Direct link to Disable APHC for the Authority but Enable for a Specific Router">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">configure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      application-policy-hit-count-tracking</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        enabled false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router &lt;router&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          application-policy-hit-count-tracking enabled</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clear-expiring-counts">Clear Expiring Counts<a href="#clear-expiring-counts" class="hash-link" aria-label="Direct link to Clear Expiring Counts" title="Direct link to Clear Expiring Counts">​</a></h3>
<p>The cleanup of expired counters runs automatically every 30 minutes. However, in some situations it may be necessary to manually clear hit count entries. In this situation the following command is available:.</p>
<p><code>clear application-policy-hit-counts [force] [node &lt;node&gt;] {router &lt;router&gt; | resource-group &lt;resource-group&gt;}</code></p>
<p>This command manually triggers the cleanup process. The execution does not change or prevent the scheduled cleanup run. However, executing the command twice will move cleanup forward by an hour and fully clear the policy hit count metrics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="persist-aphc-metrics">Persist APHC Metrics<a href="#persist-aphc-metrics" class="hash-link" aria-label="Direct link to Persist APHC Metrics" title="Direct link to Persist APHC Metrics">​</a></h2>
<p>Persistence can be configured using a metrics profile as described in the SSR Documentation. The example below show how to persist all hit count types for a specific service and tenant combination, using the <code>short</code> retention policy. It is a best practice to always use the shortest retention policy that satisfies your requirements.</p>
<p>There are typically a significant number of APHC metrics active on a system. If persistence is necessary, select a small number of service tenant combinations to be persisted. Careless selection may overwhelm the stats infrastructure resulting in resource shortages.</p>
<p>The following configurations are examples only; they should not be directly copied into another environment. Service, tenant, and router names must be replaced.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authority-configuration">Authority Configuration<a href="#authority-configuration" class="hash-link" aria-label="Direct link to Authority Configuration" title="Direct link to Authority Configuration">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">configure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metrics-profile internet-policy-hit-counts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      name internet-policy-hit-counts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      metric /stats/application-policy-hit-count/allowed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        id /stats/application-policy-hit-count/allowed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description &quot;Allowed Hit Count&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      metric /stats/application-policy-hit-count/failed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        id /stats/application-policy-hit-count/failed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description &quot;Failed Hit Count&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      metric /stats/application-policy-hit-count/deny/policy-table</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        id /stats/application-policy-hit-count/deny/policy-table</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description &quot;Denied for Explicit Access Policy Hit Count&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      metric /stats/application-policy-hit-count/deny/local-service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        id /stats/application-policy-hit-count/deny/local-service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description &quot;Denied After Ingress Router Allowed Hit Count&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      metric /stats/application-policy-hit-count/deny/url-filtering</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        id /stats/application-policy-hit-count/deny/url-filtering</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description &quot;Denied For URL Filtering Hit count&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      filter service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        parameter service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value internet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      filter tenant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        parameter tenant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value engineering</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="router-configuration">Router Configuration<a href="#router-configuration" class="hash-link" aria-label="Direct link to Router Configuration" title="Direct link to Router Configuration">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">configure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    router &lt;router&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      name &lt;router&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          profile internet-policy-hit-counts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name internet-policy-hit-counts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            retention short</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="stats-output">Stats Output<a href="#stats-output" class="hash-link" aria-label="Direct link to Stats Output" title="Direct link to Stats Output">​</a></h2>
<p>The hit count metrics can be accessed via the PCLI as shown. They provide a combination of services and tenants and show how traffic is allowed or blocked. In the example shown, we also see failures due to improperly configured services.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@westB.T207_West# show stats application-policy-hit-count node westA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Wed 2025-01-08 18:59:28 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Retrieving statistics...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Highway Manager application policy hit count Stats</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--------------------------------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========= ======= ================= ================== =======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Metric    Node    Tenant            Service            Value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">========= ======= ================= ================== =======</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> allowed   westA   &lt;global&gt;          lan2-service           1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           westA   red               lan2-service           1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           westA   red               lan2-service         326</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> deleted   westA   &lt;global&gt;          lan2-service           1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> failed    westA   &lt;invalidTenant&gt;   &lt;UnknownService&gt;      11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           westA   red               &lt;UnknownService&gt;    5841</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.06 seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-policy-hit-count---mist-output">Application Policy Hit Count - Mist Output<a href="#application-policy-hit-count---mist-output" class="hash-link" aria-label="Direct link to Application Policy Hit Count - Mist Output" title="Direct link to Application Policy Hit Count - Mist Output">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Application Policy Hit Count - Mist Output" src="/assets/images/app-policy-hit-count-mist-d6aece8fcf767a4236fe3d8858efb598.png" width="1505" height="419" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/how_to_use_app_summary"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using Application Summary</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/events_overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Alarm and Events</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-does-it-work" class="table-of-contents__link toc-highlight">How Does It Work?</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#disable-aphc-for-the-authority" class="table-of-contents__link toc-highlight">Disable APHC for the Authority</a></li><li><a href="#disable-aphc-for-the-router" class="table-of-contents__link toc-highlight">Disable APHC for the Router</a></li><li><a href="#disable-aphc-for-the-authority-but-enable-for-a-specific-router" class="table-of-contents__link toc-highlight">Disable APHC for the Authority but Enable for a Specific Router</a></li><li><a href="#clear-expiring-counts" class="table-of-contents__link toc-highlight">Clear Expiring Counts</a></li></ul></li><li><a href="#persist-aphc-metrics" class="table-of-contents__link toc-highlight">Persist APHC Metrics</a><ul><li><a href="#authority-configuration" class="table-of-contents__link toc-highlight">Authority Configuration</a></li><li><a href="#router-configuration" class="table-of-contents__link toc-highlight">Router Configuration</a></li></ul></li><li><a href="#stats-output" class="table-of-contents__link toc-highlight">Stats Output</a><ul><li><a href="#application-policy-hit-count---mist-output" class="table-of-contents__link toc-highlight">Application Policy Hit Count - Mist Output</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Juniper Networks, Inc.</div></div></div></footer></div>
</body>
</html>