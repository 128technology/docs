<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Configuring DSCP Steering | SSN Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/config_dscp_steering"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuring DSCP Steering | SSN Docs"><meta data-react-helmet="true" name="description" content="When traffic is traversing an IPSec encrypted tunnel, every flow within that tunnel shares the same layer 3 headers, making them difficult to identify."><meta data-react-helmet="true" property="og:description" content="When traffic is traversing an IPSec encrypted tunnel, every flow within that tunnel shares the same layer 3 headers, making them difficult to identify."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/config_dscp_steering"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_dscp_steering" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_dscp_steering" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.21b25f22.css">
<link rel="preload" href="/assets/js/runtime~main.dfb8ee50.js" as="script">
<link rel="preload" href="/assets/js/main.bf52851a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Session Smart Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation">Installation Process</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_aws">Cloud Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_installer">Supporting Information - Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/config_basics">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/config_basics">Configuration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_basics">Configuration Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_access_mgmt">Access Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_asset_connection_resiliency">Asset Connection Resiliency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_bgp">Configuring BGP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ospf">OSPF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/config_dscp_steering">Configuring DSCP Steering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_vrf_learning">VRF Learning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_audit_event">Audit Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dhcp">DHCP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_forward_error_correction">Configuring Forward Error Correction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_management_over_forwarding">Management over Forwarding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_domain-based_web_filter">Web Filtering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_app_ident">Application Identification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_EthoSVR">Configuring Ethernet Over Secure Vector Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_flow_perf_mon">Inline Flow Performance Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_gre_tunnel">Native GRE Tunnels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_in-memory_metrics">In-Memory Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_nat">NAT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_rate_limiting">Rate Limiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_RBAC">Configuring Role-Based Access Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_service_health">Service Health Learning and Fault Avoidance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp">SNMP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_static_hostname_mapping">Static Hostname Mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_STEP">Configuring Service and Topology Exchange Protocol (STEP)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_tenants">Tenants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_templates">Configuration Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_transport_encryption">Transport Based Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_wan_assurance">Configuring WAN Assurance</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_ha">High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/sec_adaptive_encrypt">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/how_to_use_app_summary">How To</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/ts_applications">Troubleshooting</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/bcp_att_avpn_configuration">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/release_notes_128t_5.5">Release Notes</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuring DSCP Steering</h1></header><p>When traffic is traversing an IPSec encrypted tunnel, every flow within that tunnel shares the same layer 3 headers, making them difficult to identify. </p><p>To provide identification and aid in load balancing and traffic engineering, DSCP values can be set at the tunnel endpoint. When the traffic reaches the SSR, the DSCP value is used for both traffic engineering priority and path priority for DSCP traffic steering. There are currently two IPSec tunnel types supported by the SSR; NAT traversal (NatT) and ESP.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="basic-configuration">Basic Configuration<a class="hash-link" href="#basic-configuration" title="Direct link to heading">​</a></h2><ul><li>Configure the ingress interface for <code>dscp-steering</code></li><li>Configure a parent service that matches the traffic profile of the tunnel</li><li>Configure a child service that defines the <code>dscp-range</code> to steer</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-config">Example Config<a class="hash-link" href="#example-config" title="Direct link to heading">​</a></h4><p>Configure the <code>network-interface</code> for <code>dcsp-steering</code>:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">network-interface foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    global-id 12</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vlan 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dscp-steering</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        transport</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            port-range</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                start-port 4500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit     </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Configure the parent service for the tunnel:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service          tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name           tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description    &quot;IPSec Tunnel&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope          public</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    security       internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address        5.5.5.100/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy  red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        source      red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Configure the child service with the <code>dscp-range</code>:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service          high-priority.tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name           high-priority.tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description    &quot;The high priority traffic within this tunnel&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope          public</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    security       internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dscp-range     14</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        start-value 14</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-it-works">How it Works<a class="hash-link" href="#how-it-works" title="Direct link to heading">​</a></h2><p>DSCP traffic steering is configured on the <code>network-interface</code> to identify the protocol and port, and the <code>service</code>, to identify the DSCP values used to steer the traffic. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="network-interface-configuration">Network Interface Configuration<a class="hash-link" href="#network-interface-configuration" title="Direct link to heading">​</a></h3><p>Configuring <code>dscp-steering</code> at the network-interface level focuses DSCP traffic steering on a specific transport protocol and port range, rather than an entire interface.  </p><p>Only traffic matching the <code>dscp-steering</code> properties configured on the <code>network-interface</code> and in the <code>service</code> is steered using DSCP. Other traffic is handled according to the relevant configuration. </p><p>The following example is designed to target IPSec NAT traversal traffic which is typically UDP, with a destination port 4500. </p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">network-interface foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    global-id 12</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vlan 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dscp-steering</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        transport</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            port-range</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                start-port 4500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit     </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>When steering ESP traffic, ports are not specified. For example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">network-interface foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    global-id 12</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vlan 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dscp-steering</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        enabled true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        transport</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol esp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit   </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="service-configuration">Service Configuration<a class="hash-link" href="#service-configuration" title="Direct link to heading">​</a></h3><p>A DSCP value and range is configured for a child service; this identifies the priority and handling of the traffic at the router. DSCP aware services are configured in a hierarchy; DSCP values are not configured on the parent service.</p><p>The following example configuration splits the tunnel across 3 services. Traffic with <code>dscp-range</code> value 14 is handled by the high-priority service; traffic with <code>dscp-range</code> values from 26 to 28 is handled by the low-priority service. The remaining traffic falls back into the parent tunnel service.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service          tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name           tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description    &quot;IPSec Tunnel&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope          public</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    security       internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address        5.5.5.100/0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy  red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        source      red</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service          high-priority.tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name           high-priority.tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description    &quot;The high priority traffic within this tunnel&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope          public</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    security       internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dscp-range     14</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        start-value 14</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service          low-priority.tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name           low-priority.tunnel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description    &quot;The low priority traffic within this tunnel&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope          public</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    security       internal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dscp-range     26</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        start-value 26</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        end-value   28</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="restrictions">Restrictions<a class="hash-link" href="#restrictions" title="Direct link to heading">​</a></h3><ul><li>The DSCP steering transport list for a network-interface is limited to one range.</li><li>Any service with a <code>dscp-range</code> configuration must be a child service.</li><li>Only provisioned service-routes are supported. </li><li>DSCP steering ranges must not overlap. </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="gui-configuration-screens">GUI Configuration Screens<a class="hash-link" href="#gui-configuration-screens" title="Direct link to heading">​</a></h2><p>The following screens demonstrate configuring DSCP steering on the network interface using the GUI.</p><ol><li>Enable DSCP Steering, and select the DSCP Steering Transport button.</li></ol><p><img alt="DSCP Steering button" src="/assets/images/dscp_steering1-63dfa27514d583d66d5c2cb56f1f4e16.png"></p><ol start="2"><li>Select a protocol.</li></ol><p><img alt="DSCP Steering Info" src="/assets/images/dscp_steering2-5d9b3136792e93ad775db1cfc11a633b.png"></p><ol start="3"><li>Enter the port or port range.</li></ol><p><img alt="DSCP Steering Port Ranges" src="/assets/images/dscp_steering3-45849ab6fccf6dc93e39ae70f125617b.png"></p><ol start="4"><li>Select Validate and Commit.</li></ol><p><img alt="DSCP Steering Transport Validate" src="/assets/images/dscp_steering4-f38c0fd82cfa623811402e7d21230b71.png"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-04-12T18:05:19.000Z">4/12/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/config_ospf"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OSPF</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/config_vrf_learning"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">VRF Learning</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-configuration" class="table-of-contents__link toc-highlight">Basic Configuration</a></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it Works</a><ul><li><a href="#network-interface-configuration" class="table-of-contents__link toc-highlight">Network Interface Configuration</a></li><li><a href="#service-configuration" class="table-of-contents__link toc-highlight">Service Configuration</a></li><li><a href="#restrictions" class="table-of-contents__link toc-highlight">Restrictions</a></li></ul></li><li><a href="#gui-configuration-screens" class="table-of-contents__link toc-highlight">GUI Configuration Screens</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.dfb8ee50.js"></script>
<script src="/assets/js/main.bf52851a.js"></script>
</body>
</html>