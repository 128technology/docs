<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Conductor Deployment Patterns | 128T Docs</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="128T Docs"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="The 128T conductor is the centralized orchestration platform within a 128T Authority, and maintains many persistent connections to each router and its constituent nodes. This document discusses the various  options for deploying the 128T conductor, discussing the relative strengths and drawbacks of each."><meta data-react-helmet="true" property="og:description" content="The 128T conductor is the centralized orchestration platform within a 128T Authority, and maintains many persistent connections to each router and its constituent nodes. This document discusses the various  options for deploying the 128T conductor, discussing the relative strengths and drawbacks of each."><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/bcp_conductor_deployment">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.8d924258.css">


<link rel="preload" href="/styles.b677349c.js" as="script">

<link rel="preload" href="/runtime~main.4a304c45.js" as="script">

<link rel="preload" href="/main.766ebc80.js" as="script">

<link rel="preload" href="/1.9aad4596.js" as="script">

<link rel="preload" href="/2.4c453d4b.js" as="script">

<link rel="preload" href="/41.825189b6.js" as="script">

<link rel="preload" href="/20ac7829.0f1575ee.js" as="script">

<link rel="preload" href="/17896441.5e8a9f16.js" as="script">

<link rel="preload" href="/fa10e3f3.621fa17d.js" as="script">

</head>
<body>

<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/128t_black.png" alt="128 Technology Logo"><strong></strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://community.128technology.com/home">Interchange</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.128technology.com/">Company</a><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/128t_black.png" alt="128 Technology Logo"><strong></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Docs</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://community.128technology.com/home">Interchange</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://www.128technology.com/">Company</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/img/128t_black.png" alt="128 Technology Logo"><strong></strong></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes/release_notes_4.2.0">4.2.0 Release Notes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes/release_notes_4.2.1">4.2.1 Release Notes</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/CONTRIBUTING">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_downloading">Downloading</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Getting Started</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_glossary">Glossary</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_application_discovery">Application Discovery</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_ha_theoryofoperation">HA - Theory of Operation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_interface_types">Interface Types</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_linux_host_networking">Linux Host Networking</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_network_planes">Forwarding Planes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_management_connections">M2M Communication</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Administration</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/config_basics">Basics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_audit_log">Audit Log</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_ldap">LDAP</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_ha">High Availability</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_non_forwarding_ha_interfaces">Non-forwarding HA Interfaces</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_adding_interfaces_to_ha_team">Adding Interfaces to HA Team Interface</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_transition_standalone_to_ha">Transitioning a Conductor from Standalone to HA</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_tenants">Tenants</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ts_mac_uniqueness">MAC Address Uniqueness</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/events">Alarms and Events</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Best Practics</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/bcp_conductor_deployment">Conductor Deployment</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/bcp_lte_peering">LTE Peering</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLI Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/cli_reference">Reference</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/monitoring_agent">Monitoring</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/apis_rest">REST</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/apis_netconf">NETCONF</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Conductor Deployment Patterns</h1></header><div class="markdown"><p>The 128T conductor is the centralized orchestration platform within a 128T Authority, and maintains many persistent connections to each router and its constituent nodes. This document discusses the various  options for deploying the 128T conductor, discussing the relative strengths and drawbacks of each.</p><p>All of the design patterns contained within this document are supported configurations; however, certain designs are discouraged due to their complexity, the number of limitations it imposes on your network design, the functional caveats it imposes, etc. These will be explicitly noted within each section accordingly.</p><p>For each topic, we will discuss items such as:</p><ul><li>Any resource requirements (e.g., public internet addresses)</li><li>All corresponding 128T or Linux OS configuration requirements</li><li>When the design pattern is encouraged or discouraged</li><li>The design pattern&#x27;s flexibility and scale</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="about-this-guide"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#about-this-guide" title="Direct link to heading">#</a>About this Guide</h2><p>This guide is intended to be referenced by network architects during the Design phase of a planned deployment, to assist with:</p><ul><li>Selecting the most appropriate platform for the conductor</li><li>Preparing the base platform and underlying operating system for optimal conductor performance</li><li>Choosing the most suitable design pattern for the deployment</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="terminology"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#terminology" title="Direct link to heading">#</a>Terminology</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="conductor-host-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conductor-host-services" title="Direct link to heading">#</a>Conductor Host Services</h4><p><em>Conductor Host Services</em> refers to the built-in feature within the 128T software that will generate configuration to simplify the connectivity between routers and their conductor(s). By configuring the <code>conductor-address</code> field within the 128T&#x27;s data model, and by indicating which interface(s) on a manged router should be used to connect to conductor, the conductor will automatically generate the supporting configuration infrastructure. This includes:</p><ul><li>The <code>_conductor_</code> service (which will have a trailing sequence number; e.g., <code>_conductor_1</code>)</li><li>A <code>service-route</code> for each <code>network-interface</code> on each router that has <code>conductor</code> set to <code>true</code></li></ul><p>The Conductor Host Services feature forms the basis for the majority of the conductor design patterns described in this document, and should be leveraged whenever possible.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="in-band-management"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#in-band-management" title="Direct link to heading">#</a>In-Band Management</h4><p>The term <em>in-band management</em> in the context of conductor connectivity refers to the use of a forwarding interface by a router node for reaching the conductor. I.e., there is no dedicated interface specifically for the conductor to &quot;manage&quot; the node. As most 128T deployments separate the remote sites from the conductor over a WAN, it is exceedingly common to leverage in-band management between a remote node and a conductor. For SDWAN deployments, in-band management is <em>strongly recommended</em>, for the branch locations. For head end systems that are colocated with the conductors, out-of-band management is preferable, assuming there are sufficent free interfaces on the chosen head end hardware platform.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="out-of-band-management"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#out-of-band-management" title="Direct link to heading">#</a>Out-of-Band Management</h4><p>Routing nodes are said to leverage <em>out-of-band management</em> when they have a dedicated interface for the traffic to reach the conductor. Out-of-band management is generally only feasible when a conductor is colocated with the routing nodes, as is typically the case only at a head end data center.</p><div class="admonition admonition-note"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>It is possible to have a dedicated out-of-band management interface on branch locations, but this connection will almost certainly ultimately ride over the same device&#x27;s WAN connection to the conductor. I.e., the management traffic will egress one interface on the device and be sent back to another interface on the same device. As such, the in-band management model is more suitable, as it avoids unnecessary hops.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="universal-considerations"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#universal-considerations" title="Direct link to heading">#</a>Universal Considerations</h2><p>This section contains information pertinent to all conductor deployments.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="platform-requirements"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#platform-requirements" title="Direct link to heading">#</a>Platform Requirements</h3><p>It is important from the outset to choose a platform (physical or virtual) that is suitable for the demands of managing an array of 128T routers. As the deployment scales, so too do the demands on the conductor. In general, the two primary concerns are CPU and memory. The speed of a conductor&#x27;s CPU (moreso than the quantity of CPU cores) will have the most impact on its performance as deployments scale up. The amount of memory will have an impact on the responsiveness of the conductor&#x27;s administrative interfaces as the deployments scale up.</p><div class="admonition admonition-note"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>The 128T conductor will run effectively on a virtual machine in both private and public cloud infrastructure. From a physical vs. virtual standpoint, there is no difference in the CPU and memory requirements, and thus the decision ultimately comes down to architectural preference and cost.</p></div></div><p>Running a small lab network or pilot deployment on a modestly sized conductor is acceptable, but be advised that migrating routers from a &quot;temporary&quot; or &quot;POC&quot; conductor to a production conductor may incur downtime during the transition. It is best to procure and deploy suitable hardware up front.</p><p>128 Technology provides a <a href="https://community.128technology.com/viewdocument/128t-conductor-sizing-spreadsheet?CommunityKey=db47b751-299b-4fb9-8859-a7bf877ed8d8&amp;tab=librarydocuments">sizing tool</a> on our community site to give guidance on CPU, memory, and disk requirements for bare metal and cloud conductor deployments.</p><div class="admonition admonition-tip"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Key Decision</h5></div><div class="admonition-content"><p>Size your conductor for the size you anticipate your network to grow to, or the number of nodes your administrative policy caps for a single configuration platform. For deployments in excess of 2,000 managed nodes (remembering that a highly available router counts twice), see the section on POD design below.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="pod-design"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pod-design" title="Direct link to heading">#</a>POD Design</h3><p>The conductor is the single point of configuration for an array of managed routers; as such, its configuration can grow to be quite large. As the configuration grows larger, the processing time for new configuration moves, adds, and changes grows accordingly. 128 Technology recommends that network deployments be sized to a ratio of 2,000 assets per conductor (where an asset is a single instance of 128T software). I.e., either 1,000 highly available routers comprised of two nodes each, 2,000 standalone nodes, or any combination thereof.</p><p>For large scale deployments in excess of 2,000 assets, the conventional approach is to subdivide the network into PODs â€“ independently managed networks. Each POD, or set of managed assets, is independently managed.</p><div class="admonition admonition-tip"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>Key Decision</h5></div><div class="admonition-content"><p>POD design can have impacts on staging and provisioning workflows (for example, identifying during software installation which conductor a router should be homed to), it is recommended to plan for multi-POD deployments at the outset of the program, and not to wait until your deployment is approaching 2,000 nodes.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="tuning-your-system"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#tuning-your-system" title="Direct link to heading">#</a>Tuning your System</h3><p>128 Technology recommends various platform and operating system settings to ensure the optimal performance of your 128T conductor.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="platform-tuning"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#platform-tuning" title="Direct link to heading">#</a>Platform Tuning</h4><p>128 Technology recommends enabling hyperthreading for systems operating as conductors, as it may improve performance.</p><div class="admonition admonition-note"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>Because 128 Technology <em>does not</em> recommend hyperthreading for nodes running 128T software as a router, please be aware when repurposing a host from conductor to router that hyperthreading should be disabled.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="linux-os-tuning"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#linux-os-tuning" title="Direct link to heading">#</a>Linux OS Tuning</h4><p>This section is specifically geared toward end users that want to build their own conductor nodes on top of a base CentOS operating system. For users that install their conductor software using a 128 Technology-provided ISO, these settings will be set already.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configuring-firewalld"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-firewalld" title="Direct link to heading">#</a>Configuring firewalld</h5><p>When deploying conductor on the internet, 128 Technology recommends limiting access to the system using <em>firewalld</em>. (The <a href="https://firewalld.org/"><em>firewalld</em> system daemon</a> is a managed firewall application within Linux.) The basic premise is to restrict inbound access to the public-facing addresses to only allow ports 4505/TCP, 4506/TCP, and 930/TCP. This is generally done by:</p><ol><li>Creating a specific firewalld <strong>zone</strong>; e.g., <code>conductor</code></li><li>Creating a firewalld <strong>service</strong> for the conductor&#x27;s salt master, containing TCP ports 4505, 4506; e.g., <code>salt-master</code></li><li>Creating a firewalld <strong>service</strong> for the conductor&#x27;s NETCONF connection, containing TCP port 930; e.g., <code>netconf</code></li><li>Adding the &quot;salt-master&quot; and &quot;netconf&quot; services to the <code>conductor</code> zone</li><li>Set the public address to be in the <code>conductor</code> zone</li></ol><p>128 Technology has developed some salt states to assist with these common configuration steps. Refer to our <a href="https://github.com/128technology/salt-states/blob/master/setup-firewalld-t128-zone.sls">public Github repo</a> for some samples you can use to tune your system accordingly.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="design-patterns"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#design-patterns" title="Direct link to heading">#</a>Design Patterns</h2><p>This section enumerates the supported topologies for the 128T conductor. Straying from one of these  designs may be possible, but should be avoided unless absolutely necessary.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="public-conductor"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#public-conductor" title="Direct link to heading">#</a>Public Conductor</h3><p>The most conventional deployment model is where the conductor is reachable on a public IPv4 address, and all managed nodes have direct access to it via one or more WAN connections. This is the simplest of all deployment schemes, as it allows you to leverage the global <code>conductor-address</code> fields within the 128T data model to unambiguously define the conductor targets across the entire population of router nodes.</p><p>This design pattern is suitable for both public cloud deployments of the 128T conductor, as well as private cloud deployments where the 128T conductor co-resides alongside other 128T routers in a data center. </p><p>This deployment model is recommended when possible.</p><p>Configuration required:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config auth conductor-address [public address of conductor]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config auth router r1 node n1 device-interface WAN network-interface WAN0 conductor true</span></div></code></pre></div><p>A sample configuration is provided in <a href="#appendix-a-public-conductor">Appendix A</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="public-conductor-behind-nat"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#public-conductor-behind-nat" title="Direct link to heading">#</a>Public Conductor Behind NAT</h3><p>Another common model is a deployment where the conductor is behind a static NAT/firewall, which is forwarding to a private address assigned to the conductor. When placing the conductor behind a static NAT/firewall (effectively giving it a public IP address), be mindful of whether the NAT/firewall supports &quot;hairpinning.&quot; (Hairpinning is when a device sends packets to the public IP address of a NAT that it sits behind.) This is because a conductor&#x27;s salt-minion will connect to its own salt master, and will attempt to do so at the same IP address that all external minions connect to. If the NAT does not support hairpinning, then follow the steps outlined below in the section on <em>Split Horizon Conductor</em>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="port-forwarding"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#port-forwarding" title="Direct link to heading">#</a>Port Forwarding</h4><p>When deploying a conductor behind a firewall, open 930/TCP (used for NETCONF) and 4505-4506/TCP (used for salt) to allow a conductor to communicate to managed routers. Open 443/TCP for the web UI, and 22/TCP for remote SSH.</p><p>Because there is little difference from each deployed router&#x27;s perspective between this and the previous design pattern, the configuration provided in <a href="#appendix-a-public-conductor">Appendix A</a> is representative of this design as well. All NAT awareness exists outside of the 128T&#x27;s configuration.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="conductor-behind-128t"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conductor-behind-128t" title="Direct link to heading">#</a>Conductor Behind 128T</h3><p>Oftentimes a conductor is hosted within a data center that has a 128T head end router at its edge. In these topologies, the design is a hybrid of the previous two (conductor behind NAT, split horizon conductor). From the remote routers&#x27; perspective (i.e., the branch locations not resident at this data center and other data center routers), the conductor is only reachable through the head end 128T router. That same 128T head end router will typically communicate with conductor using a private address.</p><ul><li>The head end fronting the conductor must perform NAT/NAPT to forward 4505/TCP, 4506/TCP, and 930/TCP to the conductor on the data center LAN. The authority-wide <code>conductor-address</code> is an IP address that is resolved/routed to that head end router.</li><li>The head end router overrides the <code>conductor-address</code> with specific configuration to reference the local address.</li><li>The head end router uses <code>management-config-generated</code> set to <code>proxy</code> requests received on its WAN interface (from remote branch sites) to the internal conductor&#x27;s address.</li></ul><p>####Remote Routers: to SVR or not to SVR?
When deploying your conductor behind another 128T at a data center, it opens the possibility of using Secure Vector Routing to reach the conductor using peer paths between a branch and the data center. However, 128 Technology <em>does not recommend</em> using SVR between systems for several reasons:</p><ol><li>It exacerbates the Jekyll/Hyde problem (described below), by virtue of being both at the branch and the data center</li><li>Certain upgrade workflows or maintenance activities will cause remote sites to toggle between SVR and natural routing, which is suboptimal</li></ol><p>A sample configuration is provided in <a href="#appendix-b-conductor-behind-128t">Appendix B</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="conductor-redundancy"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conductor-redundancy" title="Direct link to heading">#</a>Conductor Redundancy</h2><p>Most production deployments include redundant conductor nodes. When deployed as a highly available pair, conductor nodes are always run as <em>active/active</em>, with all managed routers connecting to both. Unlike highly available routers, there is no notion of interface takeover with conductors; each conductor node is given a unique IP address reachable by all devices at all times. The two conductors that comprise a highly available pair will communicate with one another to synchronize state, such that it does not matter which conductor an administrator logs into to view metrics, alarms, etc.</p><p>The two conductor nodes must therefore have IP reachability to one another. For conductor nodes that are physically adjacent to one another, a direct cable between them is the most common deployment style. When separating conductor nodes over any distance, ensure they have a route to reach one another that will not interfere with the connectivity to the nodes they manage.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="geographic-redundancy"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#geographic-redundancy" title="Direct link to heading">#</a>Geographic Redundancy</h3><p>Highly available conductors run as active/active, and have ongoing needs for state synchronization between one another. For this reason, 128 Technology requires that the network between geographically separated conductors have <em>latency of no more than 100ms</em>, and <em>packet loss no greater than 1%</em>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="conductor-access-router-design"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conductor-access-router-design" title="Direct link to heading">#</a>Conductor Access (Router Design)</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="jekyllhyde-access"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#jekyllhyde-access" title="Direct link to heading">#</a>Jekyll/Hyde Access</h3><p>A critical design consideration when configuring 128T routers to talk to the conductor is referred to as the &quot;Jekyll/Hyde&quot; problem: the system daemons that require connectivity to the 128T conductor must have persistent access whether the 128T router application is running or not. As starting the 128T application will typically have an (intentional) impact on that host platform&#x27;s routing behavior, administrators must be aware of two distinct behaviors: the routing configuration in Linux while 128T is stopped (&quot;Dr. Jekyll&quot;), and the routing configuration in Linux while 128T is running (&quot;Mr. Hyde&quot;). Fortunately, the 128T software has facilities to create most, if not all of the requisite configuration.</p><p>When using <em>Conductor Host Services</em> to create your configuration for a router to reach the conductor, the 128T configuration generator will create all of the necessary infrastructure (within both 128T as well as the host platform) to connect to the conductor on the interfaces you&#x27;ve specified. It does so by creating a <em>KNI</em> (Kernel Network Interface), which is a network interface that connects between the Linux kernel and the 128T software.</p><div class="admonition admonition-important"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>important</h5></div><div class="admonition-content"><p>You must also specify <code>conductor=true</code> on one of your network-interface configuration elements, in order for the 128T to recognize which egress path(s) to use.</p></div></div><p>The KNI (named <code>kni254</code>) shuttles packets back and forth between the Linux processses (salt, secureCommunicationManager) and the 128T routing domain. Conductor Host Services will install specific, /32 routes to one or two conductor addresses, using the local KNI address (169.254.127.126) as its next-hop. Those will be sent &quot;up&quot; to the 128T routing domain, where they will match the generated <code>_conductor_</code> service(s), and follow the service-route out of the specified interface.</p><hr><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="appendix-a-public-conductor"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#appendix-a-public-conductor" title="Direct link to heading">#</a>Appendix A: Public Conductor</h1><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        conductor-address  192.0.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        remote-login</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router             datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                 datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            inter-node-security  internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node                 node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                asset-id          b77cefa0-b870-49bc-8b58-31d55bc56527</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                role              combo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:01:00.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name        wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id   2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        conductor   true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address     203.0.113.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     203.0.113.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        203.0.113.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        _conductor_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          _conductor_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  _conductor_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                generated     true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      node1 wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name   node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface   wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    gateway-ip  203.0.113.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router             branch1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                 branch1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            inter-node-security  internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node                 node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                asset-id          04822a5c-1f78-4d82-a442-bcb914c7fd99</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                role              combo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:01:00.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name                   wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id              3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        conductor              true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        inter-router-security  internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat             true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address                198.51.100.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     198.51.100.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        198.51.100.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        _conductor_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          _conductor_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  _conductor_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                generated     true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      node1 wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name   node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface   wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    gateway-ip  198.51.100.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router             bernstein</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name    bernstein</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            system</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                inactivity-timer  86400</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node    node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:01:00.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name       wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id  1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        type       shared</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address    192.0.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     192.0.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        192.0.2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant             _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name         _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description  &quot;Auto generated tenant for internal services&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            generated    true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service            _conductor_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                     _conductor_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            enabled                  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                    private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            tap-multiplexing         false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport                icmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  icmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport                tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address                  192.0.2.2/32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy-generated  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy            _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy           _conductor_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes     false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            source-nat               network-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type         generic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            fqdn-resolution-type     v4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            generated                true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-policy     _conductor_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                         _conductor_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description                  &quot;Auto generated service-policy for conductor services&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            lb-strategy                  proportional</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            session-resiliency           none</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            path-quality-filter          false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            best-effort                  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-loss                     0.5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-latency                  250</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-jitter                   100</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport-state-enforcement  reset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            generated                    true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ingress-source-nat           network-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="notes-on-the-configuration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#notes-on-the-configuration" title="Direct link to heading">#</a>Notes on the Configuration</h2><ol><li><p>The inclusion of <code>conductor-address</code> into the configuration generates the service <code>_conductor_1</code>. Each configuration can contain no more than two <code>conductor-address</code> values configured; a second <code>conductor-address</code> would create <code>_conductor_2</code>.</p></li><li><p>In this configuration, each of the two sample routers (<code>datacenter</code> and <code>branch1</code>) use their WAN interface to reach the Conductor. This is done by setting <code>conductor</code> to <code>true</code> on the WAN interface.</p></li><li><p>The interface used to reach the conductor must have <code>source-nat</code> set to <code>true</code>. (This is because the conductor connection is initiated by a process in Linux, which travels through <code>kni254</code> to reach the 128T&#x27;s forwarding plane, and will have an unroutable source address: 169.254.127.127.)</p></li></ol><hr><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="appendix-b-conductor-behind-128t"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#appendix-b-conductor-behind-128t" title="Direct link to heading">#</a>Appendix B: Conductor behind 128T</h1><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        conductor-address  203.0.113.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        remote-login</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router             datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                           datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            conductor-address              172.20.0.128</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            inter-node-security            internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node                           node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                asset-id          b77cefa0-b870-49bc-8b58-31d55bc56527</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                role              combo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:01:00.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name        wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id   2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        conductor   false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant      internet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address     203.0.113.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     203.0.113.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        203.0.113.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  lan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               lan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:02:00.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  lan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name        lan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id   4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        conductor   true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address     172.20.0.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     172.20.0.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            management-service-generation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-route-type  paths-as-next-hop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                proxy               true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route                  _conductor_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          _conductor_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  _conductor_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                generated     true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      node1 lan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name       node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface       lan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    target-address  172.20.0.128</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route                  _conductor_datacenter_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          _conductor_datacenter_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  _conductor_datacenter_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                generated     true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      node1 lan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name   node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface   lan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    gateway-ip  172.20.0.128</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router             branch1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                 branch1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            inter-node-security  internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node                 node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                asset-id          04822a5c-1f78-4d82-a442-bcb914c7fd99</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                role              combo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:01:00.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name                   wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id              3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        conductor              true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        inter-router-security  internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat             true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address                198.51.100.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     198.51.100.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        198.51.100.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        _conductor_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          _conductor_1_route_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  _conductor_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                generated     true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      node1 wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name   node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface   wan1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    gateway-ip  198.51.100.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router             bernstein</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name    bernstein</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            system</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                inactivity-timer  86400</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node    node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               ethernet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:01:00.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    forwarding         false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name       wan0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id  1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        type       shared</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address    192.0.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     192.0.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        192.0.2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant             internet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name         internet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description  &quot;Public internet&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            member       internet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                neighborhood  internet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                address       0.0.0.0/0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant             _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name         _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description  &quot;Auto generated tenant for internal services&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            generated    true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service            _conductor_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                     _conductor_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            enabled                  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                    private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            tap-multiplexing         false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport                icmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  icmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport                tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address                  203.0.113.2/32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy-generated  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy            _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy            internet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      internet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy           _conductor_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes     false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            source-nat               network-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type         generic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            fqdn-resolution-type     v4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            generated                true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service            _conductor_datacenter_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                     _conductor_datacenter_1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to               router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  datacenter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            enabled                  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            scope                    private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            tap-multiplexing         false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport                icmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol  icmp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport                tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    930</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    4505</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    end-port    4506</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address                  172.20.0.128/32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy-generated  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy            _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-policy           _conductor_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes     false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            source-nat               network-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type         generic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            fqdn-resolution-type     v4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            generated                true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-policy     _conductor_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                         _conductor_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description                  &quot;Auto generated service-policy for conductor services&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            lb-strategy                  proportional</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            session-resiliency           none</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            path-quality-filter          false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            best-effort                  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-loss                     0.5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-latency                  250</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-jitter                   100</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport-state-enforcement  reset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            generated                    true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ingress-source-nat           network-interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="notes-on-the-configuration-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#notes-on-the-configuration-1" title="Direct link to heading">#</a>Notes on the Configuration</h2><ol><li><p>As in the previous example, the interfaces that have <code>conductor</code> set to <code>true</code> also require <code>source-nat</code> to be set to <code>true</code>.</p></li><li><p>The datacenter router includes new configuration in the <code>management-service-generation</code> container; <code>proxy</code> is set to <code>true</code>, to forward requests received on its WAN interface to the conductor&#x27;s private IP. The <code>paths-as-next-hop</code> value for <code>service-route-type</code> will generate one <code>service-route</code> to reach the conductor, with multiple next-hops for configurations with more than one conductor. The other choice, <code>paths-as-service-route</code> will generate multiple <code>service-route</code> configurations with a single next-hop apiece.</p></li><li><p>In this design, the datacenter router reaches to the conductor using the <code>lan</code> interface. The global <code>conductor-address</code> is overridden by the router. (If there are two conductors configured at the authority level, any router that overrides the addresses must override both.)</p></li><li><p>The datacenter&#x27;s unique accesss create a unique service specific to it: <code>_conductor_datacenter_1</code>. It has the actual conductor&#x27;s address configured and will match the requests arriving via <code>kni254</code>.</p></li><li><p>The generated <code>_conductor_1</code> service will require that the <code>access-policy-generated</code> toggle be set to <code>false</code>, and that the <code>access-policy</code> contain a reference to the WAN interfaces of the remote site(s). In our case, we have the WAN interface of the <code>datacenter</code> router in an &quot;internet&quot; neighborhood (0.0.0.0/0), such that any inbound, non-SVR request on the WAN will be treated as sourced from the <code>internet</code> tenant. We&#x27;ve added an <code>access-policy</code> statement for allowing inbound access to the <code>internet</code> tenant.</p></li></ol><div class="admonition admonition-note"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>This tenancy design may require some tuning to fit into your environment. It is good practice to use tenancy on your WAN interfaces (in the form of neighborhood/membership, preferably). This gives you more control over the security of an interface. For example, we could have a tenant named <code>remote-sites</code> that contains the WAN IP addresses of the remote sites (presuming they&#x27;re static addresses), and use that in our <code>_conductor_1</code> access-policy instead of <code>internet</code>. This would restrict inbound access. But for cases where branch offices use dynamic addressing (DHCP), this is not possible.</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/128technology/docs/tree/master/docs/bcp_conductor_deployment.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-03-16T20:16:28.000Z" class="docLastUpdatedAt_1sqk">3/16/2020</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/events"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">Â« Alarms and Events</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/bcp_lte_peering"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">LTE Peering Â»</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#about-this-guide" class="contents__link">About this Guide</a><ul><li><a href="#terminology" class="contents__link">Terminology</a></li></ul></li><li><a href="#universal-considerations" class="contents__link">Universal Considerations</a><ul><li><a href="#platform-requirements" class="contents__link">Platform Requirements</a></li><li><a href="#pod-design" class="contents__link">POD Design</a></li><li><a href="#tuning-your-system" class="contents__link">Tuning your System</a></li></ul></li><li><a href="#design-patterns" class="contents__link">Design Patterns</a><ul><li><a href="#public-conductor" class="contents__link">Public Conductor</a></li><li><a href="#public-conductor-behind-nat" class="contents__link">Public Conductor Behind NAT</a></li><li><a href="#conductor-behind-128t" class="contents__link">Conductor Behind 128T</a></li></ul></li><li><a href="#conductor-redundancy" class="contents__link">Conductor Redundancy</a><ul><li><a href="#geographic-redundancy" class="contents__link">Geographic Redundancy</a></li></ul></li><li><a href="#conductor-access-router-design" class="contents__link">Conductor Access (Router Design)</a><ul><li><a href="#jekyllhyde-access" class="contents__link">Jekyll/Hyde Access</a></li></ul></li><li><a href="#notes-on-the-configuration" class="contents__link">Notes on the Configuration</a></li><li><a href="#notes-on-the-configuration-1" class="contents__link">Notes on the Configuration</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center">Copyright Â© 2020 128 Technology, Inc.</div></div></footer>
</div>

<script src="/styles.b677349c.js"></script>

<script src="/runtime~main.4a304c45.js"></script>

<script src="/main.766ebc80.js"></script>

<script src="/1.9aad4596.js"></script>

<script src="/2.4c453d4b.js"></script>

<script src="/41.825189b6.js"></script>

<script src="/20ac7829.0f1575ee.js"></script>

<script src="/17896441.5e8a9f16.js"></script>

<script src="/fa10e3f3.621fa17d.js"></script>


</body>
</html>