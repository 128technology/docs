<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-167298415-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="128T Docs" href="/opensearch.xml"><title data-react-helmet="true">Cloud High Availability Plugin | 128T Docs</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Cloud High Availability Plugin | 128T Docs"><meta data-react-helmet="true" name="description" content="The 128T-cloud-ha plugin provides High Availability (HA) functionality for the 128T Networking Platform deployed in the cloud. HA for 128T routers in a non-cloud environment uses traditional techniques such as VRRP and GARP which both rely on a virtual MAC and virtual IP. In cloud environments such as AWS, Azure, etc., any techniques that rely on broadcast and multicast are not supported. This plugin uses node health metrics sent over SVR, as well as cloud API interactions to perform failovers in these cloud environments."><meta data-react-helmet="true" property="og:description" content="The 128T-cloud-ha plugin provides High Availability (HA) functionality for the 128T Networking Platform deployed in the cloud. HA for 128T routers in a non-cloud environment uses traditional techniques such as VRRP and GARP which both rely on a virtual MAC and virtual IP. In cloud environments such as AWS, Azure, etc., any techniques that rely on broadcast and multicast are not supported. This plugin uses node health metrics sent over SVR, as well as cloud API interactions to perform failovers in these cloud environments."><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/plugin_cloud_ha"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/plugin_cloud_ha"><link rel="stylesheet" href="/styles.b64930b1.css">
<link rel="preload" href="/styles.acd3c316.js" as="script">
<link rel="preload" href="/runtime~main.4739cbad.js" as="script">
<link rel="preload" href="/main.ec60010b.js" as="script">
<link rel="preload" href="/1.e75df5ca.js" as="script">
<link rel="preload" href="/2.3e8767f9.js" as="script">
<link rel="preload" href="/156.2fcae726.js" as="script">
<link rel="preload" href="/159.6cd6c5f0.js" as="script">
<link rel="preload" href="/935f2afb.60f41bfb.js" as="script">
<link rel="preload" href="/17896441.94eee8a0.js" as="script">
<link rel="preload" href="/7fa6ed4f.378bf357.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Juniper Logo"><strong class="navbar__title">Session Smart</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Interchange</a><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Juniper Logo"><strong class="navbar__title">Session Smart</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Docs</a></li><li class="menu__list-item"><a href="https://community.128technology.com/home" target="_blank" rel="noopener noreferrer" class="menu__link">Interchange</a></li><li class="menu__list-item"><a href="https://www.128technology.com/" target="_blank" rel="noopener noreferrer" class="menu__link">Company</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_128t">128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_svr_savings">Secure Vector Routing Savings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_releases">128T Releases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_support_policy">Software Support Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_supported_platforms">Platform Support Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_certified_platforms">Certified Platforms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_security_policy">Security Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/about_services_description">Services Description</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/CONTRIBUTING">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_getting_started">Getting Started with the 128T Networking Platform</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Considerations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_system_reqs">System Requirements</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installation Process</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation">Installation Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_downloading_iso">Downloading ISOs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_creating_bootable_usb">Creating Bootable USB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_bootable_media">Conductor Interactive Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_basic_conductor_config">Configure the Conductor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_basic_router_config">Basic Router Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_otp_iso_install">Router Installation Using OTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_install_quickstart_otpiso">QuickStart from the OTP ISO</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Cloud Installations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_aws">Installing from the AWS Marketplace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_quickstart_aws">QuickStart Installation in AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_azure">Installing in Azure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_initialize_HA_conductor">Conductor High Availability for Cloud Deployments</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Supporting Information - Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_installation_installer">Manually Installing the 128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/legacy_OTP_install">Installing Using the Pre-5.0 Interactive ISO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_upgrading">Upgrading</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro_rollback">Rollback</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_application_discovery">Application Discovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_appid">Application Identification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_EthOverSVR">Ethernet Over Secure Vector Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_ha_theoryofoperation">HA - Theory of Operation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_interface_types">Interface Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_kni">Kernel Network Interfaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_linux_host_networking">Linux Host Networking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_learning_VRF_routes">Learning VRF Routes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_network_planes">Forwarding Planes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_metadata">128T Metadata</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_machine_communication">Machine Communication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_pcli">PCLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_session_timer">Session Timers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_STEP">Service and Topology Exchange Protocol (STEP)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_waypoint_ports">Waypoints</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/concepts_glossary">Glossary</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Administration</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_basics">Configuration Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_access_mgmt">Access Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_asset_connection_resiliency">Asset Connection Resiliency</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_bgp">BGP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_vrf_learning">VRF Learning via BGP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_reference_guide">Element Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_audit_event">Audit Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_dhcp">DHCP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_ldap">LDAP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_management_over_forwarding">Management over Forwarding</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_EthoSVR">Configuring Ethernet Over Secure Vector Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_ha">High Availability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_dual_router_ha">High Availability (Dual Router)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_non_forwarding_ha_interfaces">Non-forwarding HA Interfaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_adding_interfaces_to_ha_team">Adding Interfaces to HA Team Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_transition_standalone_to_ha">Transitioning a Conductor from Standalone to HA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_nat">NAT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_ospf">OSPF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_rate_limiting">Rate Limiting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_RBAC">Configuring Role-Based Access Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_snmp">SNMP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_static_hostname_mapping">Static Hostname Mappings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_STEP">Configuring Service and Topology Exchange Protocol (STEP)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_tenants">Tenants</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config_templates">Configuration Templates</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sec_adaptive_encrypt">Adaptive Encryption</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">How To</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_conductor_migration">Conductor Migration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_extend_gui_nav">Extending GUI Nav</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_lte">LTE and Dual LTE Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_config_PPPoE">Configuring Dual PPPoE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_maintenance_mode">Maintenance Mode</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_ms365">Microsoft 365</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_trusted_ca_certificate">Adding a Trusted Certificate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/howto_tune_bfd">Tuning BFD</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_applications">Application Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_ap_salt_minion">AP: Salt Minion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_cpu_spikes">CPU Spikes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_forwarding_resource_pools">Forwarding Plane Resource Pools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_logs">Logs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_mac_uniqueness">MAC Address Uniqueness</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_packet_capture">PCLI Packet Capture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_t1_troubleshooting">T1 Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ts_troubleshooting_vrf">Troubleshooting VRF</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_overview">Alarm and Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_alarms">Alarms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events_events">Events</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_att_avpn_configuration">AT&amp;T AVPN Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_using_128T_as_ntp_server">Branch NTP Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_conductor_deployment">Conductor Deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_qos_msft_expressroute">ExpressRoute QoS Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_lte_peering">LTE Peering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_monitoring_headends">Monitoring Head End Routers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_salt_pillars">Saltstack at Scale With 128T</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_sdwan_design_guide">SD-WAN Design Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_service_and_service_policy_design">Service and Service Policy Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_service-policy_defaults">Service Policy Baseline Defaults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bcp_tenants">Tenancy Design</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLI Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli_reference">Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli_stats_reference">Show Stats Reference</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installer/Initializer Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installer_cli_reference">Installer Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installer_preferences">Installer Preferences File Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/initializer_cli_reference">Initializer Command Line Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/initializer_preferences">Initializer Preferences File Reference</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_bgp_community_services">BGP Community Services</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/plugin_cloud_ha">Cloud HA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_dns_app_id">DNS App Id</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_dns_cache">DNS Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_gre">GRE</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_icmp_reachability_detection">ICMP Reachability Detection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_ipsec_client">IPsec Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_loopback_static_routes">Loopback Static Routes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_m800_watchdog">M800 Watchdog</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_monitoring_agent">Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_mosh">Mosh</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_set_hostname">Set Hostname</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_sip_alg">SIP ALG</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_wireguard">Wireguard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin_kni_namespace_scripts">KNI Namespace Scripts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">REST APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api_rest_4.2.0">128T-4.2.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">128T</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.1">5.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_5.0">5.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.5">4.5</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.4">4.4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.3">4.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.2">4.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.1">4.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_4.0">4.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">128T Installer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.7">2.7</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.6">2.6</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.5">2.5</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.4">2.4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.3">2.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.2">2.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_installer_2.1">2.1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">128T SIP ALG</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_sip_alg_2.1">2.1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">128T ZScaler</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/release_notes_128t_zscaler_1.1">1.1</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Cloud High Availability Plugin</h1></header><div class="markdown"><p>The 128T-cloud-ha plugin provides High Availability (HA) functionality for the 128T Networking Platform deployed in the cloud. HA for 128T routers in a non-cloud environment uses traditional techniques such as VRRP and GARP which both rely on a virtual MAC and virtual IP. In cloud environments such as AWS, Azure, etc., any techniques that rely on broadcast and multicast are not supported. This plugin uses node health metrics sent over SVR, as well as cloud API interactions to perform failovers in these cloud environments.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The instructions for installing and managing the plugin can be found <a href="/docs/plugin_intro#installation-and-management">here</a>.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="supported-solutions"></a>Supported Solutions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#supported-solutions" title="Direct link to heading">#</a></h2><table><thead><tr><th>Solution Name</th><th><code>solution-type</code></th><th>Available In Version</th></tr></thead><tbody><tr><td>Azure VNET</td><td><code>azure-vnet</code></td><td>2.0.0</td></tr><tr><td>Azure Loadbalancer</td><td><code>azure-lb</code></td><td>2.0.0</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="version-restrictions"></a>Version Restrictions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#version-restrictions" title="Direct link to heading">#</a></h2><p> The router component can only be installed on versions of 128T which support provisional state on <em>device interfaces</em>. This is necessary for the plugin to be able to prevent asymmetrical routing.
The versions of 128T that support this feature have a <code>Provides: 128T-device-interface-api(1.0)</code>, so it can be checked ahead of time by performing a <code>rpm -q --whatprovides 128T-device-interface-api(1.0)</code> to see if the currently installed 128T satisfies this requirement or <code>dnf list --whatprovides 128T-device-interface-api(1.0)</code> to see all versions of 128T that satisfy this requirement.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="plugin-behavior"></a>Plugin Behavior<a aria-hidden="true" tabindex="-1" class="hash-link" href="#plugin-behavior" title="Direct link to heading">#</a></h2><p><img alt="architecture" src="/assets/images/cloud-ha-architecture-347bc488da8f21bedb0da9f1cd562a8f.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="monitoring-agent"></a>Monitoring Agent<a aria-hidden="true" tabindex="-1" class="hash-link" href="#monitoring-agent" title="Direct link to heading">#</a></h3><p>The job of the Monitoring Agent is to produce and transmit health status messages. The Monitoring Agent collects the administrative status, operational status, and mac address of all of the configured redundant interfaces and additional interfaces at one second intervals. The health status is then sent via an HTTP POST to the IP address of the <code>cloud-ha</code> interface where the HA Agent is listening on port 12800.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ha-agent"></a>HA Agent<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ha-agent" title="Direct link to heading">#</a></h3><p>The job of the HA Agent is to process the health status messages from the the local Monitoring Agent and determine the health status for performing failover operations. For an interface to be healthy, it must be administratively and operationally up. For a node to be healthy, it must have at least one healthy <code>redundant-interface</code>. If there are additional interfaces configured, then the node must have at least one healthy <code>additional-interface</code>.</p><p>The following flow diagram summarizes the process followed by the HA Agent using information supplied by the Monitoring Agent, and resulting in interactions with the API Agent.</p><p><img alt="HA Agent Flow Diagram" src="/assets/images/cloud-ha-ha-agent-flow-diagram-1508de7b8a95497ed25571e40b41451d.png"></p><p>An HA Agent configured with a priority of 1 will be defined as the Primary node; a priority of 2 becomes the Secondary node. </p><ul><li>Primary: This node is preferred to be active except when the local node is unhealthy.</li><li>Secondary: This node is preferred to become active only when the local node is healthy and the remote node is unhealthy or unreachable.</li></ul><p>The internal state machines wait for the value set in seconds in <code>up-holddown-timeout</code> before considering a node healthy. If at any point during that wait the HA Agent receives an unhealthy status, the timeout will be reset and the node is considered unhealthy.</p><p>The internal state machines wait for the <code>peer-reachability-timeout</code> after every health status before considering the node unreachable. The timer is reset if a health report is processed before the timeout expires.</p><p>When the HA Agent determines that a node must become active, the first active redundant interface&#x27;s mac address and the list of configured prefixes are sent to the API Agent&#x27;s appropriate REST endpoint. The HA Agent changes the provisional status of the configured <code>redundant-interface</code> to <strong>Up</strong>. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="api-agents"></a>API Agents<a aria-hidden="true" tabindex="-1" class="hash-link" href="#api-agents" title="Direct link to heading">#</a></h3><p>The job of the API Agent is to perform failover actions specific to the cloud provider and the chosen solution.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="azure-loadbalancer"></a>Azure Loadbalancer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#azure-loadbalancer" title="Direct link to heading">#</a></h4><p>A <code>solution-type</code> of <code>azure-lb</code> can be used to enable the Azure Loadbalancer API agent. This solution requires an <a href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview" target="_blank" rel="noopener noreferrer">Azure Loadbalancer</a> to be configured using an HTTP probe on the <code>probe-port</code> with backend pools pointing towards the redundant interfaces. </p><p>Probe example:</p><p><img alt="Azure Loadblancer Probe Configuration" src="/assets/images/cloud-ha-azure-lb-probe-config-2797db24e4678a45df16de5e2d8dcda7.png"></p><p>Backend Pool example:</p><p><img alt="Azure Loadblancer Backend Pool Configuration" src="/assets/images/cloud-ha-azure-lb-backend-pool-config-fec533861724cfbc1c723bbca45b332e.png"></p><p>The Azure Loadbalancer sends a health probe to the redundant 128T&#x27;s redundant interfaces. These probes are routed through the <code>cloud-ha</code> interface, through a <code>128T-azure-lb-nginx</code> instance, and down to the Azure Loadbalancer API Agent. </p><p>The Azure Loadbalancer API Agent responds to the probes with a <code>200</code> status code when the current node is active and a <code>500</code> code when its inactive. A probe to the inactive node will not reach the 128T when the redundant interfaces are set provisionally down.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="azure-vnet"></a>Azure VNET<a aria-hidden="true" tabindex="-1" class="hash-link" href="#azure-vnet" title="Direct link to heading">#</a></h4><p>A <code>solution-type</code> of <code>azure-vnet</code> can be used to enable the Azure VNET API agent. It requires an Azure Route Table setup on the same VNET as the redundant interfaces. The Virtual Machines where these members are running must be granted the following permissions in order for the route updates to work correctly:</p><ul><li>Microsoft.Network/routeTables/read</li><li>Microsoft.Network/networkInterfaces/read</li><li>Microsoft.Network/routeTables/routes/*/write</li><li>Microsoft.Network/routeTables/routes/read</li><li>Microsoft.Compute/virtualMachines/read</li><li>Microsoft.Network/virtualNetworks/read</li></ul><p>The agent finds all of the route tables within the VNET using the Azure REST APIs. When a redundant interface becomes active, the agent updates the route tables for all the configured prefixes to point to that interface. The solution is designed to be idempotent, so the peer member&#x27;s redundant interface will now be inactive. There is no update to the route table needed when becoming inactive.</p><p><code>Microsoft.Network/virtualNetworks/read</code> is only necessary when the plugin should discover and modify peer VNET route tables. This feature can be enabled by configuring <code>include-peer-vnets</code> to <code>true</code>.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>To prevent routing loops, the solution will not update the Azure Route Tables assigned to a subnet that has an activating node&#x27;s <em>network interface</em>.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scenarios"></a>Scenarios<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scenarios" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="both-healthy"></a>Both Healthy<a aria-hidden="true" tabindex="-1" class="hash-link" href="#both-healthy" title="Direct link to heading">#</a></h3><p>In the case where both members are healthy, the primary node is preferred and set to active. The secondary node is inactive. The redundant interface on the secondary node is set provisionally down and the API Agent steers traffic towards the primary node.</p><p><img alt="both-healthy-scenario" src="/assets/images/cloud-ha-both-healthy-scenario-da33d383ca2729425f2f21b2fde4561a.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="primary-failure"></a>Primary Failure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#primary-failure" title="Direct link to heading">#</a></h3><p>When the <strong>primary node</strong> becomes unhealthy and the redundant interfaces are operationally down, the Monitoring Agent sends an unhealthy status to the local HA Agent. When the <strong>local node</strong> is deemed unhealthy, the local HA Agent sends an unhealthy message to the remote HA Agent, and notifies the internal state machine. When the <strong>primary node</strong> recognizes it is no longer fit to process traffic, it becomes inactive. The <strong>secondary node</strong> recognizes the primary node is not processing traffic, and the <strong>secondary node</strong> is healthy so the secondary node becomes active.</p><p><img alt="primary-failure-scenario" src="/assets/images/cloud-ha-primary-failure-scenario-61a5bfef1e2d2b36299756e0d1eda755.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="primary-recovery"></a>Primary Recovery<a aria-hidden="true" tabindex="-1" class="hash-link" href="#primary-recovery" title="Direct link to heading">#</a></h3><p>Now something causes the primary node to recover and the <code>redundant-interface</code> becomes healthy again. The healthy statuses will propagate to the primary and secondary HA Agents and they will update their internal state machines which will determine that they are back to the Both Healthy Scenario. The primary node will become active and the secondary node will become inactive.</p><p><img alt="both-healthy-scenario" src="/assets/images/cloud-ha-both-healthy-scenario-da33d383ca2729425f2f21b2fde4561a.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="secondary-failure"></a>Secondary Failure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#secondary-failure" title="Direct link to heading">#</a></h3><p>Now let us consider after recovering, the secondary node becomes unhealthy. The primary node will recognize that it is still healthy so it will not do anything and continue to process traffic. The secondary node will also realize that it is unfit to process traffic so it will also not do anything and continue sit idle.</p><p><img alt="secondary-failure-scenario" src="/assets/images/cloud-ha-secondary-failure-scenario-01c12db4240126767aa1e7e16297b507.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="secondary-recovery"></a>Secondary Recovery<a aria-hidden="true" tabindex="-1" class="hash-link" href="#secondary-recovery" title="Direct link to heading">#</a></h3><p>If the problem with the secondary node resolves, then the HA Agents will update their internal state, but again since traffic is preferred to flow the same as before, both the primary and secondary will not perform any API calls to the API Agents.</p><p><img alt="secondary-recovery-scenario" src="/assets/images/cloud-ha-secondary-recovery-scenario-2852dbcd653070aadcf15d69d5432652.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="primary-shutdown"></a>Primary Shutdown<a aria-hidden="true" tabindex="-1" class="hash-link" href="#primary-shutdown" title="Direct link to heading">#</a></h3><p>This scenario is what will occur if the primary node were to be taken down for maintenance or failed completely. The primary node&#x27;s HA Agent (and Monitoring Agent and API Agent) will be shutdown when 128T is shutdown, so it will not perform any failover operations. The secondary node will wait for <code>peer-reachability-timeout</code> seconds of not hearing from the primary node to determine that the secondary node is unreachable. Once the primary node is determined unreachable, the secondary HA Agent will take over and become active since it does not know if the primary node is shutdown or unreachable.</p><p><img alt="primary-shutdown-scenario" src="/assets/images/cloud-ha-primary-shutdown-scenario-044f8017a5b506aead38404306b3e0e8.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="secondary-shutdown"></a>Secondary Shutdown<a aria-hidden="true" tabindex="-1" class="hash-link" href="#secondary-shutdown" title="Direct link to heading">#</a></h3><p>If the secondary node is shutdown while the primary is healthy, the primary HA Agent will deteremine the secondary node unreachable. Similar to the the Secondary Failure scenario, since the primary node is preferred, it will not do anything and continue to process traffic.</p><p><img alt="secondary-shutdown-scenario" src="/assets/images/cloud-ha-secondary-shutdown-scenario-0e31057330e473ab41d153fdf72abacd.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="split-brain"></a>Split Brain<a aria-hidden="true" tabindex="-1" class="hash-link" href="#split-brain" title="Direct link to heading">#</a></h3><p>This is slightly distinct from the Primary Shutdown or Secondary Shutdown because both nodes and HA Agents are up and running, but the peer link between the nodes is down. In this case, both HA Agents determine that the other HA Agent is unreachable. This is indistinguisable from the other node being shutdown, so both HA Agents will determine they are in the position to take control of traffic, so whichever node was not already active will become active. This means that both nodes will have their <code>redundant-interface</code>s provisionally up. For the <code>azure-vnet</code> solution, there will still only be one node that the route tables are pointing their routes towards due to the nature of the solution. For the <code>azure-lb</code> solution, both nodes will respond to the probes so traffic will be split according to the Azure Loadbalancer configuration. This situation can cause asymmetrical routing where if branch traffic comes in on the node that the solution is not pointed towards, then traffic will be sent into Azure through that node and come back in through the other node.</p><p>The split brain scenario can be identified if the peers can&#x27;t reach each other which will be captured with alarms:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># show alarms</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">========================= ===================== ========== ======== =========== =======================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ID                        Time                  Severity   Source   Category    Message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">========================= ===================== ========== ======== =========== =======================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> router.node:11            2020-12-16 05:40:40   CRITICAL   router2    PEER      Peer router2 is not reachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> router2.node2:10          2020-12-16 05:40:42   CRITICAL   router     PEER      Peer router is not reachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Another indicator of a split brain scenario is having the <code>remote-status</code> be <code>unreachable</code> for the <a href="#state-fields">state output</a> for both members.</p><p><img alt="split-brain-scenario" src="/assets/images/cloud-ha-split-brain-scenario-84ab365c12b5b6b7f17163bb9b9e4d3f.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="split-brain-resolution"></a>Split Brain Resolution<a aria-hidden="true" tabindex="-1" class="hash-link" href="#split-brain-resolution" title="Direct link to heading">#</a></h3><p>Once the health statuses are able to flow between the two nodes, the unreachable status that each Cloud HA Agent has for the other node will resolve to healthy or unhealthy. Even if the determination of whether the node is the same as it was before, each HA Agent will still set the provisional statuses and make the appropriate HTTP call on API Agent. This is because each node does not know what calls the other node made while the split brain was occurring, so it is safer to make calls even if it may not be necessary. Consider the scenario where the primary node is active and the secondary node is inactive before a split brain. When the split brain occurs, the secondary will then become active. If this is with a solution like <code>azure-vnet</code>, the last node to hit the API Agent will be the one that the solution point to. Thus the secondary node will be the active node from the Azure Route Table&#x27;s perspective. Once the split brain is resolved, without the extra API calls, the primary would stay active without making any API calls and the secondary would become inactive. The problem with this is that the last node to trigger the API Agent was the secondary node so all branch bound traffic would be sent into interfaces that are provisionally down. The plugin solves this by reperforming API calls when it detects that the remote node goes from unreachable to not unreachable.</p><p><img alt="both-healthy-scenario" src="/assets/images/cloud-ha-both-healthy-scenario-da33d383ca2729425f2f21b2fde4561a.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration"></a>Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="groups"></a>Groups<a aria-hidden="true" tabindex="-1" class="hash-link" href="#groups" title="Direct link to heading">#</a></h3><p>A group is a collection of nodes which all share the same settings such as the solution type. In the below configuration snippet, there is an example of each of the supported solution types with the solution-specific configuration explicitly configured with their defaults. <code>group1</code> has all of the solution-agnostic configuration settings explicitly configured with their defaults.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cloud-redundandy-group group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        enabled true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        solution-type azure-lb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        additional-branch-prefix 1.1.1.1/32</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        additional-branch-prefix 2.2.2.2/24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        up-holddown-timeout 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        peer-reachability-timeout 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        remote-health-network 169.254.180.0/24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        health-interval 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cloud-redundandy-group group2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name group2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        solution-type azure-vnet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        include-peer-vnets false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><table><thead><tr><th>Element</th><th>Type</th><th>Properties</th><th>Description</th><th></th></tr></thead><tbody><tr><td>name</td><td>string</td><td>key</td><td>The name of the group to be referenced in other places.</td><td></td></tr><tr><td>enabled</td><td>boolean</td><td>default: true</td><td>Whether the group is enabled.</td><td></td></tr><tr><td>solution-type</td><td>enum</td><td>required</td><td>The solution to use on member nodes.  Value can be one of the values in #Supported Solutions.</td><td></td></tr><tr><td>additional-branch-prefix</td><td>list: ip-prefix</td><td></td><td>Additional ip prefixes that the member routers will control.</td><td></td></tr><tr><td>up-holddown-timeout</td><td>int</td><td>default: 2</td><td>The number of seconds to wait before declaring a member up.</td><td></td></tr><tr><td>peer-reachability-timeout</td><td>int</td><td>default: 10</td><td>The number of seconds to wait before declaring a peer unreachable. This field must be at least twice the value of <code>health-interval</code>.</td><td></td></tr><tr><td>health-interval</td><td>int</td><td>default: 2</td><td>The interval in seconds for health reports to be collected.</td><td></td></tr><tr><td>remote-health-network</td><td>ip-prefix</td><td>default: 169.254.180.0/24</td><td>The ip prefix to use for inter-member health status messages.</td><td></td></tr><tr><td>include-peer-vnets</td><td>boolean</td><td>if: solution-type = azure-vnet, default: false</td><td>Whether to include peer VNETs as part of the route table discovery algorithm.</td><td></td></tr><tr><td>probe-port</td><td>port</td><td>if: solution-type = azure-lb, default: 12801</td><td>The port that the Azure Loadbalancer will be sending the HTTP probes on.</td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="membership"></a>Membership<a aria-hidden="true" tabindex="-1" class="hash-link" href="#membership" title="Direct link to heading">#</a></h3><p>Membership is how a node declares that it is part of a group. The configuration for a membership exists under the node and is where the node-specific configuration exists.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">node</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cloud-redundancy-plugin-network 169.254.137.0/30</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cloud-redundancy-membership group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cloud-redundancy-group group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        priority 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        redundant-interface private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        redundant-interface private2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        additional-interface public1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        additional-interface public2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        log-level</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ha-agent info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            api-agent info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">node</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cloud-redundancy-membership group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cloud-redundancy-group group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        priority 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        redundant-interface private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><table><thead><tr><th>Element</th><th>Type</th><th>Properties</th><th>Description</th></tr></thead><tbody><tr><td>cloud-redundancy-plugin-network</td><td>ip-network</td><td>default: 169.254.137.0/30</td><td>The ip network to use for internal networking. This should only be configured when the default value conflicts with a different service in the configuration.</td></tr><tr><td>cloud-redundancy-group</td><td>reference</td><td>required</td><td>The group that this member belongs to.</td></tr><tr><td>priority</td><td>int</td><td>min-value: 1, max-value:2</td><td>The priority of the member where lower priority has higher preference.</td></tr><tr><td>redundant-interface</td><td>list: reference</td><td>min-number: 1</td><td>The <em>device interfaces</em> that will be redundant with the <code>redundant-interfaces</code> on the peer members.</td></tr><tr><td>additional-interface</td><td>list: reference</td><td></td><td>The <em>device interfaces</em> that will be considered for node health, but not considered for redundant operations.</td></tr><tr><td>log-level/ha-agent</td><td>log-level</td><td>default: info</td><td>The log level for the HA Agent.</td></tr><tr><td>log-level/api-agent</td><td>log-level</td><td>default: info</td><td>The log level for the active API Agent.</td></tr></tbody></table><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Nodes can only be members of one group.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="address-prefixes"></a>Address Prefixes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#address-prefixes" title="Direct link to heading">#</a></h3><p>Certain prefixes can be configured to be controlled by the Cloud HA 128T by tagging services with groups. The services that are tagged with a certain group will have all of their <code>address</code> fields added to the list of configured prefixes.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    address 3.3.3.3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    address 4.4.4.4/24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cloud-redundancy-group group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cloud-redundancy-group azure-vnet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><p>Any additional prefixes that should be included in the controlled prefix list can be configured as <code>additional-branch-prefix</code>s under the group.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="generated-128t-configuration"></a>Generated 128T Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#generated-128t-configuration" title="Direct link to heading">#</a></h2><p>To see a full blown configuration and the configuration it generates, look at <code>Complete Example Configuration</code> in the <code>Appendix</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="validation"></a>Validation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#validation" title="Direct link to heading">#</a></h3><p>The following criteria need to be met in order for the cloud-ha plugin to take effect for a specific group:</p><ul><li>Priorities across all members in a group are unique.</li><li>IP Network fields such as <code>remote-health-network</code> and <code>cloud-redundancy-plugin-network</code> are validated to be an acceptable prefix size.</li><li>The <code>peer-reachability-timeout</code> for a group must be at least twice the amount of time as the <code>health-interval</code>.</li></ul><p>Please check <code>/var/log/128technology/plugins/cloud-ha-config-generation.log</code> on the Conductor for the errors causing the config to be invalid.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration-assumptions"></a>Configuration Assumptions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration-assumptions" title="Direct link to heading">#</a></h3><p>The components that are assumed to be setup already:</p><ul><li>There is at least one functioning forwarding <em>device interface</em> on each of the member nodes.</li><li>There is peering between member nodes if the member nodes are not under the same router.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cloud-ha-loopback-interface"></a>Cloud HA Loopback Interface<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cloud-ha-loopback-interface" title="Direct link to heading">#</a></h3><p>An interface with the name <code>cloud-ha</code> is generated for each node that is a member of an enabled group. This interface is used for the solution to communicate with the other group members and any other outside entities such as a load balancer.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="health-status-transport"></a>Health Status Transport<a aria-hidden="true" tabindex="-1" class="hash-link" href="#health-status-transport" title="Direct link to heading">#</a></h3><p>To facilitate the transport of the health status between members of the same group, the plugin generates services and service routes. Services are generated to classify the health summaries that each member sends to its peers. The address that they use is an address from the network defined in <code>remote-health-network</code> under the group config. If the two nodes are under different routers in the configuration, then peer service routes will be generated.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="azure-load-balancer-config-generation"></a>Azure Load Balancer Config Generation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#azure-load-balancer-config-generation" title="Direct link to heading">#</a></h3><p>If the <code>solution-type</code> of a group is <code>azure-lb</code>, then the plugin will generate services and service routes to route the http probes down into the <code>cloud-ha</code> interface for the Azure Load Balancer API Agent to respond to. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="troubleshooting"></a>Troubleshooting<a aria-hidden="true" tabindex="-1" class="hash-link" href="#troubleshooting" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration-generation"></a>Configuration Generation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration-generation" title="Direct link to heading">#</a></h3><p>The <code>/var/log/128technology/persistentDataManager.log</code> file at trace level will hold whether the configuration generation was run as well as output and return code.
Configuration generation logs can be found on the conductor under <code>/var/log/128technology/plugins/cloud-ha-config-generation.log</code>.</p><p>Additional configuration validation is done without causing a traditional validation error. These validation rules will cause the configuration generation to fail for just that group. If the configuration generation is not generating what is expected, then check <code>/var/log/128technology/plugins/cloud-ha-config-generation.log</code> for validation errors similar to these:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">2020-10-09 19:54:21,190: ERROR - Validation errors occurred:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Group group1 does not have unique priorities across members: {&#x27;node2 router2&#x27;: &#x27;2&#x27;, &#x27;node1 router1&#x27;: &#x27;2&#x27;}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logging"></a>Logging<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logging" title="Direct link to heading">#</a></h3><p>The different services on the router all log to the files captured by the glob <code>/var/log/128technology/plugins/cloud-ha-*.log</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="pcli-enhancements"></a>PCLI Enhancements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#pcli-enhancements" title="Direct link to heading">#</a></h3><p>To check the state of the Cloud HA solution running on the router, the plugin adds output to the  <code>show device-interface</code> command for the <code>cloud-ha</code> interface. This state information is also accessible from the 128T&#x27;s public REST API with a <code>GET</code> on <code>/api/v1/router/&lt;router&gt;/node/&lt;node&gt;/cloud-ha/state</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="state-fields"></a>State Fields<a aria-hidden="true" tabindex="-1" class="hash-link" href="#state-fields" title="Direct link to heading">#</a></h4><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>is-active</td><td>Whether the HA Agent considers itself active.</td></tr><tr><td>last-activity-change</td><td>The timestamp of the last time the node called the became active or became inactive API on the API Agent.</td></tr><tr><td>first-active-interface</td><td>The name of the first interface from the list of <code>redundant-interface</code>s that is healthy.</td></tr><tr><td>first-active-mac-address</td><td>The mac address of the first interface from the list of <code>redundant-interface</code>s that is healthy.</td></tr><tr><td>prefixes</td><td>The list of configured prefixes. See <code>Address Prefixes</code>.</td></tr><tr><td>local-status</td><td>The understood state of the local node.</td></tr><tr><td>remote-status</td><td>The understood state of the remote node.</td></tr></tbody></table><p>Example output for the <code>azure-vnet</code> solution:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># show device-interface name cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">======================================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> node1.router1:cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">======================================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Type:                host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Forwarding:          true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Mode:                host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> MAC Address:         92:39:db:ab:fa:e4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Admin Status:        up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Operational Status:  up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Redundancy Status:   non-redundant</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Speed:               1 Gb/s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Duplex:              full</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> in-octets:                     5653457</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> in-unicast-pkts:                 57794</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> in-errors:                           0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> out-octets:                    5648738</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> out-unicast-pkts:                57863</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> out-errors:                          0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Cloud HA:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     is-active:       True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     last-activity-change:Mon 2020-10-05 19:07:42 UTC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     first-active-interface:private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     first-active-mac-address:00:0d:3a:4e:17:b7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     prefixes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     local-status:    healthy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     remote-status:   healthy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 1.67 seconds</span></div></div></div></div></div><p>Example output for the <code>azure-lb</code> solution:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># show device-interface name cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">======================================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> node1.router1:cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">======================================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Type:                host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Forwarding:          true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Mode:                host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> MAC Address:         92:39:db:ab:fa:e4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Admin Status:        up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Operational Status:  up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Redundancy Status:   non-redundant</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Speed:               1 Gb/s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Duplex:              full</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> in-octets:                     6126820</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> in-unicast-pkts:                 62630</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> in-errors:                           0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> out-octets:                    6120618</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> out-unicast-pkts:                62701</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> out-errors:                          0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Cloud HA:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     is-active:       True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     last-activity-change:Mon 2020-10-05 20:18:15 UTC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     first-active-interface:private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     first-active-mac-address:00:0d:3a:4e:17:b7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     prefixes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     local-status:    healthy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     remote-status:   healthy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 1.72 seconds</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="systemd-services"></a>Systemd Services<a aria-hidden="true" tabindex="-1" class="hash-link" href="#systemd-services" title="Direct link to heading">#</a></h3><ul><li><code>128T-telegraf@cloud_ha_health</code>: the instance of the monitoring agent that produces the health statuses</li><li><code>128T-cloud-ha</code>: the decision making Cloud HA Agent</li><li><code>128T-azure-lb</code> and <code>128T-azure-lb-nginx</code>: the <code>azure-lb</code> specific services</li><li><code>128T-azure-api</code>: the <code>azure-vnet</code> specific service</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="manual-failover"></a>Manual Failover<a aria-hidden="true" tabindex="-1" class="hash-link" href="#manual-failover" title="Direct link to heading">#</a></h3><p>This should only be done in an emergency, but if the plugin is not behaving as expected, there is a script to manually set the activity status of the nodes. First you need to disable the HA Agents by running <code>/usr/bin/t128_cloud_ha_controller disable</code> on both nodes. This step disables the automatic API calls of the HA Agent to ensure that the following manual changes will not be overridden. Then you can run <code>/usr/bin/t128_cloud_ha_controller become-active</code> to become active and <code>/usr/bin/t128_cloud_ha_controller become-inactive</code> to become inactive. The commands should be done together at the most similar time as possible to minimize convergence time. It is better to perform the <code>become-active</code> first to allow traffic and then <code>become-inactive</code> second to disallow traffic. The HA Agents can be re-enabled with the command <code>/usr/bin/t128_cloud_ha_controller enable</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="alarms"></a>Alarms<a aria-hidden="true" tabindex="-1" class="hash-link" href="#alarms" title="Direct link to heading">#</a></h3><p>If the Cloud HA Agent does not come up cleanly or fails for a prolonged period of time, the <code>cloud-ha</code> interface will become operationally down. An alarm will be created when this happens.</p><p>Example output when the agent did not come up cleanly:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-admin@combo-west.RTR_WEST_COMBO# codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Tue 2020-10-09 16:42:50 UTC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">============== ===================== ========== ============= =========== ======================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ID             Time                  Severity   Source        Category    Message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">============== ===================== ========== ============= =========== ======================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> combo-west:8   2020-06-30 16:32:42   critical   unavailable   interface   Intf cloud-ha (4) operationally down</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">There are 0 shelved alarms</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.10 seconds</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="router-version-incompatibility"></a>Router Version Incompatibility<a aria-hidden="true" tabindex="-1" class="hash-link" href="#router-version-incompatibility" title="Direct link to heading">#</a></h3><p>As mentioned in the <code>Version Restrictions</code> section, the router component of the plugin will only install on 128T versions which support the provisional device interface state. This will be apparent to the user if the router component is not being setup and <code>show assets</code> indicates an error similar to:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Problem: conflicting requests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - nothing provides 128T-device-interface-api(1.0) needed by 128T-cloud-ha-router-1.1.0-1.x86_64</span></div></div></div></div></div><p>The router will need to be upgraded to a compatible version. Compatible versions can be listed with  <code>dnf list --whatprovides 128T-device-interface-api(1.0)</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="appendix"></a>Appendix<a aria-hidden="true" tabindex="-1" class="hash-link" href="#appendix" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="health-status-transport-1"></a>Health Status Transport<a aria-hidden="true" tabindex="-1" class="hash-link" href="#health-status-transport-1" title="Direct link to heading">#</a></h3><p>With the example configuration, we will generate the services below:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">service                 cloud-ha-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name                  cloud-ha-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    applies-to            router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router-name  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router-name  router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    address               169.254.180.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy         cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        source      cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service                 cloud-ha-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name                  cloud-ha-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    applies-to            router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router-name  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router-name  router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    address               169.254.180.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy         cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        source      cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Corresponding service routes to route them into the <code>cloud-ha</code> interface will be generated.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">router router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    service-route        cloud-ha-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name          cloud-ha-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-name  cloud-ha-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        nat-target    169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">router router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    service-route        cloud-ha-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name          cloud-ha-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-name  cloud-ha-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        nat-target    169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><p>If the two nodes are under different routers in the configuration, this would produce service routes:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">router router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    service-route        cloud-ha-peer-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name          cloud-ha-peer-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-name  cloud-ha-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        peer          router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">router router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    service-route        cloud-ha-peer-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name          cloud-ha-peer-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-name  cloud-ha-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        peer          router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="azure-loadbalancer-configuration-generation"></a>Azure Loadbalancer Configuration Generation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#azure-loadbalancer-configuration-generation" title="Direct link to heading">#</a></h3><p>With the example configuration, this would result in the following services being generated:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">service                 cloud-ha-lb-probe-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name                  cloud-ha-lb-probe-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    applies-to            router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router-name  router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    transport             tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        protocol    tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        port-range  12801</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            start-port  12801</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    address               1.1.1.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy         private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        source      private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service                 cloud-ha-lb-probe-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name                  cloud-ha-lb-probe-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    applies-to            router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router-name  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    transport             tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        protocol    tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        port-range  12801</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            start-port  12801</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    address               1.1.1.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    access-policy         private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        source      private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><p>There would also be corresponding service routes generated:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">router router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    service-route        cloud-ha-lb-probe-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name          cloud-ha-lb-probe-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-name  cloud-ha-lb-probe-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        nat-target    169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">router router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    service-route        cloud-ha-lb-probe-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name          cloud-ha-lb-probe-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service-name  cloud-ha-lb-probe-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        nat-target    169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="complete-example-configuration"></a>Complete Example Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#complete-example-configuration" title="Direct link to heading">#</a></h3><p>Below is an example of a complete, but minimal configuration entered by the user.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>This example configuration is good to understand all of the concepts but should not be used on a system as is.</p></div></div><p>This example uses <code>azure-lb</code> since it results in a superset of the configuration generated <code>azure-vnet</code>. If you are interested in <code>azure-vnet</code>, then ignore the probe-specific services and service routes in the generated config.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cloud-redundandy-group group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            solution-type azure-lb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router               router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  privateintf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name          privateintf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant        private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address       1.1.1.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     1.1.1.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        1.1.1.3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          intracloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               intracloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  intracloudintf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name          intracloudintf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        inter-router-security internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        neighborhood intracloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            name intracloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            topology mesh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address       2.2.2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     2.2.2.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        2.2.2.3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                cloud-redundancy-membership group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    cloud-redundancy-group group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    priority 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    redundant-interface private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router               router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  privateintf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name          privateintf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant        private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address       1.1.1.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     1.1.1.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        1.1.1.3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface          intracloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               intracloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  intracloudintf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name          intracloudintf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        inter-router-security internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        neighborhood intracloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            name intracloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            topology mesh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address       2.2.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     2.2.2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        2.2.2.3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                cloud-redundancy-membership group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    cloud-redundancy-group group1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    priority 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    redundant-interface private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><p>Upon commit, the plugin will generate other configuration as shown below:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        tenant                  cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name         cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            description  &quot;Auto-generated tenant for cloud ha&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface             cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    description        &quot;Auto-generated host KNI interface for cloud ha&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  cloud-ha-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name        cloud-ha-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        type        external</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant      cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address     169.254.137.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     169.254.137.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  30</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        cloud-ha-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          cloud-ha-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  cloud-ha-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                nat-target    169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        cloud-ha-peer-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          cloud-ha-peer-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  cloud-ha-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                peer          router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        cloud-ha-lb-probe-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          cloud-ha-lb-probe-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  cloud-ha-lb-probe-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                nat-target    169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface             cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    description        &quot;Auto-generated host KNI interface for cloud ha&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    type               host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  cloud-ha-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name        cloud-ha-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        type        external</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant      cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat  true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        address     169.254.137.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            ip-address     169.254.137.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            prefix-length  30</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            gateway        169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        cloud-ha-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          cloud-ha-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  cloud-ha-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                nat-target    169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        cloud-ha-peer-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          cloud-ha-peer-service-route-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  cloud-ha-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                peer          router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route        cloud-ha-lb-probe-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          cloud-ha-lb-probe-service-route-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  cloud-ha-lb-probe-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                nat-target    169.254.137.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service                 cloud-ha-lb-probe-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  cloud-ha-lb-probe-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to            router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  12801</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  12801</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address               1.1.1.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service                 cloud-ha-lb-probe-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  cloud-ha-lb-probe-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to            router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport             tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  12801</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  12801</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address               1.1.1.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service                 cloud-ha-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  cloud-ha-service-group1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to            router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address               169.254.180.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service                 cloud-ha-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name                  cloud-ha-service-group1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            applies-to            router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                type         router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                router-name  router2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            security              internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address               169.254.180.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy         cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      cloud-ha</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            share-service-routes  false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="release-notes"></a>Release Notes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#release-notes" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="release-300"></a>Release 3.0.0<a aria-hidden="true" tabindex="-1" class="hash-link" href="#release-300" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="issues-fixed"></a>Issues Fixed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#issues-fixed" title="Direct link to heading">#</a></h4><ul><li><strong>PLUGIN-768</strong> Support the Cloud HA plugin in 128T versions <code>5.1.0</code> and greater.</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-09T14:45:04.000Z" class="docLastUpdatedAt_217_">4/9/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/plugin_bgp_community_services"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« BGP Community Services Plugin</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/plugin_dns_app_id"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DNS App Id Plugin Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#supported-solutions" class="table-of-contents__link">Supported Solutions</a></li><li><a href="#version-restrictions" class="table-of-contents__link">Version Restrictions</a></li><li><a href="#plugin-behavior" class="table-of-contents__link">Plugin Behavior</a><ul><li><a href="#monitoring-agent" class="table-of-contents__link">Monitoring Agent</a></li><li><a href="#ha-agent" class="table-of-contents__link">HA Agent</a></li><li><a href="#api-agents" class="table-of-contents__link">API Agents</a></li></ul></li><li><a href="#scenarios" class="table-of-contents__link">Scenarios</a><ul><li><a href="#both-healthy" class="table-of-contents__link">Both Healthy</a></li><li><a href="#primary-failure" class="table-of-contents__link">Primary Failure</a></li><li><a href="#primary-recovery" class="table-of-contents__link">Primary Recovery</a></li><li><a href="#secondary-failure" class="table-of-contents__link">Secondary Failure</a></li><li><a href="#secondary-recovery" class="table-of-contents__link">Secondary Recovery</a></li><li><a href="#primary-shutdown" class="table-of-contents__link">Primary Shutdown</a></li><li><a href="#secondary-shutdown" class="table-of-contents__link">Secondary Shutdown</a></li><li><a href="#split-brain" class="table-of-contents__link">Split Brain</a></li><li><a href="#split-brain-resolution" class="table-of-contents__link">Split Brain Resolution</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link">Configuration</a><ul><li><a href="#groups" class="table-of-contents__link">Groups</a></li><li><a href="#membership" class="table-of-contents__link">Membership</a></li><li><a href="#address-prefixes" class="table-of-contents__link">Address Prefixes</a></li></ul></li><li><a href="#generated-128t-configuration" class="table-of-contents__link">Generated 128T Configuration</a><ul><li><a href="#validation" class="table-of-contents__link">Validation</a></li><li><a href="#configuration-assumptions" class="table-of-contents__link">Configuration Assumptions</a></li><li><a href="#cloud-ha-loopback-interface" class="table-of-contents__link">Cloud HA Loopback Interface</a></li><li><a href="#health-status-transport" class="table-of-contents__link">Health Status Transport</a></li><li><a href="#azure-load-balancer-config-generation" class="table-of-contents__link">Azure Load Balancer Config Generation</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link">Troubleshooting</a><ul><li><a href="#configuration-generation" class="table-of-contents__link">Configuration Generation</a></li><li><a href="#logging" class="table-of-contents__link">Logging</a></li><li><a href="#pcli-enhancements" class="table-of-contents__link">PCLI Enhancements</a></li><li><a href="#systemd-services" class="table-of-contents__link">Systemd Services</a></li><li><a href="#manual-failover" class="table-of-contents__link">Manual Failover</a></li><li><a href="#alarms" class="table-of-contents__link">Alarms</a></li><li><a href="#router-version-incompatibility" class="table-of-contents__link">Router Version Incompatibility</a></li></ul></li><li><a href="#appendix" class="table-of-contents__link">Appendix</a><ul><li><a href="#health-status-transport-1" class="table-of-contents__link">Health Status Transport</a></li><li><a href="#azure-loadbalancer-configuration-generation" class="table-of-contents__link">Azure Loadbalancer Configuration Generation</a></li><li><a href="#complete-example-configuration" class="table-of-contents__link">Complete Example Configuration</a></li></ul></li><li><a href="#release-notes" class="table-of-contents__link">Release Notes</a><ul><li><a href="#release-300" class="table-of-contents__link">Release 3.0.0</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright Â© 2021 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/styles.acd3c316.js"></script>
<script src="/runtime~main.4739cbad.js"></script>
<script src="/main.ec60010b.js"></script>
<script src="/1.e75df5ca.js"></script>
<script src="/2.3e8767f9.js"></script>
<script src="/156.2fcae726.js"></script>
<script src="/159.6cd6c5f0.js"></script>
<script src="/935f2afb.60f41bfb.js"></script>
<script src="/17896441.94eee8a0.js"></script>
<script src="/7fa6ed4f.378bf357.js"></script>
</body>
</html>