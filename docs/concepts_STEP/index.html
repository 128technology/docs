<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts_STEP" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Service and Topology Exchange Protocol (STEP) | SSN Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.128technology.com/docs/concepts_STEP"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Service and Topology Exchange Protocol (STEP) | SSN Docs"><meta data-rh="true" name="description" content="Because networks are constantly changing, services and service reachability information need to be dynamically exchanged between routers. Services are defined to represent the capabilities that the network is designed to deliver to consumers. These services, along with their requisite policies and characteristics, dictate how the traffic patterns traverse the network."><meta data-rh="true" property="og:description" content="Because networks are constantly changing, services and service reachability information need to be dynamically exchanged between routers. Services are defined to represent the capabilities that the network is designed to deliver to consumers. These services, along with their requisite policies and characteristics, dictate how the traffic patterns traverse the network."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.128technology.com/docs/concepts_STEP"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/concepts_STEP" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.128technology.com/docs/concepts_STEP" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/kb/rss.xml" title="SSR Knowledge Base Articles RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/kb/atom.xml" title="SSR Knowledge Base Articles Atom Feed">
<link rel="alternate" type="application/json" href="/kb/feed.json" title="SSR Knowledge Base Articles JSON Feed"><link rel="stylesheet" href="/assets/css/styles.b50a304b.css">
<script src="/assets/js/runtime~main.55e822d6.js" defer="defer"></script>
<script src="/assets/js/main.ecb6bbfb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a class="navbar__item navbar__link" href="/kb">Knowledge Base</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Service and Topology Exchange Protocol (STEP)</h1></header><p>Because networks are constantly changing, services and service reachability information need to be dynamically exchanged between routers. Services are defined to represent the capabilities that the network is designed to deliver to consumers. These services, along with their requisite policies and characteristics, dictate how the traffic patterns traverse the network.</p>
<p>Service and Topology Exchange Protocol (STEP) provides a way to achieve service availability through a central repository. STEP helps network administrators easily design and scale existing or new networks and provide insight into the service availability across the whole network.</p>
<p>The <strong>STEP Repository</strong> is built upon a highly efficient and scalable in-memory database. There is no business logic in the STEP repository itself; all of the routing decisions (both client publishing routing data, and the client using the data to perform path computations) are performed on each router.</p>
<p>Routers participating in a STEP-enabled network publish information about services, peer connections, and link state in a JSON encoded document called the STEP document. This information is used by all routers to intelligently route traffic to services and react to network changes. The STEP repository can also be used by service providers to advertise service information from their networks/authority.</p>
<p>A router supporting STEP publishes a document to the STEP repository. To enable optimal routing decisions in the network, routers need to advertise the peer path SLA metrics in their STEP router document and publish that to the STEP repository. Much of the router document content is expected to be stable and only need occasional updates (such as the operational status of a peer path changing from “up” to “down” or vice versa).</p>
<p>However, the peer path metrics can change constantly, multiple times per minute. These loss, latency and jitter metrics are measured at every BFD link test interval (10 seconds by default), so advertising them frequently represents a scaling problem. In general, a router will update its router document and publish it as soon as a relevant change has occurred. But updating the peer path metrics requires a damping mechanism. This guide describes the processing pipeline that receives the raw metric update stream from BFD and transforms it into a manageable series of STEP router document updates.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="calculating-the-weighted-moving-average-wma">Calculating the Weighted Moving Average (WMA)<a href="#calculating-the-weighted-moving-average-wma" class="hash-link" aria-label="Direct link to Calculating the Weighted Moving Average (WMA)" title="Direct link to Calculating the Weighted Moving Average (WMA)">​</a></h3>
<p>The peer path SLA metrics originate from BFD and are individually generated for each peer path on the router. By default, this happens every 13s. The metrics are:</p>
<ul>
<li>loss (as a percentage)</li>
<li>latency (in ms)</li>
<li>jitter (in ms)</li>
</ul>
<p>These metrics need to be advertised in the STEP router document, but at a lower frequency. In support of that, a moving average calculation is performed to smooth out brief spikes. The moving average is weighted towards the most recent values, and the sample size for the moving average is configurable. The default sample size is 3. The WMA parameters can be configured by neighborhood. For a configuration example, see <a href="/docs/config_STEP#configuring-peer-path-advertisement-settings">Configuring Peer Path Advertisement Settings</a>. For a list and description of the configuration elements, see <a href="/docs/config_reference_guide#step-peer-path-advertisement-neighborhood"><code>step-peer-path-advertisement (neighborhood)</code></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="determining-the-reporting-delay">Determining the Reporting Delay<a href="#determining-the-reporting-delay" class="hash-link" aria-label="Direct link to Determining the Reporting Delay" title="Direct link to Determining the Reporting Delay">​</a></h3>
<p>In order to determine how quickly a metric change needs to be advertised, the latest SLA metrics coming out of the WMA calculation are compared against the values most recently advertised in the router document. The result is a percentage increase or decrease for each of the three metric types. The largest percentage increase and the largest percentage decrease are chosen from the three percentage values. The Reporting Delay parameters can be configured by neighborhood, as shown in the link above.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="threshold-values">Threshold Values<a href="#threshold-values" class="hash-link" aria-label="Direct link to Threshold Values" title="Direct link to Threshold Values">​</a></h4>
<p>A 100% change from 1ms latency to 2ms latency versus a 100% change from 100ms to 200ms is qualitatively different. Threshold values for the three metric types can be configured that set a “noise floor”. Changes in value below the threshold are considered trivial and don’t contribute to the percentage increase/decrease calculation. Before calculating the change, both the previously advertised metric values and the latest WMA metric values are raised up to the threshold (if they are below). The comparison is then done on those resulting values.</p>
<p>The default thresholds are:</p>
<ul>
<li>Loss = 1%</li>
<li>Latency = 5ms</li>
<li>Jitter = 2ms</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mapping-from-percentage-change-to-resulting-reporting-delay">Mapping from Percentage Change to Resulting Reporting Delay<a href="#mapping-from-percentage-change-to-resulting-reporting-delay" class="hash-link" aria-label="Direct link to Mapping from Percentage Change to Resulting Reporting Delay" title="Direct link to Mapping from Percentage Change to Resulting Reporting Delay">​</a></h4>
<p>After computing the largest increase and largest decrease percentage, those values then get mapped to a reporting delay value (measured in seconds). By delaying the report of a small change, the router document update gets deferred to a later time, when the metric might have already changed back to its previously advertised value. In that case, the router document update would be avoided completely.</p>
<p>As new moving average values come in, the delay gets re-evaluated, always comparing the latest WMA against the values in the most recent router document advertisement. The reference point from which the delay will be applied is the earliest time a change was detected after the most recent router document advertisement. That way the reporting of the metric change does not get delayed indefinitely.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="consolidating-individual-updates-into-router-document-updates">Consolidating Individual Updates Into Router Document Updates<a href="#consolidating-individual-updates-into-router-document-updates" class="hash-link" aria-label="Direct link to Consolidating Individual Updates Into Router Document Updates" title="Direct link to Consolidating Individual Updates Into Router Document Updates">​</a></h3>
<p>After waiting for the computed delay, a peer path metric change is ready to be included in the next router document update. Ideally that should happen right away in order to get the information out. But there can be multiple peer path metric changes, each with their own reporting delay, resulting in different points in time when they are ready to be advertised in the router document.
To consolidate this into a small number of router document updates, an overall rate limit is imposed on the router document updates. The configurable parameters are:</p>
<ul>
<li>Average interval (in seconds) between router document peer path metric updates (default is 3 minutes).</li>
<li>Burst size, measured in how many updates may happen in bursts faster than the average interval (default is 2).</li>
</ul>
<p>Additionally, the burst rate is configurable. That is the smallest possible interval between two consecutive router document peer path metric updates. The default is 30 seconds. The end effect of these rate limiting measures is that “interesting” changes will get advertised immediately (if the metrics were relatively stable before), whereas in the worst case of constant major change, the router will limit itself to the average update interval (3 minutes by default).</p>
<p>For detailed information about configuring STEP please see <a href="/docs/config_STEP">Configuring STEP</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#calculating-the-weighted-moving-average-wma" class="table-of-contents__link toc-highlight">Calculating the Weighted Moving Average (WMA)</a></li><li><a href="#determining-the-reporting-delay" class="table-of-contents__link toc-highlight">Determining the Reporting Delay</a></li><li><a href="#consolidating-individual-updates-into-router-document-updates" class="table-of-contents__link toc-highlight">Consolidating Individual Updates Into Router Document Updates</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Juniper Networks, Inc.</div></div></div></footer></div>
</body>
</html>