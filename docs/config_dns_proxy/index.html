<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">DNS Proxy | 128T Docs</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="128T Docs"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="In a typical hub/spoke deployment, its very common for the WAN interfaces to have some sort of dynamic interface such as DHCP, PPPoE, LTE, etc. The 128T router can dynamically learn the DNS server address for these interfaces and can load balance DNS requests across the learned servers. The dns-proxy feature aims to provide a simple way to proxy all DNS requests originating on the LAN side to the learned server address(es) on the WAN side without having to re-configure or update client endpoints. This allows the network to better adapt to failures on the WAN interfaces while minimizing loss of connectivity from client side applications as clients can utilize the LAN address of the 128T to resolve DNS requests."><meta data-react-helmet="true" property="og:description" content="In a typical hub/spoke deployment, its very common for the WAN interfaces to have some sort of dynamic interface such as DHCP, PPPoE, LTE, etc. The 128T router can dynamically learn the DNS server address for these interfaces and can load balance DNS requests across the learned servers. The dns-proxy feature aims to provide a simple way to proxy all DNS requests originating on the LAN side to the learned server address(es) on the WAN side without having to re-configure or update client endpoints. This allows the network to better adapt to failures on the WAN interfaces while minimizing loss of connectivity from client side applications as clients can utilize the LAN address of the 128T to resolve DNS requests."><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/config_dns_proxy">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.8d924258.css">


<link rel="preload" href="/styles.ae7d4fa9.js" as="script">

<link rel="preload" href="/runtime~main.190951ee.js" as="script">

<link rel="preload" href="/main.e1f82b77.js" as="script">

<link rel="preload" href="/1.ba9e242e.js" as="script">

<link rel="preload" href="/2.d5a58239.js" as="script">

<link rel="preload" href="/30.385376cd.js" as="script">

<link rel="preload" href="/20ac7829.844769e8.js" as="script">

<link rel="preload" href="/17896441.088f1c8a.js" as="script">

<link rel="preload" href="/d9f2e9de.0b8bf83e.js" as="script">

</head>
<body>

<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/128t_black.png" alt="128 Technology Logo"><strong></strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://community.128technology.com/home">Interchange</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.128technology.com/">Company</a><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/128t_black.png" alt="128 Technology Logo"><strong></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Docs</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://community.128technology.com/home">Interchange</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://www.128technology.com/">Company</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/img/128t_black.png" alt="128 Technology Logo"><strong></strong></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes/release_notes_4.2.0">4.2.0 Release Notes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/release_notes/release_notes_4.2.1">4.2.1 Release Notes</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/CONTRIBUTING">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro_downloading">Downloading</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro_getting_started">Getting Started</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_glossary">Glossary</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/concepts_management_connections">M2M Communication</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/config_basics">Basics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_audit_log">Audit Log</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/config_tenants">Tenants</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/ts_connecting_to_routers">Connecting to Routers</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/events">Alarms and Events</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Best Practics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/bcp_conductor_deployment">Conductor Deployment</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/bcp_lte_peering">LTE Peering</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLI Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/cli_reference">Reference</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/monitoring_agent">Monitoring</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/apis_rest">REST</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/apis_netconf">NETCONF</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">DNS Proxy</h1></header><div class="markdown"><p>In a typical hub/spoke deployment, its very common for the WAN interfaces to have some sort of dynamic interface such as DHCP, PPPoE, LTE, etc. The 128T router can dynamically learn the DNS server address for these interfaces and can load balance DNS requests across the learned servers. The dns-proxy feature aims to provide a simple way to proxy all DNS requests originating on the LAN side to the learned server address(es) on the WAN side without having to re-configure or update client endpoints. This allows the network to better adapt to failures on the WAN interfaces while minimizing loss of connectivity from client side applications as clients can utilize the LAN address of the 128T to resolve DNS requests.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="overview"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#overview" title="Direct link to heading">#</a>Overview</h2><p>The common workflow for using this feature is as follows:</p><ul><li>Configure a DNS server for the LAN network(s)</li><li>Configure a DNS proxy service to match the advertisement</li><li>Configure a service-route to indicate the WAN interface(s) to be used for proxying DNS requests</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="advertise-interface-address-as-dns-server"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#advertise-interface-address-as-dns-server" title="Direct link to heading">#</a>Advertise Interface Address as DNS Server</h2><p>A key component for DNS proxy is the ability to configure a fixed address as the DNS address for the clients on the LAN. A typical choice is to use the LAN-facing 128T interface address as the DNS server address, though the feature is not limited to this choice. The selected address can either be statically configured on the clients or configured via DHCP server (either external or 128T acting as the DHCP server).</p><p>On a linux system representing a client, its <code>/etc/resolv.conf</code> file would contain similar contents:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; generated by /usr/sbin/dhclient-script</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">search openstacklocal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">nameserver 10.10.10.1</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configuring-a-dns-proxy-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-a-dns-proxy-service" title="Direct link to heading">#</a>Configuring a DNS proxy service</h2><p>The special <code>dns-proxy</code> application-type is used for creating a DNS proxy service. All other service attributes such as access-policies, service-policies, etc., are also applicable to this service. The <code>dns-proxy</code> application-type indicates to the 128T router to perform a destination NAT on the traffic when the session is created for the service.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show config running authority service lan-dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service  lan-dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name              lan-dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            transport         udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    udp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address           10.10.10.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy     lan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      lan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy     _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type  dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor#</span></div></code></pre></div><p>The example configuration captures all DNS traffic sent to address <code>10.10.10.1</code> interface as configured on the test client in the previous step. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="how-to-proxy-dns-requests-originating-from-the-linux-host-of-the-128t-router"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-proxy-dns-requests-originating-from-the-linux-host-of-the-128t-router" title="Direct link to heading">#</a>How to proxy DNS requests originating from the linux host of the 128T router</h3><p>The <code>_internal_</code> tenant has a special meaning on the 128T routers as it represents the traffic originating from the host OS of the router. When the service allows the <code>_internal_</code> tenant and a <code>service-route</code> is created for this service, the target router linux environment is automatically configured for use with the DNS proxy. The <code>/etc/resolv.conf</code> on the 128T is modified to point to a loopback address within the 128T router.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">; This file has been automatically updated by 128T - DO NOT EDIT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">nameserver 169.254.127.126</span></div></code></pre></div><p>This allows all DNS queries (for example, as a result of dnf lookups, etc.) to be intercepted by 128T router and create sessions appropriately.</p><p>Additionally, this loopback address needs to be added to <code>dns-proxy</code> service.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service  lan-dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name              lan-dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address           10.10.10.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address           169.254.127.126</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type  dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div></code></pre></div><div class="admonition admonition-note"><div class="admonition-heading"><h5><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>note</h5></div><div class="admonition-content"><p>The <code>/etc/resolv.conf</code> file can also be configured to point to the LAN interface address to achieve the same results.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configuring-service-routes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-service-routes" title="Direct link to heading">#</a>Configuring Service Route(s)</h2><p>When the service route&#x27;s next hop for the dns-proxy service points to a dynamic interface such as DHCP based interface, any learned DNS address(es) will be automatically used as destination nat target for sessions for that service. This is accomplished by populating the <code>next-hop</code> &gt; <code>target-address</code> configuration internally upon address resolution. An example of the service-route configuration is as follows:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show config running authority router router1 node node1 device-interface inband-mgmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            node  node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  inband-mgmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               inband-mgmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:00:03.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  inband-mgmt-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        name          inband-mgmt-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id     1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        conductor     true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant        wan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat    true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        host-service  ssh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            service-type  ssh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        host-service  web</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            service-type  web</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        dhcp          v4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show config running authority router router1 service-route dns-proxy-route</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        router  router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name           router1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route  dns-proxy-route</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name          dns-proxy-route</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  lan-dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      node1 inband-mgmt-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name  node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface  inband-mgmt-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    target-address 8.8.8.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor#</span></div></code></pre></div><p>A few key points about the service-route for a dns-proxy service type:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="multiple-learned-dns-addresses"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#multiple-learned-dns-addresses" title="Direct link to heading">#</a>Multiple learned DNS addresses</h3><p>If the dynamic interface learns multiple IP addresses, the 128T router will apply a round-robin load-balancing strategy amongst these IP address. Here&#x27;s how you can check the details on the learned DNS addresses.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show dhcp v4 router router1 name inband-mgmt-intf detail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Sat 2020-02-22 04:43:12 UTC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">============================================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Router</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">============================================================</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Node:                            node1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Device Interface:              inband-mgmt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Network Interface:           inband-mgmt-intf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Dhcp State:                Resolved</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          State Machine State:     Bound</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Lease Start Time:        Sat Feb 22 00:28:30 2020</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Lease Renewal Time:      Sat Feb 22 12:28:30 2020</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Lease Rebinding Time:    Sat Feb 22 18:28:30 2020</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Lease Expiration Time:   Sun Feb 23 00:28:30 2020</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Learned MTU:             0 bytes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Server Address:          192.168.1.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Dns Server Address:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - 172.20.0.100</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - 172.20.0.101</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Addresses:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Address:               192.168.1.10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Prefix Length:         24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Gateway:               192.168.1.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.14 seconds</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor#</span></div></code></pre></div><p>The following example illustrates how the round-robin strategy gets applied for load-balancing the data across multiple learned addresses for two back-to-back queries.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show sessions router router1 | grep dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Piping output...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> 745809ea-7ada-4225-a379-4159c1e226a2   fwd   lan-dns-proxy                                     lan          dpdk2            0   udp     10.10.10.11          52513   10.10.10.1               53   192.168.1.10         16398   false                     4   0 days  0:00:03</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> 745809ea-7ada-4225-a379-4159c1e226a2   rev   lan-dns-proxy                                     lan          inband-mgmt      0   udp     172.20.0.100            53   192.168.1.10          16398   0.0.0.0                  0   false                     4   0 days  0:00:03</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show sessions router router1 | grep dns-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Piping output...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> 801d9495-66a4-44cf-9eea-e22731389a95   fwd   lan-dns-proxy                                     lan          dpdk2            0   udp     10.10.10.11          44426   10.10.10.1               53   192.168.1.10         16399   false                     5   0 days  0:00:03</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> 801d9495-66a4-44cf-9eea-e22731389a95   rev   lan-dns-proxy                                     lan          inband-mgmt      0   udp     172.20.0.101            53   192.168.1.10          16399   0.0.0.0                  0   false                     5   0 days  0:00:03</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="manually-configured-target-address"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#manually-configured-target-address" title="Direct link to heading">#</a>Manually configured <code>target-address</code></h3><p>As seen in the example <a href="#Configuring-Service-Route(s)">above</a> the <code>service-route</code> &gt; <code>next-hop</code> points to a DHCP interface and also specifies <code>8.8.8.8</code> as the target-address. When this configuration is present, the learned address are combined with the statically configured address(es). Based on the previous example, this means that there will be three DNS server targes (8.8.8.8, 172.20.0.100, 172.20.0.101). This configuration also allow the user to configure a failsafe DNS server address in case the DHCP server did not provide any valid DNS server addresses.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/128technology/docs/tree/master/docs/config_dns_proxy.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-03-10T21:44:48.000Z" class="docLastUpdatedAt_1sqk">3/10/2020</time> by <strong>Michael Baj</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/config_audit_log"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Configuring Audit Logging</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/config_tenants"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Tenants »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#overview" class="contents__link">Overview</a></li><li><a href="#advertise-interface-address-as-dns-server" class="contents__link">Advertise Interface Address as DNS Server</a></li><li><a href="#configuring-a-dns-proxy-service" class="contents__link">Configuring a DNS proxy service</a><ul><li><a href="#how-to-proxy-dns-requests-originating-from-the-linux-host-of-the-128t-router" class="contents__link">How to proxy DNS requests originating from the linux host of the 128T router</a></li></ul></li><li><a href="#configuring-service-routes" class="contents__link">Configuring Service Route(s)</a><ul><li><a href="#multiple-learned-dns-addresses" class="contents__link">Multiple learned DNS addresses</a></li><li><a href="#manually-configured-target-address" class="contents__link">Manually configured <code>target-address</code></a></li></ul></li></ul></div></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center">Copyright © 2020 128 Technology, Inc.</div></div></footer>
</div>

<script src="/styles.ae7d4fa9.js"></script>

<script src="/runtime~main.190951ee.js"></script>

<script src="/main.e1f82b77.js"></script>

<script src="/1.ba9e242e.js"></script>

<script src="/2.d5a58239.js"></script>

<script src="/30.385376cd.js"></script>

<script src="/20ac7829.844769e8.js"></script>

<script src="/17896441.088f1c8a.js"></script>

<script src="/d9f2e9de.0b8bf83e.js"></script>


</body>
</html>