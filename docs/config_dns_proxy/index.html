<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">DNS Proxy | SSN Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.128technology.com/docs/config_dns_proxy"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="DNS Proxy | SSN Docs"><meta data-react-helmet="true" name="description" content="In a typical hub/spoke deployment, its very common for the WAN interfaces to have some sort of dynamic interface such as DHCP, PPPoE, LTE, etc. The 128T router can dynamically learn the DNS server address for these interfaces and can load balance DNS requests across the learned servers. The dns-proxy feature aims to provide a simple way to proxy all DNS requests originating on the LAN side to the learned server address(es) on the WAN side without having to re-configure or update client endpoints. This allows the network to better adapt to failures on the WAN interfaces while minimizing loss of connectivity from client side applications as clients can utilize the LAN address of the 128T to resolve DNS requests."><meta data-react-helmet="true" property="og:description" content="In a typical hub/spoke deployment, its very common for the WAN interfaces to have some sort of dynamic interface such as DHCP, PPPoE, LTE, etc. The 128T router can dynamically learn the DNS server address for these interfaces and can load balance DNS requests across the learned servers. The dns-proxy feature aims to provide a simple way to proxy all DNS requests originating on the LAN side to the learned server address(es) on the WAN side without having to re-configure or update client endpoints. This allows the network to better adapt to failures on the WAN interfaces while minimizing loss of connectivity from client side applications as clients can utilize the LAN address of the 128T to resolve DNS requests."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.128technology.com/docs/config_dns_proxy"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_dns_proxy" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.128technology.com/docs/config_dns_proxy" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.21b25f22.css">
<link rel="preload" href="/assets/js/runtime~main.485ec013.js" as="script">
<link rel="preload" href="/assets/js/main.bf52851a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Juniper Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_dark.png" alt="Juniper Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Session Smart</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro_getting_started">Docs</a><a href="https://community.juniper.net/answers/communities/community-home?CommunityKey=310d1a41-12fa-4627-9a99-880145a7c87c" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Session Smart Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.juniper.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Company<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/about_128t">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_system_reqs">Deployment Considerations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation">Installation Process</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_aws">Cloud Installations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/intro_installation_installer">Supporting Information - Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts_application_discovery">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/config_basics">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/config_basics">Configuration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_basics">Configuration Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_access_mgmt">Access Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_asset_connection_resiliency">Asset Connection Resiliency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_bgp">Configuring BGP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ospf">OSPF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dscp_steering">Configuring DSCP Steering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_vrf_learning">VRF Learning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_audit_event">Audit Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_dhcp">DHCP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/config_dns_proxy">DNS Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_forward_error_correction">Configuring Forward Error Correction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_management_over_forwarding">Management over Forwarding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_domain-based_web_filter">Web Filtering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_app_ident">Application Identification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_EthoSVR">Configuring Ethernet Over Secure Vector Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_flow_perf_mon">Inline Flow Performance Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_gre_tunnel">Native GRE Tunnels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_in-memory_metrics">In-Memory Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_nat">NAT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_rate_limiting">Rate Limiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_RBAC">Configuring Role-Based Access Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_service_health">Service Health Learning and Fault Avoidance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp">SNMP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_snmp_metrics">SNMP: User defined metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_static_hostname_mapping">Static Hostname Mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_STEP">Configuring Service and Topology Exchange Protocol (STEP)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_tenants">Tenants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_templates">Configuration Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_transport_encryption">Transport Based Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config_wan_assurance">Configuring WAN Assurance</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/config_ha">High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/sec_adaptive_encrypt">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/how_to_use_app_summary">How To</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/ts_applications">Troubleshooting</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/events_overview">Events</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/bcp_att_avpn_configuration">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cli_reference">CLI and Element Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/installer_cli_reference">Installer/Initializer Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/plugin_intro">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/release_notes_128t_5.5">Release Notes</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DNS Proxy</h1></header><p>In a typical hub/spoke deployment, its very common for the WAN interfaces to have some sort of dynamic interface such as DHCP, PPPoE, LTE, etc. The 128T router can dynamically learn the DNS server address for these interfaces and can load balance DNS requests across the learned servers. The dns-proxy feature aims to provide a simple way to proxy all DNS requests originating on the LAN side to the learned server address(es) on the WAN side without having to re-configure or update client endpoints. This allows the network to better adapt to failures on the WAN interfaces while minimizing loss of connectivity from client side applications as clients can utilize the LAN address of the 128T to resolve DNS requests.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>The common workflow for using this feature is as follows:</p><ul><li>Configure a DNS server for the LAN network(s)</li><li>Configure a DNS proxy service to match the advertisement</li><li>Configure a service-route to indicate the WAN interface(s) to be used for proxying DNS requests</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="advertise-interface-address-as-dns-server">Advertise Interface Address as DNS Server<a class="hash-link" href="#advertise-interface-address-as-dns-server" title="Direct link to heading">​</a></h2><p>A key component for DNS proxy is the ability to configure a fixed address as the DNS address for the clients on the LAN. A typical choice is to use the LAN-facing 128T interface address as the DNS server address, though the feature is not limited to this choice. The selected address can either be statically configured on the clients or configured via DHCP server (either external or 128T acting as the DHCP server).</p><p>On a linux system representing a client, its <code>/etc/resolv.conf</code> file would contain similar contents:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">; generated by /usr/sbin/dhclient-script</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">search openstacklocal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nameserver 10.10.10.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-a-dns-proxy-service">Configuring a DNS proxy service<a class="hash-link" href="#configuring-a-dns-proxy-service" title="Direct link to heading">​</a></h2><p>The special <code>dns-proxy</code> application-type is used for creating a DNS proxy service. All other service attributes such as access-policies, service-policies, etc., are also applicable to this service. The <code>dns-proxy</code> application-type indicates to the 128T router to perform a destination NAT on the traffic when the session is created for the service.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show config running authority service lan-dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  lan-dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name              lan-dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            transport         udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                protocol    udp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                port-range  53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    start-port  53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address           10.10.10.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy     lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      lan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access-policy     _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                source      _internal_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                permission  allow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type  dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The example configuration captures all DNS traffic sent to address <code>10.10.10.1</code> interface as configured on the test client in the previous step. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-proxy-dns-requests-originating-from-the-linux-host-of-the-128t-router">How to proxy DNS requests originating from the linux host of the 128T router<a class="hash-link" href="#how-to-proxy-dns-requests-originating-from-the-linux-host-of-the-128t-router" title="Direct link to heading">​</a></h3><p>The <code>_internal_</code> tenant has a special meaning on the 128T routers as it represents the traffic originating from the host OS of the router. When the service allows the <code>_internal_</code> tenant and a <code>service-route</code> is created for this service, the target router linux environment is automatically configured for use with the DNS proxy. The <code>/etc/resolv.conf</code> on the 128T is modified to point to a loopback address within the 128T router.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">; This file has been automatically updated by 128T - DO NOT EDIT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nameserver 169.254.127.126</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This allows all DNS queries (for example, as a result of dnf lookups, etc.) to be intercepted by 128T router and create sessions appropriately.</p><p>Additionally, this loopback address needs to be added to <code>dns-proxy</code> service.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service  lan-dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name              lan-dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address           10.10.10.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            address           169.254.127.126</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            application-type  dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The <code>/etc/resolv.conf</code> file can also be configured to point to the LAN interface address to achieve the same results.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-service-routes">Configuring Service Route(s)<a class="hash-link" href="#configuring-service-routes" title="Direct link to heading">​</a></h2><p>When the service route&#x27;s next hop for the dns-proxy service points to a dynamic interface such as DHCP based interface, any learned DNS address(es) will be automatically used as destination nat target for sessions for that service. This is accomplished by populating the <code>next-hop</code> &gt; <code>target-address</code> configuration internally upon address resolution. An example of the service-route configuration is as follows:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show config running authority router router1 node node1 device-interface inband-mgmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name  router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            node  node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name              node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                device-interface  inband-mgmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    name               inband-mgmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    pci-address        0000:00:03.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    network-interface  inband-mgmt-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        name          inband-mgmt-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        global-id     1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        conductor     true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        tenant        wan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        source-nat    true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        host-service  ssh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            service-type  ssh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        host-service  web</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            service-type  web</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        dhcp          v4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show config running authority router router1 service-route dns-proxy-route</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authority</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        router  router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name           router1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            service-route  dns-proxy-route</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                name          dns-proxy-route</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                service-name  lan-dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                next-hop      node1 inband-mgmt-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    node-name  node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    interface  inband-mgmt-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    target-address 8.8.8.8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A few key points about the service-route for a dns-proxy service type:</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="multiple-learned-dns-addresses">Multiple learned DNS addresses<a class="hash-link" href="#multiple-learned-dns-addresses" title="Direct link to heading">​</a></h3><p>If the dynamic interface learns multiple IP addresses, the 128T router will apply a round-robin load-balancing strategy amongst these IP address. Here&#x27;s how you can check the details on the learned DNS addresses.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show dhcp v4 router router1 name inband-mgmt-intf detail</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Sat 2020-02-22 04:43:12 UTC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Router</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">============================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Node:                            node1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Device Interface:              inband-mgmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      Network Interface:           inband-mgmt-intf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Dhcp State:                Resolved</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          State Machine State:     Bound</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Lease Start Time:        Sat Feb 22 00:28:30 2020</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Lease Renewal Time:      Sat Feb 22 12:28:30 2020</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Lease Rebinding Time:    Sat Feb 22 18:28:30 2020</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Lease Expiration Time:   Sun Feb 23 00:28:30 2020</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Learned MTU:             0 bytes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Server Address:          192.168.1.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Dns Server Address:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - 172.20.0.100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - 172.20.0.101</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Addresses:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Address:               192.168.1.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Prefix Length:         24</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Gateway:               192.168.1.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Completed in 0.14 seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The following example illustrates how the round-robin strategy gets applied for load-balancing the data across multiple learned addresses for two back-to-back queries.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show sessions router router1 | grep dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Piping output...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 745809ea-7ada-4225-a379-4159c1e226a2   fwd   lan-dns-proxy                                     lan          dpdk2            0   udp     10.10.10.11          52513   10.10.10.1               53   192.168.1.10         16398   false                     4   0 days  0:00:03</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 745809ea-7ada-4225-a379-4159c1e226a2   rev   lan-dns-proxy                                     lan          inband-mgmt      0   udp     172.20.0.100            53   192.168.1.10          16398   0.0.0.0                  0   false                     4   0 days  0:00:03</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">admin@node1.conductor# show sessions router router1 | grep dns-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Piping output...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 801d9495-66a4-44cf-9eea-e22731389a95   fwd   lan-dns-proxy                                     lan          dpdk2            0   udp     10.10.10.11          44426   10.10.10.1               53   192.168.1.10         16399   false                     5   0 days  0:00:03</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 801d9495-66a4-44cf-9eea-e22731389a95   rev   lan-dns-proxy                                     lan          inband-mgmt      0   udp     172.20.0.101            53   192.168.1.10          16399   0.0.0.0                  0   false                     5   0 days  0:00:03</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="manually-configured-target-address">Manually configured <code>target-address</code><a class="hash-link" href="#manually-configured-target-address" title="Direct link to heading">​</a></h3><p>As seen in the example <a href="#configuring-service-routes">above</a> the <code>service-route</code> &gt; <code>next-hop</code> points to a DHCP interface and also specifies <code>8.8.8.8</code> as the target-address. When this configuration is present, the learned address are combined with the statically configured address(es). Based on the previous example, this means that there will be three DNS server targes (8.8.8.8, 172.20.0.100, 172.20.0.101). This configuration also allow the user to configure a failsafe DNS server address in case the DHCP server did not provide any valid DNS server addresses.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-05-11T23:36:42.000Z">5/11/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/config_dhcp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DHCP</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/config_ldap"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">LDAP</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#advertise-interface-address-as-dns-server" class="table-of-contents__link toc-highlight">Advertise Interface Address as DNS Server</a></li><li><a href="#configuring-a-dns-proxy-service" class="table-of-contents__link toc-highlight">Configuring a DNS proxy service</a><ul><li><a href="#how-to-proxy-dns-requests-originating-from-the-linux-host-of-the-128t-router" class="table-of-contents__link toc-highlight">How to proxy DNS requests originating from the linux host of the 128T router</a></li></ul></li><li><a href="#configuring-service-routes" class="table-of-contents__link toc-highlight">Configuring Service Route(s)</a><ul><li><a href="#multiple-learned-dns-addresses" class="table-of-contents__link toc-highlight">Multiple learned DNS addresses</a></li><li><a href="#manually-configured-target-address" class="table-of-contents__link toc-highlight">Manually configured <code>target-address</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Juniper Networks, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.485ec013.js"></script>
<script src="/assets/js/main.bf52851a.js"></script>
</body>
</html>