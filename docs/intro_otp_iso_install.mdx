---
title: Router Installation Using OTP
sidebar_label: Router Installation Using OTP
---

import Flowchart from '../src/components/Flowchart';

128 Technology has a software-driven framework for rapid and dynamic deployment of network nodes across the enterprise using One Touch Provisioning (OTP). The software has been architected to enable automated deployment across a large set of scenarios, including simple, repeatable branch deployments and dynamic, scalable data center/cloud deployments. The solution may be deployed with minimal configuration using the default 128T installation process, or customized and integrated with 3rd party tools.

An important aspect of the 128 Technology OTP solution is its flexibility. When the product is deployed using the standard 128T images, many customers appreciate the simplicity of enabling an enterprise-wide SessionSmart&trade; routing fabric without investing additional time to customize the deployment. Rapid deployment of session-enabled routing, security and network visibility is the key objective.

In this deployment model, the 128T node is deployed into the production environment with no site-specific configuration during shipment of units and initial on-line state. A site configuration file is directed via the 128T for initial provisioning.

## Software Delivery Options
The simplest deployment of the 128 Technology OTP solution is highly automated and leverages just two components, the 128T Conductor and at least one 128T SessionSmart&trade; Router. For many customers, the 128T platform is ordered and delivered as a pre-integrated, off-the-shelf solution through the 128T partner network. An image leveraging QuickStart provisioning can also be deployed into a VM or cloud environment, though consideration must be made to the mechanism of injecting the file. Virtual environments may be better suited for cloud automation tools to assist in automated, dynamic deployment.

The OTP installation process produces a Router installed with 128T software set to factory defaults. Upon completing the OTP installation process, the default behavior is to provision the device to be configured with a DHCP client on the first ethernet port and DHCP server listening on all other ports. A user then connects to the 128T via ethernet cable and use the QuickStart file generated by the Conductor to finalize the 128T configuration. After performing the QuickStart operation, the 128T will have connectivity to its Conductor and can download the latest configuration (if necessary) and begin operation. These defaults [can be changed](#quickstart-location) to suit your needs.

## QuickStart Provisioning
Basic configuration parameters are encoded within an encrypted file. For each node, a custom file can be exported from the Conductor and minimally contains the following configuration encoded parameters:
- WAN IP address, subnet mask and gateway
- Conductor IP address
- Asset ID

### Disk Cloning

Disk Cloning allows you to create a generic router platform image that can be used to perform multiple installations quickly and efficiently. After the initial ISO installation and power off, the platform is generic and can be cloned to a disk to create a copy of that platform. 
:::note
When using cloned images, an identical hardware platform must be used. Create a new disk image for each hardware variation.
:::
The cloned platform disk is then used to install the filesystem and 128T software on any number of other identical hardware platforms. 

The general process for disk cloning is as follows:

1. The platform is installed using an ISO image which powers down on success.
2. Use Clonezilla or other Live USB to make a copy of the platform.
3. Distribute the cloned disk using USB, multicast, or other technique.
4. Start each platform after installation.
5. Allow each platform to bootstrap and then reboot.
6. Verify the platform validation report.xs

## Before you Begin

Before beginning the Router installation, you must have a 128T Conductor operationally deployed and reachable by the router.

This diagram is one possible topology for a standalone 128T deployed at the edge of the network.

![QuickStart network diagram](/img/intro_ztp_quickstart_network_diagram.png)

## Installing 128T with the ISO
The following procedure installs a router using the OTP ISO **for software versions of 5.0 and higher**. If you are installing or upgrading older versions of the 128T Networking Software, please refer to Legacy Installations for procedures containing the legacy UI components.

Use the arrow keys to select either `OTP Install 128T Routing Software Serial Console` or `OTP Install 128T Routing Software VGA Console`. 

![VGA Boot with OTP Install](/img/install_select_OTP.png)

:::note
Not all hardware has video support. Booting to the serial console is the default, and is automatically selected after 30 seconds. When using the serial console, the terminal size is 80x25 - anything smaller may result in abnormal navigation behavior.

Selecting the wrong type of console (Serial or VGA) may result in garbled characters being displayed, and if left to continue will result in an incorrect installation. If the wrong console is selected, reboot the target system and select the correct line for the target hardware.
::: 

The procedure that follows here is the OTP Install on the VGA Console.

#### 128T System via Serial Console

Use this option when running on hardware with no video chipset. It uses `/dev/ttyS0` as the serial console for interacting with the installer. For serial console issues please refer to [Serial Console Troubleshooting](intro_installation_bootable_media.md#serial-console-troubleshooting).

#### 128T System with VGA Console

Use this option when running on hardware that has onboard graphics chipsets. This installs 128T using the GUI installer.

### 128T Installation

After the Linux installation completes, the 128T software installation begins. Note that this may take several minutes to complete. After the installation has completed, the following screen is displayed:

![Installation Complete](/img/intro_installation_bootable_media_install_complete.png)

Shut down the system and remove the bootable media. Then power the system up to complete the installation process. 

- GUI login via HTTPS is enabled by default on port 443.

- The following user accounts and passwords are created during the ISO installation process:

   | Username | Password   | Access Scope |
   | -------- | ---------- | ------------ |
   | root     | 128tRoutes | Linux account |
   | t128     | 128tRoutes | Linux account |
   | admin | 128Tadmin | 128T PCLI admin account |
 
   It is *strongly recommended* that you change these passwords immediately.

## Initialize the 128T Node

The 128T Initializer tunes your operating system, prepares the platform to run the 128T software, and creates the bootstrapping files necessary to load the software. The Initializer is launched after the installation reboot. 

1. On the 128T Initializer wizard screen, use the space bar to select the **Router** role for the 128T node, and press the **Enter** key to select **OK**.

  ![128T Role](/img/initializer_Serial2.png)

2. For 128T routers, you will be prompted for the IP address(es) of your 128T conductor(s). If you have conductors installed and configured, enter their administrative addresses here, and this node will retrieve its configuration from the conductor. If you have only one conductor (i.e., a standalone conductor), leave the field labeled 2nd Conductor Address blank. If you have no conductors, choose **Skip**.
3. When asked _What kind of Router/Conductor node is this?_, select from the following options:

  ![Identify the Node](/img/initializer_Serial3.png)

- **Standalone:** This router has no highly available peer, and is not currently planned for high availability.

- **1st HA Node:** This router is the first node of a high availability pair. You will be prompted to provide the local IP address for this node. The 2nd HA node will contact this node at the address provided to synchronize state. Note: The 1st Node IP address must be reachable by the 2nd HA Node.
  
- **2nd HA Node:** This router is the second node of a high availability pair, where the first node has been initialized. You will be prompted to provide the 1st Node IP address for this 2nd node that will be used to synchronize state. Note: The 2nd Node IP address must be reachable by the 1st HA Node.

4. The following steps configure a high availability router node. If you are not configuring HA, you will be presented with the **Node Info** screen in step 4b. 

  a). Enter the IP address of the local HA sync interface. 

    ![High Availability IP Address](/img/initializer_Serial3HAIP.png)

  b). Enter the following system properties on the **Node Info** screen:

    ![Node Information](/img/initializer_Serial5.png)

    - **Node Name:** The name of the system within your 128T Router, for example, _router_. By default this field uses the Linux system's hostname.

    :::note
    Both routers and conductors can consist of one node (for standalone systems) or two nodes (for highly available systems).
    :::
    - **Router/Conductor Name:** The name of the Router or Conductor system as a whole. When referring to a running 128T software instance, it is identifiable by the full name of `nodeName.routerName`; e.g., `router-node1.router`. The full system name is reflected in the PCLI prompt as discussed in the Document Conventions section of this document.

  c). The initializer returns you to the **HA Setup** screen to configure the second HA node. Select **2nd HA Node** if not already selected. 

    ![2nd HA Node Setup](/img/initializer_Serial4cHANode.png)

  d). Enter the **HA Address** and **Peer HA Address** for the second node. The HA Address is the local 2nd HA Node IP address, and the Peer HA Address is the 1st HA Node IP address.

    ![2nd HA Peer IP](/img/initializer_Serial4dHANode.png)

  e). Enter the **HA Peer Credentials**. This is a one time operation for the initialization of the second HA Node with the first HA Peer. 
  
    ![HA Peer Credentials](/img/initializer_Serial4eHAPeer.png)

5. The **Advanced** button allows you to specify the number of CPU cores to be allocated for running your 128T routing software. The **Advanced** selection is only available when configuring a 128T Router. 
   :::info
   This is only recommended for experienced users. This setting is intended to optimize the forwarding capabilities of the 128T Router beyond the default settings for the target platform.
   :::

6. On the **Password Setup** screen, create a password for the 128T Admin user. The administrator password must be at least 8 characters long, contain at least 1 uppercase letter, at least 1 lowercase letter, at least 1 number, and cannot repeat characters more than 3 times.
  :::note
  Resetting a password requires entering the old password. If a password is lost or forgotten and the account is inaccessible, the account cannot be recovered. Please keep password records accessible and secure. 
  :::

  ![Password Setup](/img/initializer_Serial6.png)

7. If presented with the **Anonymous Data Collection** screen, select either **Accept** or **Disable** to enable or disable the process that measures the health of your 128T router and components.

8. Press the **Enter** key to select **OK**. The Initializer performs a hardware compatibility check. The compatibility check may fail due to warnings or failure notices, which are displayed in the output script. If no failures are present, you can choose to continue with the installation even if multiple warnings exist. For information on why a specific test may have failed or generated a warning, contact 128T technical support.

9. When prompted, either reboot your system or start 128T.

  ![Initializer Complete](/img/initializer_complete.png)

  :::note
  If installing the 128T software for the first time, a system reboot is required.
  :::

### Verify Installation

After installing the 128T Software it is important to verify that the installation was completed successfully.

#### To Verify the 128T Installation:

1. Launch a command prompt window.

2. Execute the command:

   ```
   sudo systemctl status 128T
   ```

   **Result:** The service is listed as _Active (running)_.

   If the service is listed as _Inactive_, run the `sudo systemctl start 128T` command. This may take several minutes to fully launch the service.

3. Once the service is listed as _Active_, log into the system as Admin using the system default password.

   **Result:** The installation is verified.

4. Close the command prompt window. 



## Bootstrapping

After the initial installation and poweroff, the system is generic - it has no specific configuration. Once the platform is started again, an automated script performs bootstrapping of the platform. This script is a single run service unit that executes **once** during the first bootup, and performs the following steps:

### 1. Configure Hostname and Salt Minion Identifier

The hostname and salt minion identifier are set to the same value during the bootstrapping process.

If the system serial number is provisioned (seen by `dmidecode --string system-serial-number`) this value will be used. Otherwise use the first MAC address found in the format of: `mac-<address>`

### 2. Configure the 128T and Network Interfaces

The Bootstrapper sets the 128T configuration via the QuickStart file found in one of the following locations:

- The root of an attached USB drive. i.e. `/bootstrap.quickstart`. The USB drive MUST be named "BOOTSTRAP" in all caps.

- In `/etc/128technology/bootstrap.quickstart`.

If no file source is present in either location, the Bootstrapper executes HTTP GET requests to the following endpoints to download the QuickStart File from a server. The REST response is explained in [REST details](#quickstart-file-via-rest).
    1. `http://quickstart.128t-bootstrap.local/quickstart/<identifier>`
    2. `http://192.168.128.128/quickstart/<identifier>`

The `<identifier>` is the minion-id as determined by the algorithm discussed in [Configure Hostname and Salt Minion Identifier](#configure-hostname-and-salt-minion-identifier). Typically, it is the system serial number.

If none of the above are successful, the OTP defaults are used. This configures the DHCP client on the first ethernet port and a DHCP server listening on all other ports.

### 3. Enable 128T and Salt-Minion Service

The quickstart file configures and enables the 128T Router and the associated salt-minion service.

### 4. Write a Result Report

Once the platform is rebooted after bootstrapping, the bootstrap validation report can be found at the root filesystem (`/root/128T-bootstrap.txt`) containing details about the steps taken. The `/root/128T-bootstrap.json` file contains the same information in JSON format. The report contains a message that includes additional details for each step.

Shown below is the location of the bootstrap report as well as an example of the contents.
```
[root@sn123456789 ~]# cat /root/128T-bootstrap.txt
+--------------------+--------+---------------------------------+
| Label              | Result | Message                         |
+--------------------+--------+---------------------------------+
| Minion ID          | True   | mac-000000                      |
| Hostname           | True   | mac-000000                      |
| Clock Sync         | True   |                                 |
| Initialize 128T    | True   | node.Router                     |
| Enable 128T        | True   |                                 |
| Enable salt-minion | True   |                                 |
| Factory Defaults   | True   | http://192.168.0.100/quickstart |
| Ifgcfg files       | True   |                                 |
+--------------------+--------+---------------------------------+
```

### 5. Reboot

After reboot, the 128T service will be configured and running.

:::info
It is important to note that after the OS installation the dhclient is configured across all network interfaces until the platform has completed Bootstrapping.
:::

### Scriptlets
In addition to the above steps, the Bootstrap utility supports executing pre- and post- scriptlets on a USB drive for further customization of the platform. The scriptlets will be executed as the first and last steps in the bootstrap process.

The names and locations for the scriptlets are:
* If scriptlet exists at the root of USB drive and is called “/pre-bootstrap”, it will be the first step. Otherwise use /etc/128technology/pre-bootstrap.
* If scriptlet exists at the root of USB drive and is called “/post-bootstrap”, it will be the last step. Otherwise use /etc/128technology/post-bootstrap.

:::important
The scriptlets must have executable permissions to be executed properly.
:::
Any stdout/stderr output generated from the scriptlets is logged in `/var/log/128T-bootstrap/<scriptlet-name>-scriptlet.log`.

### Bootstrapping Flow Chart
The diagram below shows the procedure the Bootstrap utility follows during the first bootup of the platform after the ISO installation completes. 

<Flowchart
  chartCode={`
    st=>start: Start
      bs=>operation: Check for Pre-Bootstrap Scriptlet
      usb1=>condition: On USB?
      def1=>condition: Default?
      es=>inputoutput: Execute Pre-Bootstrap Scriptlet
      smh=>operation: Set Minion ID\nSet Hostname\nSynchronize Clock
      sfd=>operation: Set 128T Factory Defaults
      usb2=>condition: On USB?
      def2=>condition: Default?
      rest=>condition: REST get?
      aq=>inputoutput: Apply quickstart.txt
      aotpd=>inputoutput: Apply OTP Defaults
      ist=>operation: Setup IFCFG\nEnable salt-minion\nEnable 128T
      pbs=>operation: Check for Post-Bootstrap Scriptlet
      usb3=>condition: On USB?
      def3=>condition: Default?
      es2=>inputoutput: Execute Post-Bootstrap Scriptlet
      fin=>operation: Finalize
      wbr=>subroutine: Write Bootstrap Report
      reb=>operation: Reboot
      e=>end: End
    st->bs->usb1
    usb1(no)->def1
    usb1(yes)->es
    def1(yes)->es
    def1(no)->smh
    es->smh
    smh->sfd->usb2
    usb2(no, right)->def2
    usb2(yes, right)->aq
    def2(yes)->aq
    def2(no)->rest
    rest(no)->aotpd
    rest(yes)->aq->ist
    aotpd->ist->pbs->usb3
    usb3(yes)->es2
    usb3(no)->def3
    def3(yes)->es2->fin
    def3(no)->fin
    fin->wbr->reb->e
  `}
/>

### QuickStart File via REST

If no bootstrap file is present on the USB device or disk, the Bootstrapper will execute HTTP GET requests in an attempt to download the QuickStart file from a server.

The server must respond to the HTTP GET request with valid JSON data that is of format:
```
{
  “quickstart”: “<quickstart-file-contents>”,
  “password”: “this-is-my-password”
}
```
:::important
The response must be URL-encoded, otherwise the client will not decode the data correctly.
:::

The password data within the JSON is required if the QuickStart file was encrypted when exported from the 128T Conductor.

### Testing

The Bootstrap utility provides an entrypoint to test your QuickStart Server. By executing the command below, the client makes requests to URLs and attempts to download and decode the QuickStart file. It will NOT apply the QuickStart to the platform - only test the process.
```
$ bootstrap128t rest-test -i <test-identifier>
```
Or, if you want to test a specific url:
```
$ bootstrap128t rest-test -i <test-identifier> --url <a-fully-qualified-url>
```
